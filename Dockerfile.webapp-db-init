FROM node:18-alpine

# Install system dependencies for PostgreSQL
RUN apk add --no-cache postgresql-client

# Set working directory
WORKDIR /app

# Copy package.json and install dependencies
COPY webapp/lambda/package*.json ./
RUN npm ci --only=production

# Copy initialization script
COPY webapp-db-init.js ./

# Run the initialization script
CMD ["node", "webapp-db-init.js"]