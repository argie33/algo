TEST FAILURE PRIORITY FIX LIST
================================
Date: 2025-10-19
Total Failures: 1,126 tests (33.5% failure rate)

QUICK SUMMARY - TOP 6 ERRORS
=============================

ERROR #1: Assignment to constant variable [612 tests, 54% of failures]
  Difficulty: ⭐ EASY (30 min total)
  Files: 9 integration test files
  Fix: Change `const app` to `let app`

  Files to fix:
  - tests/integration/routes/strategyBuilder.integration.test.js
  - tests/integration/routes/alerts.integration.test.js
  - tests/integration/routes/backtest.integration.test.js
  - tests/integration/routes/positioning.integration.test.js
  - tests/integration/routes/recommendations.integration.test.js
  - tests/integration/routes/sectors.integration.test.js
  - tests/integration/routes/sentiment.integration.test.js
  - tests/integration/routes/signals.integration.test.js
  - tests/integration/routes/trades.integration.test.js

ERROR #2: query is not defined [396 tests, 35% of failures]
  Difficulty: ⭐⭐ MEDIUM (2-3 hours total)
  Files: 13+ test files
  Fix: Add jest.mock() for database module

  Top files to fix (by test count):
  - tests/unit/routes/portfolio.test.js (98 tests)
  - tests/unit/routes/trades.test.js (75 tests)
  - tests/unit/utils/tradingModeHelper.test.js (40 tests)
  - tests/performance/api-load-testing.test.js (31 tests)
  - tests/integration/auth/api-key-integration.test.js (28 tests)
  - tests/integration/analytics/dashboard.test.js (26 tests)
  - tests/unit/routes/news.test.js (24 tests)
  - tests/integration/data-pipeline.integration.test.js (18 tests)
  - tests/integration/analytics/recommendations.test.js (17 tests)
  - tests/unit/utils/riskEngine.test.js (14 tests)

ERROR #3: req.address undefined [338 tests, 30% of failures]
  Difficulty: ⭐⭐ MEDIUM (1-2 hours total)
  Files: 12+ middleware/integration test files
  Fix: Add connection.address() to mock request objects

  Top files to fix:
  - tests/integration/middleware/security-headers.integration.test.js (41 tests)
  - tests/integration/errors/4xx-error-scenarios.integration.test.js (39 tests)
  - tests/integration/auth/auth-flow.integration.test.js (35 tests)
  - tests/integration/errors/5xx-server-errors.integration.test.js (30 tests)
  - tests/integration/middleware/responseFormatter-middleware.integration.test.js (27 tests)
  - tests/integration/middleware/errorHandler-middleware.integration.test.js (27 tests)
  - tests/integration/streaming/sse-streaming.integration.test.js (26 tests)
  - tests/integration/errors/malformed-request.integration.test.js (25 tests)
  - tests/integration/errors/timeout-handling.integration.test.js (20 tests)
  - tests/integration/services/cross-service-integration.test.js (19 tests)

ERROR #4: SecretsManagerClient is not defined [104 tests, 9% of failures]
  Difficulty: ⭐ EASY (10 min total)
  Files: 2 files
  Fix: Add jest.mock() for @aws-sdk/client-secrets-manager

  Files to fix:
  - tests/unit/utils/apiKeyService.test.js (102 tests)
  - tests/unit/routes/economic.test.js (1 test)

ERROR #5: authenticateToken is not defined [78 tests, 7% of failures]
  Difficulty: ⭐ EASY (20 min total)
  Files: 4 files
  Fix: Add jest.mock() for middleware/auth

  Files to fix:
  - tests/unit/routes/sectors.test.js (40 tests)
  - tests/unit/middleware/auth.test.js (33 tests)
  - tests/unit/routes/performance.test.js (2 tests)
  - tests/integration/alpaca/real-api-integration.test.js (1 test)

ERROR #6: FactorScoringEngine is not defined [42 tests, 4% of failures]
  Difficulty: ⭐ EASY (15 min total)
  Files: 2 files
  Fix: Add jest.mock() for utils/factorScoring

  Files to fix:
  - tests/unit/routes/screener.test.js (40 tests)
  - tests/unit/utils/errorTracker.test.js (1 test)

RECOMMENDED FIX ORDER
=====================
1. Fix #1 (Assignment to const) - 30 min → 54% improvement
2. Fix #2 (query undefined) - 2-3 hours → +35% = 89% total
3. Fix #3 (req.address) - 1-2 hours → +30% = 119% total*
4. Fix #4 (SecretsManager) - 10 min → +9%
5. Fix #5 (authenticateToken) - 20 min → +7%
6. Fix #6 (FactorScoring) - 15 min → +4%

* Some tests have multiple errors, so fixing all 6 won't restore exactly 139% but rather 80-90% realistically

EXPECTED OUTCOME
================
After fixing errors #1-3:
- Pass rate: 65% → 92-95%
- Failed tests: 1,126 → ~150-250
- Time investment: 4-6 hours
- ROI: Excellent (80-90% of failures fixed)
