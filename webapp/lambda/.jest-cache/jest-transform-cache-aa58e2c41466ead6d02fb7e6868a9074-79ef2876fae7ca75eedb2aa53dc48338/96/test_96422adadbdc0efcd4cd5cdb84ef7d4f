267a00b733e4c9fe0aec1211c5fe4891
'use strict';

/**
 * Module dependencies.
 */
const {
  inspect
} = require('util');
const {
  STATUS_CODES
} = require('http');
const {
  Server
} = require('tls');
const {
  deepStrictEqual
} = require('assert');
const {
  Request
} = require('superagent');

/** @typedef {import('superagent').Response} Response */

class Test extends Request {
  /**
   * Initialize a new `Test` with the given `app`,
   * request `method` and `path`.
   *
   * @param {Server} app
   * @param {String} method
   * @param {String} path
   * @api public
   */
  constructor(app, method, path) {
    super(method.toUpperCase(), path);
    this.redirects(0);
    this.buffer();
    this.app = app;
    this._asserts = [];
    this.url = typeof app === 'string' ? app + path : this.serverAddress(app, path);
  }

  /**
   * Returns a URL, extracted from a server.
   *
   * @param {Server} app
   * @param {String} path
   * @returns {String} URL address
   * @api private
   */
  serverAddress(app, path) {
    const addr = app.address();
    if (!addr) this._server = app.listen(0);
    const port = app.address().port;
    const protocol = app instanceof Server ? 'https' : 'http';
    return protocol + '://127.0.0.1:' + port + path;
  }

  /**
   * Expectations:
   *
   *   .expect(200)
   *   .expect(200, fn)
   *   .expect(200, body)
   *   .expect('Some body')
   *   .expect('Some body', fn)
   *   .expect(['json array body', { key: 'val' }])
   *   .expect('Content-Type', 'application/json')
   *   .expect('Content-Type', 'application/json', fn)
   *   .expect(fn)
   *   .expect([200, 404])
   *
   * @return {Test}
   * @api public
   */
  expect(a, b, c) {
    // callback
    if (typeof a === 'function') {
      this._asserts.push(wrapAssertFn(a));
      return this;
    }
    if (typeof b === 'function') this.end(b);
    if (typeof c === 'function') this.end(c);

    // status
    if (typeof a === 'number') {
      this._asserts.push(wrapAssertFn(this._assertStatus.bind(this, a)));
      // body
      if (typeof b !== 'function' && arguments.length > 1) {
        this._asserts.push(wrapAssertFn(this._assertBody.bind(this, b)));
      }
      return this;
    }

    // multiple statuses
    if (Array.isArray(a) && a.length > 0 && a.every(val => typeof val === 'number')) {
      this._asserts.push(wrapAssertFn(this._assertStatusArray.bind(this, a)));
      return this;
    }

    // header field
    if (typeof b === 'string' || typeof b === 'number' || b instanceof RegExp) {
      this._asserts.push(wrapAssertFn(this._assertHeader.bind(this, {
        name: '' + a,
        value: b
      })));
      return this;
    }

    // body
    this._asserts.push(wrapAssertFn(this._assertBody.bind(this, a)));
    return this;
  }

  /**
   * Defer invoking superagent's `.end()` until
   * the server is listening.
   *
   * @param {Function} fn
   * @api public
   */
  end(fn) {
    const server = this._server;
    super.end((err, res) => {
      const localAssert = () => {
        this.assert(err, res, fn);
      };
      if (server && server._handle) return server.close(localAssert);
      localAssert();
    });
    return this;
  }

  /**
   * Perform assertions and invoke `fn(err, res)`.
   *
   * @param {?Error} resError
   * @param {Response} res
   * @param {Function} fn
   * @api private
   */
  assert(resError, res, fn) {
    let errorObj;

    // check for unexpected network errors or server not running/reachable errors
    // when there is no response and superagent sends back a System Error
    // do not check further for other asserts, if any, in such case
    // https://nodejs.org/api/errors.html#errors_common_system_errors
    const sysErrors = {
      ECONNREFUSED: 'Connection refused',
      ECONNRESET: 'Connection reset by peer',
      EPIPE: 'Broken pipe',
      ETIMEDOUT: 'Operation timed out'
    };
    if (!res && resError) {
      if (resError instanceof Error && resError.syscall === 'connect' && Object.getOwnPropertyNames(sysErrors).indexOf(resError.code) >= 0) {
        errorObj = new Error(resError.code + ': ' + sysErrors[resError.code]);
      } else {
        errorObj = resError;
      }
    }

    // asserts
    for (let i = 0; i < this._asserts.length && !errorObj; i += 1) {
      errorObj = this._assertFunction(this._asserts[i], res);
    }

    // set unexpected superagent error if no other error has occurred.
    if (!errorObj && resError instanceof Error && (!res || resError.status !== res.status)) {
      errorObj = resError;
    }
    fn.call(this, errorObj || null, res);
  }

  /**
   * Perform assertions on a response body and return an Error upon failure.
   *
   * @param {Mixed} body
   * @param {Response} res
   * @return {?Error}
   * @api private
   */ // eslint-disable-next-line class-methods-use-this
  _assertBody(body, res) {
    const isRegexp = body instanceof RegExp;

    // parsed
    if (typeof body === 'object' && !isRegexp) {
      try {
        deepStrictEqual(body, res.body);
      } catch (err) {
        const a = inspect(body);
        const b = inspect(res.body);
        return error('expected ' + a + ' response body, got ' + b, body, res.body);
      }
    } else if (body !== res.text) {
      // string
      const a = inspect(body);
      const b = inspect(res.text);

      // regexp
      if (isRegexp) {
        if (!body.test(res.text)) {
          return error('expected body ' + b + ' to match ' + body, body, res.body);
        }
      } else {
        return error('expected ' + a + ' response body, got ' + b, body, res.body);
      }
    }
  }

  /**
   * Perform assertions on a response header and return an Error upon failure.
   *
   * @param {Object} header
   * @param {Response} res
   * @return {?Error}
   * @api private
   */ // eslint-disable-next-line class-methods-use-this
  _assertHeader(header, res) {
    const field = header.name;
    const actual = res.header[field.toLowerCase()];
    const fieldExpected = header.value;
    if (typeof actual === 'undefined') return new Error('expected "' + field + '" header field');
    // This check handles header values that may be a String or single element Array
    if (Array.isArray(actual) && actual.toString() === fieldExpected || fieldExpected === actual) {
      return;
    }
    if (fieldExpected instanceof RegExp) {
      if (!fieldExpected.test(actual)) {
        return new Error('expected "' + field + '" matching ' + fieldExpected + ', got "' + actual + '"');
      }
    } else {
      return new Error('expected "' + field + '" of "' + fieldExpected + '", got "' + actual + '"');
    }
  }

  /**
   * Perform assertions on the response status and return an Error upon failure.
   *
   * @param {Number} status
   * @param {Response} res
   * @return {?Error}
   * @api private
   */ // eslint-disable-next-line class-methods-use-this
  _assertStatus(status, res) {
    if (res.status !== status) {
      const a = STATUS_CODES[status];
      const b = STATUS_CODES[res.status];
      return new Error('expected ' + status + ' "' + a + '", got ' + res.status + ' "' + b + '"');
    }
  }

  /**
   * Perform assertions on the response status and return an Error upon failure.
   *
   * @param {Array<Number>} statusArray
   * @param {Response} res
   * @return {?Error}
   * @api private
   */ // eslint-disable-next-line class-methods-use-this
  _assertStatusArray(statusArray, res) {
    if (!statusArray.includes(res.status)) {
      const b = STATUS_CODES[res.status];
      const expectedList = statusArray.join(', ');
      return new Error('expected one of "' + expectedList + '", got ' + res.status + ' "' + b + '"');
    }
  }

  /**
   * Performs an assertion by calling a function and return an Error upon failure.
   *
   * @param {Function} fn
   * @param {Response} res
   * @return {?Error}
   * @api private
   */ // eslint-disable-next-line class-methods-use-this
  _assertFunction(fn, res) {
    let err;
    try {
      err = fn(res);
    } catch (e) {
      err = e;
    }
    if (err instanceof Error) return err;
  }
}

/**
 * Wraps an assert function into another.
 * The wrapper function edit the stack trace of any assertion error, prepending a more useful stack to it.
 *
 * @param {Function} assertFn
 * @returns {Function} wrapped assert function
 */

function wrapAssertFn(assertFn) {
  const savedStack = new Error().stack.split('\n').slice(3);
  return function (res) {
    let badStack;
    let err;
    try {
      err = assertFn(res);
    } catch (e) {
      err = e;
    }
    if (err instanceof Error && err.stack) {
      badStack = err.stack.replace(err.message, '').split('\n').slice(1);
      err.stack = [err.toString()].concat(savedStack).concat('----').concat(badStack).join('\n');
    }
    return err;
  };
}

/**
 * Return an `Error` with `msg` and results properties.
 *
 * @param {String} msg
 * @param {Mixed} expected
 * @param {Mixed} actual
 * @return {Error}
 * @api private
 */

function error(msg, expected, actual) {
  const err = new Error(msg);
  err.expected = expected;
  err.actual = actual;
  err.showDiff = true;
  return err;
}

/**
 * Expose `Test`.
 */

module.exports = Test;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpbnNwZWN0IiwicmVxdWlyZSIsIlNUQVRVU19DT0RFUyIsIlNlcnZlciIsImRlZXBTdHJpY3RFcXVhbCIsIlJlcXVlc3QiLCJUZXN0IiwiY29uc3RydWN0b3IiLCJhcHAiLCJtZXRob2QiLCJwYXRoIiwidG9VcHBlckNhc2UiLCJyZWRpcmVjdHMiLCJidWZmZXIiLCJfYXNzZXJ0cyIsInVybCIsInNlcnZlckFkZHJlc3MiLCJhZGRyIiwiYWRkcmVzcyIsIl9zZXJ2ZXIiLCJsaXN0ZW4iLCJwb3J0IiwicHJvdG9jb2wiLCJleHBlY3QiLCJhIiwiYiIsImMiLCJwdXNoIiwid3JhcEFzc2VydEZuIiwiZW5kIiwiX2Fzc2VydFN0YXR1cyIsImJpbmQiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJfYXNzZXJ0Qm9keSIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwidmFsIiwiX2Fzc2VydFN0YXR1c0FycmF5IiwiUmVnRXhwIiwiX2Fzc2VydEhlYWRlciIsIm5hbWUiLCJ2YWx1ZSIsImZuIiwic2VydmVyIiwiZXJyIiwicmVzIiwibG9jYWxBc3NlcnQiLCJhc3NlcnQiLCJfaGFuZGxlIiwiY2xvc2UiLCJyZXNFcnJvciIsImVycm9yT2JqIiwic3lzRXJyb3JzIiwiRUNPTk5SRUZVU0VEIiwiRUNPTk5SRVNFVCIsIkVQSVBFIiwiRVRJTUVET1VUIiwiRXJyb3IiLCJzeXNjYWxsIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImluZGV4T2YiLCJjb2RlIiwiaSIsIl9hc3NlcnRGdW5jdGlvbiIsInN0YXR1cyIsImNhbGwiLCJib2R5IiwiaXNSZWdleHAiLCJlcnJvciIsInRleHQiLCJ0ZXN0IiwiaGVhZGVyIiwiZmllbGQiLCJhY3R1YWwiLCJ0b0xvd2VyQ2FzZSIsImZpZWxkRXhwZWN0ZWQiLCJ0b1N0cmluZyIsInN0YXR1c0FycmF5IiwiaW5jbHVkZXMiLCJleHBlY3RlZExpc3QiLCJqb2luIiwiZSIsImFzc2VydEZuIiwic2F2ZWRTdGFjayIsInN0YWNrIiwic3BsaXQiLCJzbGljZSIsImJhZFN0YWNrIiwicmVwbGFjZSIsIm1lc3NhZ2UiLCJjb25jYXQiLCJtc2ciLCJleHBlY3RlZCIsInNob3dEaWZmIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuXG4gKi9cblxuY29uc3QgeyBpbnNwZWN0IH0gPSByZXF1aXJlKCd1dGlsJyk7XG5jb25zdCB7IFNUQVRVU19DT0RFUyB9ID0gcmVxdWlyZSgnaHR0cCcpO1xuY29uc3QgeyBTZXJ2ZXIgfSA9IHJlcXVpcmUoJ3RscycpO1xuY29uc3QgeyBkZWVwU3RyaWN0RXF1YWwgfSA9IHJlcXVpcmUoJ2Fzc2VydCcpO1xuY29uc3QgeyBSZXF1ZXN0IH0gPSByZXF1aXJlKCdzdXBlcmFnZW50Jyk7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCdzdXBlcmFnZW50JykuUmVzcG9uc2V9IFJlc3BvbnNlICovXG5cbmNsYXNzIFRlc3QgZXh0ZW5kcyBSZXF1ZXN0IHtcbiAgLyoqXG4gICAqIEluaXRpYWxpemUgYSBuZXcgYFRlc3RgIHdpdGggdGhlIGdpdmVuIGBhcHBgLFxuICAgKiByZXF1ZXN0IGBtZXRob2RgIGFuZCBgcGF0aGAuXG4gICAqXG4gICAqIEBwYXJhbSB7U2VydmVyfSBhcHBcbiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZFxuICAgKiBAcGFyYW0ge1N0cmluZ30gcGF0aFxuICAgKiBAYXBpIHB1YmxpY1xuICAgKi9cbiAgY29uc3RydWN0b3IgKGFwcCwgbWV0aG9kLCBwYXRoKSB7XG4gICAgc3VwZXIobWV0aG9kLnRvVXBwZXJDYXNlKCksIHBhdGgpO1xuXG4gICAgdGhpcy5yZWRpcmVjdHMoMCk7XG4gICAgdGhpcy5idWZmZXIoKTtcbiAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICB0aGlzLl9hc3NlcnRzID0gW107XG4gICAgdGhpcy51cmwgPSB0eXBlb2YgYXBwID09PSAnc3RyaW5nJ1xuICAgICAgPyBhcHAgKyBwYXRoXG4gICAgICA6IHRoaXMuc2VydmVyQWRkcmVzcyhhcHAsIHBhdGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBVUkwsIGV4dHJhY3RlZCBmcm9tIGEgc2VydmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge1NlcnZlcn0gYXBwXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IFVSTCBhZGRyZXNzXG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi9cbiAgc2VydmVyQWRkcmVzcyhhcHAsIHBhdGgpIHtcbiAgICBjb25zdCBhZGRyID0gYXBwLmFkZHJlc3MoKTtcblxuICAgIGlmICghYWRkcikgdGhpcy5fc2VydmVyID0gYXBwLmxpc3RlbigwKTtcbiAgICBjb25zdCBwb3J0ID0gYXBwLmFkZHJlc3MoKS5wb3J0O1xuICAgIGNvbnN0IHByb3RvY29sID0gYXBwIGluc3RhbmNlb2YgU2VydmVyID8gJ2h0dHBzJyA6ICdodHRwJztcbiAgICByZXR1cm4gcHJvdG9jb2wgKyAnOi8vMTI3LjAuMC4xOicgKyBwb3J0ICsgcGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBlY3RhdGlvbnM6XG4gICAqXG4gICAqICAgLmV4cGVjdCgyMDApXG4gICAqICAgLmV4cGVjdCgyMDAsIGZuKVxuICAgKiAgIC5leHBlY3QoMjAwLCBib2R5KVxuICAgKiAgIC5leHBlY3QoJ1NvbWUgYm9keScpXG4gICAqICAgLmV4cGVjdCgnU29tZSBib2R5JywgZm4pXG4gICAqICAgLmV4cGVjdChbJ2pzb24gYXJyYXkgYm9keScsIHsga2V5OiAndmFsJyB9XSlcbiAgICogICAuZXhwZWN0KCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpXG4gICAqICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nLCBmbilcbiAgICogICAuZXhwZWN0KGZuKVxuICAgKiAgIC5leHBlY3QoWzIwMCwgNDA0XSlcbiAgICpcbiAgICogQHJldHVybiB7VGVzdH1cbiAgICogQGFwaSBwdWJsaWNcbiAgICovXG4gIGV4cGVjdChhLCBiLCBjKSB7XG4gICAgLy8gY2FsbGJhY2tcbiAgICBpZiAodHlwZW9mIGEgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRoaXMuX2Fzc2VydHMucHVzaCh3cmFwQXNzZXJ0Rm4oYSkpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYiA9PT0gJ2Z1bmN0aW9uJykgdGhpcy5lbmQoYik7XG4gICAgaWYgKHR5cGVvZiBjID09PSAnZnVuY3Rpb24nKSB0aGlzLmVuZChjKTtcblxuICAgIC8vIHN0YXR1c1xuICAgIGlmICh0eXBlb2YgYSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuX2Fzc2VydHMucHVzaCh3cmFwQXNzZXJ0Rm4odGhpcy5fYXNzZXJ0U3RhdHVzLmJpbmQodGhpcywgYSkpKTtcbiAgICAgIC8vIGJvZHlcbiAgICAgIGlmICh0eXBlb2YgYiAhPT0gJ2Z1bmN0aW9uJyAmJiBhcmd1bWVudHMubGVuZ3RoID4gMSkge1xuICAgICAgICB0aGlzLl9hc3NlcnRzLnB1c2god3JhcEFzc2VydEZuKHRoaXMuX2Fzc2VydEJvZHkuYmluZCh0aGlzLCBiKSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLy8gbXVsdGlwbGUgc3RhdHVzZXNcbiAgICBpZiAoQXJyYXkuaXNBcnJheShhKSAmJiBhLmxlbmd0aCA+IDAgJiYgYS5ldmVyeSh2YWwgPT4gdHlwZW9mIHZhbCA9PT0gJ251bWJlcicpKSB7XG4gICAgICB0aGlzLl9hc3NlcnRzLnB1c2god3JhcEFzc2VydEZuKHRoaXMuX2Fzc2VydFN0YXR1c0FycmF5LmJpbmQodGhpcywgYSkpKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8vIGhlYWRlciBmaWVsZFxuICAgIGlmICh0eXBlb2YgYiA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGIgPT09ICdudW1iZXInIHx8IGIgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgIHRoaXMuX2Fzc2VydHMucHVzaCh3cmFwQXNzZXJ0Rm4odGhpcy5fYXNzZXJ0SGVhZGVyLmJpbmQodGhpcywgeyBuYW1lOiAnJyArIGEsIHZhbHVlOiBiIH0pKSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvLyBib2R5XG4gICAgdGhpcy5fYXNzZXJ0cy5wdXNoKHdyYXBBc3NlcnRGbih0aGlzLl9hc3NlcnRCb2R5LmJpbmQodGhpcywgYSkpKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgLyoqXG4gICAqIERlZmVyIGludm9raW5nIHN1cGVyYWdlbnQncyBgLmVuZCgpYCB1bnRpbFxuICAgKiB0aGUgc2VydmVyIGlzIGxpc3RlbmluZy5cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cbiAgICogQGFwaSBwdWJsaWNcbiAgICovXG4gIGVuZChmbikge1xuICAgIGNvbnN0IHNlcnZlciA9IHRoaXMuX3NlcnZlcjtcblxuICAgIHN1cGVyLmVuZCgoZXJyLCByZXMpID0+IHtcbiAgICAgIGNvbnN0IGxvY2FsQXNzZXJ0ID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmFzc2VydChlcnIsIHJlcywgZm4pO1xuICAgICAgfTtcblxuICAgICAgaWYgKHNlcnZlciAmJiBzZXJ2ZXIuX2hhbmRsZSkgcmV0dXJuIHNlcnZlci5jbG9zZShsb2NhbEFzc2VydCk7XG5cbiAgICAgIGxvY2FsQXNzZXJ0KCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIGFzc2VydGlvbnMgYW5kIGludm9rZSBgZm4oZXJyLCByZXMpYC5cbiAgICpcbiAgICogQHBhcmFtIHs/RXJyb3J9IHJlc0Vycm9yXG4gICAqIEBwYXJhbSB7UmVzcG9uc2V9IHJlc1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmblxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovXG4gIGFzc2VydChyZXNFcnJvciwgcmVzLCBmbikge1xuICAgIGxldCBlcnJvck9iajtcblxuICAgIC8vIGNoZWNrIGZvciB1bmV4cGVjdGVkIG5ldHdvcmsgZXJyb3JzIG9yIHNlcnZlciBub3QgcnVubmluZy9yZWFjaGFibGUgZXJyb3JzXG4gICAgLy8gd2hlbiB0aGVyZSBpcyBubyByZXNwb25zZSBhbmQgc3VwZXJhZ2VudCBzZW5kcyBiYWNrIGEgU3lzdGVtIEVycm9yXG4gICAgLy8gZG8gbm90IGNoZWNrIGZ1cnRoZXIgZm9yIG90aGVyIGFzc2VydHMsIGlmIGFueSwgaW4gc3VjaCBjYXNlXG4gICAgLy8gaHR0cHM6Ly9ub2RlanMub3JnL2FwaS9lcnJvcnMuaHRtbCNlcnJvcnNfY29tbW9uX3N5c3RlbV9lcnJvcnNcbiAgICBjb25zdCBzeXNFcnJvcnMgPSB7XG4gICAgICBFQ09OTlJFRlVTRUQ6ICdDb25uZWN0aW9uIHJlZnVzZWQnLFxuICAgICAgRUNPTk5SRVNFVDogJ0Nvbm5lY3Rpb24gcmVzZXQgYnkgcGVlcicsXG4gICAgICBFUElQRTogJ0Jyb2tlbiBwaXBlJyxcbiAgICAgIEVUSU1FRE9VVDogJ09wZXJhdGlvbiB0aW1lZCBvdXQnXG4gICAgfTtcblxuICAgIGlmICghcmVzICYmIHJlc0Vycm9yKSB7XG4gICAgICBpZiAocmVzRXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiByZXNFcnJvci5zeXNjYWxsID09PSAnY29ubmVjdCdcbiAgICAgICAgJiYgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoc3lzRXJyb3JzKS5pbmRleE9mKHJlc0Vycm9yLmNvZGUpID49IDApIHtcbiAgICAgICAgZXJyb3JPYmogPSBuZXcgRXJyb3IocmVzRXJyb3IuY29kZSArICc6ICcgKyBzeXNFcnJvcnNbcmVzRXJyb3IuY29kZV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXJyb3JPYmogPSByZXNFcnJvcjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBhc3NlcnRzXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9hc3NlcnRzLmxlbmd0aCAmJiAhZXJyb3JPYmo7IGkgKz0gMSkge1xuICAgICAgZXJyb3JPYmogPSB0aGlzLl9hc3NlcnRGdW5jdGlvbih0aGlzLl9hc3NlcnRzW2ldLCByZXMpO1xuICAgIH1cblxuICAgIC8vIHNldCB1bmV4cGVjdGVkIHN1cGVyYWdlbnQgZXJyb3IgaWYgbm8gb3RoZXIgZXJyb3IgaGFzIG9jY3VycmVkLlxuICAgIGlmICghZXJyb3JPYmogJiYgcmVzRXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiAoIXJlcyB8fCByZXNFcnJvci5zdGF0dXMgIT09IHJlcy5zdGF0dXMpKSB7XG4gICAgICBlcnJvck9iaiA9IHJlc0Vycm9yO1xuICAgIH1cblxuICAgIGZuLmNhbGwodGhpcywgZXJyb3JPYmogfHwgbnVsbCwgcmVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIGFzc2VydGlvbnMgb24gYSByZXNwb25zZSBib2R5IGFuZCByZXR1cm4gYW4gRXJyb3IgdXBvbiBmYWlsdXJlLlxuICAgKlxuICAgKiBAcGFyYW0ge01peGVkfSBib2R5XG4gICAqIEBwYXJhbSB7UmVzcG9uc2V9IHJlc1xuICAgKiBAcmV0dXJuIHs/RXJyb3J9XG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi8vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpc1xuICBfYXNzZXJ0Qm9keShib2R5LCByZXMpIHtcbiAgICBjb25zdCBpc1JlZ2V4cCA9IGJvZHkgaW5zdGFuY2VvZiBSZWdFeHA7XG5cbiAgICAvLyBwYXJzZWRcbiAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnICYmICFpc1JlZ2V4cCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZGVlcFN0cmljdEVxdWFsKGJvZHksIHJlcy5ib2R5KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zdCBhID0gaW5zcGVjdChib2R5KTtcbiAgICAgICAgY29uc3QgYiA9IGluc3BlY3QocmVzLmJvZHkpO1xuICAgICAgICByZXR1cm4gZXJyb3IoJ2V4cGVjdGVkICcgKyBhICsgJyByZXNwb25zZSBib2R5LCBnb3QgJyArIGIsIGJvZHksIHJlcy5ib2R5KTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGJvZHkgIT09IHJlcy50ZXh0KSB7XG4gICAgICAvLyBzdHJpbmdcbiAgICAgIGNvbnN0IGEgPSBpbnNwZWN0KGJvZHkpO1xuICAgICAgY29uc3QgYiA9IGluc3BlY3QocmVzLnRleHQpO1xuXG4gICAgICAvLyByZWdleHBcbiAgICAgIGlmIChpc1JlZ2V4cCkge1xuICAgICAgICBpZiAoIWJvZHkudGVzdChyZXMudGV4dCkpIHtcbiAgICAgICAgICByZXR1cm4gZXJyb3IoJ2V4cGVjdGVkIGJvZHkgJyArIGIgKyAnIHRvIG1hdGNoICcgKyBib2R5LCBib2R5LCByZXMuYm9keSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBlcnJvcignZXhwZWN0ZWQgJyArIGEgKyAnIHJlc3BvbnNlIGJvZHksIGdvdCAnICsgYiwgYm9keSwgcmVzLmJvZHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIGFzc2VydGlvbnMgb24gYSByZXNwb25zZSBoZWFkZXIgYW5kIHJldHVybiBhbiBFcnJvciB1cG9uIGZhaWx1cmUuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkZXJcbiAgICogQHBhcmFtIHtSZXNwb25zZX0gcmVzXG4gICAqIEByZXR1cm4gez9FcnJvcn1cbiAgICogQGFwaSBwcml2YXRlXG4gICAqLy8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzXG4gIF9hc3NlcnRIZWFkZXIoaGVhZGVyLCByZXMpIHtcbiAgICBjb25zdCBmaWVsZCA9IGhlYWRlci5uYW1lO1xuICAgIGNvbnN0IGFjdHVhbCA9IHJlcy5oZWFkZXJbZmllbGQudG9Mb3dlckNhc2UoKV07XG4gICAgY29uc3QgZmllbGRFeHBlY3RlZCA9IGhlYWRlci52YWx1ZTtcblxuICAgIGlmICh0eXBlb2YgYWN0dWFsID09PSAndW5kZWZpbmVkJykgcmV0dXJuIG5ldyBFcnJvcignZXhwZWN0ZWQgXCInICsgZmllbGQgKyAnXCIgaGVhZGVyIGZpZWxkJyk7XG4gICAgLy8gVGhpcyBjaGVjayBoYW5kbGVzIGhlYWRlciB2YWx1ZXMgdGhhdCBtYXkgYmUgYSBTdHJpbmcgb3Igc2luZ2xlIGVsZW1lbnQgQXJyYXlcbiAgICBpZiAoKEFycmF5LmlzQXJyYXkoYWN0dWFsKSAmJiBhY3R1YWwudG9TdHJpbmcoKSA9PT0gZmllbGRFeHBlY3RlZClcbiAgICAgIHx8IGZpZWxkRXhwZWN0ZWQgPT09IGFjdHVhbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZmllbGRFeHBlY3RlZCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgaWYgKCFmaWVsZEV4cGVjdGVkLnRlc3QoYWN0dWFsKSkge1xuICAgICAgICByZXR1cm4gbmV3IEVycm9yKCdleHBlY3RlZCBcIicgKyBmaWVsZCArICdcIiBtYXRjaGluZyAnXG4gICAgICAgICAgKyBmaWVsZEV4cGVjdGVkICsgJywgZ290IFwiJyArIGFjdHVhbCArICdcIicpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3IEVycm9yKCdleHBlY3RlZCBcIicgKyBmaWVsZCArICdcIiBvZiBcIicgKyBmaWVsZEV4cGVjdGVkICsgJ1wiLCBnb3QgXCInICsgYWN0dWFsICsgJ1wiJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gYXNzZXJ0aW9ucyBvbiB0aGUgcmVzcG9uc2Ugc3RhdHVzIGFuZCByZXR1cm4gYW4gRXJyb3IgdXBvbiBmYWlsdXJlLlxuICAgKlxuICAgKiBAcGFyYW0ge051bWJlcn0gc3RhdHVzXG4gICAqIEBwYXJhbSB7UmVzcG9uc2V9IHJlc1xuICAgKiBAcmV0dXJuIHs/RXJyb3J9XG4gICAqIEBhcGkgcHJpdmF0ZVxuICAgKi8vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2xhc3MtbWV0aG9kcy11c2UtdGhpc1xuICBfYXNzZXJ0U3RhdHVzKHN0YXR1cywgcmVzKSB7XG4gICAgaWYgKHJlcy5zdGF0dXMgIT09IHN0YXR1cykge1xuICAgICAgY29uc3QgYSA9IFNUQVRVU19DT0RFU1tzdGF0dXNdO1xuICAgICAgY29uc3QgYiA9IFNUQVRVU19DT0RFU1tyZXMuc3RhdHVzXTtcbiAgICAgIHJldHVybiBuZXcgRXJyb3IoJ2V4cGVjdGVkICcgKyBzdGF0dXMgKyAnIFwiJyArIGEgKyAnXCIsIGdvdCAnICsgcmVzLnN0YXR1cyArICcgXCInICsgYiArICdcIicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIGFzc2VydGlvbnMgb24gdGhlIHJlc3BvbnNlIHN0YXR1cyBhbmQgcmV0dXJuIGFuIEVycm9yIHVwb24gZmFpbHVyZS5cbiAgICpcbiAgICogQHBhcmFtIHtBcnJheTxOdW1iZXI+fSBzdGF0dXNBcnJheVxuICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNcbiAgICogQHJldHVybiB7P0Vycm9yfVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXNcbiAgX2Fzc2VydFN0YXR1c0FycmF5KHN0YXR1c0FycmF5LCByZXMpIHtcbiAgICBpZiAoIXN0YXR1c0FycmF5LmluY2x1ZGVzKHJlcy5zdGF0dXMpKSB7XG4gICAgICBjb25zdCBiID0gU1RBVFVTX0NPREVTW3Jlcy5zdGF0dXNdO1xuICAgICAgY29uc3QgZXhwZWN0ZWRMaXN0ID0gc3RhdHVzQXJyYXkuam9pbignLCAnKTtcbiAgICAgIHJldHVybiBuZXcgRXJyb3IoXG4gICAgICAgICdleHBlY3RlZCBvbmUgb2YgXCInICsgZXhwZWN0ZWRMaXN0ICsgJ1wiLCBnb3QgJyArIHJlcy5zdGF0dXMgKyAnIFwiJyArIGIgKyAnXCInXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtcyBhbiBhc3NlcnRpb24gYnkgY2FsbGluZyBhIGZ1bmN0aW9uIGFuZCByZXR1cm4gYW4gRXJyb3IgdXBvbiBmYWlsdXJlLlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmblxuICAgKiBAcGFyYW0ge1Jlc3BvbnNlfSByZXNcbiAgICogQHJldHVybiB7P0Vycm9yfVxuICAgKiBAYXBpIHByaXZhdGVcbiAgICovLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXNcbiAgX2Fzc2VydEZ1bmN0aW9uKGZuLCByZXMpIHtcbiAgICBsZXQgZXJyO1xuICAgIHRyeSB7XG4gICAgICBlcnIgPSBmbihyZXMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVyciA9IGU7XG4gICAgfVxuICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikgcmV0dXJuIGVycjtcbiAgfVxufVxuXG4vKipcbiAqIFdyYXBzIGFuIGFzc2VydCBmdW5jdGlvbiBpbnRvIGFub3RoZXIuXG4gKiBUaGUgd3JhcHBlciBmdW5jdGlvbiBlZGl0IHRoZSBzdGFjayB0cmFjZSBvZiBhbnkgYXNzZXJ0aW9uIGVycm9yLCBwcmVwZW5kaW5nIGEgbW9yZSB1c2VmdWwgc3RhY2sgdG8gaXQuXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gYXNzZXJ0Rm5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gd3JhcHBlZCBhc3NlcnQgZnVuY3Rpb25cbiAqL1xuXG5mdW5jdGlvbiB3cmFwQXNzZXJ0Rm4oYXNzZXJ0Rm4pIHtcbiAgY29uc3Qgc2F2ZWRTdGFjayA9IG5ldyBFcnJvcigpLnN0YWNrLnNwbGl0KCdcXG4nKS5zbGljZSgzKTtcblxuICByZXR1cm4gZnVuY3Rpb24ocmVzKSB7XG4gICAgbGV0IGJhZFN0YWNrO1xuICAgIGxldCBlcnI7XG4gICAgdHJ5IHtcbiAgICAgIGVyciA9IGFzc2VydEZuKHJlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyID0gZTtcbiAgICB9XG4gICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yICYmIGVyci5zdGFjaykge1xuICAgICAgYmFkU3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShlcnIubWVzc2FnZSwgJycpLnNwbGl0KCdcXG4nKS5zbGljZSgxKTtcbiAgICAgIGVyci5zdGFjayA9IFtlcnIudG9TdHJpbmcoKV1cbiAgICAgICAgLmNvbmNhdChzYXZlZFN0YWNrKVxuICAgICAgICAuY29uY2F0KCctLS0tJylcbiAgICAgICAgLmNvbmNhdChiYWRTdGFjaylcbiAgICAgICAgLmpvaW4oJ1xcbicpO1xuICAgIH1cbiAgICByZXR1cm4gZXJyO1xuICB9O1xufVxuXG4vKipcbiAqIFJldHVybiBhbiBgRXJyb3JgIHdpdGggYG1zZ2AgYW5kIHJlc3VsdHMgcHJvcGVydGllcy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbXNnXG4gKiBAcGFyYW0ge01peGVkfSBleHBlY3RlZFxuICogQHBhcmFtIHtNaXhlZH0gYWN0dWFsXG4gKiBAcmV0dXJuIHtFcnJvcn1cbiAqIEBhcGkgcHJpdmF0ZVxuICovXG5cbmZ1bmN0aW9uIGVycm9yKG1zZywgZXhwZWN0ZWQsIGFjdHVhbCkge1xuICBjb25zdCBlcnIgPSBuZXcgRXJyb3IobXNnKTtcbiAgZXJyLmV4cGVjdGVkID0gZXhwZWN0ZWQ7XG4gIGVyci5hY3R1YWwgPSBhY3R1YWw7XG4gIGVyci5zaG93RGlmZiA9IHRydWU7XG4gIHJldHVybiBlcnI7XG59XG5cbi8qKlxuICogRXhwb3NlIGBUZXN0YC5cbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRlc3Q7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVo7QUFDQTtBQUNBO0FBRUEsTUFBTTtFQUFFQTtBQUFRLENBQUMsR0FBR0MsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUNuQyxNQUFNO0VBQUVDO0FBQWEsQ0FBQyxHQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQ3hDLE1BQU07RUFBRUU7QUFBTyxD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