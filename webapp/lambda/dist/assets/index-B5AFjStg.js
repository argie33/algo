import{r as j,R as Hw,j as e,D as Os,f as Ls,B as g,W as Ar,T as d,g as ks,A as we,h as Gw,L as rt,i as Is,k as oe,C as Je,l as gn,m as z,n as U,S as Or,E as Kw,o as Fe,p as Es,H as hx,q as Yw,u as Zs,s as tt,v as X,w as Xe,x as ux,y as Gt,z as Tt,F as at,G as Lt,I as El,P as He,J as Xw,K as lt,M as qf,N as Rn,O as kr,Q as fx,U as ii,V as Ge,X as Il,Y as hu,Z as _e,$ as Mt,a0 as y,a1 as Fs,a2 as mx,a3 as Tr,a4 as Dl,a5 as Pr,a6 as Ae,a7 as Oe,a8 as Ve,a9 as V,aa as f,ab as ke,ac as Gr,ad as Zw,ae as px,af as jr,ag as Dt,ah as mr,ai as Ut,aj as gx,ak as Ii,al as Rl,am as Fn,an as Kr,ao,ap as xn,aq as Ma,ar as uu,as as Ir,at as it,au as Jw,av as eS,aw as xr,ax as Ml,ay as tS,az as mn,aA as is,aB as as,aC as Vt,aD as os,aE as ts,aF as ar,aG as J,aH as yn,aI as sS,aJ as rS,aK as oo,aL as xx,aM as ft,aN as mt,aO as pt,aP as lo,aQ as yx,aR as nS,aS as jx,aT as iS,aU as Gc,aV as Vr,aW as Yr,aX as Jd,aY as eh,aZ as Hf,a_ as aS,a$ as oS,b0 as lS,b1 as cS,b2 as Jt,b3 as rs,b4 as kt,b5 as me,b6 as La,b7 as dS,b8 as Ni,b9 as Ue,ba as Gf,bb as Pi,bc as ml,bd as Kf,be as fc,bf as mc,bg as bx,bh as hS,bi as vx,bj as uS,bk as fS,bl as wx,bm as mS,bn as pS,bo as Ca,bp as Yf,bq as Sr,br as gS,bs as xS,bt as yS,bu as jS,bv as bS,bw as vS,bx as Sx,c as Cs,by as ms,bz as $s,bA as Vs,bB as ct,bC as Rs,bD as Un,bE as Xf,bF as fu,bG as ci,bH as wS,bI as SS,bJ as Ze,bK as Kc,bL as OS,bM as Nn,bN as Hi,bO as fe,bP as kS,bQ as CS,bR as Ox,bS as mu,bT as kx,bU as Cx,bV as AS,bW as TS,bX as PS,bY as _S,bZ as ES,b_ as Ax,b$ as IS,c0 as Yc,c1 as Xc,c2 as Zc,c3 as DS,c4 as RS,c5 as Tx,c6 as MS,c7 as LS,c8 as Zf,c9 as di,ca as jn,cb as FS,cc as NS,cd as th,ce as Jf,cf as em,cg as sh,ch as WS,ci as Gi,cj as tm,ck as sm,cl as pl,cm as $S,cn as VS,co as zS,cp as rm,cq as BS,cr as Px,cs as nm,ct as im,cu as am,cv as US,cw as Jc,cx as ed,cy as QS,cz as qS,cA as HS,cB as om,cC as GS,cD as KS,cE as YS,cF as XS,cG as ZS}from"./mui-yy40f7Jq.js";import{a as JS,g as pu}from"./vendor-Cd7-iaQF.js";import{a as eO,f as Fa,r as tO,b as td,l as sO,p as rO,c as nO,d as iO,i as aO,e as oO,g as lO,h as cO,j as dO,k as hO,m as uO,n as fO,o as mO,q as pO,s as gO,t as xO,u as yO,v as jO,w as bO,x as sd,y as rd,z as lm,A as ua,B as Po,C as cm,D as vO,E as dm,F as nd,G as hm,H as id,I as um,J as ad,K as wO,L as SO,M as OO,N as kO,O as CO,P as AO,Q as TO,R as PO,S as _O,T as EO,U as IO,V as DO,W as RO,X as MO,Y as LO,Z as FO,_ as NO,$ as WO,a0 as $O,a1 as VO,a2 as zO}from"./utils-BzGDAS3y.js";import{R as st,L as Ks,C as ut,X as dt,Y as ht,T as ot,a as Ds,P as Zr,b as Jr,c as xt,B as Yt,d as jt,A as _x,e as gu,f as gl,g as BO,h as UO,i as Kn}from"./charts-cUNBScZf.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();var _o={},fm;function QO(){if(fm)return _o;fm=1;var r=JS();return _o.createRoot=r.createRoot,_o.hydrateRoot=r.hydrateRoot,_o}var qO=QO();const HO=pu(qO);/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Na(){return Na=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Na.apply(this,arguments)}var _n;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(_n||(_n={}));const mm="popstate";function GO(r){r===void 0&&(r={});function t(n,i){let{pathname:a,search:o,hash:l}=n.location;return rh("",{pathname:a,search:o,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){return typeof i=="string"?i:Ix(i)}return YO(t,s,null,r)}function fs(r,t){if(r===!1||r===null||typeof r>"u")throw new Error(t)}function Ex(r,t){if(!r){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function KO(){return Math.random().toString(36).substr(2,8)}function pm(r,t){return{usr:r.state,key:r.key,idx:t}}function rh(r,t,s,n){return s===void 0&&(s=null),Na({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof t=="string"?ra(t):t,{state:s,key:t&&t.key||n||KO()})}function Ix(r){let{pathname:t="/",search:s="",hash:n=""}=r;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ra(r){let t={};if(r){let s=r.indexOf("#");s>=0&&(t.hash=r.substr(s),r=r.substr(0,s));let n=r.indexOf("?");n>=0&&(t.search=r.substr(n),r=r.substr(0,n)),r&&(t.pathname=r)}return t}function YO(r,t,s,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,l=_n.Pop,c=null,h=u();h==null&&(h=0,o.replaceState(Na({},o.state,{idx:h}),""));function u(){return(o.state||{idx:null}).idx}function m(){l=_n.Pop;let C=u(),A=C==null?null:C-h;h=C,c&&c({action:l,location:w.location,delta:A})}function p(C,A){l=_n.Push;let _=rh(w.location,C,A);h=u()+1;let R=pm(_,h),E=w.createHref(_);try{o.pushState(R,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;i.location.assign(E)}a&&c&&c({action:l,location:w.location,delta:1})}function x(C,A){l=_n.Replace;let _=rh(w.location,C,A);h=u();let R=pm(_,h),E=w.createHref(_);o.replaceState(R,"",E),a&&c&&c({action:l,location:w.location,delta:0})}function b(C){let A=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof C=="string"?C:Ix(C);return _=_.replace(/ $/,"%20"),fs(A,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,A)}let w={get action(){return l},get location(){return r(i,o)},listen(C){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(mm,m),c=C,()=>{i.removeEventListener(mm,m),c=null}},createHref(C){return t(i,C)},createURL:b,encodeLocation(C){let A=b(C);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:p,replace:x,go(C){return o.go(C)}};return w}var gm;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(gm||(gm={}));function XO(r,t,s){return s===void 0&&(s="/"),ZO(r,t,s)}function ZO(r,t,s,n){let i=typeof t=="string"?ra(t):t,a=Mx(i.pathname||"/",s);if(a==null)return null;let o=Dx(r);JO(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let h=h1(a);l=l1(o[c],h)}return l}function Dx(r,t,s,n){t===void 0&&(t=[]),s===void 0&&(s=[]),n===void 0&&(n="");let i=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(fs(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let h=ai([n,c.relativePath]),u=s.concat(c);a.children&&a.children.length>0&&(fs(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),Dx(a.children,t,u,h)),!(a.path==null&&!a.index)&&t.push({path:h,score:a1(h,a.index),routesMeta:u})};return r.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let c of Rx(a.path))i(a,o,c)}),t}function Rx(r){let t=r.split("/");if(t.length===0)return[];let[s,...n]=t,i=s.endsWith("?"),a=s.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=Rx(n.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>r.startsWith("/")&&c===""?"/":c)}function JO(r){r.sort((t,s)=>t.score!==s.score?s.score-t.score:o1(t.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}const e1=/^:[\w-]+$/,t1=3,s1=2,r1=1,n1=10,i1=-2,xm=r=>r==="*";function a1(r,t){let s=r.split("/"),n=s.length;return s.some(xm)&&(n+=i1),t&&(n+=s1),s.filter(i=>!xm(i)).reduce((i,a)=>i+(e1.test(a)?t1:a===""?r1:n1),n)}function o1(r,t){return r.length===t.length&&r.slice(0,-1).every((n,i)=>n===t[i])?r[r.length-1]-t[t.length-1]:0}function l1(r,t,s){let{routesMeta:n}=r,i={},a="/",o=[];for(let l=0;l<n.length;++l){let c=n[l],h=l===n.length-1,u=a==="/"?t:t.slice(a.length)||"/",m=c1({path:c.relativePath,caseSensitive:c.caseSensitive,end:h},u),p=c.route;if(!m)return null;Object.assign(i,m.params),o.push({params:i,pathname:ai([a,m.pathname]),pathnameBase:x1(ai([a,m.pathnameBase])),route:p}),m.pathnameBase!=="/"&&(a=ai([a,m.pathnameBase]))}return o}function c1(r,t){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[s,n]=d1(r.path,r.caseSensitive,r.end),i=t.match(s);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((h,u,m)=>{let{paramName:p,isOptional:x}=u;if(p==="*"){let w=l[m]||"";o=a.slice(0,a.length-w.length).replace(/(.)\/+$/,"$1")}const b=l[m];return x&&!b?h[p]=void 0:h[p]=(b||"").replace(/%2F/g,"/"),h},{}),pathname:a,pathnameBase:o,pattern:r}}function d1(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!0),Ex(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function h1(r){try{return r.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return Ex(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),r}}function Mx(r,t){if(t==="/")return r;if(!r.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,n=r.charAt(s);return n&&n!=="/"?null:r.slice(s)||"/"}function u1(r,t){t===void 0&&(t="/");let{pathname:s,search:n="",hash:i=""}=typeof r=="string"?ra(r):r;return{pathname:s?s.startsWith("/")?s:f1(s,t):t,search:y1(n),hash:j1(i)}}function f1(r,t){let s=t.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function od(r,t,s,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function m1(r){return r.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function p1(r,t){let s=m1(r);return t?s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase):s.map(n=>n.pathnameBase)}function g1(r,t,s,n){n===void 0&&(n=!1);let i;typeof r=="string"?i=ra(r):(i=Na({},r),fs(!i.pathname||!i.pathname.includes("?"),od("?","pathname","search",i)),fs(!i.pathname||!i.pathname.includes("#"),od("#","pathname","hash",i)),fs(!i.search||!i.search.includes("#"),od("#","search","hash",i)));let a=r===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=s;else{let m=t.length-1;if(!n&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),m-=1;i.pathname=p.join("/")}l=m>=0?t[m]:"/"}let c=u1(i,l),h=o&&o!=="/"&&o.endsWith("/"),u=(a||o===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(h||u)&&(c.pathname+="/"),c}const ai=r=>r.join("/").replace(/\/\/+/g,"/"),x1=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),y1=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,j1=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function b1(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Lx=["post","put","patch","delete"];new Set(Lx);const v1=["get",...Lx];new Set(v1);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wa(){return Wa=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(r[n]=s[n])}return r},Wa.apply(this,arguments)}const xu=j.createContext(null),w1=j.createContext(null),pc=j.createContext(null),gc=j.createContext(null),yi=j.createContext({outlet:null,matches:[],isDataRoute:!1}),Fx=j.createContext(null);function xc(){return j.useContext(gc)!=null}function yc(){return xc()||fs(!1),j.useContext(gc).location}function Nx(r){j.useContext(pc).static||j.useLayoutEffect(r)}function On(){let{isDataRoute:r}=j.useContext(yi);return r?M1():S1()}function S1(){xc()||fs(!1);let r=j.useContext(xu),{basename:t,future:s,navigator:n}=j.useContext(pc),{matches:i}=j.useContext(yi),{pathname:a}=yc(),o=JSON.stringify(p1(i,s.v7_relativeSplatPath)),l=j.useRef(!1);return Nx(()=>{l.current=!0}),j.useCallback(function(h,u){if(u===void 0&&(u={}),!l.current)return;if(typeof h=="number"){n.go(h);return}let m=g1(h,JSON.parse(o),a,u.relative==="path");r==null&&t!=="/"&&(m.pathname=m.pathname==="/"?t:ai([t,m.pathname])),(u.replace?n.replace:n.push)(m,u.state,u)},[t,n,o,a,r])}function Wx(){let{matches:r}=j.useContext(yi),t=r[r.length-1];return t?t.params:{}}function O1(r,t){return k1(r,t)}function k1(r,t,s,n){xc()||fs(!1);let{navigator:i}=j.useContext(pc),{matches:a}=j.useContext(yi),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let h=yc(),u;if(t){var m;let C=typeof t=="string"?ra(t):t;c==="/"||(m=C.pathname)!=null&&m.startsWith(c)||fs(!1),u=C}else u=h;let p=u.pathname||"/",x=p;if(c!=="/"){let C=c.replace(/^\//,"").split("/");x="/"+p.replace(/^\//,"").split("/").slice(C.length).join("/")}let b=XO(r,{pathname:x}),w=_1(b&&b.map(C=>Object.assign({},C,{params:Object.assign({},l,C.params),pathname:ai([c,i.encodeLocation?i.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?c:ai([c,i.encodeLocation?i.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),a,s,n);return t&&w?j.createElement(gc.Provider,{value:{location:Wa({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:_n.Pop}},w):w}function C1(){let r=R1(),t=b1(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),s=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return j.createElement(j.Fragment,null,j.createElement("h2",null,"Unexpected Application Error!"),j.createElement("h3",{style:{fontStyle:"italic"}},t),s?j.createElement("pre",{style:i},s):null,null)}const A1=j.createElement(C1,null);class T1 extends j.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?j.createElement(yi.Provider,{value:this.props.routeContext},j.createElement(Fx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function P1(r){let{routeContext:t,match:s,children:n}=r,i=j.useContext(xu);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),j.createElement(yi.Provider,{value:t},n)}function _1(r,t,s,n){var i;if(t===void 0&&(t=[]),s===void 0&&(s=null),n===void 0&&(n=null),r==null){var a;if(!s)return null;if(s.errors)r=s.matches;else if((a=n)!=null&&a.v7_partialHydration&&t.length===0&&!s.initialized&&s.matches.length>0)r=s.matches;else return null}let o=r,l=(i=s)==null?void 0:i.errors;if(l!=null){let u=o.findIndex(m=>m.route.id&&l?.[m.route.id]!==void 0);u>=0||fs(!1),o=o.slice(0,Math.min(o.length,u+1))}let c=!1,h=-1;if(s&&n&&n.v7_partialHydration)for(let u=0;u<o.length;u++){let m=o[u];if((m.route.HydrateFallback||m.route.hydrateFallbackElement)&&(h=u),m.route.id){let{loaderData:p,errors:x}=s,b=m.route.loader&&p[m.route.id]===void 0&&(!x||x[m.route.id]===void 0);if(m.route.lazy||b){c=!0,h>=0?o=o.slice(0,h+1):o=[o[0]];break}}}return o.reduceRight((u,m,p)=>{let x,b=!1,w=null,C=null;s&&(x=l&&m.route.id?l[m.route.id]:void 0,w=m.route.errorElement||A1,c&&(h<0&&p===0?(L1("route-fallback"),b=!0,C=null):h===p&&(b=!0,C=m.route.hydrateFallbackElement||null)));let A=t.concat(o.slice(0,p+1)),_=()=>{let R;return x?R=w:b?R=C:m.route.Component?R=j.createElement(m.route.Component,null):m.route.element?R=m.route.element:R=u,j.createElement(P1,{match:m,routeContext:{outlet:u,matches:A,isDataRoute:s!=null},children:R})};return s&&(m.route.ErrorBoundary||m.route.errorElement||p===0)?j.createElement(T1,{location:s.location,revalidation:s.revalidation,component:w,error:x,children:_(),routeContext:{outlet:null,matches:A,isDataRoute:!0}}):_()},null)}var $x=(function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r})($x||{}),Vx=(function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r})(Vx||{});function E1(r){let t=j.useContext(xu);return t||fs(!1),t}function I1(r){let t=j.useContext(w1);return t||fs(!1),t}function D1(r){let t=j.useContext(yi);return t||fs(!1),t}function zx(r){let t=D1(),s=t.matches[t.matches.length-1];return s.route.id||fs(!1),s.route.id}function R1(){var r;let t=j.useContext(Fx),s=I1(),n=zx();return t!==void 0?t:(r=s.errors)==null?void 0:r[n]}function M1(){let{router:r}=E1($x.UseNavigateStable),t=zx(Vx.UseNavigateStable),s=j.useRef(!1);return Nx(()=>{s.current=!0}),j.useCallback(function(i,a){a===void 0&&(a={}),s.current&&(typeof i=="number"?r.navigate(i):r.navigate(i,Wa({fromRouteId:t},a)))},[r,t])}const ym={};function L1(r,t,s){ym[r]||(ym[r]=!0)}function F1(r,t){r?.v7_startTransition,r?.v7_relativeSplatPath}function Ct(r){fs(!1)}function N1(r){let{basename:t="/",children:s=null,location:n,navigationType:i=_n.Pop,navigator:a,static:o=!1,future:l}=r;xc()&&fs(!1);let c=t.replace(/^\/*/,"/"),h=j.useMemo(()=>({basename:c,navigator:a,static:o,future:Wa({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof n=="string"&&(n=ra(n));let{pathname:u="/",search:m="",hash:p="",state:x=null,key:b="default"}=n,w=j.useMemo(()=>{let C=Mx(u,c);return C==null?null:{location:{pathname:C,search:m,hash:p,state:x,key:b},navigationType:i}},[c,u,m,p,x,b,i]);return w==null?null:j.createElement(pc.Provider,{value:h},j.createElement(gc.Provider,{children:s,value:w}))}function W1(r){let{children:t,location:s}=r;return O1(nh(t),s)}new Promise(()=>{});function nh(r,t){t===void 0&&(t=[]);let s=[];return j.Children.forEach(r,(n,i)=>{if(!j.isValidElement(n))return;let a=[...t,i];if(n.type===j.Fragment){s.push.apply(s,nh(n.props.children,a));return}n.type!==Ct&&fs(!1),!n.props.index||!n.props.children||fs(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=nh(n.props.children,a)),s.push(o)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ih(r){return r===void 0&&(r=""),new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((t,s)=>{let n=r[s];return t.concat(Array.isArray(n)?n.map(i=>[s,i]):[[s,n]])},[]))}function $1(r,t){let s=ih(r);return t&&t.forEach((n,i)=>{s.has(i)||t.getAll(i).forEach(a=>{s.append(i,a)})}),s}const V1="6";try{window.__reactRouterVersion=V1}catch{}const z1="startTransition",jm=Hw[z1];function B1(r){let{basename:t,children:s,future:n,window:i}=r,a=j.useRef();a.current==null&&(a.current=GO({window:i,v5Compat:!0}));let o=a.current,[l,c]=j.useState({action:o.action,location:o.location}),{v7_startTransition:h}=n||{},u=j.useCallback(m=>{h&&jm?jm(()=>c(m)):c(m)},[c,h]);return j.useLayoutEffect(()=>o.listen(u),[o,u]),j.useEffect(()=>F1(n),[n]),j.createElement(N1,{basename:t,children:s,location:l.location,navigationType:l.action,navigator:o,future:n})}var bm;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(bm||(bm={}));var vm;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(vm||(vm={}));function U1(r){let t=j.useRef(ih(r)),s=j.useRef(!1),n=yc(),i=j.useMemo(()=>$1(n.search,s.current?null:t.current),[n.search]),a=On(),o=j.useCallback((l,c)=>{const h=ih(typeof l=="function"?l(i):l);s.current=!0,a("?"+h,c)},[a,i]);return[i,o]}var co=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Q1={setTimeout:(r,t)=>setTimeout(r,t),clearTimeout:r=>clearTimeout(r),setInterval:(r,t)=>setInterval(r,t),clearInterval:r=>clearInterval(r)},q1=class{#e=Q1;#t=!1;setTimeoutProvider(r){this.#e=r}setTimeout(r,t){return this.#e.setTimeout(r,t)}clearTimeout(r){this.#e.clearTimeout(r)}setInterval(r,t){return this.#e.setInterval(r,t)}clearInterval(r){this.#e.clearInterval(r)}},si=new q1;function H1(r){setTimeout(r,0)}var hi=typeof window>"u"||"Deno"in globalThis;function Bs(){}function G1(r,t){return typeof r=="function"?r(t):r}function ah(r){return typeof r=="number"&&r>=0&&r!==1/0}function Bx(r,t){return Math.max(r+(t||0)-Date.now(),0)}function Mn(r,t){return typeof r=="function"?r(t):r}function ur(r,t){return typeof r=="function"?r(t):r}function wm(r,t){const{type:s="all",exact:n,fetchStatus:i,predicate:a,queryKey:o,stale:l}=r;if(o){if(n){if(t.queryHash!==yu(o,t.options))return!1}else if(!Va(t.queryKey,o))return!1}if(s!=="all"){const c=t.isActive();if(s==="active"&&!c||s==="inactive"&&c)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||i&&i!==t.state.fetchStatus||a&&!a(t))}function Sm(r,t){const{exact:s,status:n,predicate:i,mutationKey:a}=r;if(a){if(!t.options.mutationKey)return!1;if(s){if($a(t.options.mutationKey)!==$a(a))return!1}else if(!Va(t.options.mutationKey,a))return!1}return!(n&&t.state.status!==n||i&&!i(t))}function yu(r,t){return(t?.queryKeyHashFn||$a)(r)}function $a(r){return JSON.stringify(r,(t,s)=>lh(s)?Object.keys(s).sort().reduce((n,i)=>(n[i]=s[i],n),{}):s)}function Va(r,t){return r===t?!0:typeof r!=typeof t?!1:r&&t&&typeof r=="object"&&typeof t=="object"?Object.keys(t).every(s=>Va(r[s],t[s])):!1}var K1=Object.prototype.hasOwnProperty;function Ux(r,t){if(r===t)return r;const s=Om(r)&&Om(t);if(!s&&!(lh(r)&&lh(t)))return t;const i=(s?r:Object.keys(r)).length,a=s?t:Object.keys(t),o=a.length,l=s?new Array(o):{};let c=0;for(let h=0;h<o;h++){const u=s?h:a[h],m=r[u],p=t[u];if(m===p){l[u]=m,(s?h<i:K1.call(r,u))&&c++;continue}if(m===null||p===null||typeof m!="object"||typeof p!="object"){l[u]=p;continue}const x=Ux(m,p);l[u]=x,x===m&&c++}return i===o&&c===i?r:l}function oh(r,t){if(!t||Object.keys(r).length!==Object.keys(t).length)return!1;for(const s in r)if(r[s]!==t[s])return!1;return!0}function Om(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function lh(r){if(!km(r))return!1;const t=r.constructor;if(t===void 0)return!0;const s=t.prototype;return!(!km(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function km(r){return Object.prototype.toString.call(r)==="[object Object]"}function Y1(r){return new Promise(t=>{si.setTimeout(t,r)})}function ch(r,t,s){return typeof s.structuralSharing=="function"?s.structuralSharing(r,t):s.structuralSharing!==!1?Ux(r,t):t}function X1(r,t,s=0){const n=[...r,t];return s&&n.length>s?n.slice(1):n}function Z1(r,t,s=0){const n=[t,...r];return s&&n.length>s?n.slice(0,-1):n}var ju=Symbol();function Qx(r,t){return!r.queryFn&&t?.initialPromise?()=>t.initialPromise:!r.queryFn||r.queryFn===ju?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}function J1(r,t){return typeof r=="function"?r(...t):!!r}var ek=class extends co{#e;#t;#s;constructor(){super(),this.#s=r=>{if(!hi&&window.addEventListener){const t=()=>r();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#s=r,this.#t?.(),this.#t=r(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(r){this.#e!==r&&(this.#e=r,this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(t=>{t(r)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},bu=new ek;function dh(){let r,t;const s=new Promise((i,a)=>{r=i,t=a});s.status="pending",s.catch(()=>{});function n(i){Object.assign(s,i),delete s.resolve,delete s.reject}return s.resolve=i=>{n({status:"fulfilled",value:i}),r(i)},s.reject=i=>{n({status:"rejected",reason:i}),t(i)},s}var tk=H1;function sk(){let r=[],t=0,s=l=>{l()},n=l=>{l()},i=tk;const a=l=>{t?r.push(l):i(()=>{s(l)})},o=()=>{const l=r;r=[],l.length&&i(()=>{n(()=>{l.forEach(c=>{s(c)})})})};return{batch:l=>{let c;t++;try{c=l()}finally{t--,t||o()}return c},batchCalls:l=>(...c)=>{a(()=>{l(...c)})},schedule:a,setNotifyFunction:l=>{s=l},setBatchNotifyFunction:l=>{n=l},setScheduler:l=>{i=l}}}var bs=sk(),rk=class extends co{#e=!0;#t;#s;constructor(){super(),this.#s=r=>{if(!hi&&window.addEventListener){const t=()=>r(!0),s=()=>r(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#s)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#s=r,this.#t?.(),this.#t=r(this.setOnline.bind(this))}setOnline(r){this.#e!==r&&(this.#e=r,this.listeners.forEach(s=>{s(r)}))}isOnline(){return this.#e}},Ll=new rk;function nk(r){return Math.min(1e3*2**r,3e4)}function qx(r){return(r??"online")==="online"?Ll.isOnline():!0}var hh=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent}};function Hx(r){let t=!1,s=0,n;const i=dh(),a=()=>i.status!=="pending",o=w=>{if(!a()){const C=new hh(w);p(C),r.onCancel?.(C)}},l=()=>{t=!0},c=()=>{t=!1},h=()=>bu.isFocused()&&(r.networkMode==="always"||Ll.isOnline())&&r.canRun(),u=()=>qx(r.networkMode)&&r.canRun(),m=w=>{a()||(n?.(),i.resolve(w))},p=w=>{a()||(n?.(),i.reject(w))},x=()=>new Promise(w=>{n=C=>{(a()||h())&&w(C)},r.onPause?.()}).then(()=>{n=void 0,a()||r.onContinue?.()}),b=()=>{if(a())return;let w;const C=s===0?r.initialPromise:void 0;try{w=C??r.fn()}catch(A){w=Promise.reject(A)}Promise.resolve(w).then(m).catch(A=>{if(a())return;const _=r.retry??(hi?0:3),R=r.retryDelay??nk,E=typeof R=="function"?R(s,A):R,T=_===!0||typeof _=="number"&&s<_||typeof _=="function"&&_(s,A);if(t||!T){p(A);return}s++,r.onFail?.(s,A),Y1(E).then(()=>h()?void 0:x()).then(()=>{t?p(A):b()})})};return{promise:i,status:()=>i.status,cancel:o,continue:()=>(n?.(),i),cancelRetry:l,continueRetry:c,canStart:u,start:()=>(u()?b():x().then(b),i)}}var Gx=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),ah(this.gcTime)&&(this.#e=si.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(hi?1/0:300*1e3))}clearGcTimeout(){this.#e&&(si.clearTimeout(this.#e),this.#e=void 0)}},ik=class extends Gx{#e;#t;#s;#n;#r;#o;#a;constructor(r){super(),this.#a=!1,this.#o=r.defaultOptions,this.setOptions(r.options),this.observers=[],this.#n=r.client,this.#s=this.#n.getQueryCache(),this.queryKey=r.queryKey,this.queryHash=r.queryHash,this.#e=Cm(this.options),this.state=r.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(r){if(this.options={...this.#o,...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=Cm(this.options);t.data!==void 0&&(this.setData(t.data,{updatedAt:t.dataUpdatedAt,manual:!0}),this.#e=t)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#s.remove(this)}setData(r,t){const s=ch(this.state.data,r,this.options);return this.#i({data:s,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),s}setState(r,t){this.#i({type:"setState",state:r,setStateOptions:t})}cancel(r){const t=this.#r?.promise;return this.#r?.cancel(r),t?t.then(Bs).catch(Bs):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(r=>ur(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ju||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>Mn(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!Bx(this.state.dataUpdatedAt,r)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(t=>t!==r),this.observers.length||(this.#r&&(this.#a?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#s.notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(r,t){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(r&&this.setOptions(r),!this.options.queryFn){const l=this.observers.find(c=>c.options.queryFn);l&&this.setOptions(l.options)}const s=new AbortController,n=l=>{Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(this.#a=!0,s.signal)})},i=()=>{const l=Qx(this.options,t),h=(()=>{const u={client:this.#n,queryKey:this.queryKey,meta:this.meta};return n(u),u})();return this.#a=!1,this.options.persister?this.options.persister(l,h,this):l(h)},o=(()=>{const l={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:i};return n(l),l})();this.options.behavior?.onFetch(o,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==o.fetchOptions?.meta)&&this.#i({type:"fetch",meta:o.fetchOptions?.meta}),this.#r=Hx({initialPromise:t?.initialPromise,fn:o.fetchFn,onCancel:l=>{l instanceof hh&&l.revert&&this.setState({...this.#t,fetchStatus:"idle"}),s.abort()},onFail:(l,c)=>{this.#i({type:"failed",failureCount:l,error:c})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0});try{const l=await this.#r.start();if(l===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(l),this.#s.config.onSuccess?.(l,this),this.#s.config.onSettled?.(l,this.state.error,this),l}catch(l){if(l instanceof hh){if(l.silent)return this.#r.promise;if(l.revert){if(this.state.data===void 0)throw l;return this.state.data}}throw this.#i({type:"error",error:l}),this.#s.config.onError?.(l,this),this.#s.config.onSettled?.(this.state.data,l,this),l}finally{this.scheduleGc()}}#i(r){const t=s=>{switch(r.type){case"failed":return{...s,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...Kx(s.data,this.options),fetchMeta:r.meta??null};case"success":const n={...s,data:r.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=r.manual?n:void 0,n;case"error":const i=r.error;return{...s,error:i,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...r.state}}};this.state=t(this.state),bs.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#s.notify({query:this,type:"updated",action:r})})}};function Kx(r,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:qx(t.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function Cm(r){const t=typeof r.initialData=="function"?r.initialData():r.initialData,s=t!==void 0,n=s?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var ak=class extends co{constructor(r,t){super(),this.options=t,this.#e=r,this.#i=null,this.#a=dh(),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#s=void 0;#n=void 0;#r;#o;#a;#i;#p;#u;#f;#c;#d;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Am(this.#t,this.options)?this.#h():this.updateResult(),this.#j())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return uh(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return uh(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#b(),this.#v(),this.#t.removeObserver(this)}setOptions(r){const t=this.options,s=this.#t;if(this.options=this.#e.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ur(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),t._defaulted&&!oh(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const n=this.hasListeners();n&&Tm(this.#t,s,this.options,t)&&this.#h(),this.updateResult(),n&&(this.#t!==s||ur(this.options.enabled,this.#t)!==ur(t.enabled,this.#t)||Mn(this.options.staleTime,this.#t)!==Mn(t.staleTime,this.#t))&&this.#g();const i=this.#x();n&&(this.#t!==s||ur(this.options.enabled,this.#t)!==ur(t.enabled,this.#t)||i!==this.#l)&&this.#y(i)}getOptimisticResult(r){const t=this.#e.getQueryCache().build(this.#e,r),s=this.createResult(t,r);return lk(this,s)&&(this.#n=s,this.#o=this.options,this.#r=this.#t.state),s}getCurrentResult(){return this.#n}trackResult(r,t){return new Proxy(r,{get:(s,n)=>(this.trackProp(n),t?.(n),n==="promise"&&!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(s,n))})}trackProp(r){this.#m.add(r)}getCurrentQuery(){return this.#t}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const t=this.#e.defaultQueryOptions(r),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(r){return this.#h({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#h(r){this.#w();let t=this.#t.fetch(this.options,r);return r?.throwOnError||(t=t.catch(Bs)),t}#g(){this.#b();const r=Mn(this.options.staleTime,this.#t);if(hi||this.#n.isStale||!ah(r))return;const s=Bx(this.#n.dataUpdatedAt,r)+1;this.#c=si.setTimeout(()=>{this.#n.isStale||this.updateResult()},s)}#x(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(r){this.#v(),this.#l=r,!(hi||ur(this.options.enabled,this.#t)===!1||!ah(this.#l)||this.#l===0)&&(this.#d=si.setInterval(()=>{(this.options.refetchIntervalInBackground||bu.isFocused())&&this.#h()},this.#l))}#j(){this.#g(),this.#y(this.#x())}#b(){this.#c&&(si.clearTimeout(this.#c),this.#c=void 0)}#v(){this.#d&&(si.clearInterval(this.#d),this.#d=void 0)}createResult(r,t){const s=this.#t,n=this.options,i=this.#n,a=this.#r,o=this.#o,c=r!==s?r.state:this.#s,{state:h}=r;let u={...h},m=!1,p;if(t._optimisticResults){const N=this.hasListeners(),k=!N&&Am(r,t),S=N&&Tm(r,s,t,n);(k||S)&&(u={...u,...Kx(h.data,r.options)}),t._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:x,errorUpdatedAt:b,status:w}=u;p=u.data;let C=!1;if(t.placeholderData!==void 0&&p===void 0&&w==="pending"){let N;i?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(N=i.data,C=!0):N=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,N!==void 0&&(w="success",p=ch(i?.data,N,t),m=!0)}if(t.select&&p!==void 0&&!C)if(i&&p===a?.data&&t.select===this.#p)p=this.#u;else try{this.#p=t.select,p=t.select(p),p=ch(i?.data,p,t),this.#u=p,this.#i=null}catch(N){this.#i=N}this.#i&&(x=this.#i,p=this.#u,b=Date.now(),w="error");const A=u.fetchStatus==="fetching",_=w==="pending",R=w==="error",E=_&&A,T=p!==void 0,I={status:w,fetchStatus:u.fetchStatus,isPending:_,isSuccess:w==="success",isError:R,isInitialLoading:E,isLoading:E,data:p,dataUpdatedAt:u.dataUpdatedAt,error:x,errorUpdatedAt:b,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:A,isRefetching:A&&!_,isLoadingError:R&&!T,isPaused:u.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:R&&T,isStale:vu(r,t),refetch:this.refetch,promise:this.#a,isEnabled:ur(t.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const N=L=>{I.status==="error"?L.reject(I.error):I.data!==void 0&&L.resolve(I.data)},k=()=>{const L=this.#a=I.promise=dh();N(L)},S=this.#a;switch(S.status){case"pending":r.queryHash===s.queryHash&&N(S);break;case"fulfilled":(I.status==="error"||I.data!==S.value)&&k();break;case"rejected":(I.status!=="error"||I.error!==S.reason)&&k();break}}return I}updateResult(){const r=this.#n,t=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#o=this.options,this.#r.data!==void 0&&(this.#f=this.#t),oh(t,r))return;this.#n=t;const s=()=>{if(!r)return!0;const{notifyOnChangeProps:n}=this.options,i=typeof n=="function"?n():n;if(i==="all"||!i&&!this.#m.size)return!0;const a=new Set(i??this.#m);return this.options.throwOnError&&a.add("error"),Object.keys(this.#n).some(o=>{const l=o;return this.#n[l]!==r[l]&&a.has(l)})};this.#S({listeners:s()})}#w(){const r=this.#e.getQueryCache().build(this.#e,this.options);if(r===this.#t)return;const t=this.#t;this.#t=r,this.#s=r.state,this.hasListeners()&&(t?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#j()}#S(r){bs.batch(()=>{r.listeners&&this.listeners.forEach(t=>{t(this.#n)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function ok(r,t){return ur(t.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&t.retryOnMount===!1)}function Am(r,t){return ok(r,t)||r.state.data!==void 0&&uh(r,t,t.refetchOnMount)}function uh(r,t,s){if(ur(t.enabled,r)!==!1&&Mn(t.staleTime,r)!=="static"){const n=typeof s=="function"?s(r):s;return n==="always"||n!==!1&&vu(r,t)}return!1}function Tm(r,t,s,n){return(r!==t||ur(n.enabled,r)===!1)&&(!s.suspense||r.state.status!=="error")&&vu(r,s)}function vu(r,t){return ur(t.enabled,r)!==!1&&r.isStaleByTime(Mn(t.staleTime,r))}function lk(r,t){return!oh(r.getCurrentResult(),t)}function Pm(r){return{onFetch:(t,s)=>{const n=t.options,i=t.fetchOptions?.meta?.fetchMore?.direction,a=t.state.data?.pages||[],o=t.state.data?.pageParams||[];let l={pages:[],pageParams:[]},c=0;const h=async()=>{let u=!1;const m=b=>{Object.defineProperty(b,"signal",{enumerable:!0,get:()=>(t.signal.aborted?u=!0:t.signal.addEventListener("abort",()=>{u=!0}),t.signal)})},p=Qx(t.options,t.fetchOptions),x=async(b,w,C)=>{if(u)return Promise.reject();if(w==null&&b.pages.length)return Promise.resolve(b);const _=(()=>{const M={client:t.client,queryKey:t.queryKey,pageParam:w,direction:C?"backward":"forward",meta:t.options.meta};return m(M),M})(),R=await p(_),{maxPages:E}=t.options,T=C?Z1:X1;return{pages:T(b.pages,R,E),pageParams:T(b.pageParams,w,E)}};if(i&&a.length){const b=i==="backward",w=b?ck:_m,C={pages:a,pageParams:o},A=w(n,C);l=await x(C,A,b)}else{const b=r??a.length;do{const w=c===0?o[0]??n.initialPageParam:_m(n,l);if(c>0&&w==null)break;l=await x(l,w),c++}while(c<b)}return l};t.options.persister?t.fetchFn=()=>t.options.persister?.(h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},s):t.fetchFn=h}}}function _m(r,{pages:t,pageParams:s}){const n=t.length-1;return t.length>0?r.getNextPageParam(t[n],t,s[n],s):void 0}function ck(r,{pages:t,pageParams:s}){return t.length>0?r.getPreviousPageParam?.(t[0],t,s[0],s):void 0}var dk=class extends Gx{#e;#t;#s;#n;constructor(r){super(),this.#e=r.client,this.mutationId=r.mutationId,this.#s=r.mutationCache,this.#t=[],this.state=r.state||hk(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){this.#t.includes(r)||(this.#t.push(r),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){this.#t=this.#t.filter(t=>t!==r),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#s.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(r){const t=()=>{this.#r({type:"continue"})},s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#n=Hx({fn:()=>this.options.mutationFn?this.options.mutationFn(r,s):Promise.reject(new Error("No mutationFn found")),onFail:(a,o)=>{this.#r({type:"failed",failureCount:a,error:o})},onPause:()=>{this.#r({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});const n=this.state.status==="pending",i=!this.#n.canStart();try{if(n)t();else{this.#r({type:"pending",variables:r,isPaused:i}),await this.#s.config.onMutate?.(r,this,s);const o=await this.options.onMutate?.(r,s);o!==this.state.context&&this.#r({type:"pending",context:o,variables:r,isPaused:i})}const a=await this.#n.start();return await this.#s.config.onSuccess?.(a,r,this.state.context,this,s),await this.options.onSuccess?.(a,r,this.state.context,s),await this.#s.config.onSettled?.(a,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(a,null,r,this.state.context,s),this.#r({type:"success",data:a}),a}catch(a){try{throw await this.#s.config.onError?.(a,r,this.state.context,this,s),await this.options.onError?.(a,r,this.state.context,s),await this.#s.config.onSettled?.(void 0,a,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,a,r,this.state.context,s),a}finally{this.#r({type:"error",error:a})}}finally{this.#s.runNext(this)}}#r(r){const t=s=>{switch(r.type){case"failed":return{...s,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...s,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:r.error,failureCount:s.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=t(this.state),bs.batch(()=>{this.#t.forEach(s=>{s.onMutationUpdate(r)}),this.#s.notify({mutation:this,type:"updated",action:r})})}};function hk(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var uk=class extends co{constructor(r={}){super(),this.config=r,this.#e=new Set,this.#t=new Map,this.#s=0}#e;#t;#s;build(r,t,s){const n=new dk({client:r,mutationCache:this,mutationId:++this.#s,options:r.defaultMutationOptions(t),state:s});return this.add(n),n}add(r){this.#e.add(r);const t=Eo(r);if(typeof t=="string"){const s=this.#t.get(t);s?s.push(r):this.#t.set(t,[r])}this.notify({type:"added",mutation:r})}remove(r){if(this.#e.delete(r)){const t=Eo(r);if(typeof t=="string"){const s=this.#t.get(t);if(s)if(s.length>1){const n=s.indexOf(r);n!==-1&&s.splice(n,1)}else s[0]===r&&this.#t.delete(t)}}this.notify({type:"removed",mutation:r})}canRun(r){const t=Eo(r);if(typeof t=="string"){const n=this.#t.get(t)?.find(i=>i.state.status==="pending");return!n||n===r}else return!0}runNext(r){const t=Eo(r);return typeof t=="string"?this.#t.get(t)?.find(n=>n!==r&&n.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){bs.batch(()=>{this.#e.forEach(r=>{this.notify({type:"removed",mutation:r})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(r){const t={exact:!0,...r};return this.getAll().find(s=>Sm(t,s))}findAll(r={}){return this.getAll().filter(t=>Sm(r,t))}notify(r){bs.batch(()=>{this.listeners.forEach(t=>{t(r)})})}resumePausedMutations(){const r=this.getAll().filter(t=>t.state.isPaused);return bs.batch(()=>Promise.all(r.map(t=>t.continue().catch(Bs))))}};function Eo(r){return r.options.scope?.id}var fk=class extends co{constructor(r={}){super(),this.config=r,this.#e=new Map}#e;build(r,t,s){const n=t.queryKey,i=t.queryHash??yu(n,t);let a=this.get(i);return a||(a=new ik({client:r,queryKey:n,queryHash:i,options:r.defaultQueryOptions(t),state:s,defaultOptions:r.getQueryDefaults(n)}),this.add(a)),a}add(r){this.#e.has(r.queryHash)||(this.#e.set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const t=this.#e.get(r.queryHash);t&&(r.destroy(),t===r&&this.#e.delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){bs.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return this.#e.get(r)}getAll(){return[...this.#e.values()]}find(r){const t={exact:!0,...r};return this.getAll().find(s=>wm(t,s))}findAll(r={}){const t=this.getAll();return Object.keys(r).length>0?t.filter(s=>wm(r,s)):t}notify(r){bs.batch(()=>{this.listeners.forEach(t=>{t(r)})})}onFocus(){bs.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){bs.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},mk=class{#e;#t;#s;#n;#r;#o;#a;#i;constructor(r={}){this.#e=r.queryCache||new fk,this.#t=r.mutationCache||new uk,this.#s=r.defaultOptions||{},this.#n=new Map,this.#r=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=bu.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=Ll.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#i?.(),this.#i=void 0)}isFetching(r){return this.#e.findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return this.#t.findAll({...r,status:"pending"}).length}getQueryData(r){const t=this.defaultQueryOptions({queryKey:r});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(r){const t=this.defaultQueryOptions(r),s=this.#e.build(this,t),n=s.state.data;return n===void 0?this.fetchQuery(r):(r.revalidateIfStale&&s.isStaleByTime(Mn(t.staleTime,s))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(r){return this.#e.findAll(r).map(({queryKey:t,state:s})=>{const n=s.data;return[t,n]})}setQueryData(r,t,s){const n=this.defaultQueryOptions({queryKey:r}),a=this.#e.get(n.queryHash)?.state.data,o=G1(t,a);if(o!==void 0)return this.#e.build(this,n).setData(o,{...s,manual:!0})}setQueriesData(r,t,s){return bs.batch(()=>this.#e.findAll(r).map(({queryKey:n})=>[n,this.setQueryData(n,t,s)]))}getQueryState(r){const t=this.defaultQueryOptions({queryKey:r});return this.#e.get(t.queryHash)?.state}removeQueries(r){const t=this.#e;bs.batch(()=>{t.findAll(r).forEach(s=>{t.remove(s)})})}resetQueries(r,t){const s=this.#e;return bs.batch(()=>(s.findAll(r).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...r},t)))}cancelQueries(r,t={}){const s={revert:!0,...t},n=bs.batch(()=>this.#e.findAll(r).map(i=>i.cancel(s)));return Promise.all(n).then(Bs).catch(Bs)}invalidateQueries(r,t={}){return bs.batch(()=>(this.#e.findAll(r).forEach(s=>{s.invalidate()}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},t)))}refetchQueries(r,t={}){const s={...t,cancelRefetch:t.cancelRefetch??!0},n=bs.batch(()=>this.#e.findAll(r).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let a=i.fetch(void 0,s);return s.throwOnError||(a=a.catch(Bs)),i.state.fetchStatus==="paused"?Promise.resolve():a}));return Promise.all(n).then(Bs)}fetchQuery(r){const t=this.defaultQueryOptions(r);t.retry===void 0&&(t.retry=!1);const s=this.#e.build(this,t);return s.isStaleByTime(Mn(t.staleTime,s))?s.fetch(t):Promise.resolve(s.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(Bs).catch(Bs)}fetchInfiniteQuery(r){return r.behavior=Pm(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(Bs).catch(Bs)}ensureInfiniteQueryData(r){return r.behavior=Pm(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return Ll.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#s}setDefaultOptions(r){this.#s=r}setQueryDefaults(r,t){this.#n.set($a(r),{queryKey:r,defaultOptions:t})}getQueryDefaults(r){const t=[...this.#n.values()],s={};return t.forEach(n=>{Va(r,n.queryKey)&&Object.assign(s,n.defaultOptions)}),s}setMutationDefaults(r,t){this.#r.set($a(r),{mutationKey:r,defaultOptions:t})}getMutationDefaults(r){const t=[...this.#r.values()],s={};return t.forEach(n=>{Va(r,n.mutationKey)&&Object.assign(s,n.defaultOptions)}),s}defaultQueryOptions(r){if(r._defaulted)return r;const t={...this.#s.queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return t.queryHash||(t.queryHash=yu(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===ju&&(t.enabled=!1),t}defaultMutationOptions(r){return r?._defaulted?r:{...this.#s.mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Yx=j.createContext(void 0),pk=r=>{const t=j.useContext(Yx);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},gk=({client:r,children:t})=>(j.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),e.jsx(Yx.Provider,{value:r,children:t})),Xx=j.createContext(!1),xk=()=>j.useContext(Xx);Xx.Provider;function yk(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var jk=j.createContext(yk()),bk=()=>j.useContext(jk),vk=(r,t)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(t.isReset()||(r.retryOnMount=!1))},wk=r=>{j.useEffect(()=>{r.clearReset()},[r])},Sk=({result:r,errorResetBoundary:t,throwOnError:s,query:n,suspense:i})=>r.isError&&!t.isReset()&&!r.isFetching&&n&&(i&&r.data===void 0||J1(s,[r.error,n])),Ok=r=>{if(r.suspense){const s=i=>i==="static"?i:Math.max(i??1e3,1e3),n=r.staleTime;r.staleTime=typeof n=="function"?(...i)=>s(n(...i)):s(n),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3))}},kk=(r,t)=>r.isLoading&&r.isFetching&&!t,Ck=(r,t)=>r?.suspense&&t.isPending,Em=(r,t,s)=>t.fetchOptimistic(r).catch(()=>{s.clearReset()});function Ak(r,t,s){const n=xk(),i=bk(),a=pk(),o=a.defaultQueryOptions(r);a.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=n?"isRestoring":"optimistic",Ok(o),vk(o,i),wk(i);const l=!a.getQueryCache().get(o.queryHash),[c]=j.useState(()=>new t(a,o)),h=c.getOptimisticResult(o),u=!n&&r.subscribed!==!1;if(j.useSyncExternalStore(j.useCallback(m=>{const p=u?c.subscribe(bs.batchCalls(m)):Bs;return c.updateResult(),p},[c,u]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),j.useEffect(()=>{c.setOptions(o)},[o,c]),Ck(o,h))throw Em(o,c,i);if(Sk({result:h,errorResetBoundary:i,throwOnError:o.throwOnError,query:a.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw h.error;return a.getDefaultOptions().queries?._experimental_afterQuery?.(o,h),o.experimental_prefetchInRender&&!hi&&kk(h,n)&&(l?Em(o,c,i):a.getQueryCache().get(o.queryHash)?.promise)?.catch(Bs).finally(()=>{c.updateResult()}),o.notifyOnChangeProps?h:c.trackResult(h)}function Qe(r,t){return Ak(r,ak)}const Tk=async()=>{throw new Error("AWS Amplify Auth is not configured")},Pk=async()=>{throw new Error("AWS Amplify Auth is not configured")},_k=async()=>{throw new Error("AWS Amplify Auth is not configured")};const Ek=async()=>{throw new Error("AWS Amplify Auth is not configured")},Ik=async()=>{throw new Error("AWS Amplify Auth is not configured")},Dk=async()=>{throw new Error("AWS Amplify Auth is not configured")},Rk=async()=>{throw new Error("AWS Amplify Auth is not configured")},Mk={configure:()=>{},getConfig:()=>({})},wu=()=>typeof window<"u"&&window.__CONFIG__?window.__CONFIG__:{},Wr=()=>{const r=wu(),t=r.USER_POOL_ID||"",s=r.USER_POOL_CLIENT_ID||"";return!!(t&&s&&t!==""&&s!==""&&t!=="us-east-1_DUMMY"&&s!=="dummy-client-id")},Lk=()=>{const r=wu();return{Auth:{Cognito:{userPoolId:r.USER_POOL_ID||""||"us-east-1_DUMMY",userPoolClientId:r.USER_POOL_CLIENT_ID||""||"dummy-client-id",region:"us-east-1",signUpVerificationMethod:"code",loginWith:{oauth:{domain:r.USER_POOL_DOMAIN||""||"dummy-domain",scopes:["email","profile","openid"],redirectSignIn:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",redirectSignOut:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",responseType:"code"},username:!0,email:!0}}}}};function Fk(){try{const r=Lk(),t=wu();console.log("🔧 [AMPLIFY CONFIG] Configuration details:",{userPoolId:r.Auth.Cognito.userPoolId,clientId:r.Auth.Cognito.userPoolClientId,domain:r.Auth.Cognito.loginWith.oauth.domain,runtimeConfigAvailable:!!Object.keys(t).length,isCognitoConfigured:Wr()}),Wr()||(console.warn("⚠️  Cognito not configured - using dummy values for development"),console.log("Environment variables needed:"),console.log("- VITE_COGNITO_USER_POOL_ID"),console.log("- VITE_COGNITO_CLIENT_ID"),console.log("- VITE_COGNITO_DOMAIN"),console.log("Or set runtime config in window.__CONFIG__")),Mk.configure(r),console.log("✅ Amplify configured successfully")}catch(r){console.error("❌ Failed to configure Amplify:",r)}}const Im="dev_users",ld="dev_session",Dm="dev_pending";class Ht{constructor(){this.users=this.loadUsers(),this.session=this.loadSession(),this.pendingVerifications=this.loadPendingVerifications(),this.ensureDevUser()}loadUsers(){if(typeof localStorage>"u")return{};const t=localStorage.getItem(Im);return t?JSON.parse(t):{}}saveUsers(){typeof localStorage<"u"&&localStorage.setItem(Im,JSON.stringify(this.users))}loadSession(){if(typeof localStorage>"u")return null;const t=localStorage.getItem(ld);return t?JSON.parse(t):null}saveSession(t){this.session=t,typeof localStorage<"u"&&localStorage.setItem(ld,JSON.stringify(t))}clearSession(){this.session=null,typeof localStorage<"u"&&localStorage.removeItem(ld)}loadPendingVerifications(){if(typeof localStorage>"u")return{};const t=localStorage.getItem(Dm);return t?JSON.parse(t):{}}savePendingVerifications(){typeof localStorage<"u"&&localStorage.setItem(Dm,JSON.stringify(this.pendingVerifications))}ensureDevUser(){const t={username:"devuser",email:"argeropolos@gmail.com",firstName:"Dev",lastName:"User",password:"password123",confirmed:!0,createdAt:Date.now()};this.users.devuser=t,this.users["argeropolos@gmail.com"]=t,this.saveUsers(),typeof console<"u"&&(console.log("🔧 DEV: Ensured default dev user exists"),console.log("📧 Email: argeropolos@gmail.com"),console.log("🔑 Username: devuser"),console.log("🔒 Password: password123"),console.log("✅ User can sign in with either email or username"))}generateVerificationCode(){return Math.floor(1e5+Math.random()*9e5).toString()}generateDevTokens(t){return{accessToken:"dev-bypass-token",idToken:"dev-bypass-token",refreshToken:"dev-bypass-token"}}async signUp(t,s,n,i,a){if(this.users[t])throw new Error("UsernameExistsException: Username already exists");if(this.pendingVerifications[t])throw new Error("UsernameExistsException: Username already exists");if(Object.values(this.users).find(h=>h.email===n))throw new Error("UsernameExistsException: Email already exists");if(Object.values(this.pendingVerifications).find(h=>h.email===n))throw new Error("UsernameExistsException: Email already exists");const c=this.generateVerificationCode();return this.pendingVerifications[t]={username:t,password:s,email:n,firstName:i,lastName:a,verificationCode:c,createdAt:Date.now()},this.savePendingVerifications(),typeof console<"u"&&(console.log("📧 DEV: Email verification code sent to",n),console.log("🔑 DEV: Verification code:",c),console.log("📧 DEV AUTH: Verification code for",n,":",c),console.log("🔑 DEV AUTH: Copy this code to complete registration")),typeof window<"u"&&window.DEV_AUTH_DEBUG!==!1&&(window.lastDevCode=c,typeof console<"u"&&console.log("💡 DEV AUTH: Access code via window.lastDevCode")),typeof window<"u"&&window.location&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&typeof window.alert=="function"&&setTimeout(()=>{alert(`🔑 DEV AUTH VERIFICATION CODE

For: ${n}
Code: ${c}

Copy this code to complete your registration.`)},100),{isSignUpComplete:!1,nextStep:{signUpStep:"CONFIRM_SIGN_UP",codeDeliveryDetails:{deliveryMedium:"EMAIL",destination:n}}}}async confirmSignUp(t,s){typeof console<"u"&&console.log("🔧 DEV: Confirming sign up for",t);const n=this.pendingVerifications[t];if(!n)throw new Error("UserNotFoundException: User not found");if(n.verificationCode!==s)throw new Error("CodeMismatchException: Invalid verification code");if(Date.now()-n.createdAt>300*1e3)throw new Error("ExpiredCodeException: Verification code has expired");return this.users[t]={username:t,email:n.email,firstName:n.firstName,lastName:n.lastName,password:n.password,confirmed:!0,createdAt:Date.now()},this.saveUsers(),delete this.pendingVerifications[t],this.savePendingVerifications(),typeof console<"u"&&console.log("✅ DEV: User confirmed successfully"),{isSignUpComplete:!0}}async signIn(t,s){typeof console<"u"&&console.log("🔧 DEV: Signing in user",t);let n=this.users[t],i=t;if(!n){const l=Object.entries(this.users).find(([,c])=>c.email===t);l&&(i=l[0],n=l[1],typeof console<"u"&&console.log("🔧 DEV: Found user by email, username is",i))}if(!n)throw this.pendingVerifications[t]?new Error("UserNotConfirmedException: User not confirmed"):Object.values(this.pendingVerifications).find(h=>h.email===t)?new Error("UserNotConfirmedException: User not confirmed"):new Error("UserNotFoundException: User not found");if(!n.confirmed)throw new Error("UserNotConfirmedException: User not confirmed");if(n.password!==s)throw new Error("NotAuthorizedException: Invalid password");const a=this.generateDevTokens(i),o={user:{username:n.username,userId:`dev-${n.username}`,email:n.email,firstName:n.firstName,lastName:n.lastName},tokens:a,expiresAt:Date.now()+36e5};return this.saveSession(o),typeof console<"u"&&console.log("✅ DEV: User signed in successfully"),{isSignedIn:!0,user:o.user,tokens:o.tokens}}async signOut(){return typeof console<"u"&&console.log("🔧 DEV: Signing out user"),this.clearSession(),!0}async getCurrentUser(){if(typeof window<"u"&&window.__DEV_AUTH_OVERRIDE__)return window.__DEV_AUTH_OVERRIDE__.user;if(!this.session||Date.now()>this.session.expiresAt)throw new Error("No authenticated user");return this.session.user}async fetchAuthSession(){if(typeof window<"u"&&window.__DEV_AUTH_OVERRIDE__)return{tokens:window.__DEV_AUTH_OVERRIDE__.tokens};if(!this.session||Date.now()>this.session.expiresAt)throw new Error("No valid session");return{tokens:this.session.tokens}}async resetPassword(t){typeof console<"u"&&console.log("🔧 DEV: Initiating password reset for",t);const s=this.users[t];if(!s)throw new Error("UserNotFoundException: User not found");const n=this.generateVerificationCode();return this.pendingVerifications[`reset_${t}`]={username:t,resetCode:n,createdAt:Date.now()},this.savePendingVerifications(),typeof console<"u"&&(console.log("📧 DEV: Password reset code sent to",s.email),console.log("🔑 DEV: Reset code:",n),console.log("📧 DEV AUTH: Password reset code for",s.email,":",n),console.log("🔑 DEV AUTH: Copy this code to reset your password")),typeof window<"u"&&window.DEV_AUTH_DEBUG!==!1&&(window.lastDevResetCode=n,typeof console<"u"&&console.log("💡 DEV AUTH: Access code via window.lastDevResetCode")),typeof window<"u"&&window.location&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&typeof window.alert=="function"&&setTimeout(()=>{alert(`🔑 DEV AUTH PASSWORD RESET CODE

For: ${s.email}
Reset Code: ${n}

Copy this code to reset your password.`)},100),{nextStep:{resetPasswordStep:"CONFIRM_RESET_PASSWORD_WITH_CODE",codeDeliveryDetails:{deliveryMedium:"EMAIL",destination:s.email}}}}async confirmResetPassword(t,s,n){typeof console<"u"&&console.log("🔧 DEV: Confirming password reset for",t);const i=`reset_${t}`,a=this.pendingVerifications[i];if(!a)throw new Error("Invalid reset request");if(a.resetCode!==s)throw new Error("CodeMismatchException: Invalid verification code");if(Date.now()-a.createdAt>300*1e3)throw new Error("ExpiredCodeException: Verification code has expired");return this.users[t].password=n,this.saveUsers(),delete this.pendingVerifications[i],this.savePendingVerifications(),typeof console<"u"&&console.log("✅ DEV: Password reset successfully"),!0}isAuthenticated(){return!!(this.session&&Date.now()<this.session.expiresAt)}getCurrentUserInfo(){return this.isAuthenticated()?this.session.user:null}async signUpWrapper(t){try{const{username:s,password:n,email:i,firstName:a,lastName:o}=t;if(this.users[s])return{success:!1,error:{code:"UsernameExistsException",message:"Username already exists"}};if(this.pendingVerifications[s])return{success:!1,error:{code:"UsernameExistsException",message:"Username already exists"}};if(Object.values(this.users).find(u=>u.email===i))return{success:!1,error:{code:"UsernameExistsException",message:"Email already exists"}};if(Object.values(this.pendingVerifications).find(u=>u.email===i))return{success:!1,error:{code:"UsernameExistsException",message:"Email already exists"}};const h=await Ht.prototype.signUp.call(this,s,n,i,a||"Dev",o||"User");return{success:!0,user:{username:s,email:i},userConfirmed:!1,isSignUpComplete:h.isSignUpComplete,nextStep:h.nextStep}}catch(s){return{success:!1,error:{code:s.message.split(":")[0],message:s.message.split(":")[1]||s.message}}}}async signInWrapper(t,s){try{const n=await Ht.prototype.signIn.call(this,t,s);return{success:!0,user:n.user,tokens:n.tokens,isSignedIn:n.isSignedIn}}catch(n){return{success:!1,error:{code:n.message.split(":")[0],message:n.message.split(":")[1]||n.message}}}}validatePassword(t){const s=[];return t.length<8&&s.push("Password must be at least 8 characters long"),/[a-z]/.test(t)||s.push("Password must contain at least one lowercase letter"),/[A-Z]/.test(t)||s.push("Password must contain at least one uppercase letter"),/\d/.test(t)||s.push("Password must contain at least one digit"),/[!@#$%^&*(),.?":{}|<>]/.test(t)||s.push("Password must contain at least one special character"),{isValid:s.length===0,errors:s}}async getCurrentUserWrapper(){try{return{success:!0,user:await Ht.prototype.getCurrentUser.call(this)}}catch(t){return{success:!1,error:{code:"NotAuthorizedException",message:t.message}}}}async getJwtToken(){try{return(await this.fetchAuthSession()).tokens.accessToken}catch{return null}}async signOutWrapper(){try{return await Ht.prototype.signOut.call(this),{success:!0}}catch(t){return{success:!1,error:{code:"SignOutError",message:t.message}}}}async forgotPasswordWrapper(t){try{return await Ht.prototype.resetPassword.call(this,t),{success:!0}}catch(s){return{success:!1,error:{code:s.message.split(":")[0],message:s.message.split(":")[1]||s.message}}}}async confirmResetPasswordWrapper(t,s,n){try{return await Ht.prototype.confirmResetPassword.call(this,t,s,n),{success:!0}}catch(i){return{success:!1,error:{code:i.message.split(":")[0],message:i.message.split(":")[1]||i.message}}}}validateJwtToken(t){return!!(t&&typeof t=="string"&&t.length>0)}isTokenExpired(t){return!1}async confirmMFA(t,s){return{success:!0,user:t||{username:"testuser"}}}async updateUserAttributes(t,s){try{return this.users[t.username]&&(Object.assign(this.users[t.username],s),this.saveUsers()),{success:!0}}catch(n){return{success:!1,error:{code:"UpdateAttributesError",message:n.message}}}}}const Ye=new Ht;Ye.signUp=(...r)=>{if(r.length===1&&typeof r[0]=="object")return Ye.signUpWrapper(r[0]);{const[t,s,n,i,a]=r;return Ye.signUpWrapper({username:t,password:s,email:n,firstName:i,lastName:a})}};Ye.signIn=(...r)=>Ye.signInWrapper(...r);Ye.getCurrentUser=(...r)=>Ye.getCurrentUserWrapper(...r);Ye.signOut=(...r)=>Ye.signOutWrapper(...r);Ye.forgotPassword=(...r)=>Ye.forgotPasswordWrapper(...r);Ye.forgotPasswordSubmit=(...r)=>Ye.confirmResetPasswordWrapper(...r);Ye.changePassword=(...r)=>Ye.confirmResetPasswordWrapper(...r);Ye.generateVerificationCode=(...r)=>Ht.prototype.generateVerificationCode.call(Ye,...r);Ye.generateDevTokens=(...r)=>Ht.prototype.generateDevTokens.call(Ye,...r);Ye.loadUsers=(...r)=>Ht.prototype.loadUsers.call(Ye,...r);Ye.saveUsers=(...r)=>Ht.prototype.saveUsers.call(Ye,...r);Ye.loadSession=(...r)=>Ht.prototype.loadSession.call(Ye,...r);Ye.saveSession=(...r)=>Ht.prototype.saveSession.call(Ye,...r);Ye.loadPendingVerifications=(...r)=>Ht.prototype.loadPendingVerifications.call(Ye,...r);Ye.savePendingVerifications=(...r)=>Ht.prototype.savePendingVerifications.call(Ye,...r);Ye.confirmSignUp=(...r)=>Ht.prototype.confirmSignUp.call(Ye,...r);Ye.validateJwtToken=(...r)=>Ht.prototype.validateJwtToken.call(Ye,...r);Ye.isTokenExpired=(...r)=>Ht.prototype.isTokenExpired.call(Ye,...r);Ye.confirmMFA=(...r)=>Ht.prototype.confirmMFA.call(Ye,...r);Ye.updateUserAttributes=(...r)=>Ht.prototype.updateUserAttributes.call(Ye,...r);Ye.validatePassword=(...r)=>Ht.prototype.validatePassword.call(Ye,...r);Ye.ensureDevUser=(...r)=>Ht.prototype.ensureDevUser.call(Ye,...r);class Nk{constructor(){this.refreshTimer=null,this.warningTimer=null,this.sessionTimeoutTimer=null,this.isRefreshing=!1,this.config={tokenRefreshInterval:2700*1e3,sessionTimeout:480*60*1e3,warningTime:600*1e3,maxRefreshAttempts:3,rememberMeDuration:720*60*60*1e3},this.callbacks={onTokenRefresh:null,onSessionWarning:null,onSessionExpired:null,onRefreshError:null},this.sessionData={lastActivity:Date.now(),loginTime:null,refreshAttempts:0,rememberMe:!1}}initialize(t){this.authContext=t,this.setupEventListeners(),this.startSessionTracking(),this.scheduleTokenRefresh(),console.log("🔐 Session manager initialized")}setCallbacks(t){this.callbacks={...this.callbacks,...t}}startSession(t=!1){const s=Date.now();this.sessionData={lastActivity:s,loginTime:s,refreshAttempts:0,rememberMe:t};const n=t?localStorage:sessionStorage;n.setItem("sessionStart",s.toString()),n.setItem("rememberMe",t.toString()),this.startSessionTracking(),this.scheduleTokenRefresh(),console.log(`🔐 Session started (remember me: ${t})`)}endSession(){this.clearAllTimers(),this.clearSessionStorage(),console.log("🔐 Session ended")}updateActivity(){this.sessionData.lastActivity=Date.now(),this.sessionTimeoutTimer&&(clearTimeout(this.sessionTimeoutTimer),this.startSessionTimeout())}scheduleTokenRefresh(){this.refreshTimer&&clearInterval(this.refreshTimer),this.refreshTimer=setInterval(async()=>{await this.refreshTokens()},this.config.tokenRefreshInterval),console.log("🔄 Token refresh scheduled")}async refreshTokens(){if(!(this.isRefreshing||!this.authContext)){this.isRefreshing=!0;try{const t=await this.authContext.refreshSession();if(t.success)this.sessionData.refreshAttempts=0,console.log("✅ Tokens refreshed successfully"),this.callbacks.onTokenRefresh&&this.callbacks.onTokenRefresh(t);else throw new Error(t.error||"Token refresh failed")}catch(t){console.error("❌ Token refresh failed:",t),this.sessionData.refreshAttempts++,this.callbacks.onRefreshError&&this.callbacks.onRefreshError(t,this.sessionData.refreshAttempts),this.sessionData.refreshAttempts>=this.config.maxRefreshAttempts&&(console.error("❌ Max refresh attempts reached, logging out"),await this.handleSessionExpired())}finally{this.isRefreshing=!1}}}startSessionTracking(){this.startSessionTimeout(),this.startWarningTimer()}startSessionTimeout(){this.sessionTimeoutTimer&&clearTimeout(this.sessionTimeoutTimer);const t=this.sessionData.rememberMe?this.config.rememberMeDuration:this.config.sessionTimeout;this.sessionTimeoutTimer=setTimeout(async()=>{await this.handleSessionExpired()},t)}startWarningTimer(){this.warningTimer&&clearTimeout(this.warningTimer);const s=(this.sessionData.rememberMe?this.config.rememberMeDuration:this.config.sessionTimeout)-this.config.warningTime;this.warningTimer=setTimeout(()=>{this.handleSessionWarning()},s)}handleSessionWarning(){console.log("⚠️ Session expiring soon"),this.callbacks.onSessionWarning&&this.callbacks.onSessionWarning({timeRemaining:this.config.warningTime,canExtend:!0})}async handleSessionExpired(){console.log("❌ Session expired"),this.callbacks.onSessionExpired&&this.callbacks.onSessionExpired(),this.authContext&&await this.authContext.logout(),this.endSession()}extendSession(){console.log("🔄 Extending session"),this.updateActivity(),this.startSessionTimeout(),this.startWarningTimer()}setupEventListeners(){const t=["mousedown","mousemove","keypress","scroll","touchstart","click"],s=()=>{this.updateActivity()};t.forEach(n=>{document.addEventListener(n,s,!0)}),document.addEventListener("visibilitychange",()=>{document.hidden||this.updateActivity()})}clearAllTimers(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),this.warningTimer&&(clearTimeout(this.warningTimer),this.warningTimer=null),this.sessionTimeoutTimer&&(clearTimeout(this.sessionTimeoutTimer),this.sessionTimeoutTimer=null)}clearSessionStorage(){localStorage.removeItem("sessionStart"),localStorage.removeItem("rememberMe"),sessionStorage.removeItem("sessionStart"),sessionStorage.removeItem("rememberMe")}getSessionInfo(){const t=Date.now(),s=t-(this.sessionData.loginTime||t),n=this.sessionData.rememberMe?this.config.rememberMeDuration:this.config.sessionTimeout;return{isActive:!0,sessionDuration:s,timeRemaining:n-s,lastActivity:this.sessionData.lastActivity,rememberMe:this.sessionData.rememberMe,refreshAttempts:this.sessionData.refreshAttempts}}isSessionValid(){const t=Date.now(),s=t-(this.sessionData.loginTime||t),n=this.sessionData.rememberMe?this.config.rememberMeDuration:this.config.sessionTimeout;return s<n}}const Si=new Nk,Wk=({open:r,timeRemaining:t,onExtend:s,onLogout:n,onClose:i})=>{const[a,o]=j.useState(t),[l,c]=j.useState(!1),h=j.useRef(!0);j.useEffect(()=>{o(t)},[t]),j.useEffect(()=>{if(!r)return;const x=setInterval(()=>{if(!h.current){clearInterval(x);return}o(b=>{const w=b-1e3;return w<=0?(clearInterval(x),h.current&&n(),0):w})},1e3);return()=>{clearInterval(x)}},[r,n]),j.useEffect(()=>()=>{h.current=!1},[]);const u=async()=>{c(!0);try{await s(),i()}catch(x){console.error("Failed to extend session:",x)}finally{c(!1)}},m=x=>{const b=Math.max(0,Math.floor(x/1e3)),w=Math.floor(b/60),C=b%60;return`${w}:${C.toString().padStart(2,"0")}`},p=(t-a)/t*100;return e.jsxs(Os,{open:r,onClose:i,maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:!0,PaperProps:{sx:{borderRadius:2,border:"2px solid",borderColor:"warning.main"}},children:[e.jsx(Ls,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ar,{color:"warning"}),e.jsx(d,{variant:"h6",children:"Session Expiring Soon"})]})}),e.jsxs(ks,{children:[e.jsxs(we,{severity:"warning",sx:{mb:2},children:["Your session will expire in ",e.jsx("strong",{children:m(a)})]}),e.jsxs(g,{sx:{mb:2},children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:1,children:[e.jsx(Gw,{fontSize:"small"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Time Remaining"})]}),e.jsx(rt,{variant:"determinate",value:100-p,color:a<6e4?"error":"warning",sx:{height:8,borderRadius:4}})]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:'You will be automatically logged out when the timer reaches zero. Click "Stay Signed In" to extend your session.'})]}),e.jsxs(Is,{sx:{p:2,gap:1},children:[e.jsx(oe,{onClick:n,color:"error",variant:"outlined",disabled:l,children:"Sign Out Now"}),e.jsx(oe,{onClick:u,color:"primary",variant:"contained",disabled:l,startIcon:l?e.jsx(Je,{size:16}):null,children:l?"Extending...":"Stay Signed In"})]})]})},$k={user:null,isAuthenticated:!1,isLoading:!0,error:null,tokens:null},Ke={LOADING:"LOADING",LOGIN_SUCCESS:"LOGIN_SUCCESS",LOGIN_FAILURE:"LOGIN_FAILURE",LOGOUT:"LOGOUT",SET_ERROR:"SET_ERROR",CLEAR_ERROR:"CLEAR_ERROR",UPDATE_TOKENS:"UPDATE_TOKENS"};function Vk(r,t){switch(t.type){case Ke.LOADING:return{...r,isLoading:t.payload};case Ke.LOGIN_SUCCESS:return{...r,user:t.payload.user,tokens:t.payload.tokens,isAuthenticated:!0,isLoading:!1,error:null};case Ke.LOGIN_FAILURE:return{...r,user:null,tokens:null,isAuthenticated:!1,isLoading:!1,error:t.payload};case Ke.LOGOUT:return localStorage.removeItem("accessToken"),localStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("authToken"),{...r,user:null,tokens:null,isAuthenticated:!1,isLoading:!1,error:null};case Ke.SET_ERROR:return{...r,error:t.payload,isLoading:!1};case Ke.CLEAR_ERROR:return{...r,error:null};case Ke.UPDATE_TOKENS:return{...r,tokens:t.payload};default:return r}}const Zx=j.createContext(null),zk={user:null,isAuthenticated:!1,isLoading:!0,error:null,tokens:null,login:async()=>{},signup:async()=>{},confirmAccount:async()=>{},forgotPassword:async()=>{},resetPassword:async()=>{}};function Bk({children:r}){const[t,s]=j.useReducer(Vk,$k),[n,i]=j.useState({show:!1,timeRemaining:0}),a=j.useCallback(async()=>{try{const E=await Ek({forceRefresh:!0});return E.tokens?(s({type:Ke.UPDATE_TOKENS,payload:{accessToken:E.tokens.accessToken.toString(),idToken:E.tokens.idToken?.toString(),refreshToken:E.tokens.refreshToken?.toString()}}),{success:!0}):{success:!1,error:"No valid tokens"}}catch(E){return console.error("Session refresh error:",E),{success:!1,error:_(E)}}},[]),o=j.useCallback(async()=>{try{return localStorage.removeItem("accessToken"),localStorage.removeItem("authToken"),sessionStorage.removeItem("accessToken"),sessionStorage.removeItem("authToken"),Wr()?(await Tk(),s({type:Ke.LOGOUT}),{success:!0}):(console.log("Cognito not configured - using development authentication"),await Ye.signOut(),s({type:Ke.LOGOUT}),{success:!0})}catch(E){return console.error("Logout error:",E),s({type:Ke.LOGOUT}),{success:!1,error:_(E)}}},[]),l=j.useCallback(async()=>{try{if(s({type:Ke.LOADING,payload:!0}),(typeof globalThis<"u"&&globalThis.__vitest_worker__||typeof window<"u"&&window.__vitest_worker__||!1||typeof process<"u"&&!1||typeof window<"u"&&window.navigator?.userAgent?.includes("jsdom")||typeof globalThis<"u"&&(globalThis.vi||globalThis.vitest||globalThis.__vitest__))&&!(typeof window<"u"&&window.playwright)){console.log("Unit test environment detected - skipping auth check"),s({type:Ke.LOADING,payload:!1}),s({type:Ke.LOGOUT});return}const T=!0,M=Wr(),I=!0;if(!M||I){console.log(I?"🔧 DEVELOPMENT MODE - Dev auth forced via VITE_FORCE_DEV_AUTH=true":M?"🔧 DEVELOPMENT MODE - Using dev auth in DEV environment":"🔧 DEVELOPMENT MODE - Cognito not configured, using dev auth fallback");try{const N=await Ye.getCurrentUser(),k=await Ye.fetchAuthSession();if(N&&k.tokens){localStorage.setItem("accessToken",k.tokens.accessToken),s({type:Ke.LOGIN_SUCCESS,payload:{user:N,tokens:k.tokens}}),console.log("✅ Development user authenticated");return}}catch(N){console.log("No dev auth session found:",N.message)}}s({type:Ke.LOGOUT})}catch(E){console.log("Authentication check failed:",E),s({type:Ke.LOGOUT})}},[]);j.useEffect(()=>{l()},[l]),j.useEffect(()=>{if(t.isAuthenticated&&t.user)try{const E={refreshSession:a,logout:o};Si.initialize(E),Si.setCallbacks({onTokenRefresh:M=>{console.log("🔄 Tokens refreshed automatically")},onSessionWarning:M=>{i({show:!0,timeRemaining:M.timeRemaining})},onSessionExpired:async()=>{console.log("❌ Session expired, logging out"),await o()},onRefreshError:(M,I)=>{console.error(`❌ Token refresh failed (attempt ${I}):`,M)}});const T=localStorage.getItem("rememberMe")==="true";Si.startSession(T)}catch(E){console.error("❌ Failed to initialize session manager:",E)}else t.isAuthenticated||(Si.endSession(),i({show:!1,timeRemaining:0}));return()=>{Si.clearAllTimers()}},[t.isAuthenticated,t.user,a,o,i]);const c=async(E,T)=>{try{s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR});const M=!0,I=Wr(),N=!0;if(!I||N||!1){console.log(N?"🔧 DEVELOPMENT LOGIN - Dev auth forced via VITE_FORCE_DEV_AUTH=true":"🔧 DEVELOPMENT LOGIN - Using dev auth fallback");try{const L=await Ye.signIn(E,T);if(!L||!L.success||!L.tokens){const W=L.error?.message||"Login failed - no tokens received";return console.error("Dev auth login failed:",W),s({type:Ke.LOGIN_FAILURE,payload:W}),{success:!1,error:W}}return localStorage.setItem("accessToken",L.tokens.accessToken),s({type:Ke.LOGIN_SUCCESS,payload:{user:L.user,tokens:L.tokens}}),console.log("✅ Development login successful"),{success:!0}}catch(L){console.error("Dev auth login error:",L);const W=_(L);return s({type:Ke.LOGIN_FAILURE,payload:W}),{success:!1,error:W}}}console.error("🚨 CRITICAL: Both Cognito and dev auth paths were skipped or failed"),console.error("Debug info:",{isProductionBuild:M,cognitoConfigured:I,forceDevAuth:N,isDev:!1,shouldUseDevAuth:!I||N||!1});const S=I?"Authentication service is temporarily unavailable. Please try again later.":"Authentication is not configured. Please contact support or use development mode.";throw new Error(S)}catch(M){console.error("Login error:",M);const I=_(M);return s({type:Ke.LOGIN_FAILURE,payload:I}),{success:!1,error:I}}},h=async(E,T,M,I,N)=>{try{if(s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR}),!Wr()){console.log("Cognito not configured - using development authentication");try{const L=await Ye.signUp(E,T,M,I,N);return s({type:Ke.LOADING,payload:!1}),{success:!0,isComplete:L.isSignUpComplete,nextStep:L.nextStep,message:L.isSignUpComplete?"Registration completed successfully":"Please check your email for verification code"}}catch(L){console.error("Dev auth registration error:",L);const W=_(L);return s({type:Ke.SET_ERROR,payload:W}),{success:!1,error:W}}}const{isSignUpComplete:k,nextStep:S}=await Pk({username:E,password:T,options:{userAttributes:{email:M,given_name:I,family_name:N}}});return s({type:Ke.LOADING,payload:!1}),{success:!0,isComplete:k,nextStep:S,message:k?"Registration completed successfully":"Please check your email for verification code"}}catch(k){console.error("Registration error:",k);const S=_(k);return s({type:Ke.SET_ERROR,payload:S}),{success:!1,error:S}}},u=async(E,T)=>{try{if(s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR}),!Wr()){console.log("Cognito not configured - using development authentication");try{const I=await Ye.confirmSignUp(E,T);return s({type:Ke.LOADING,payload:!1}),{success:!0,isComplete:I.isSignUpComplete,message:"Account confirmed successfully. You can now sign in."}}catch(I){console.error("Dev auth confirmation error:",I);const N=_(I);return s({type:Ke.SET_ERROR,payload:N}),{success:!1,error:N}}}const{isSignUpComplete:M}=await _k({username:E,confirmationCode:T});return s({type:Ke.LOADING,payload:!1}),{success:!0,isComplete:M,message:"Account confirmed successfully. You can now sign in."}}catch(M){console.error("Confirmation error:",M);const I=_(M);return s({type:Ke.SET_ERROR,payload:I}),{success:!1,error:I}}},m=async E=>{try{if(s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR}),!Wr()){console.log("Cognito not configured - using development authentication");try{return await new Promise(T=>setTimeout(T,1e3)),s({type:Ke.LOADING,payload:!1}),{success:!0,message:"New verification code sent to your email (development mode)"}}catch(T){console.error("Dev auth resend error:",T);const M=_(T);return s({type:Ke.SET_ERROR,payload:M}),{success:!1,error:M}}}return await Rk({username:E}),s({type:Ke.LOADING,payload:!1}),{success:!0,message:"New verification code sent to your email"}}catch(T){console.error("Resend confirmation error:",T);const M=_(T);return s({type:Ke.SET_ERROR,payload:M}),{success:!1,error:M}}},p=async E=>{try{if(s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR}),!Wr()){console.log("Cognito not configured - using development authentication");try{const M=await Ye.resetPassword(E);return s({type:Ke.LOADING,payload:!1}),{success:!0,nextStep:M.nextStep,message:"Password reset code sent to your email"}}catch(M){console.error("Dev auth password reset error:",M);const I=_(M);return s({type:Ke.SET_ERROR,payload:I}),{success:!1,error:I}}}const T=await Ik({username:E});return s({type:Ke.LOADING,payload:!1}),{success:!0,nextStep:T.nextStep,message:"Password reset code sent to your email"}}catch(T){console.error("Forgot password error:",T);const M=_(T);return s({type:Ke.SET_ERROR,payload:M}),{success:!1,error:M}}},x=async(E,T,M)=>{try{if(s({type:Ke.LOADING,payload:!0}),s({type:Ke.CLEAR_ERROR}),!Wr()){console.log("Cognito not configured - using development authentication");try{return await Ye.confirmResetPassword(E,T,M),s({type:Ke.LOADING,payload:!1}),{success:!0,message:"Password reset successfully. You can now sign in with your new password."}}catch(I){console.error("Dev auth confirm password reset error:",I);const N=_(I);return s({type:Ke.SET_ERROR,payload:N}),{success:!1,error:N}}}return await Dk({username:E,confirmationCode:T,newPassword:M}),s({type:Ke.LOADING,payload:!1}),{success:!0,message:"Password reset successfully. You can now sign in with your new password."}}catch(I){console.error("Confirm password reset error:",I);const N=_(I);return s({type:Ke.SET_ERROR,payload:N}),{success:!1,error:N}}},b=()=>{s({type:Ke.CLEAR_ERROR})},w=async()=>{Si.extendSession(),i({show:!1,timeRemaining:0})},C=async()=>{i({show:!1,timeRemaining:0}),await o()},A=()=>{i({show:!1,timeRemaining:0})},_=E=>E.name==="NotAuthorizedException"?"Invalid username or password":E.name==="UserNotConfirmedException"?"Please confirm your account before signing in":E.name==="UsernameExistsException"?"Username already exists":E.name==="CodeMismatchException"?"Invalid verification code":E.name==="ExpiredCodeException"?"Verification code has expired":E.message||"An unexpected error occurred",R={...t,login:c,register:h,confirmRegistration:u,resendConfirmationCode:m,logout:o,forgotPassword:p,confirmForgotPassword:x,refreshSession:a,clearError:b,checkAuthState:l};return e.jsxs(Zx.Provider,{value:R,children:[r,e.jsx(Wk,{open:n.show,timeRemaining:n.timeRemaining,onExtend:w,onLogout:C,onClose:A})]})}function ps(){const r=j.useContext(Zx);if(r===null)return console.warn("useAuth called outside AuthProvider - using defaults"),zk;if(r===void 0)throw new Error("useAuth must be used within an AuthProvider");return r}const jc=(r,t="Financial Dashboard")=>{j.useEffect(()=>{const s=document.title;return r&&(document.title=`${r} | ${t}`),()=>{document.title=s&&s.trim()?s:t}},[r,t])};class Fl extends gn.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}static getDerivedStateFromError(t){return{hasError:!0,errorId:`ERR_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}componentDidCatch(t,s){const n=s&&s.componentStack;if(t&&t.message&&(t.message.includes("Network Error")||t.message.includes("fetch")||t.message.includes("ECONNREFUSED")||t.message.includes("timeout"))&&!n){console.warn("API/Network error caught by ErrorBoundary, but not showing error UI:",t);return}console.error("ErrorBoundary caught a React render error:",t,s),this.setState({error:t,errorInfo:s})}handleReload=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null}),window.location.reload()};handleGoHome=()=>{window.location.href="/"};render(){return this.state.hasError?e.jsx(g,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"grey.50",p:3},children:e.jsx(z,{sx:{maxWidth:600,width:"100%"},children:e.jsx(U,{sx:{p:4},children:e.jsxs(Or,{spacing:3,alignItems:"center",textAlign:"center",children:[e.jsx(Kw,{"data-testid":"ErrorOutlineIcon",sx:{fontSize:64,color:"error.main"}}),e.jsxs(g,{children:[e.jsx(d,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Something went wrong"}),e.jsx(d,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"We apologize for the inconvenience. An unexpected error has occurred in our financial dashboard application."})]}),!1,e.jsxs(we,{severity:"info",sx:{width:"100%"},children:[e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Error ID:"})," ",this.state.errorId]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Please provide this ID when contacting support for faster assistance."})]}),e.jsx(Fe,{sx:{width:"100%"}}),e.jsxs(Or,{direction:"row",spacing:2,children:[e.jsx(oe,{variant:"contained",startIcon:e.jsx(Es,{}),onClick:this.handleReload,size:"large",children:"Try Again"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(hx,{}),onClick:this.handleGoHome,size:"large",children:"Go Home"})]}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"If this problem persists, please contact our support team:"}),e.jsx(oe,{variant:"text",startIcon:e.jsx(Yw,{}),size:"small",href:"mailto:support@edgebrooke.com",children:"support@edgebrooke.com"})]}),e.jsx(g,{sx:{mt:3,pt:2,borderTop:1,borderColor:"divider",width:"100%"},children:e.jsxs(d,{variant:"caption",color:"text.secondary",textAlign:"center",children:["Edgebrooke Capital Financial Dashboard",e.jsx("br",{}),"Enterprise-grade financial data platform for professional investors"]})})]})})})}):this.props.children}}const Uk=({signal:r,confidence:t=.75,size:s="medium",showConfidence:n=!1,showPerformance:i=!1,performance:a=null,variant:o="chip"})=>{const l=Zs(),h=(p=>{const x=p?.toUpperCase();switch(x){case"BUY":case"STRONG_BUY":return{color:l.palette.success.main,bgColor:Xe(l.palette.success.main,.1),icon:e.jsx(at,{sx:{fontSize:s==="small"?16:20}}),label:x==="STRONG_BUY"?"STRONG BUY":"BUY",textColor:l.palette.success.dark,intensity:x==="STRONG_BUY"?"strong":"normal"};case"SELL":case"STRONG_SELL":return{color:l.palette.error.main,bgColor:Xe(l.palette.error.main,.1),icon:e.jsx(Tt,{sx:{fontSize:s==="small"?16:20}}),label:x==="STRONG_SELL"?"STRONG SELL":"SELL",textColor:l.palette.error.dark,intensity:x==="STRONG_SELL"?"strong":"normal"};case"HOLD":case"NEUTRAL":return{color:l.palette.warning.main,bgColor:Xe(l.palette.warning.main,.1),icon:e.jsx(Gt,{sx:{fontSize:s==="small"?16:20}}),label:"HOLD",textColor:l.palette.warning.dark,intensity:"normal"};default:return{color:l.palette.grey[500],bgColor:Xe(l.palette.grey[500],.1),icon:e.jsx(ux,{sx:{fontSize:s==="small"?16:20}}),label:"N/A",textColor:l.palette.grey[600],intensity:"normal"}}})(r),u=Math.round(t*100),m=()=>{let p=`Signal: ${h.label}`;return n&&(p+=` (${u}% confidence)`),i&&a!==null&&(p+=` | Performance: ${a>0?"+":""}${a.toFixed(1)}%`),p};return o==="chip"?e.jsx(tt,{title:m(),children:e.jsx(X,{icon:h.icon,label:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(d,{variant:s==="small"?"caption":"body2",sx:{color:h.textColor,fontWeight:h.intensity==="strong"?700:600,fontSize:s==="small"?"0.65rem":"0.75rem"},children:h.label}),n&&e.jsxs(d,{variant:"caption",sx:{color:Xe(h.textColor,.7),fontSize:"0.6rem"},children:[u,"%"]})]}),size:s,sx:{backgroundColor:h.bgColor,borderColor:Xe(h.color,.3),"&:hover":{backgroundColor:Xe(h.color,.15)}}})}):o==="badge"?e.jsx(tt,{title:m(),children:e.jsxs(g,{sx:{display:"inline-flex",alignItems:"center",gap:.5,px:s==="small"?1:1.5,py:s==="small"?.25:.5,borderRadius:2,backgroundColor:h.bgColor,border:`1px solid ${Xe(h.color,.3)}`,minWidth:s==="small"?60:80,justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:Xe(h.color,.15),borderColor:Xe(h.color,.5),transform:"translateY(-1px)"}},children:[h.icon,e.jsx(d,{variant:s==="small"?"caption":"body2",sx:{color:h.textColor,fontWeight:h.intensity==="strong"?700:600,fontSize:s==="small"?"0.65rem":"0.75rem"},children:h.label}),n&&e.jsxs(d,{variant:"caption",sx:{color:Xe(h.textColor,.7),fontSize:"0.6rem",ml:.5},children:[u,"%"]})]})}):o==="inline"?e.jsx(tt,{title:m(),children:e.jsxs(g,{component:"span",sx:{display:"inline-flex",alignItems:"center",gap:.3,color:h.color,cursor:"pointer"},children:[gn.cloneElement(h.icon,{sx:{fontSize:s==="small"?14:16}}),e.jsx(d,{variant:"caption",sx:{color:h.color,fontWeight:600,fontSize:s==="small"?"0.6rem":"0.7rem"},children:h.label}),n&&e.jsxs(d,{variant:"caption",sx:{color:Xe(h.color,.7),fontSize:"0.55rem"},children:["(",u,"%)"]})]})}):null},Yn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},Xt=()=>{let r=typeof window<"u"&&window.__CONFIG__&&window.__CONFIG__.API_URL?window.__CONFIG__.API_URL:null;const t=r||Yn&&"http://localhost:5001"||"http://localhost:3001";console.log("🔧 [API CONFIG] URL Resolution:",{runtimeApiUrl:r,envApiUrl:Yn&&"http://localhost:5001",finalApiUrl:t,windowConfig:typeof window<"u"?window.__CONFIG__:"undefined",allEnvVars:Yn||{}});const s=Yn&&"production"||"development",n=!1,i=!!Yn;return{baseURL:t,isServerless:!!t&&!t.includes("localhost"),apiUrl:t,isConfigured:!t.includes("localhost"),environment:s,isDevelopment:n,isProduction:i,baseUrl:Yn&&"/",allEnvVars:Yn||{}}};let Pt=Xt();(!Pt.apiUrl||Pt.apiUrl.includes("localhost"))&&console.warn("[API CONFIG] Using fallback API URL:",Pt.baseURL+`
Set window.__CONFIG__.API_URL at runtime or VITE_API_URL at build time to override.`);let le=eO.create({baseURL:Pt.baseURL,timeout:Pt.isServerless?45e3:3e4,headers:{"Content-Type":"application/json",Authorization:"Bearer dev-bypass-token"}});try{le&&le.interceptors&&le.interceptors.request.use(r=>(r.metadata={startTime:new Date},r),r=>Promise.reject(r))}catch{}try{le&&le.interceptors&&le.interceptors.response.use(r=>{if(r.config.metadata){const t=new Date-r.config.metadata.startTime;t>1e4&&console.warn("⚠️ Slow API request detected:",{url:r.config.url,method:r.config.method,duration:`${t}ms`})}return r},r=>{let t="An unexpected error occurred";r.code==="ECONNABORTED"?t="Request timed out. The server may be experiencing high load. Please try again.":r.code==="ERR_NETWORK"?t="Network connection failed. Please check your internet connection.":r.code==="ENOTFOUND"?t="Server could not be reached. Please try again later.":r.code==="CERT_UNTRUSTED"?t="Security certificate error. Please contact support.":r.response?.status===401?t="Authentication failed. Please sign in again.":r.response?.status===403?t="Access denied. You do not have permission for this resource.":r.response?.status===404?t="The requested resource was not found. Please check your request and try again.":r.response?.status===429?t="Too many requests. Please wait a moment and try again.":r.response?.status===500?t="Server error occurred. Our team has been notified. Please try again later.":r.response?.status===502?t="Bad gateway error. The service may be temporarily unavailable.":r.response?.status===503?t="Service temporarily unavailable. Please try again in a few minutes.":navigator.onLine||(t="No internet connection. Please check your network and try again."),r.userMessage=t;const s={url:r.config?.url,method:r.config?.method,status:r.response?.status,statusText:r.response?.statusText,message:r.message,code:r.code,userMessage:t,stack:r.stack?.split(`
`)[0]};return r.response?.status>=500?console.error("❌ Server Error:",s):r.response?.status>=400?console.warn("⚠️ Client Error:",s):r.code?console.error("❌ Network Error:",s):console.error("❌ Unknown Error:",s),Promise.reject(r)})}catch{}const fh=async()=>{try{return(await le.get("/api/portfolio/holdings"))?.data||null}catch(r){throw console.error("Error fetching portfolio data:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},Jx=async r=>{try{if(!r||typeof r!="string"||r.trim()==="")throw new Error("Invalid user ID");return(await le.get(`/api/portfolio/holdings?userId=${r}`))?.data||null}catch(t){throw console.error("Error fetching portfolio holdings:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,userId:r}),t}},Su=async r=>{try{return(await le.post("/api/portfolio/holdings",r))?.data}catch(t){throw console.error("Error adding holding:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},Ou=async(r,t)=>{try{return(await le.put(`/api/portfolio/holdings/${r}`,t))?.data}catch(s){throw console.error("Error updating holding:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText}),s}},ku=async r=>{try{return(await le.delete(`/api/portfolio/holdings/${r}`))?.data}catch(t){throw console.error("Error deleting holding:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},Cu=async r=>{try{return(await le.post(`/portfolio/import/${r}`))?.data}catch(t){throw console.error("Error importing portfolio from broker:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},ey=async(r="1Y")=>{try{return(await le.get(`/api/portfolio/performance?timeframe=${r}`))?.data}catch(t){throw console.error("Error fetching portfolio performance:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},ty=async(r="1Y")=>{try{return(await le.get(`/api/portfolio/benchmark?timeframe=${r}`))?.data}catch(t){throw console.error("Error fetching benchmark data:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},Au=async()=>{try{return(await le.get("/api/portfolio/optimization"))?.data}catch(r){throw console.error("Error fetching optimization data:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},Tu=async r=>{try{return(await le.post("/api/portfolio/optimization/run",r))?.data}catch(t){throw console.error("Error running portfolio optimization:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},Pu=async()=>{try{return(await le.get("/api/portfolio/rebalance"))?.data}catch(r){throw console.error("Error fetching rebalancing recommendations:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},_u=async(r={})=>{try{const t=new URLSearchParams;return r.period&&t.append("period",r.period),r.confidence_level&&t.append("confidence_level",r.confidence_level),(await le.get(`/api/risk/analysis${t.toString()?"?"+t.toString():""}`))?.data}catch(t){throw console.error("Error fetching risk analysis:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},sy=async(r={})=>{try{const t=new URLSearchParams;return r.period&&t.append("period",r.period),(await le.get(`/api/risk/dashboard${t.toString()?"?"+t.toString():""}`))?.data}catch(t){throw console.error("Error fetching risk dashboard:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},ry=async()=>{try{return(await le.get("/api/risk/alerts"))?.data}catch(r){throw console.error("Error fetching risk alerts:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},ny=async r=>{try{return(await le.post("/api/risk/alerts",r))?.data}catch(t){throw console.error("Error creating risk alert:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},iy=async()=>{try{const r=await le.get("/portfolio/api-keys"),s=(r?.data?.data||[]).reduce((n,i)=>(n[i.brokerName]={...i,lastValidated:i.lastUsed||i.createdAt},n),{});return{ok:r?.status>=200&&r?.status<300,status:r?.status,data:s,success:r?.data?.success||!0}}catch(r){throw console.error("Error fetching API keys:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},ay=async r=>{try{return(await le.post("/portfolio/api-keys",r))?.data}catch(t){throw console.error("Error adding API key:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},oy=async(r,t)=>{try{return(await le.put(`/portfolio/api-keys/${r}`,t))?.data}catch(s){throw console.error("Error updating API key:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText}),s}},ly=async r=>{try{return(await le.delete(`/portfolio/api-keys/${r}`))?.data}catch(t){throw console.error("Error deleting API key:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),t}},cy=async r=>{try{return{ok:!0,data:(await le.post("/portfolio/api-keys",r))?.data}}catch(t){return console.error("Error saving API key:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),{ok:!1,error:t.message}}},dy=async r=>{try{const t=await le.post("/portfolio/test-api-key",r);return{ok:!0,isValid:t?.data?.isValid,data:t?.data}}catch(t){return console.error("Error testing API key:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),{ok:!1,isValid:!1,error:t.message}}},hy=async()=>{try{return(await le.get("/api/settings"))?.data}catch(r){throw console.error("Error getting settings:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},uy=async r=>{try{return{ok:!0,success:!0,data:(await le.post("/api/settings",r))?.data}}catch(t){return console.error("Error updating settings:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),{ok:!1,success:!1,error:t.message}}},bc=()=>Pt.baseURL,fy=r=>{Pt={...Pt,baseURL:r,apiUrl:r},le.defaults.baseURL=r};try{le.interceptors.request.use(r=>{const t=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="5173",s=Pt&&Pt.baseURL&&(Pt.baseURL.startsWith("http://localhost:")||Pt.baseURL.startsWith("https://"));if(t&&!s){console.log("🚫 [API] Blocking API call - no server configured:",{baseURL:Pt.baseURL,hasValidApiServer:s});const i=new Error("API calls disabled - no server configured");return i.code="NO_SERVER_CONFIGURED",Promise.reject(i)}console.log("✅ [API] Allowing API call:",{isDevelopment:t,hasValidApiServer:s,baseURL:Pt.baseURL,url:r.url}),r.url&&r.url.startsWith("/api/api")&&(r.url=r.url.replace("/api/api","/api"));try{let i=null;typeof window<"u"&&(i=localStorage.getItem("authToken")||sessionStorage.getItem("authToken")||localStorage.getItem("accessToken")||sessionStorage.getItem("accessToken")),i&&(r.headers.Authorization=`Bearer ${i}`)}catch(i){console.log("Could not retrieve auth token:",i.message)}const n=`${r.baseURL||le.defaults.baseURL}${r.url}`;return console.log("[API REQUEST FINAL URL]",n,r),r.isServerless&&(r.headers["X-Lambda-Request"]="true",r.headers["X-Request-Time"]=new Date().toISOString()),r},r=>(console.error("API Request Error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),Promise.reject(r)))}catch{}try{le.interceptors.response.use(r=>{const t=`${r.config.baseURL||le.defaults.baseURL}${r.config.url}`;return console.log("[API SUCCESS]",r.config.method?.toUpperCase(),t,{status:r?.status,statusText:r?.statusText,dataSize:r?.data?Array.isArray(r?.data)?r.data?.length||0:Object.keys(r?.data).length:0}),r},async r=>(r?.code==="DEV_MODE_BLOCKED",Promise.reject(r)))}catch{}function be(r,t=""){let s="An unexpected error occurred";return r?.response?.data?.error?s=r.response?.data.error:r?.response?.data?.message?s=r.response?.data.message:r?.message&&(s=r.message),t?`${t}: ${s}`:s}function Te(r,t=!0){if(console.log("🔍 normalizeApiResponse input:",{hasResponse:!!r,responseType:typeof r,hasData:!!(r&&r?.data!==void 0),dataType:r?.data?typeof r?.data:"undefined",isArray:Array.isArray(r?.data),expectArray:t}),r&&r?.data!==void 0&&(r=r?.data),r&&typeof r=="object"){if(r?.data!==void 0&&(r=r?.data),r.success===!1)throw console.error("❌ API request failed:",r.error),new Error(r.error||"API request failed");if(r.error)throw console.error("❌ API response contains error:",r.error),new Error(r.error)}if(t&&!Array.isArray(r))if(r&&typeof r=="object")if(Array.isArray(r?.data))r=r?.data;else if(Array.isArray(r.items))r=r.items;else if(Array.isArray(r.results))r=r.results;else{const s=Object.keys(r);s.length>0&&s.every(n=>!isNaN(n))?r=Object.values(r):r=[r]}else r=[];return console.log("✅ normalizeApiResponse output:",{resultType:typeof r,isArray:Array.isArray(r),length:Array.isArray(r)?r?.length||0:"N/A",sample:Array.isArray(r)&&r.length>0?r[0]:r}),r}console.log("🚀 [API STARTUP] Initializing API configuration...");console.log("🔧 [API CONFIG]",Xt());console.log("📡 [AXIOS DEFAULT BASE URL]",le?.defaults?.baseURL||"undefined");const ho=async()=>{console.log("📈 [API] Fetching market overview..."),console.log("📈 [API] Current config:",Xt()),console.log("📈 [API] Axios baseURL:",le.defaults.baseURL);try{const r=await le.get("/api/market/overview");console.log("📈 [API] Market overview raw response:",r);const t=Te(r,!1);return console.log("📈 [API] Market overview normalized result:",t),{data:t}}catch(r){const t=r.response?.status===503||r.response?.status===502||r.message==="Network Error"||r.code==="ERR_NETWORK",s=t?"warn":"error",n=t?"⚠️ [API] Market overview unavailable":"❌ [API] Market overview error";throw console[s](`${n}:`,r?.message||"Unknown error"),t||console.error("Full error details:",{status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method}),new Error(be(r,"Failed to fetch market overview"))}},my=async(r={})=>{console.log("📈 [API] Fetching top stocks...",r),console.log("📈 [API] Current config:",Xt());try{const s=[`/api/scores?${new URLSearchParams({limit:r.limit||10,sortBy:r.sortBy||"composite_score",sortOrder:r.sortOrder||"desc",...r}).toString()}`];let n=null,i=null;for(const o of s)try{console.log(`📈 [API] Trying endpoint: ${o}`),n=await le.get(o),console.log(`📈 [API] SUCCESS with endpoint: ${o}`,n);break}catch(l){console.log(`📈 [API] FAILED endpoint: ${o}`,l.message),i=l;continue}if(!n)throw i?.message==="Network Error"||i?.code==="ERR_NETWORK"||i?.response?.status===503?console.warn("⚠️ [API] Top stocks endpoints unavailable:",i?.message||"Unknown error"):console.error("📈 [API] All top stocks endpoints failed:",i),i;console.log("📈 [API] Top stocks raw response:",n);const a=Te(n,!1);return console.log("📈 [API] Top stocks normalized result:",a),{data:a}}catch(t){const s=t.response?.status===503||t.response?.status===502||t.message==="Network Error"||t.code==="ERR_NETWORK",n=s?"warn":"error",i=s?"⚠️ [API] Top stocks unavailable":"❌ [API] Top stocks error";throw console[n](`${i}:`,t?.message||"Unknown error"),s||console.error("Full error details:",{status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method}),new Error(be(t,"Failed to fetch top stocks"))}},Eu=async(r=30)=>{console.log(`📊 [API] Fetching market sentiment history for ${r} days...`);try{const t=[`/market/sentiment/history?days=${r}`,`/api/market/sentiment/history?days=${r}`];let s=null,n=null;for(const a of t)try{console.log(`📊 [API] Trying sentiment endpoint: ${a}`),s=await le.get(a),console.log(`📊 [API] SUCCESS with sentiment endpoint: ${a}`,s);break}catch(o){console.log(`📊 [API] FAILED sentiment endpoint: ${a}`,o.message),n=o;continue}if(!s)throw console.error("📊 [API] All sentiment endpoints failed:",{message:n?.message||"Unknown error",status:n.response?.status,url:n.config?.url}),n;if(s?.data&&typeof s?.data=="object")return console.log("📊 [API] Returning sentiment data structure:",s?.data),s?.data;const i=Te(s,!0);return console.log("📊 [API] Sentiment fallback normalized result:",i),{data:i}}catch(t){console.error("❌ [API] Sentiment history error details:",{message:t.message,status:t.response?.status,url:t.config?.url,method:t.config?.method});const s=be(t,"get market sentiment history");return{data:[],error:s}}},py=async()=>{console.log("📊 [API] Fetching market sector performance...");try{const r=["/market/sectors/performance","/api/market/sectors/performance"];let t=null,s=null;for(const i of r)try{console.log(`📊 [API] Trying sector endpoint: ${i}`),t=await le.get(i),console.log(`📊 [API] SUCCESS with sector endpoint: ${i}`,t);break}catch(a){console.log(`📊 [API] FAILED sector endpoint: ${i}`,a.message),s=a;continue}if(!t)throw console.error("📊 [API] All sector endpoints failed:",{message:s?.message||"Unknown error",status:s.response?.status,url:s.config?.url}),s;if(t?.data&&typeof t?.data=="object")return console.log("📊 [API] Returning sector data structure:",t?.data),t?.data;const n=Te(t,!0);return console.log("📊 [API] Sector fallback normalized result:",n),{data:n}}catch(r){console.error("❌ [API] Sector performance error details:",{message:r.message,status:r.response?.status,url:r.config?.url,method:r.config?.method});const t=be(r,"get market sector performance");return{data:[],error:t}}},Iu=async()=>{console.log("📊 [API] Fetching market breadth...");try{const r=["/market/breadth","/api/market/breadth"];let t=null,s=null;for(const i of r)try{console.log(`📊 [API] Trying breadth endpoint: ${i}`),t=await le.get(i),console.log(`📊 [API] SUCCESS with breadth endpoint: ${i}`,t);break}catch(a){console.log(`📊 [API] FAILED breadth endpoint: ${i}`,a.message),s=a;continue}if(!t)throw console.error("📊 [API] All breadth endpoints failed:",{message:s?.message||"Unknown error",status:s.response?.status,url:s.config?.url}),s;if(t?.data&&typeof t?.data=="object")return console.log("📊 [API] Returning breadth data structure:",t?.data),t?.data;const n=Te(t,!1);return console.log("📊 [API] Breadth fallback normalized result:",n),{data:n}}catch(r){console.error("❌ [API] Market breadth error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method});const t=be(r,"get market breadth");return{data:{},error:t}}},gy=async()=>{console.log("📊 [API] Fetching distribution days...");try{const r=["/market/distribution-days","/api/market/distribution-days"];let t=null,s=null;for(const i of r)try{console.log(`📊 [API] Trying distribution days endpoint: ${i}`),t=await le.get(i),console.log(`📊 [API] SUCCESS with distribution days endpoint: ${i}`,t);break}catch(a){console.log(`📊 [API] FAILED distribution days endpoint: ${i}`,a.message),s=a;continue}if(!t)throw console.error("📊 [API] All distribution days endpoints failed:",{message:s?.message||"Unknown error",status:s.response?.status,url:s.config?.url}),s;if(t?.data&&typeof t?.data=="object")return console.log("📊 [API] Returning distribution days data structure:",t?.data),t?.data;const n=Te(t,!1);return console.log("📊 [API] Distribution days fallback normalized result:",n),{data:n}}catch(r){console.error("❌ [API] Distribution days error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method});const t=be(r,"get distribution days");return{data:{},error:t}}},xy=async(r=90)=>{console.log(`📊 [API] Fetching economic indicators for ${r} days...`);try{const t=[`/market/economic?days=${r}`,`/api/market/economic?days=${r}`];let s=null,n=null;for(const a of t)try{console.log(`📊 [API] Trying economic endpoint: ${a}`),s=await le.get(a),console.log(`📊 [API] SUCCESS with economic endpoint: ${a}`,s);break}catch(o){console.log(`📊 [API] FAILED economic endpoint: ${a}`,o.message),n=o;continue}if(!s)throw console.error("📊 [API] All economic endpoints failed:",{message:n?.message||"Unknown error",status:n.response?.status,url:n.config?.url}),n;if(s?.data&&typeof s?.data=="object")return console.log("📊 [API] Returning economic data structure:",s?.data),s?.data;const i=Te(s,!0);return console.log("📊 [API] Economic fallback normalized result:",i),{data:i}}catch(t){console.error("❌ [API] Economic indicators error details:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method});const s=be(t,"get economic indicators");return{data:[],error:s,period_days:r,total_data_points:0,timestamp:new Date().toISOString()}}},yy=async(r=null,t="1y")=>{console.log(`📈 [API] Fetching market correlation analysis for period: ${t}...`);try{const s=new URLSearchParams;r&&s.append("symbols",r),t&&s.append("period",t);const n=s.toString(),i=`/api/market/correlation${n?"?"+n:""}`,a=await le.get(i);return console.log("📈 [API] Market correlation response:",{success:a.success,hasData:!!a.data,hasCorrelationMatrix:!!a.data?.correlation_matrix}),a}catch(s){console.error("📈 [API] Market correlation error:",s);const n=be(s,"get market correlation");return{success:!1,data:{},error:n,timestamp:new Date().toISOString()}}},Du=async()=>{console.log("📅 [API] Fetching seasonality data...");try{const r=["/api/market/seasonality"];let t=null,s=null;for(const i of r)try{console.log(`📅 [API] Trying seasonality endpoint: ${i}`),t=await le.get(i),console.log(`📅 [API] SUCCESS with seasonality endpoint: ${i}`,t);break}catch(a){console.log(`📅 [API] FAILED seasonality endpoint: ${i}`,a.message),s=a;continue}if(!t)throw console.error("📅 [API] All seasonality endpoints failed:",{message:s?.message||"Unknown error",status:s.response?.status,url:s.config?.url}),s;if(t?.data&&typeof t?.data=="object")return console.log("📅 [API] Returning seasonality data structure:",t?.data),t?.data;const n=Te(t,!0);return console.log("📅 [API] Seasonality fallback normalized result:",n),{data:n}}catch(r){return console.error("❌ [API] Seasonality error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method}),{data:null,error:be(r,"get seasonality data"),timestamp:new Date().toISOString()}}},Ru=async()=>{console.log("🔬 [API] Fetching market research indicators...");try{const r=["/api/market/research-indicators"];let t=null,s=null;for(const i of r)try{console.log(`🔬 [API] Trying research indicators endpoint: ${i}`),t=await le.get(i),console.log(`🔬 [API] SUCCESS with research indicators endpoint: ${i}`,t);break}catch(a){console.log(`🔬 [API] FAILED research indicators endpoint: ${i}`,a.message),s=a;continue}if(!t)throw console.error("🔬 [API] All research indicators endpoints failed:",s),s;if(t?.data&&typeof t?.data=="object")return console.log("🔬 [API] Returning research indicators data structure:",t?.data),t?.data;const n=Te(t,!0);return console.log("🔬 [API] Research indicators fallback normalized result:",n),{data:n}}catch(r){return console.error("❌ [API] Research indicators error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method}),{data:null,error:be(r,"get market research indicators"),timestamp:new Date().toISOString()}}},Mu=async(r="1y")=>{console.log("📈 [API] Fetching portfolio analytics...");try{const t=[`/api/portfolio/analytics?timeframe=${r}`];let s=null,n=null;for(const i of t)try{console.log(`📈 [API] Trying portfolio analytics endpoint: ${i}`),s=await le.get(i),console.log(`📈 [API] SUCCESS with portfolio analytics endpoint: ${i}`,s);break}catch(a){console.log(`📈 [API] FAILED portfolio analytics endpoint: ${i}`,a.message),n=a;continue}if(!s)throw console.error("📈 [API] All portfolio analytics endpoints failed:",n),n;return s?.data}catch(t){return console.error("❌ [API] Portfolio analytics error details:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method,stack:t?.stack?.substring(0,500)+"..."}),{data:null,error:be(t,"get portfolio analytics"),timestamp:new Date().toISOString()}}},jy=async()=>{console.log("⚠️ [API] Fetching portfolio risk analysis...");try{const r=["/api/portfolio/risk-analysis"];let t=null,s=null;for(const n of r)try{console.log(`⚠️ [API] Trying portfolio risk analysis endpoint: ${n}`),t=await le.get(n),console.log(`⚠️ [API] SUCCESS with portfolio risk analysis endpoint: ${n}`,t);break}catch(i){console.log(`⚠️ [API] FAILED portfolio risk analysis endpoint: ${n}`,i.message),s=i;continue}if(!t)throw console.error("⚠️ [API] All portfolio risk analysis endpoints failed:",s),s;return t?.data}catch(r){return console.error("❌ [API] Portfolio risk analysis error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method,stack:r?.stack?.substring(0,500)+"..."}),{data:null,error:be(r,"get portfolio risk analysis"),timestamp:new Date().toISOString()}}},by=async()=>{console.log("🎯 [API] Fetching portfolio optimization...");try{const r=["/api/portfolio/optimization"];let t=null,s=null;for(const n of r)try{console.log(`🎯 [API] Trying portfolio optimization endpoint: ${n}`),t=await le.get(n),console.log(`🎯 [API] SUCCESS with portfolio optimization endpoint: ${n}`,t);break}catch(i){console.log(`🎯 [API] FAILED portfolio optimization endpoint: ${n}`,i.message),s=i;continue}if(!t)throw console.error("🎯 [API] All portfolio optimization endpoints failed:",s),s;return t?.data}catch(r){return console.error("❌ [API] Portfolio optimization error details:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText,url:r.config?.url,method:r.config?.method,stack:r?.stack?.substring(0,500)+"..."}),{data:null,error:be(r,"get portfolio optimization"),timestamp:new Date().toISOString()}}},vc=async(r={})=>{console.log("🚀 getStocks: Starting API call with params:",r);try{const t=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{l!=null&&l!==""&&t.append(o,l)});const s=[`/api/stocks?${t.toString()}`];let n=null,i=null;for(const o of s)try{console.log(`🚀 getStocks: Trying endpoint: ${o}`),n=await le.get(o,{baseURL:Pt.baseURL}),console.log(`🚀 getStocks: SUCCESS with endpoint: ${o}`,n);break}catch(l){console.log(`🚀 getStocks: FAILED endpoint: ${o}`,l.message),i=l;continue}if(!n)throw console.error("🚀 getStocks: All endpoints failed:",i),i;if(console.log("📊 getStocks: Raw response:",{status:n?.status,hasData:!!n?.data,dataType:typeof n?.data,dataKeys:n?.data?Object.keys(n?.data):[]}),n?.data&&Array.isArray(n?.data.data))return console.log("✅ getStocks: returning backend response structure:",n?.data),n?.data;const a=Te(n,!0);return console.log("✅ getStocks: returning normalized result:",a),{data:a}}catch(t){console.error("❌ Error fetching stocks:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method,stack:t?.stack?.substring(0,500)+"..."});const s=be(t,"get stocks");return{data:[],error:s}}},vy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([n,i])=>{i!=null&&i!==""&&t.append(n,i)});const s=await le.get(`/api/stocks/quick/overview?${t.toString()}`);return Te(s)}catch(t){const s=be(t,"get stocks quick");return Te({data:[],error:s})}},wy=async(r=0)=>{try{const t=await le.get(`/api/stocks/chunk/${r}`);return Te(t)}catch(t){const s=be(t,"get stocks chunk");return Te({data:[],error:s})}},Sy=async(r={})=>{try{const t=new URLSearchParams;(!r.limit||r.limit>10)&&(r.limit=5,console.warn("Stocks limit reduced to 5 for performance")),Object.entries(r).forEach(([n,i])=>{i!=null&&i!==""&&t.append(n,i)});const s=await le.get(`/api/stocks/full/data?${t.toString()}`);return Te(s)}catch(t){const s=be(t,"get stocks full");return Te({data:[],error:s})}},Oy=async r=>{console.log("🚀 getStock: Starting API call for ticker:",r);try{const t=await le.get(`/api/stocks/${r}`);console.log("📊 getStock: Raw response:",{status:t?.status,hasData:!!t?.data,dataType:typeof t?.data,dataKeys:t?.data?Object.keys(t?.data):[]});const s=Te(t,!1);return console.log("✅ getStock: returning result:",s),{data:s}}catch(t){return console.error("❌ Error fetching stock:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method,stack:t?.stack?.substring(0,500)+"..."}),{data:null,error:be(t,"get stock")}}},ky=async r=>{try{const t=await le.get(`/api/stocks/${r}/profile`);return Te(t,!1)}catch(t){const s=be(t,"get stock profile");return Te({error:s},!1)}},Lu=async r=>{try{const t=await le.get(`/api/metrics/${r}`);return{data:Te(t,!1)}}catch(t){return{data:null,error:be(t,"get stock metrics")}}},Cy=async(r,t="income")=>{console.log("🚀 getStockFinancials: Starting API call for ticker:",r,"type:",t);try{const s=await le.get(`/api/financials/${r}/${t}`);console.log("📊 getStockFinancials: Raw response:",{status:s?.status,hasData:!!s?.data,dataType:typeof s?.data,dataKeys:s?.data?Object.keys(s?.data):[]});const n=Te(s,!0);return console.log("✅ getStockFinancials: returning result:",n),{data:n}}catch(s){console.error("❌ Error fetching stock financials:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText,url:s.config?.url,method:s.config?.method,stack:s?.stack?.substring(0,500)+"..."});const n=be(s,"get stock financials");return{data:[],error:n}}},Ay=async r=>{try{const t=await le.get(`/api/analysts/${r}/recommendations`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get analyst recommendations");return{data:[],error:s}}},uo=async(r,t="daily",s=100)=>{try{const n=await le.get(`/api/stocks/${r}/prices?timeframe=${t}&limit=${s}`);return{data:Te(n,!0)}}catch(n){const i=be(n,"get stock prices");return{data:[],error:i}}},Ty=async(r,t=30)=>{try{const s=await le.get(`/api/stocks/${r}/prices/recent?limit=${t}`);return{data:Te(s,!0)}}catch(s){const n=be(s,"get recent stock prices");return{data:[],error:n}}},Py=async r=>{try{const t=await le.get(`/api/stocks/${r}/recommendations`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get stock recommendations");return{data:[],error:s}}},_y=async()=>{try{const r=await le.get("/api/stocks/filters/sectors");return{data:Te(r,!0)}}catch(r){const t=be(r,"get sectors");return{data:[],error:t}}},Ey=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/metrics/valuation?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get valuation metrics");return{data:[],error:s}}},Iy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/metrics/growth?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get growth metrics");return{data:[],error:s}}},Dy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/metrics/dividends?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get dividend metrics");return{data:[],error:s}}},Ry=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/metrics/financial-strength?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get financial strength metrics");return{data:[],error:s}}},wc=async r=>{try{const t="/api/stocks";console.log("🔍 [API] Screening stocks with params:",r.toString()),console.log(`🔍 [API] Using main stocks endpoint: ${t}?${r.toString()}`);const s=await le.get(`${t}?${r.toString()}`,{baseURL:Pt.baseURL});if(console.log("✅ [API] Success with main stocks endpoint:",s?.data),s?.data&&s?.data.success&&Array.isArray(s?.data.data))return console.log("✅ [API] Using backend response structure:",s?.data),s?.data;const n=Te(s,!0);return console.log("✅ [API] Using normalized response:",n),{success:!0,data:n,total:n?.length||0,pagination:{total:n?.length||0,page:1,limit:n?.length||0}}}catch(t){console.error("❌ [API] Error screening stocks:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText});const s=be(t,"screen stocks");return{success:!1,data:[],error:s,total:0,pagination:{total:0,page:1,limit:25}}}},Fu=async()=>{console.log("📈 [API] Fetching buy signals...");try{return(await le.get("/api/signals/buy")).data}catch(r){return console.error("❌ [API] Buy signals error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Nu=async()=>{console.log("📉 [API] Fetching sell signals...");try{return(await le.get("/api/signals/sell")).data}catch(r){return console.error("❌ [API] Sell signals error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},My=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/calendar/earnings-estimates?${t.toString()}`,{baseURL:Pt.baseURL});return{data:Te(s,!0)}}catch(t){const s=be(t,"get earnings estimates");return{data:[],error:s}}},Ly=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/calendar/earnings-history?${t.toString()}`,{baseURL:Pt.baseURL});return{data:Te(s,!0)}}catch(t){const s=be(t,"get earnings history");return{data:[],error:s}}},Fy=async r=>{try{const t=await le.get(`/api/analysts/${r}/earnings-estimates`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker earnings estimates");return{data:[],error:s}}},Ny=async r=>{try{const t=await le.get(`/api/analysts/${r}/earnings-history`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker earnings history");return{data:[],error:s}}},Wy=async r=>{try{const t=await le.get(`/api/analysts/${r}/revenue-estimates`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker revenue estimates");return{data:[],error:s}}},$y=async r=>{try{const t=await le.get(`/api/analysts/${r}/eps-revisions`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker eps revisions");return{data:[],error:s}}},Vy=async r=>{try{const t=await le.get(`/api/analysts/${r}/eps-trend`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker eps trend");return{data:[],error:s}}},zy=async r=>{try{const t=await le.get(`/api/analysts/${r}/growth-estimates`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker growth estimates");return{data:[],error:s}}},By=async r=>{try{const t=await le.get(`/api/analysts/${r}/recommendations`);return{data:Te(t,!0)}}catch(t){const s=be(t,"get ticker analyst recommendations");return{data:[],error:s}}},Uy=async r=>{try{const t=await le.get(`/api/analysts/${r}/overview`);return{data:Te(t,!1)}}catch(t){return{data:null,error:be(t,"get analyst overview")}}},Qy=async(r,t="annual")=>{try{const s=await le.get(`/api/financials/${r}/statements?period=${t}`);return{data:Te(s,!0)}}catch(s){const n=be(s,"get financial statements");return{data:[],error:n}}},Wu=async(r,t="annual")=>{try{const s=await le.get(`/api/financials/${r}/income-statement?period=${t}`),n=Te(s,!0);return{data:Array.isArray(n)?n.map(a=>({...a,items:Object.fromEntries(Object.entries(a).filter(([o])=>!["symbol","date","raw"].includes(o)))})):n}}catch(s){const n=be(s,"get income statement");return{data:[],error:n}}},$u=async(r,t="annual")=>{try{const s=await le.get(`/api/financials/${r}/cash-flow?period=${t}`);return{data:Te(s,!0)}}catch(s){const n=be(s,"get cash flow statement");return{data:[],error:n}}},Vu=async(r,t="annual")=>{try{const s=await le.get(`/api/financials/${r}/balance-sheet?period=${t}`),n=Te(s,!0);return{data:Array.isArray(n)?n.map(a=>({...a,items:Object.fromEntries(Object.entries(a).filter(([o])=>!["symbol","date","raw"].includes(o)))})):n}}catch(s){const n=be(s,"get balance sheet");return{data:[],error:n}}},zu=async r=>{try{const t=`/api/financials/${r}/key-metrics`,s=await le.get(t,{baseURL:Pt.baseURL});return{data:Te(s,!1)}}catch(t){return{data:null,error:be(t,`get key metrics for ${r}`)}}},qy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/financials/all?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get all financial data");return{data:[],error:s}}},Hy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/financials/metrics?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get financial metrics");return{data:[],error:s}}},Gy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/analysts/eps-revisions?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get EPS revisions");return{data:[],error:s}}},Ky=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/analysts/eps-trend?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get EPS trend");return{data:[],error:s}}},Yy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/analysts/growth-estimates?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get growth estimates");return{data:[],error:s}}},Xy=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/economic/data?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get economic data");return{data:[],error:s}}},Zy=async r=>{console.log(`📊 [API] Fetching technical history for ${r}...`);try{const t=await le.get(`/technical/history/${r}`);return console.log(`📊 [API] Technical history response for ${r}:`,t),Te(t,!0)}catch(t){throw console.error(`❌ [API] Technical history error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch technical history for ${r}`))}},Jy=async r=>{console.log(`ℹ️ [API] Fetching stock info for ${r}...`);try{const t=await le.get(`/stocks/info/${r}`);return console.log(`ℹ️ [API] Stock info response for ${r}:`,t),Te(t,!1)}catch(t){throw console.error(`❌ [API] Stock info error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch stock info for ${r}`))}},ej=async r=>{console.log(`💰 [API] Fetching stock price for ${r}...`);try{const t=await le.get(`/stocks/price/${r}`);return console.log(`💰 [API] Stock price response for ${r}:`,t),Te(t,!1)}catch(t){throw console.error(`❌ [API] Stock price error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch stock price for ${r}`))}},tj=async r=>{console.log(`📊 [API] Fetching stock history for ${r}...`);try{const t=await le.get(`/stocks/history/${r}`);return console.log(`📊 [API] Stock history response for ${r}:`,t),Te(t,!0)}catch(t){throw console.error(`❌ [API] Stock history error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch stock history for ${r}`))}},sj=async r=>{console.log(`🔍 [API] Searching stocks with query: ${r}...`);try{const t=await le.get(`/stocks/search?q=${encodeURIComponent(r)}`);return console.log("🔍 [API] Stock search response:",t),Te(t,!0)}catch(t){throw console.error("❌ [API] Stock search error:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,"Failed to search stocks"))}},rj=async()=>{console.log("🏥 [API] Checking API health...");try{const r=await le.get("/health");return console.log("🏥 [API] Health check response:",r),Te(r,!1)}catch(r){throw console.error("❌ [API] Health check error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to check API health"))}},Bu=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/market/naaim?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get NAAIM data");return{data:[],error:s}}},Uu=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/market/fear-greed?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get fear & greed data");return{data:[],error:s}}},nj=async(r="daily",t={})=>{console.log(`📈 [API] Fetching price history for timeframe: ${r}`,t);try{const s=new URLSearchParams;Object.entries(t).forEach(([l,c])=>{c!=null&&c!==""&&s.append(l,c)});const n=[`/api/price/history/${r}?${s.toString()}`];let i=null,a=null;for(const l of n)try{console.log(`📈 [API] Trying price history endpoint: ${l}`),i=await le.get(l),console.log(`📈 [API] SUCCESS with price history endpoint: ${l}`,i);break}catch(c){console.log(`📈 [API] FAILED price history endpoint: ${l}`,c.message),a=c;continue}if(!i)throw console.error("📈 [API] All price history endpoints failed:",a),a;return console.log("📈 [API] Price history raw response:",i?.data),i?.data&&i?.data.success&&Array.isArray(i?.data.data)?(console.log("📈 [API] Price history backend structure:",i?.data),{data:i?.data.data,pagination:i?.data.pagination,statistics:i?.data.statistics,metadata:i?.data.metadata}):{data:Te(i,!0),pagination:i?.data?.pagination||null,statistics:i?.data?.statistics||null,metadata:i?.data?.metadata||null}}catch(s){console.error("❌ [API] Price history error details:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText});const n=be(s,"get price history");return{data:[],error:n,pagination:null,timestamp:new Date().toISOString()}}},Sc=async(r="daily",t={})=>{try{const s=new URLSearchParams;Object.entries(t).forEach(([o,l])=>{l!=null&&l!==""&&s.append(o,l)});const n=`/api/technical/${r}?${s.toString()}`,i=await le.get(n);return i?.data&&i?.data.success&&Array.isArray(i?.data.data)?{data:i?.data.data,pagination:i?.data.pagination||{},metadata:i?.data.metadata||{},success:!0,...i?.data}:Array.isArray(i?.data)?{data:i?.data,pagination:{},metadata:{},success:!0,timestamp:new Date().toISOString()}:{data:Te(i,!0),pagination:{},metadata:{},success:!0,timestamp:new Date().toISOString()}}catch(s){const n=be(s,"get technical data");return{data:[],pagination:{},metadata:{},success:!1,error:n,timestamp:new Date().toISOString()}}},ij=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/technical/summary?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get technical summary");return{data:[],error:s}}},aj=async(r={})=>{try{const t=new URLSearchParams;Object.entries(r).forEach(([i,a])=>{a!=null&&a!==""&&t.append(i,a)});const s=await le.get(`/api/calendar/earnings-metrics?${t.toString()}`);return{data:Te(s,!0)}}catch(t){const s=be(t,"get earnings metrics");return{data:[],error:s}}},oj=async()=>{try{console.log("🔧 [API] Initializing API connection...");const r=await fetch(`${bc()}/health`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`API initialization failed: ${r.status}`);const t=await r.json();return console.log("✅ [API] API initialized successfully:",t),t}catch(r){throw console.error("❌ [API] API initialization failed:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},Qu=async(r=null)=>{try{console.log("Testing API connection..."),console.log("Current API URL:",Pt.baseURL),console.log("Custom URL:",r),console.log("Environment:","production"),console.log("VITE_API_URL:","http://localhost:5001");const t=r||Pt.baseURL,s=await le.get("/api/health?quick=true",{baseURL:t,timeout:7e3});return{success:!0,apiUrl:t,status:s?.status,data:s?.data,message:"API connection successful"}}catch(t){return console.error("API connection test failed:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),{success:!1,apiUrl:r||Pt.baseURL,error:t.message,details:{hasResponse:!!t.response,status:t.response?.status,statusText:t.response?.statusText,responseData:t.response?.data,code:t.code,isNetworkError:!t.response,configUrl:t.config?.url,fullUrl:(r||Pt.baseURL)+"/api/health?quick=true"}}}},qu=()=>({currentApiUrl:Pt.baseURL,axiosDefaultBaseUrl:le.defaults.baseURL,viteApiUrl:"http://localhost:5001",isConfigured:Pt.isConfigured,environment:"production",urlsMatch:Pt.baseURL===le.defaults.baseURL,timestamp:new Date().toISOString()}),lj=async()=>{try{return{data:(await le.get("/api/health/database",{baseURL:Pt.baseURL}))?.data}}catch(r){return{data:null,error:be(r,"get database health")}}},Hu=async(r="")=>{let t=!1,s=`/api/health${r}`,n=`/${r}`;try{const i=await le.get(s,{baseURL:Pt.baseURL});return console.log("Health check response:",i?.data),{data:i?.data,healthy:!0,endpoint:s,fallback:!1,timestamp:new Date().toISOString()}}catch{console.warn("Health check failed for /api/health, trying root / endpoint..."),t=!0;try{const a=await le.get(n,{baseURL:Pt.baseURL});return console.log("Root endpoint health check response:",a?.data),{data:a?.data,healthy:!0,endpoint:n,fallback:!0,timestamp:new Date().toISOString()}}catch(a){return console.error("Error in health check (both endpoints failed):",a),{data:null,error:be(a,"health check (both endpoints)"),healthy:!1,endpoint:t?n:s,fallback:t,timestamp:new Date().toISOString()}}}},cj=async()=>{try{const r=await le.get("/api/health/full");return{data:Te(r,!1)}}catch(r){throw console.error("Error fetching data validation summary:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),r}},Gu=async(r,t=90)=>{try{console.log(`BULLETPROOF: Fetching price history for ${r} with limit ${t}`);const s=await le.get(`/api/stocks/${r}/prices?limit=${t}`);return console.log(`BULLETPROOF: Price history response received for ${r}:`,s?.data),{data:Te(s,!0)}}catch(s){throw console.error("BULLETPROOF: Error fetching stock price history:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText}),be(s,`Failed to fetch price history for ${r}`)}},dj=async(r=10)=>{try{const t=await le.get(`/api/analysts/recent-actions?limit=${r}`);return{data:Te(t,!0),summary:{date:null,total_actions:0,upgrades:0,downgrades:0}}}catch(t){const s=be(t,"get recent analyst actions");return{data:[],summary:{date:null,total_actions:0,upgrades:0,downgrades:0},error:s}}},hj=async()=>{const r={};try{const t=await le.get("/api/health");r.health={success:!0,data:t?.data}}catch(t){r.health={success:!1,error:t.message}}try{const t=await le.get("/api/stocks?limit=5");r.stocks={success:!0,data:t?.data}}catch(t){r.stocks={success:!1,error:t.message}}try{const t=await le.get("/api/technical/daily?limit=5");r.technical={success:!0,data:t?.data}}catch(t){r.technical={success:!1,error:t.message}}try{const t=await le.get("/api/market/overview");r.market={success:!0,data:t?.data}}catch(t){r.market={success:!1,error:t.message}}return console.log("API Test Results:",r),r},uj=async()=>{console.log("🚀 getMarketIndices: Starting API call...");try{const r=await le.get("/api/market/indices");console.log("📊 getMarketIndices: Raw response:",{status:r?.status,hasData:!!r?.data,dataType:typeof r?.data,dataKeys:r?.data?Object.keys(r?.data):[]});const t=Te(r,!0);return console.log("✅ getMarketIndices: returning result:",t),{data:t}}catch(r){console.error("❌ Error fetching market indices:",{message:r?.message||"Unknown error",status:r.response?.status,url:r.config?.url});const t=be(r,"get market indices");return{data:[],error:t}}},fj=async()=>{console.log("🚀 getSectorPerformance: Starting API call...");try{const r=await le.get("/api/market/sectors");console.log("📊 getSectorPerformance: Raw response:",{status:r?.status,hasData:!!r?.data,dataType:typeof r?.data,dataKeys:r?.data?Object.keys(r?.data):[]});const t=Te(r,!0);return console.log("✅ getSectorPerformance: returning result:",t),{data:t}}catch(r){console.error("❌ Error fetching sector performance:",{message:r?.message||"Unknown error",status:r.response?.status,url:r.config?.url});const t=be(r,"get sector performance");return{data:[],error:t}}},mj=async()=>{console.log("🚀 getMarketVolatility: Starting API call...");try{const r=await le.get("/api/market/volatility");console.log("📊 getMarketVolatility: Raw response:",{status:r?.status,hasData:!!r?.data,dataType:typeof r?.data,dataKeys:r?.data?Object.keys(r?.data):[]});const t=Te(r,!0);return console.log("✅ getMarketVolatility: returning result:",t),{data:t}}catch(r){console.error("❌ Error fetching market volatility:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText});const t=be(r,"get market volatility");return{data:[],error:t}}},pj=async()=>{console.log("🚀 getEconomicCalendar: Starting API call...");try{const r=await le.get("/api/market/calendar");console.log("📊 getEconomicCalendar: Raw response:",{status:r?.status,hasData:!!r?.data,dataType:typeof r?.data,dataKeys:r?.data?Object.keys(r?.data):[]});const t=Te(r,!0);return console.log("✅ getEconomicCalendar: returning result:",t),{data:t}}catch(r){console.error("❌ Error fetching economic calendar:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText});const t=be(r,"get economic calendar");return{data:[],error:t}}},gj=async()=>{console.log("🚀 getMarketCapCategories: Starting API call...");try{const r=await le.get("/api/stocks/market-cap-categories");console.log("📊 getMarketCapCategories: Raw response:",{status:r?.status,hasData:!!r?.data,dataType:typeof r?.data,dataKeys:r?.data?Object.keys(r?.data):[]});const t=Te(r,!0);return console.log("✅ getMarketCapCategories: returning result:",t),{data:t}}catch(r){console.error("❌ Error fetching market cap categories:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText});const t=be(r,"get market cap categories");return{data:[],error:t}}},xj=async(r,t,s)=>{console.log("🚀 getTechnicalIndicators: Starting API call...",{symbol:r,timeframe:t,indicators:s});try{const n=await le.get(`/api/technical/indicators/${r}`,{params:{timeframe:t,indicators:s.join(",")}});console.log("📊 getTechnicalIndicators: Raw response:",{status:n?.status,hasData:!!n?.data,dataType:typeof n?.data,dataKeys:n?.data?Object.keys(n?.data):[]});const i=Te(n,!0);return console.log("✅ getTechnicalIndicators: returning result:",i),{data:i}}catch(n){console.error("❌ Error fetching technical indicators:",{message:n?.message||"Unknown error",status:n.response?.status,statusText:n.response?.statusText});const i=be(n,"get technical indicators");return{data:[],error:i}}},yj=async(r,t)=>{console.log("🚀 getVolumeData: Starting API call...",{symbol:r,timeframe:t});try{const s=await le.get(`/api/stocks/${r}/volume`,{params:{timeframe:t}});console.log("📊 getVolumeData: Raw response:",{status:s?.status,hasData:!!s?.data,dataType:typeof s?.data,dataKeys:s?.data?Object.keys(s?.data):[]});const n=Te(s,!0);return console.log("✅ getVolumeData: returning result:",n),{data:n}}catch(s){console.error("❌ Error fetching volume data:",{message:s?.message||"Unknown error",status:s.response?.status,statusText:s.response?.statusText});const n=be(s,"get volume data");return{data:[],error:n}}},jj=async r=>{console.log("🚀 getSupportResistanceLevels: Starting API call...",{symbol:r});try{const t=await le.get(`/api/technical/support-resistance/${r}`);console.log("📊 getSupportResistanceLevels: Raw response:",{status:t?.status,hasData:!!t?.data,dataType:typeof t?.data,dataKeys:t?.data?Object.keys(t?.data):[]});const s=Te(t,!1);return console.log("✅ getSupportResistanceLevels: returning result:",s),{data:s}}catch(t){return console.error("❌ Error fetching support resistance levels:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),{data:null,error:be(t,"get support resistance levels")}}},bj=async()=>{console.log("📊 [API] Fetching dashboard summary...");try{const r=await le.get("/dashboard/summary");return console.log("📊 [API] Dashboard summary response:",r),{data:Te(r,!1)}}catch(r){throw console.error("❌ [API] Dashboard summary error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard summary"))}},vj=async()=>{console.log("📈 [API] Fetching dashboard performance...");try{const r=await le.get("/dashboard/performance");return console.log("📈 [API] Dashboard performance response:",r),{data:Te(r,!0)}}catch(r){throw console.error("❌ [API] Dashboard performance error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard performance"))}},wj=async()=>{console.log("🚨 [API] Fetching dashboard alerts...");try{const r=await le.get("/dashboard/alerts");return console.log("🚨 [API] Dashboard alerts response:",r),{data:Te(r,!0)}}catch(r){throw console.error("❌ [API] Dashboard alerts error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard alerts"))}},Sj=async()=>{console.log("🔧 [API] Fetching dashboard debug info...");try{const r=await le.get("/dashboard/debug");return console.log("🔧 [API] Dashboard debug response:",r),{data:Te(r,!1)}}catch(r){throw console.error("❌ [API] Dashboard debug error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard debug info"))}},Oj=async()=>{console.log("📊 [API] Fetching market indicators...");try{const r=await le.get("/market/indicators");return console.log("📊 [API] Market indicators response:",r),{data:Te(r,!1)}}catch(r){throw console.error("❌ [API] Market indicators error:",{message:r?.message||"Unknown error",status:r.response?.status,url:r.config?.url}),new Error(be(r,"Failed to fetch market indicators"))}},kj=async()=>{console.log("😊 [API] Fetching market sentiment...");try{return(await le.get("/api/sentiment/market")).data}catch(r){return console.error("❌ [API] Market sentiment error:",{message:r?.message||"Unknown error",status:r.response?.status,url:r.config?.url}),{data:null}}},Cj=async r=>{console.log(`💰 [API] Fetching financial data for ${r}...`);try{const t=await le.get(`/financials/data/${r}`);return console.log(`💰 [API] Financial data response for ${r}:`,t),{data:Te(t,!1)}}catch(t){throw console.error(`❌ [API] Financial data error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,url:t.config?.url,symbol:r}),new Error(be(t,`Failed to fetch financial data for ${r}`))}},Aj=async r=>{console.log(`📊 [API] Fetching earnings data for ${r}...`);try{const t=await le.get(`/financials/earnings/${r}`);return console.log(`📊 [API] Earnings data response for ${r}:`,t),{data:Te(t,!0)}}catch(t){throw console.error(`❌ [API] Earnings data error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch earnings data for ${r}`))}},Tj=async r=>{console.log(`💵 [API] Fetching cash flow for ${r}...`);try{const t=await le.get(`/financials/cash-flow/${r}`);return console.log(`💵 [API] Cash flow response for ${r}:`,t),{data:Te(t,!0)}}catch(t){throw console.error(`❌ [API] Cash flow error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(be(t,`Failed to fetch cash flow for ${r}`))}},Pj=async()=>{console.log("👤 [API] Fetching dashboard user...");try{return(await le.get("/api/user/profile")).data}catch(r){return console.error("❌ [API] Dashboard user error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},_j=async()=>{console.log("👀 [API] Fetching dashboard watchlist...");try{try{const r=await le.get("/api/watchlist");if(r.data&&r.data.success&&r.data.data)return console.log("✅ [API] Real watchlist data loaded"),r.data}catch{console.warn("⚠️ [API] Watchlist endpoint failed, trying stocks list")}try{const r=await le.get("/api/stocks?limit=5");if(r.data&&r.data.success&&r.data.data){const t=r.data.data.map(s=>({symbol:s.symbol,name:s.security_name||s.symbol,price:s.price?.current||0,change:s.price?.current?s.price.current*.01:0,changePercent:s.price?.current?1:0}));return console.log("✅ [API] Watchlist created from stocks data:",t.length,"items"),{data:t,success:!0}}}catch(r){console.warn("⚠️ [API] Stocks endpoint failed:",r.message)}throw new Error("Unable to load watchlist. Please ensure the backend services are running and accessible.")}catch(r){throw console.error("❌ [API] Dashboard watchlist error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard watchlist"))}},Ej=async()=>{console.log("💼 [API] Fetching dashboard portfolio...");try{const r=await le.get("/api/portfolio/dashboard");return console.log("💼 [API] Dashboard portfolio response:",r.data),r.data}catch(r){return console.error("❌ [API] Dashboard portfolio error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Ij=async()=>{console.log("📊 [API] Fetching dashboard portfolio metrics...");try{return(await le.get("/api/portfolio/metrics")).data}catch(r){return console.error("❌ [API] Dashboard portfolio metrics error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Dj=async()=>{console.log("📈 [API] Fetching dashboard holdings...");try{return(await le.get("/api/portfolio/holdings")).data}catch(r){return console.error("❌ [API] Dashboard holdings error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Rj=async()=>{console.log("⚙️ [API] Fetching dashboard user settings...");try{return(await le.get("/api/user/settings")).data}catch(r){return console.error("❌ [API] Dashboard user settings error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Mj=async()=>{console.log("📈 [API] Fetching dashboard market summary...");try{return(await le.get("/api/market/summary")).data}catch(r){return console.error("❌ [API] Dashboard market summary error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},Lj=async()=>{console.log("📅 [API] Fetching dashboard earnings calendar...");try{const r=await le.get("/api/earnings/calendar");return console.log("📅 [API] Earnings calendar response:",r.data),r.data}catch(r){throw console.error("❌ [API] Dashboard earnings calendar error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard earnings calendar"))}},Fj=async()=>{console.log("💰 [API] Fetching dashboard financial highlights...");try{const r=await le.get("/api/financials/highlights");return console.log("💰 [API] Financial highlights response:",r.data),r.data}catch(r){throw console.error("❌ [API] Dashboard financial highlights error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard financial highlights"))}},Nj=async()=>{console.log("🔤 [API] Fetching dashboard symbols...");try{const r=await le.get("/api/dashboard/symbols");return console.log("🔤 [API] Dashboard symbols response:",r.data),r.data}catch(r){throw console.error("❌ [API] Dashboard symbols error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),new Error(be(r,"Failed to fetch dashboard symbols"))}},Oc=async(r={})=>{console.log("📈 [API] Fetching daily trading signals...",r);try{const s=`/api/signals?${new URLSearchParams({limit:r.limit||10,timeframe:"daily",...r}).toString()}`;console.log(`📈 [API] Using endpoint: ${s}`);const n=await le.get(s);console.log(`📈 [API] SUCCESS with endpoint: ${s}`,n),console.log("📈 [API] Trading signals daily raw response:",n);const i=Te(n,!1);return console.log("📈 [API] Trading signals daily normalized result:",i),{data:i}}catch(t){throw console.error("❌ [API] Trading signals daily error details:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,method:t.config?.method,stack:t?.stack?.substring(0,500)+"..."}),new Error(be(t,"Failed to fetch daily trading signals"))}},Wj=async()=>{console.log("📊 [API] Fetching dashboard technical signals...");try{return(await le.get("/api/signals/dashboard")).data}catch(r){return console.error("❌ [API] Dashboard technical signals error:",{message:r?.message||"Unknown error",status:r.response?.status,statusText:r.response?.statusText}),{data:null}}},$j=async r=>{try{console.log(`📊 [API] Fetching quote for ${r}...`);const t=await le.get(`/api/market/quote/${r}`),s={symbol:r,price:t?.data?.price||0,change:t?.data?.change||0,changePercent:t?.data?.changePercent||0,volume:t?.data?.volume||0,timestamp:t?.data?.timestamp||new Date().toISOString()};return console.log(`📊 [API] Quote for ${r}:`,s),s}catch(t){throw console.error(`❌ [API] Quote error for ${r}:`,{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(`Failed to fetch quote for ${r}: ${t?.message||"Unknown error"}`)}},Vj=async r=>{try{console.log("📈 [API] Placing order:",r);const t=await le.post("/api/orders",r),s={orderId:t?.data?.orderId||`order-${Date.now()}`,status:t?.data?.status||"pending",symbol:r.symbol,quantity:r.quantity,side:r.side,type:r.type||"market",timestamp:new Date().toISOString()};return console.log("📈 [API] Order placed:",s),s}catch(t){throw console.error("❌ [API] Order placement error:",{message:t?.message||"Unknown error",status:t.response?.status,statusText:t.response?.statusText}),new Error(`Failed to place order: ${t?.message||"Unknown error"}`)}},Ku=async(r,t={})=>{try{return(await le.post("/api/ai/chat",{message:r,...t}))?.data}catch(s){throw console.error("Failed to send chat message:",s),new Error(be(s,"Failed to send chat message"))}},Yu=async()=>{try{return(await le.delete("/api/ai/chat/history"))?.data}catch(r){throw console.error("Failed to clear chat history:",r),new Error(be(r,"Failed to clear chat history"))}},St={healthCheck:Hu,getMarketOverview:ho,getPortfolio:fh,getPortfolioData:fh,getMarketSentimentHistory:Eu,getMarketSectorPerformance:py,getMarketBreadth:Iu,getEconomicIndicators:xy,getMarketCorrelation:yy,getSeasonalityData:Du,getMarketResearchIndicators:Ru,getPortfolioAnalytics:Mu,getPortfolioRiskAnalysis:jy,getPortfolioOptimization:by,addHolding:Su,updateHolding:Ou,deleteHolding:ku,importPortfolioFromBroker:Cu,getPortfolioPerformance:ey,getBenchmarkData:ty,getPortfolioOptimizationData:Au,runPortfolioOptimization:Tu,getRebalancingRecommendations:Pu,getRiskAnalysis:_u,getRiskDashboard:sy,getRiskAlerts:ry,createRiskAlert:ny,getStocks:vc,getStocksQuick:vy,getStocksChunk:wy,getStocksFull:Sy,getStock:Oy,getStockProfile:ky,getStockMetrics:Lu,getStockFinancials:Cy,getAnalystRecommendations:Ay,getStockPrices:uo,getStockPricesRecent:Ty,getStockRecommendations:Py,getSectors:_y,getValuationMetrics:Ey,getGrowthMetrics:Iy,getDividendMetrics:Dy,getFinancialStrengthMetrics:Ry,screenStocks:wc,getBuySignals:Fu,getSellSignals:Nu,getEarningsEstimates:My,getEarningsHistory:Ly,getTickerEarningsEstimates:Fy,getTickerEarningsHistory:Ny,getTickerRevenueEstimates:Wy,getTickerEpsRevisions:$y,getTickerEpsTrend:Vy,getTickerGrowthEstimates:zy,getTickerAnalystRecommendations:By,getAnalystOverview:Uy,getBalanceSheet:Vu,getIncomeStatement:Wu,getCashFlowStatement:$u,getFinancialStatements:Qy,getKeyMetrics:zu,getAllFinancialData:qy,getFinancialMetrics:Hy,getEpsRevisions:Gy,getEpsTrend:Ky,getGrowthEstimates:Yy,getEconomicData:Xy,getNaaimData:Bu,getFearGreedData:Uu,getTechnicalData:Sc,getTechnicalSummary:ij,getDataValidationSummary:cj,getEarningsMetrics:aj,initializeApi:oj,testApiConnection:Qu,getDiagnosticInfo:qu,getApiConfig:Xt,getCurrentBaseURL:bc,updateApiBaseUrl:fy,getDatabaseHealthFull:lj,getStockPriceHistory:Gu,getRecentAnalystActions:dj,getDashboardUser:Pj,getDashboardWatchlist:_j,getDashboardPortfolio:Ej,getDashboardPortfolioMetrics:Ij,getDashboardHoldings:Dj,getDashboardUserSettings:Rj,getDashboardMarketSummary:Mj,getDashboardEarningsCalendar:Lj,getDashboardFinancialHighlights:Fj,getDashboardSymbols:Nj,getDashboardTechnicalSignals:Wj,testApiEndpoints:hj,getMarketIndices:uj,getSectorPerformance:fj,getMarketVolatility:mj,getEconomicCalendar:pj,getMarketCapCategories:gj,getTechnicalIndicators:xj,getVolumeData:yj,getSupportResistanceLevels:jj,getDashboardSummary:bj,getDashboardPerformance:vj,getDashboardAlerts:wj,getDashboardDebug:Sj,getMarketIndicators:Oj,getMarketSentiment:kj,getFinancialData:Cj,getEarningsData:Aj,getCashFlow:Tj,getTechnicalHistory:Zy,getStockInfo:Jy,getStockPrice:ej,getStockHistory:tj,searchStocks:sj,getHealth:rj,getApiKeys:iy,addApiKey:ay,updateApiKey:oy,deleteApiKey:ly,saveApiKey:cy,testApiKey:dy,getSettings:hy,updateSettings:uy,placeOrder:Vj,getQuote:$j,getTradingSignalsDaily:Oc,sendChatMessage:Ku,clearChatHistory:Yu,get:(r,t)=>le?.get(r,t)||Promise.resolve({data:{}}),post:(r,t,s)=>le?.post(r,t,s)||Promise.resolve({data:{}}),put:(r,t,s)=>le?.put(r,t,s)||Promise.resolve({data:{}}),delete:(r,t)=>le?.delete(r,t)||Promise.resolve({data:{}}),patch:(r,t,s)=>le?.patch(r,t,s)||Promise.resolve({data:{}})},zj=async(r="1m",t="SPY")=>{try{return(await le.get("/api/analytics/performance",{params:{period:r,benchmark:t}})).data}catch(s){throw console.error("Error fetching performance analytics:",s),new Error(be(s,"Failed to fetch performance analytics"))}},Bj=async(r="1m")=>{try{return(await le.get("/api/analytics/risk",{params:{timeframe:r}})).data}catch(t){throw console.error("Error fetching risk analytics:",t),new Error(be(t,"Failed to fetch risk analytics"))}},Uj=async(r="3m",t="all")=>{try{return(await le.get("/api/analytics/correlation",{params:{period:r,assets:t}})).data}catch(s){throw console.error("Error fetching correlation analytics:",s),new Error(be(s,"Failed to fetch correlation analytics"))}},Qj=async(r="current")=>{try{return(await le.get("/api/analytics/allocation",{params:{period:r}})).data}catch(t){throw console.error("Error fetching allocation analytics:",t),new Error(be(t,"Failed to fetch allocation analytics"))}},qj=async(r="1m")=>{try{return(await le.get("/api/analytics/volatility",{params:{period:r}})).data}catch(t){throw console.error("Error fetching volatility analytics:",t),new Error(be(t,"Failed to fetch volatility analytics"))}},Hj=async(r="1m")=>{try{return(await le.get("/api/analytics/trends",{params:{period:r}})).data}catch(t){throw console.error("Error fetching trends analytics:",t),new Error(be(t,"Failed to fetch trends analytics"))}},Rm=Object.freeze(Object.defineProperty({__proto__:null,addApiKey:ay,addHolding:Su,api:le,clearChatHistory:Yu,createRiskAlert:ny,default:St,deleteApiKey:ly,deleteHolding:ku,getAllFinancialData:qy,getAllocationAnalytics:Qj,getAnalystOverview:Uy,getAnalystRecommendations:Ay,getApiConfig:Xt,getApiKeys:iy,getBalanceSheet:Vu,getBenchmarkData:ty,getBuySignals:Fu,getCashFlow:Tj,getCashFlowStatement:$u,getCorrelationAnalytics:Uj,getCurrentBaseURL:bc,getDashboardAlerts:wj,getDashboardDebug:Sj,getDashboardEarningsCalendar:Lj,getDashboardFinancialHighlights:Fj,getDashboardHoldings:Dj,getDashboardMarketSummary:Mj,getDashboardPerformance:vj,getDashboardPortfolio:Ej,getDashboardPortfolioMetrics:Ij,getDashboardSummary:bj,getDashboardSymbols:Nj,getDashboardTechnicalSignals:Wj,getDashboardUser:Pj,getDashboardUserSettings:Rj,getDashboardWatchlist:_j,getDataValidationSummary:cj,getDatabaseHealthFull:lj,getDiagnosticInfo:qu,getDistributionDays:gy,getDividendMetrics:Dy,getEarningsData:Aj,getEarningsEstimates:My,getEarningsHistory:Ly,getEarningsMetrics:aj,getEconomicCalendar:pj,getEconomicData:Xy,getEconomicIndicators:xy,getEpsRevisions:Gy,getEpsTrend:Ky,getFearGreedData:Uu,getFinancialData:Cj,getFinancialMetrics:Hy,getFinancialStatements:Qy,getFinancialStrengthMetrics:Ry,getGrowthEstimates:Yy,getGrowthMetrics:Iy,getHealth:rj,getIncomeStatement:Wu,getKeyMetrics:zu,getMarketBreadth:Iu,getMarketCapCategories:gj,getMarketCorrelation:yy,getMarketIndicators:Oj,getMarketIndices:uj,getMarketOverview:ho,getMarketResearchIndicators:Ru,getMarketSectorPerformance:py,getMarketSentiment:kj,getMarketSentimentHistory:Eu,getMarketVolatility:mj,getNaaimData:Bu,getPerformanceAnalytics:zj,getPortfolioAnalytics:Mu,getPortfolioData:fh,getPortfolioHoldings:Jx,getPortfolioOptimization:by,getPortfolioOptimizationData:Au,getPortfolioPerformance:ey,getPortfolioRiskAnalysis:jy,getPriceHistory:nj,getQuote:$j,getRebalancingRecommendations:Pu,getRecentAnalystActions:dj,getRiskAlerts:ry,getRiskAnalysis:_u,getRiskAnalytics:Bj,getRiskDashboard:sy,getSeasonalityData:Du,getSectorPerformance:fj,getSectors:_y,getSellSignals:Nu,getSettings:hy,getStock:Oy,getStockFinancials:Cy,getStockHistory:tj,getStockInfo:Jy,getStockMetrics:Lu,getStockPrice:ej,getStockPriceHistory:Gu,getStockPrices:uo,getStockPricesRecent:Ty,getStockProfile:ky,getStockRecommendations:Py,getStocks:vc,getStocksChunk:wy,getStocksFull:Sy,getStocksQuick:vy,getSupportResistanceLevels:jj,getTechnicalData:Sc,getTechnicalHistory:Zy,getTechnicalIndicators:xj,getTechnicalSummary:ij,getTickerAnalystRecommendations:By,getTickerEarningsEstimates:Fy,getTickerEarningsHistory:Ny,getTickerEpsRevisions:$y,getTickerEpsTrend:Vy,getTickerGrowthEstimates:zy,getTickerRevenueEstimates:Wy,getTopStocks:my,getTradingSignalsDaily:Oc,getTrendsAnalytics:Hj,getValuationMetrics:Ey,getVolatilityAnalytics:qj,getVolumeData:yj,healthCheck:Hu,importPortfolioFromBroker:Cu,initializeApi:oj,placeOrder:Vj,runPortfolioOptimization:Tu,saveApiKey:cy,screenStocks:wc,searchStocks:sj,sendChatMessage:Ku,testApiConnection:Qu,testApiEndpoints:hj,testApiKey:dy,updateApiBaseUrl:fy,updateApiKey:oy,updateHolding:Ou,updateSettings:uy},Symbol.toStringTag,{value:"Module"})),Qk=({symbol:r="AAPL",defaultPeriod:t=30})=>{const[s,n]=j.useState(t),[i,a]=j.useState("daily"),{data:o,isLoading:l,error:c,refetch:h}=Qe({queryKey:["historical-prices",r,i,s],queryFn:async()=>{console.log(`Fetching ${i} prices for ${r}, ${s} periods`);try{return await uo(r,i,s)||{data:[]}}catch(R){return console.warn("Historical prices API failed, using fallback:",R.message),{data:[]}}},enabled:!!r,staleTime:300*1e3,retry:2}),u=R=>R?`$${R.toFixed(2)}`:"N/A",m=R=>{if(!R)return"";try{return Fa(new Date(R),"MMM dd, yyyy")}catch{return R}},p=R=>{if(!R)return"";try{return Fa(new Date(R),"MMM dd, yyyy, h:mm a")}catch{return R}},x=o?.data||[],b=x[0],w=x[(x?.length||0)-1],C=b&&w?b.close-w.close:0,A=b&&w&&w.close?C/w.close*100:0,_=({active:R,payload:E,label:T})=>{if(R&&E&&E?.length){const M=E[0].payload;return e.jsxs(g,{sx:{backgroundColor:"background.paper",border:1,borderColor:"divider",borderRadius:1,p:2,boxShadow:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:p(T)||"No Date"}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Open:"})," ",u(M.open)]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"High:"})," ",u(M.high)]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Low:"})," ",u(M.low)]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Close:"})," ",u(M.close)]}),e.jsxs(d,{variant:"body2",children:[e.jsx("strong",{children:"Volume:"})," ",M.volume?.toLocaleString()||"N/A"]})]})}return e.jsx(g,{})};return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gt,{sx:{color:"primary.main"}}),e.jsxs(d,{variant:"h6",sx:{fontWeight:600},children:["Historical Prices - ",r]})]}),e.jsx(oe,{variant:"outlined",size:"small",onClick:()=>h(),disabled:l,startIcon:e.jsx(Lt,{}),children:"Refresh"})]}),e.jsxs(g,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsxs(El,{size:"small",variant:"outlined",children:[e.jsx(oe,{onClick:()=>a("daily"),variant:i==="daily"?"contained":"outlined",children:"Daily"}),e.jsx(oe,{onClick:()=>a("weekly"),variant:i==="weekly"?"contained":"outlined",children:"Weekly"}),e.jsx(oe,{onClick:()=>a("monthly"),variant:i==="monthly"?"contained":"outlined",children:"Monthly"})]}),e.jsxs(El,{size:"small",variant:"outlined",children:[e.jsx(oe,{onClick:()=>n(30),variant:s===30?"contained":"outlined",children:"30 periods"}),e.jsx(oe,{onClick:()=>n(90),variant:s===90?"contained":"outlined",children:"90 periods"}),e.jsx(oe,{onClick:()=>n(252),variant:s===252?"contained":"outlined",children:"1 Year"})]})]}),b&&w&&e.jsxs(g,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Current: ${u(b.close)}`,color:"primary",variant:"outlined"}),e.jsx(X,{icon:C>=0?e.jsx(at,{}):e.jsx(Tt,{}),label:`${C>=0?"+":""}${u(C)} (${A.toFixed(2)}%)`,color:C>=0?"success":"error",variant:"outlined"}),e.jsx(X,{label:`Volume: ${b.volume?.toLocaleString()||"N/A"}`,variant:"outlined"})]}),l&&e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:300},children:e.jsx(Je,{})}),c&&e.jsxs(we,{severity:"error",sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",children:"Failed to load price data"}),e.jsx(d,{variant:"body2",children:c.message||"Unknown error occurred"})]}),!l&&!c&&x.length>0&&e.jsx(st,{width:"100%",height:300,"data-testid":"responsive-container",children:e.jsxs(Ks,{data:[...x].reverse(),"data-testid":"line-chart","data-chart-data":JSON.stringify(x),children:[e.jsx(ut,{strokeDasharray:"3 3","data-testid":"cartesian-grid"}),e.jsx(dt,{dataKey:"date",tick:{fontSize:12},"data-testid":"x-axis","data-key":"date"}),e.jsx(ht,{tick:{fontSize:12},domain:["auto","auto"],"data-testid":"y-axis"}),e.jsx(ot,{content:e.jsx(_,{}),"data-testid":"chart-tooltip"}),e.jsx(Ds,{type:"monotone",dataKey:"close",stroke:"#1976d2",strokeWidth:2,dot:{r:0},"data-testid":"chart-line"})]})}),!l&&!c&&(x?.length||0)===0&&e.jsxs(we,{severity:"info",children:[e.jsx(d,{variant:"subtitle2",children:"No price data available"}),e.jsxs(d,{variant:"body2",children:["The price data for ",r," (",i,") is not yet loaded. The price loaders need to populate the database tables."]})]}),x.length>0&&e.jsx(g,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:["Showing ",x?.length||0," ",i," data points for"," ",r,b&&` • Latest: ${m(b.date)}`]})})]})})};class qk{constructor(){this.cache=new Map,this.refreshIntervals={marketData:36e5,portfolio:36e5,sentiment:36e5,earnings:864e5,financials:864e5,news:36e5,companyInfo:864e5,sectorData:36e5,economicData:36e5},this.apiCallCounts=new Map,this.rateLimits={default:{calls:100,window:6e4},yfinance:{calls:50,window:6e4},newsapi:{calls:100,window:36e5}}}isMarketHours(){const t=new Date,s=t.getDay(),n=t.getHours(),i=t.getMinutes();if(s===0||s===6)return!1;const a=9.5,o=16,l=n+i/60;return l>=a&&l<o}getCacheKey(t,s={}){try{return`${t}-${JSON.stringify(s||{})}`}catch(n){return console.warn("[Cache] Failed to stringify params, using endpoint only:",n),t}}async get(t,s={},n={}){const i=this.getCacheKey(t,s),a=this.cache.get(i),o=n.cacheType||"default",l=this.refreshIntervals[o]||this.refreshIntervals.marketData;if(a&&!n.forceRefresh&&Date.now()-a.timestamp<l)return a?.data;if(!this.checkRateLimit(n.apiType||"default")){if(a)return a?.data;throw new Error("Rate limit exceeded - please try again later")}try{const c=n.fetchFunction;if(!c)throw new Error("No fetch function provided");const h=await c();return this.cache.set(i,{data:h,timestamp:Date.now(),endpoint:t}),this.cache.size>100&&this.cleanupCache(),h}catch(c){if(a)return a?.data;throw c}}checkRateLimit(t){const s=this.rateLimits[t]||this.rateLimits.default,n=Date.now();this.apiCallCounts.has(t)||this.apiCallCounts.set(t,[]);const i=this.apiCallCounts.get(t),a=n-s.window,o=i.filter(l=>l>a);return this.apiCallCounts.set(t,o),o.length>=s.calls?!1:(o.push(n),!0)}cleanupCache(){try{const t=Date.now(),s=1440*60*1e3,n=[];for(const[i,a]of this.cache.entries()){if(!a||typeof a!="object"||typeof a.timestamp!="number"){n.push(i);continue}t-a.timestamp>s&&n.push(i)}n.forEach(i=>this.cache.delete(i))}catch(t){console.error("[Cache] Error during cleanup:",t)}}async batchFetch(t,s={}){return!t||!Array.isArray(t)||t.length===0?[]:(await Promise.allSettled(t.map(i=>!i||typeof i!="object"||!i.endpoint?Promise.reject(new Error("Invalid request object")):this.get(i.endpoint,i.params,{...s,...i.options})))).map((i,a)=>({...t[a]||{},success:i.status==="fulfilled",data:i.status==="fulfilled"?i.value:null,error:i.status==="rejected"?i.reason:null}))}async preloadCommonData(){if(!this.isMarketHours()){const t=[{endpoint:"/api/market/overview",cacheType:"marketData"},{endpoint:"/api/market/sectors",cacheType:"sectorData"},{endpoint:"/api/market/sentiment",cacheType:"sentiment"}];for(const s of t)try{await this.get(s.endpoint,{},{cacheType:s.cacheType,fetchFunction:()=>fetch(s.endpoint).then(n=>n.json())}),await new Promise(n=>setTimeout(n,2e3))}catch{}}}getStats(){const t={cacheSize:this.cache.size,cacheEntries:[],apiCallCounts:{}};try{for(const[s,n]of this.cache.entries()){if(!n||typeof n!="object"){t.cacheEntries.push({endpoint:s,age:0,expired:!0,invalid:!0});continue}const i=typeof n.timestamp=="number"?n.timestamp:0,a=Date.now()-i,o=n.cacheType||"marketData";t.cacheEntries.push({endpoint:n.endpoint||s,age:Math.round(a/1e3),expired:a>(this.refreshIntervals[o]||this.refreshIntervals.marketData)})}for(const[s,n]of this.apiCallCounts.entries()){if(!Array.isArray(n)){t.apiCallCounts[s]={recent:0,limit:0,window:"0s",invalid:!0};continue}const i=this.rateLimits[s]||this.rateLimits.default,a=Date.now()-i.window,o=n.filter(l=>typeof l=="number"&&l>a);t.apiCallCounts[s]={recent:o.length,limit:i.calls,window:i.window/1e3+"s"}}}catch(s){console.error("[Cache] Error generating stats:",s)}return t}}const Xu=new qk;var Hk=tO();const nr=pu(Hk),ge=(r,t=2)=>{if(r==null)return"N/A";const s=parseFloat(r);return isNaN(s)?"N/A":Math.abs(s)>=1e12?nr(s).format("$0.00a").replace("t","T"):Math.abs(s)>=1e9?nr(s).format("$0.00a").replace("b","B"):Math.abs(s)>=1e6?nr(s).format("$0.00a").replace("m","M"):Math.abs(s)>=1e3?nr(s).format("$0.00a").replace("k","K"):nr(s).format(`$0.${"0".repeat(t)}`)},Et=(r,t=2)=>{if(r==null)return"N/A";const s=parseFloat(r);return isNaN(s)?"N/A":nr(s/100).format(`0.${"0".repeat(t)}%`)},Gk=(r,t=2)=>{if(r==null)return"N/A";const s=parseFloat(r);if(isNaN(s))return"N/A";const n=nr(Math.abs(s)).format(`0.${"0".repeat(t)}`);return s>0?`+${n}%`:s<0?`-${n}%`:`${n}%`},Kt=Et,Me=(r,t=2)=>{if(r==null)return"N/A";const s=parseFloat(r);return isNaN(s)?"N/A":Math.abs(s)>=1e12?nr(s).format("0.00a").replace("t","T"):Math.abs(s)>=1e9?nr(s).format("0.00a").replace("b","B"):Math.abs(s)>=1e6?nr(s).format("0.00a").replace("m","M"):Math.abs(s)>=1e3?nr(s).format("0.00a").replace("k","K"):nr(s).format(`0.${"0".repeat(t)}`)},Xn=(r,t=0)=>{if(r==null)return"N/A";const s=parseFloat(r);return isNaN(s)?"N/A":nr(s).format(`0,0.${"0".repeat(t)}`)},Ts=r=>{if(r==null)return"#666";const t=parseFloat(r);return isNaN(t)?"#666":t>0?"#2e7d32":t<0?"#d32f2f":"#666"},Aa=r=>{if(!r)return"N/A";try{return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},cr=(r,t)=>{if(t==null)return{icon:"info",color:"text.secondary",label:"N/A"};switch(r){case"rsi":return t>70?{icon:"up",color:"error.main",label:"Overbought"}:t<30?{icon:"down",color:"primary.main",label:"Oversold"}:{icon:"neutral",color:"success.main",label:"Neutral"};case"macd":return t>0?{icon:"up",color:"success.main",label:"Bullish"}:t<0?{icon:"down",color:"error.main",label:"Bearish"}:{icon:"flat",color:"warning.main",label:"Flat"};case"adx":return t>=25?{icon:"up",color:"success.main",label:"Trending"}:{icon:"flat",color:"info.main",label:"Weak"};case"atr":return t>2?{icon:"up",color:"warning.main",label:"High Volatility"}:{icon:"flat",color:"info.main",label:"Low Volatility"};case"mfi":return t>80?{icon:"up",color:"error.main",label:"Overbought"}:t<20?{icon:"down",color:"primary.main",label:"Oversold"}:{icon:"neutral",color:"success.main",label:"Neutral"};case"roc":case"mom":return t>0?{icon:"up",color:"success.main",label:"Positive"}:t<0?{icon:"down",color:"error.main",label:"Negative"}:{icon:"flat",color:"info.main",label:"Flat"};case"bbands_upper":case"bbands_middle":case"bbands_lower":return{icon:"neutral",color:"info.main",label:""};case"sma_10":case"sma_20":case"sma_50":case"sma_150":case"sma_200":case"ema_4":case"ema_9":case"ema_21":return{icon:"neutral",color:"secondary.main",label:""};case"pivot_high":return t?{icon:"up",color:"success.main",label:"Pivot High"}:{icon:"neutral",color:"info.main",label:""};case"pivot_low":return t?{icon:"down",color:"primary.main",label:"Pivot Low"}:{icon:"neutral",color:"info.main",label:""};default:return{icon:"info",color:"text.secondary",label:""}}},Kk=()=>{const[r,t]=j.useState({isOpen:!1,session:"Closed",nextChange:null,indices:[]}),[s,n]=j.useState(!0),i=async()=>{try{const o=await Xu.get("/api/market/status",{},{cacheType:"marketData",fetchFunction:async()=>{const l=new Date,c=l.getDay(),h=l.getHours(),u=l.getMinutes(),m=h+u/60,p=c>0&&c<6,x=m>=9.5&&m<16,b=m>=4&&m<9.5,w=m>=16&&m<20;let C="Closed",A=null;p&&(x?(C="Open",A="Closes at 4:00 PM"):b?(C="Pre-Market",A="Opens at 9:30 AM"):w&&(C="After-Hours",A="Closes at 8:00 PM"));const _=[{symbol:"SPX",name:"S&P 500",value:4500+(Math.random()-.5)*100,change:(Math.random()-.5)*2,changePercent:(Math.random()-.5)*2},{symbol:"DJI",name:"Dow Jones",value:35e3+(Math.random()-.5)*500,change:(Math.random()-.5)*200,changePercent:(Math.random()-.5)*2},{symbol:"IXIC",name:"Nasdaq",value:14e3+(Math.random()-.5)*300,change:(Math.random()-.5)*100,changePercent:(Math.random()-.5)*3}];return{isOpen:C==="Open",session:C,nextChange:A,indices:_}}});t(o),n(!1)}catch{n(!1)}};if(j.useEffect(()=>{i();const o=setInterval(i,36e5);return()=>clearInterval(o)},[]),s||!r)return null;const a=()=>{if(!r?.session)return"default";switch(r.session){case"Open":return"success";case"Pre-Market":return"warning";case"After-Hours":return"info";default:return"error"}};return e.jsx(He,{elevation:0,"data-testid":"market-status-bar",sx:{p:1.5,backgroundColor:"background.default",borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(X,{icon:e.jsx(Xw,{sx:{fontSize:12}}),label:`Market Status: ${r?.session||"Unknown"}`,color:a(),size:"small",sx:{fontWeight:"bold"}}),r?.nextChange&&e.jsx(d,{variant:"caption",color:"text.secondary",children:r.nextChange})]}),e.jsx(g,{display:"flex",alignItems:"center",gap:3,children:r?.indices&&(r.indices||[]).map((o,l)=>e.jsxs(gn.Fragment,{children:[l>0&&e.jsx(Fe,{orientation:"vertical",flexItem:!0}),e.jsx(g,{display:"flex",alignItems:"center",gap:1,children:e.jsxs(g,{children:[e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontWeight:500},children:o.name}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(d,{variant:"body2",fontWeight:"bold",children:Me(o.value,0)}),o.change>=0?e.jsx(at,{sx:{fontSize:16,color:"success.main"}}):e.jsx(Tt,{sx:{fontSize:16,color:"error.main"}}),e.jsx(d,{variant:"body2",color:o.change>=0?"success.main":"error.main",fontWeight:"medium",children:Et(o.changePercent)})]})]})})]},o.symbol))}),!1]})})};function Yk(){const[r,t]=j.useState(!1),[s,n]=j.useState(!1);return j.useEffect(()=>{const a=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.port==="5173";t(a),a?(async()=>{try{const l=new AbortController,c=setTimeout(()=>l.abort(),1e3),h=window.__CONFIG__?.API_URL||"http://localhost:3001",u=await fetch(`${h}/api/health?quick=true`,{signal:l.signal,headers:{Accept:"application/json"}});clearTimeout(c);const m=u.ok;n(m)}catch{n(!1)}})():n(!0)},[]),{isDevelopment:r,apiAvailable:s,shouldEnableQueries:!r||s}}const Gj={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},Io=["#1976d2","#43a047","#ffb300","#8e24aa","#e53935"],cd="ProTrade Analytics",Xk=[{name:"S&P 500",value:5432.1,change:.42,pct:"+0.8%",icon:e.jsx(Ii,{sx:{color:"success.main",fontSize:18}})},{name:"NASDAQ",value:17890.55,change:-.22,pct:"-0.1%",icon:e.jsx(Rl,{sx:{color:"error.main",fontSize:18}})},{name:"DOW",value:38900.12,change:.15,pct:"+0.4%",icon:e.jsx(Ii,{sx:{color:"success.main",fontSize:18}})},{name:"VIX",value:18.5,change:-.8,pct:"-4.1%",icon:e.jsx(Rl,{sx:{color:"success.main",fontSize:18}})},{name:"DXY",value:103.2,change:.3,pct:"+0.3%",icon:e.jsx(Ii,{sx:{color:"success.main",fontSize:18}})},{name:"Gold",value:2345.5,change:12.3,pct:"+0.5%",icon:e.jsx(Ii,{sx:{color:"success.main",fontSize:18}})}];function kc(r=!0){return Qe({queryKey:["market-overview"],enabled:r,queryFn:async()=>{try{return await Xu.get("/api/market/overview",{},{cacheType:"marketData",fetchFunction:async()=>{try{return(await ho())?.data}catch(s){throw(s.message?.includes("503")||s.message?.includes("Service Unavailable")||s.message?.includes("Network Error"))&&console.warn("⚠️ Market overview API unavailable:",s.message),new Error("Market data unavailable - check API connection")}}})||{data:{}}}catch(t){return console.warn("Market overview cache failed, using fallback:",t.message),{data:{}}}},staleTime:3600*1e3,refetchInterval:3600*1e3})}function Kj(r=!0){return Qe({queryKey:["top-stocks"],enabled:r,queryFn:async()=>{try{return await Xu.get("/api/scores",{limit:10,sortBy:"composite_score",sortOrder:"desc"},{cacheType:"marketData",fetchFunction:async()=>{try{return(await my({limit:10,sortBy:"composite_score",sortOrder:"desc"}))?.data}catch(s){throw(s.message?.includes("503")||s.message?.includes("Service Unavailable")||s.message?.includes("Network Error"))&&console.warn("⚠️ Top stocks API unavailable:",s.message),new Error("Stock scoring data unavailable - check API connection")}}})||[]}catch(t){return console.warn("Top stocks cache failed, using fallback:",t.message),[]}},staleTime:3600*1e3,refetchInterval:3600*1e3})}function Zk(r=!0){const{isAuthenticated:t}=ps();return Qe({queryKey:["portfolio-data"],enabled:r,queryFn:async()=>{if(!t)return null;try{const s=await Mu();return s?.data?{value:s.data.total_value||s.data.value,pnl:{daily:s.data.daily_change||s.data.pnl?.daily,mtd:s.data.mtd_change||s.data.pnl?.mtd,ytd:s.data.ytd_change||s.data.pnl?.ytd},allocation:s.data.allocation}:null}catch(s){return console.error("Portfolio API failed:",s),null}},staleTime:120*1e3})}function Jk({enabled:r=!0}){const{data:t,isLoading:s}=Qe({queryKey:["dashboard-technical-signals"],enabled:r,queryFn:async()=>{try{return(await Oc({limit:10}))?.data||[]}catch(i){console.error("Trading signals API failed:",i);try{const{apiUrl:a}=Xt(),o=await fetch(`${a}/api/dashboard/summary`,{headers:{Authorization:"Bearer dev-bypass-token"}});if(o.ok)return((await o.json()).data?.top_gainers||[]).slice(0,5).map(u=>({symbol:u.symbol,signal:u.change_percent>0?"Buy":"Sell",date:new Date().toISOString().split("T")[0],current_price:u.current_price,performance_percent:u.change_percent}))}catch(a){console.error("Dashboard fallback also failed:",a)}return[]}},refetchInterval:3e5,retry:1,retryDelay:1e3}),n=t&&Array.isArray(t)?t:[];return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(gx,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Technical Signals"}),e.jsx(X,{label:"Live",color:"success",size:"small",sx:{ml:1}})]}),s?e.jsx(d,{variant:"body2",color:"text.secondary",children:"Loading signals..."}):e.jsx(Ae,{sx:{maxHeight:200},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Signal"}),e.jsx(f,{align:"right",children:"Price"}),e.jsx(f,{align:"right",children:"Perf"})]})}),e.jsx(ke,{children:Array.isArray(n)&&(n||[]).map((i,a)=>e.jsxs(V,{children:[e.jsx(f,{children:i.symbol}),e.jsx(f,{children:e.jsx(Uk,{signal:i.signal,confidence:i.confidence||.75,size:"small",variant:"chip",showConfidence:!1})}),e.jsx(f,{align:"right",children:i.current_price?`$${Number(i.current_price).toFixed(2)}`:"--"}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",color:i.performance_percent>=0?"success.main":"error.main",children:i.performance_percent?Number(i.performance_percent).toFixed(1)+"%":"--"})})]},i.symbol+i.date+a))})]})})]})})}function eC(){const{data:r,isLoading:t}=kc(),s=r?.data?.sentiment||{fearGreed:50,naaim:50,aaii:{bullish:33,neutral:33,bearish:34},status:"Neutral",vix:20},n=i=>i>75?"success":i>50?"warning":"error";return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Rn,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Market Sentiment"})]}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h4",color:n(s.fearGreed),children:s.fearGreed}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Fear & Greed"})]})}),e.jsx(y,{item:!0,xs:6,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h4",color:n(s.naaim),children:s.naaim}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"NAAIM"})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[e.jsx(g,{children:e.jsxs(d,{variant:"body2",color:"success.main",children:["Bulls: ",s.aaii?.bullish||45,"%"]})}),e.jsx(g,{children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Neutral: ",s.aaii?.neutral||27,"%"]})}),e.jsx(g,{children:e.jsxs(d,{variant:"body2",color:"error.main",children:["Bears: ",s.aaii?.bearish||28,"%"]})})]})})]}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(X,{label:`${s.status} Market`,color:n(s.fearGreed),size:"small"}),e.jsx(X,{label:`VIX: ${s.vix}`,color:s.vix<20?"success":"warning",size:"small",sx:{ml:1}})]})]})})}function tC(){const{data:r,isLoading:t}=kc(),s=r?.data?.sectors||[];return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ma,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Sector Performance"})]}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:s,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"sector",tick:{fontSize:12}}),e.jsx(ht,{tick:{fontSize:12}}),e.jsx(ot,{formatter:n=>`${n.toFixed(2)}%`}),e.jsx(jt,{dataKey:"performance",fill:"#8884d8",children:(s||[]).map((n,i)=>e.jsx(xt,{fill:n.performance>=0?"#00C49F":"#FF8042"},`cell-${i}`))})]})})]})})}function sC(){const{data:r,isLoading:t}=Kj(),s=r?.data||[];return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(mx,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Top Rated Stocks"})]}),e.jsx(Ae,{sx:{maxHeight:250},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"}),e.jsx(f,{align:"right",children:"Quality"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsx(ke,{children:s.slice(0,6).map((n,i)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(g,{sx:{display:"flex",alignItems:"center"},children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:n.symbol})})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:n.score,color:n.score>=90?"success":n.score>=80?"warning":"default",size:"small"})}),e.jsx(f,{align:"right",children:n.quality}),e.jsx(f,{align:"right",children:n.value})]},n.symbol||i))})]})})]})})}function rC(){const{data:r,isLoading:t}=kc(),s=r?.data?.economic||[],n=i=>i==="up"?e.jsx(Ii,{sx:{color:"success.main",fontSize:16}}):i==="down"?e.jsx(Rl,{sx:{color:"error.main",fontSize:16}}):e.jsx(uu,{sx:{color:"text.secondary",fontSize:16}});return e.jsx(z,{sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Dl,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h6",sx:{fontWeight:600},children:"Economic Indicators"})]}),e.jsx(Or,{spacing:2,children:(s||[]).map((i,a)=>e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(d,{variant:"body2",children:i.name}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[i.value,"%"]}),n(i.trend)]})]},a))})]})})}const nC=()=>{jc("Dashboard");const{isAuthenticated:r,user:t}=ps(),[s,n]=j.useState("AAPL"),[i,a]=j.useState("overview"),{shouldEnableQueries:o}=Yk(),[l,c]=j.useState("http://localhost:3001"),[h,u]=j.useState(!1),[m,p]=j.useState(!1),[x,b]=j.useState(!1),w=["AAPL","MSFT","GOOGL","TSLA","NVDA","SPY","QQQ"];j.useEffect(()=>{const F=()=>{const ne=window.innerWidth;u(ne<=375),p(ne>375&&ne<=768)},$=()=>{if(window.matchMedia)try{const ne=window.matchMedia("(prefers-contrast: high)");if(ne&&typeof ne.matches<"u"){b(ne.matches);const he=re=>b(re.matches);return ne.addListener(he),()=>ne.removeListener(he)}}catch(ne){console.warn("Media query not supported:",ne)}},q=()=>{try{const he=Xt()?.apiUrl||"http://localhost:3001";c(he),console.log("Dashboard API Base:",he)}catch(ne){console.warn("API config failed, using default:",ne),c("http://localhost:3001")}};return F(),$(),q(),window.addEventListener("resize",F),()=>window.removeEventListener("resize",F)},[]);const{data:C}=Zk(o&&r),{data:A}=kc(o&&r),{data:_}=Kj(o&&r),{data:R,isLoading:E}=Qe({queryKey:["stock-prices",s],enabled:o&&r,queryFn:async()=>{try{return await uo(s,"daily",30)||{data:[]}}catch(F){return console.warn("Stock prices API failed, using fallback:",F.message),{data:[]}}},staleTime:300*1e3}),{data:T,isLoading:M}=Qe({queryKey:["stock-metrics",s],enabled:o&&r,queryFn:async()=>{try{return await Lu(s)||{data:{}}}catch(F){return console.warn("Stock metrics API failed, using fallback:",F.message),{data:{}}}},staleTime:300*1e3}),I=Qe({queryKey:["dashboard-trading-signals"],queryFn:async()=>{try{return((await Oc({limit:10}))?.data||[]).map($=>({symbol:$.symbol,action:$.signal==="BUY"?"Buy":$.signal==="SELL"?"Sell":"Hold",confidence:$.confidence||.75,type:$.type||"Technical",price:parseFloat($.price||$.current_price||0),date:$.date}))}catch(F){return console.error("Trading signals API failed:",F),[]}},staleTime:300*1e3,retry:1}),N=C||{value:0,pnl:{daily:0,mtd:0,ytd:0},allocation:[]},k=[],S=[],L=[],W=I.data||[];return R?.data&&R?.data.map(F=>({date:F.date||F.timestamp,equity:F.close||F.price})).reverse(),T?.data&&(T?.data.beta,T?.data.volatility&&(T?.data.volatility*100).toFixed(2)+"",T?.data.sharpe_ratio,T?.data.max_drawdown&&(T?.data.max_drawdown*100).toFixed(2)+""),e.jsxs(e.Fragment,{children:[e.jsx(Kk,{}),e.jsxs(lt,{maxWidth:"xl",sx:{py:3},"data-testid":h?"mobile-dashboard":m?"tablet-dashboard":x?"high-contrast-dashboard":void 0,children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:700,background:"linear-gradient(45deg, #1976d2, #43a047)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:cd}),e.jsx(d,{variant:"h6",color:"text.secondary",sx:{fontWeight:500},children:"Elite Financial Intelligence Platform"}),e.jsxs(g,{display:"flex",gap:1,mt:1,children:[e.jsx(X,{icon:e.jsx(qf,{}),label:"Real-Time",color:"success",size:"small"}),e.jsx(X,{icon:e.jsx(Rn,{}),label:"AI-Powered",color:"primary",size:"small"}),e.jsx(X,{icon:e.jsx(kr,{}),label:"Institutional",color:"warning",size:"small"}),e.jsx(X,{icon:e.jsx(fx,{}),label:"Advanced Analytics",color:"info",size:"small"})]})]}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(ii,{badgeContent:W?.length||0,color:"error",children:e.jsx(Ge,{"aria-label":"View notifications",tabIndex:0,children:e.jsx(Il,{})})}),e.jsx(hu,{options:w,value:s,onChange:(F,$)=>$&&n($),sx:{width:180},renderInput:F=>e.jsx(_e,{...F,label:"Symbol",size:"small","aria-label":"Search for stock symbol",inputProps:{...F.inputProps,"aria-describedby":"symbol-search-help"}}),"aria-label":"Stock symbol search"}),t&&e.jsx(tt,{title:t.email||t.name,arrow:!0,children:e.jsx(Mt,{sx:{bgcolor:"primary.main",width:40,height:40},children:t.name?t.name[0]:t.email?t.email[0]:"U"})})]})]}),r&&t&&e.jsx(z,{sx:{mb:4,background:"linear-gradient(135deg, #1976d2 0%, #42a5f5 100%)",color:"white"},children:e.jsx(U,{sx:{py:2},children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:4,children:[e.jsxs(g,{children:[e.jsxs(d,{variant:"h5",fontWeight:"bold",children:["Welcome back,"," ",t.firstName||t.username||t.email?.split("@")[0]||"Investor"]}),e.jsxs(d,{variant:"body2",sx:{opacity:.9},children:["Portfolio Status: Active | Market Session: Open | Data Feed: Live | Last Updated:"," ",new Date().toLocaleTimeString()]})]}),e.jsxs(g,{display:"flex",gap:4,children:[e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Portfolio Value"}),e.jsxs(d,{variant:"h5",fontWeight:"bold",children:["$",Xn(N.value)]})]}),e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Today's P&L"}),e.jsxs(d,{variant:"h5",fontWeight:"bold",color:N.pnl.daily>=0?"success.light":"error.light",children:["$",Xn(N.pnl.daily)]})]}),e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Active Signals"}),e.jsx(d,{variant:"h5",fontWeight:"bold",children:W?.length||0})]}),e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Win Rate"}),e.jsx(d,{variant:"h5",fontWeight:"bold",color:"success.light",children:"87.2%"})]})]})]}),e.jsx(g,{display:"flex",alignItems:"center",gap:2,children:e.jsxs(g,{textAlign:"right",children:[e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"System Status"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(g,{width:8,height:8,borderRadius:"50%",bgcolor:"success.main",sx:{animation:"pulse 2s infinite"}}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:"All Systems Operational"})]})]})})]})})}),!r&&e.jsxs(we,{severity:"info",sx:{mb:4,background:"linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)",border:"1px solid #2196f3"},action:e.jsx(oe,{color:"inherit",size:"small",variant:"outlined","aria-label":"Sign in to your account",tabIndex:0,children:"Sign In"}),children:[e.jsx("strong",{children:"Demo Mode:"})," You're viewing sample data with full platform capabilities. Sign in to access your personal portfolio, real-time alerts, and advanced analytics."]}),e.jsxs(y,{container:!0,spacing:2,mb:4,children:[e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #1976d2 0%, #42a5f5 100%)",color:"white"},onClick:()=>window.location.href="/portfolio",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(Fs,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Portfolio"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Analytics"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #43a047 0%, #66bb6a 100%)",color:"white"},onClick:()=>window.location.href="/scores",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(mx,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Scores"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Rankings"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #ff9800 0%, #ffb74d 100%)",color:"white"},onClick:()=>window.location.href="/screener",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(Tr,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Screener"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Discovery"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #9c27b0 0%, #ba68c8 100%)",color:"white"},onClick:()=>window.location.href="/realtime",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(Lt,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Real-Time"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Live Data"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #f44336 0%, #ef5350 100%)",color:"white"},onClick:()=>window.location.href="/market-overview",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(Dl,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Market"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Overview"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s","&:hover":{transform:"translateY(-4px)",boxShadow:6},background:"linear-gradient(135deg, #607d8b 0%, #78909c 100%)",color:"white"},onClick:()=>window.location.href="/metrics",children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(Pr,{sx:{fontSize:32,mb:1}}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Metrics"}),e.jsx(d,{variant:"body2",sx:{opacity:.9},children:"Analysis"})]})})})]}),e.jsxs(g,{sx:{mb:4,p:2,bgcolor:"grey.50",borderRadius:2},children:[e.jsx(d,{variant:"h2",component:"h2",sx:{mb:2,fontWeight:600,fontSize:"1.5rem"},children:"Market Summary"}),e.jsx(y,{container:!0,spacing:2,children:(Xk||[]).map((F,$)=>e.jsx(y,{item:!0,xs:12,sm:6,md:2,children:e.jsx(z,{sx:{boxShadow:1,borderTop:`4px solid ${Io[$%(Io?.length||0)]}`},children:e.jsxs(U,{sx:{textAlign:"center",py:1},children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:F.name}),e.jsx(d,{variant:"h6",sx:{fontWeight:700},children:F.value.toLocaleString()}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[F.icon,e.jsx(d,{variant:"body2",sx:{fontWeight:600,color:F.change>=0?"success.main":"error.main"},children:F.pct})]})]})})},F.name))})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{sx:{height:400,boxShadow:3,borderLeft:"6px solid #1976d2"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Fs,{sx:{color:"primary.main",mr:1}}),e.jsx(d,{variant:"h3",component:"h3",sx:{fontWeight:600,fontSize:"1.25rem"},children:"Portfolio Overview"})]}),e.jsxs(d,{variant:"h4",sx:{fontWeight:700,color:"primary.main",mb:2},children:["$",Xn(N.value)]}),e.jsxs(g,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Daily: $${Xn(N.pnl.daily)}`,color:N.pnl.daily>=0?"success":"error",size:"small"}),e.jsx(X,{label:`MTD: $${Xn(N.pnl.mtd)}`,color:N.pnl.mtd>=0?"success":"error",size:"small"}),e.jsx(X,{label:`YTD: $${Xn(N.pnl.ytd)}`,color:N.pnl.ytd>=0?"success":"error",size:"small"})]}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:N.allocation,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:F,value:$})=>`${F} ${$}%`,children:(N.allocation||[]).map((F,$)=>e.jsx(xt,{fill:Io[$%(Io?.length||0)]},`cell-${$}`))}),e.jsx(ot,{})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{sx:{height:400,boxShadow:3,borderLeft:"6px solid #43a047"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Gt,{sx:{color:"success.main",mr:1}}),e.jsx(d,{variant:"h3",component:"h3",sx:{fontWeight:600,fontSize:"1.25rem"},children:"Elite Watchlist"})]}),e.jsx(Ae,{sx:{maxHeight:320},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Price"}),e.jsx(f,{align:"right",children:"Change"}),e.jsx(f,{align:"right",children:"Score"}),e.jsx(f,{align:"center",children:"Action"})]})}),e.jsx(ke,{children:(k||[]).map((F,$)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:F.symbol})}),e.jsxs(f,{align:"right",children:["$",F.price?.toFixed(2)||"--"]}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"body2",color:F.change>=0?"success.main":"error.main",fontWeight:"bold",children:[F.change>=0?"+":"",F.change??"--","%"]})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:F.score,color:F.score>=90?"success":F.score>=80?"warning":"default",size:"small"})}),e.jsx(f,{align:"center",children:e.jsx(Ge,{size:"small",color:"primary","aria-label":"Execute trading strategy",tabIndex:0,children:e.jsx(Gr,{})})})]},F.symbol||$))})]})})]})})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(eC,{})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(tC,{})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(sC,{})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(rC,{})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(Fl,{componentName:"TechnicalSignalsWidget",children:e.jsx(Jk,{enabled:o&&r})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(Fl,{componentName:"HistoricalPriceChart",children:e.jsx(Qk,{symbol:s,defaultPeriod:30})})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:350},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Zw,{sx:{color:"warning.main",mr:1}}),e.jsx(d,{variant:"h3",component:"h3",sx:{fontWeight:600,fontSize:"1.25rem"},children:"Trading Signals"}),e.jsx(X,{label:"AI-Powered",color:"primary",size:"small",sx:{ml:1}})]}),e.jsx(Or,{spacing:2,children:(W||[]).map((F,$)=>e.jsx(g,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body1",fontWeight:"bold",children:F.symbol}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[F.type," Signal"]})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsx(X,{label:F.action,color:F.action==="Buy"?"success":"error",size:"small",sx:{mb:.5}}),e.jsxs(d,{variant:"caption",display:"block",children:[(F.confidence*100).toFixed(0),"% confidence"]})]})]})},F.symbol||$))}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Market News"}),e.jsx(d,{variant:"body2",color:"primary.main",fontWeight:"bold",children:"Loading latest news..."})]})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:350},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(px,{sx:{color:"info.main",mr:1}}),e.jsx(d,{variant:"h3",component:"h3",sx:{fontWeight:600,fontSize:"1.25rem"},children:"Economic Calendar"}),e.jsx(X,{label:"High Impact",color:"warning",size:"small",sx:{ml:1}})]}),e.jsx(Or,{spacing:2,children:(L||[]).map((F,$)=>e.jsx(g,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body1",fontWeight:"bold",children:F.event}),e.jsx(d,{variant:"caption",color:"text.secondary",children:Fa(new Date(F.date),"MMM d, yyyy")})]}),e.jsx(X,{label:F.impact,color:F.impact==="High"?"error":"warning",size:"small"})]})},F.event||$))})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:350},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Lt,{sx:{color:"success.main",mr:1}}),e.jsx(d,{variant:"h3",component:"h3",sx:{fontWeight:600,fontSize:"1.25rem"},children:"Trading Activity"}),e.jsx(X,{label:"Live",color:"success",size:"small",sx:{ml:1}}),e.jsx(oe,{size:"small",variant:"outlined",sx:{ml:"auto"},onClick:()=>window.location.href="/trade-history","aria-label":"View all market alerts",tabIndex:0,children:"View All"})]}),e.jsx(Or,{spacing:2,children:(S||[]).map((F,$)=>e.jsx(g,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body1",fontWeight:"bold",children:F.type}),e.jsx(d,{variant:"body2",color:"text.secondary",children:F.desc}),e.jsx(d,{variant:"caption",color:"text.secondary",children:Fa(new Date(F.date),"MMM d, yyyy")})]}),F.amount&&e.jsxs(d,{variant:"body2",fontWeight:"bold",color:"primary.main",children:["$",Xn(F.amount)]})]})},F.type+F.desc+$))})]})})})]}),e.jsx(y,{container:!0,spacing:3,sx:{mb:4},children:e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{sx:{background:"linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%)",border:"1px solid #ddd"},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Rn,{sx:{color:"primary.main",mr:1,fontSize:32}}),e.jsx(d,{variant:"h2",component:"h2",sx:{fontWeight:700,fontSize:"1.5rem"},children:"AI-Powered Intelligence Center"}),e.jsx(X,{label:"Neural Networks",color:"primary",size:"small",sx:{ml:2}}),e.jsx(X,{label:"Machine Learning",color:"secondary",size:"small",sx:{ml:1}})]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:"100%",border:"2px solid #1976d2"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,sx:{color:"primary.main",fontWeight:600},children:"Market Intelligence"}),e.jsxs(jr,{dense:!0,children:[e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"success.main",width:32,height:32},children:e.jsx(at,{fontSize:"small"})})}),e.jsx(Ut,{primary:"Market Sentiment: Bullish",secondary:"Neural network confidence: 89%"})]}),e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"warning.main",width:32,height:32},children:e.jsx(Ar,{fontSize:"small"})})}),e.jsx(Ut,{primary:"Volatility Forecast",secondary:"VIX spike probability: 34%"})]}),e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"info.main",width:32,height:32},children:e.jsx(gx,{fontSize:"small"})})}),e.jsx(Ut,{primary:"Sector Rotation Signal",secondary:"Technology outperformance expected"})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:"100%",border:"2px solid #43a047"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,sx:{color:"success.main",fontWeight:600},children:"Risk Management"}),e.jsxs(Or,{spacing:2,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Portfolio Beta"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(rt,{variant:"determinate",value:75,sx:{flex:1,height:8,borderRadius:4},role:"progressbar","aria-label":"Market sentiment score progress","aria-valuenow":75,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":"75% market sentiment score"}),e.jsx(d,{variant:"h6",children:"0.95"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Value at Risk (95%)"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(rt,{variant:"determinate",value:60,color:"warning",sx:{flex:1,height:8,borderRadius:4},role:"progressbar","aria-label":"Value at risk indicator","aria-valuenow":60,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":"60% value at risk"}),e.jsx(d,{variant:"h6",children:"-$28K"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Sharpe Ratio"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(rt,{variant:"determinate",value:85,color:"success",sx:{flex:1,height:8,borderRadius:4},role:"progressbar","aria-label":"Portfolio diversification score","aria-valuenow":85,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":"85% portfolio diversification"}),e.jsx(d,{variant:"h6",children:"1.42"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Max Drawdown"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(rt,{variant:"determinate",value:25,color:"error",sx:{flex:1,height:8,borderRadius:4},role:"progressbar","aria-label":"Account utilization percentage","aria-valuenow":25,"aria-valuemin":0,"aria-valuemax":100,"aria-valuetext":"25% account utilization"}),e.jsx(d,{variant:"h6",children:"-8.2%"})]})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{sx:{height:"100%",border:"2px solid #ff9800"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,sx:{color:"warning.main",fontWeight:600},children:"Algorithm Signals"}),e.jsxs(jr,{dense:!0,children:[(W||[]).map((F,$)=>e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:F.action==="Buy"?"success.main":"error.main",width:32,height:32},children:F.action==="Buy"?e.jsx(Ii,{fontSize:"small"}):e.jsx(Rl,{fontSize:"small"})})}),e.jsx(Ut,{primary:`${F.action} ${F.symbol}`,secondary:`${(F.confidence*100).toFixed(0)}% confidence • ${F.type}`}),e.jsx(Ge,{size:"small",color:"primary","aria-label":"View stock details",tabIndex:0,children:e.jsx(Gr,{})})]},$)),e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"info.main",width:32,height:32},children:e.jsx(qf,{fontSize:"small"})})}),e.jsx(Ut,{primary:"Strategy Performance",secondary:"YTD: +23.7% • Win Rate: 87.2%"})]})]})]})})})]})]})})})}),e.jsx(z,{sx:{mb:4,border:"2px solid #e3f2fd"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h2",component:"h2",gutterBottom:!0,sx:{fontWeight:600,fontSize:"1.5rem"},children:"Quick Actions"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),fullWidth:!0,onClick:()=>window.location.href="/portfolio",sx:{background:"linear-gradient(45deg, #1976d2, #42a5f5)"},"aria-label":"Add new position to portfolio",tabIndex:0,children:"Add Position"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Lt,{}),fullWidth:!0,onClick:()=>window.location.href="/trade-history",sx:{background:"linear-gradient(45deg, #43a047, #66bb6a)"},"aria-label":"View trade history",tabIndex:0,children:"Trade History"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Gr,{}),fullWidth:!0,onClick:()=>window.location.href="/orders",sx:{background:"linear-gradient(45deg, #ff5722, #ff7043)"},"aria-label":"Place new trading order",tabIndex:0,children:"Place Order"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",color:"secondary",startIcon:e.jsx(Pr,{}),fullWidth:!0,onClick:()=>window.location.href="/backtest","aria-label":"Run strategy backtest",tabIndex:0,children:"Run Backtest"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",color:"success",startIcon:e.jsx(Tr,{}),fullWidth:!0,onClick:()=>window.location.href="/screener","aria-label":"Screen stocks with filters",tabIndex:0,children:"Screen Stocks"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",color:"warning",startIcon:e.jsx(Il,{}),fullWidth:!0,onClick:()=>window.location.href="/alerts","aria-label":"Set up price alerts",tabIndex:0,children:"Set Alert"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"contained",color:"info",startIcon:e.jsx(Kr,{}),fullWidth:!0,"aria-label":"Export portfolio data",tabIndex:0,children:"Export Data"})}),e.jsx(y,{item:!0,xs:6,md:2,children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(ao,{}),fullWidth:!0,onClick:()=>window.location.href="/settings","aria-label":"Open settings page",tabIndex:0,children:"Settings"})})]})]})}),e.jsxs(g,{sx:{mt:4,mb:2,textAlign:"center",p:3,bgcolor:"grey.50",borderRadius:2},children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,color:"primary.main"},children:[cd," - Elite Financial Intelligence"]}),e.jsx(d,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Powered by advanced machine learning, real-time data feeds, and institutional-grade analytics."}),e.jsxs(g,{sx:{display:"flex",justifyContent:"center",gap:2,mb:2},children:[e.jsx(X,{icon:e.jsx(kr,{}),label:"Bank-Grade Security",color:"primary",size:"small"}),e.jsx(X,{icon:e.jsx(xn,{}),label:"Sub-Second Latency",color:"success",size:"small"}),e.jsx(X,{icon:e.jsx(Rn,{}),label:"AI-Powered",color:"secondary",size:"small"}),e.jsx(X,{icon:e.jsx(Dl,{}),label:"Global Markets",color:"info",size:"small"})]}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["For institutional and qualified investors only. Not investment advice. Data may be delayed. Risk disclosure: Trading involves substantial risk of loss. © ",new Date().getFullYear()," ",cd,". All rights reserved."]})]})]})]})},iC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},Yj=(r,t,s,n={})=>{new Date().toISOString(),s?.message||s?.toString(),s?.stack,s?.isAxiosError&&(s.config?.url,s.config?.method,s.config?.baseURL,s.config?.timeout,s.response?.status,s.response?.statusText,s.response?.data)},aC=(r,t,s,n={})=>{Yj(r,`Query[${t}]`,s,{...n})},oC=(r,t,s=null,n={})=>{new Date().toISOString(),s&&(Array.isArray(s)?s?.length:Object.keys(s).length)},Qn=r=>({error:(t,s,n)=>Yj(r,t,s,n),queryError:(t,s,n)=>aC(r,t,s,n),success:(t,s,n)=>oC(r,t,s,n),info:(t,s)=>iC&&!1}),na=Qn("MarketOverview"),lC=({children:r,delay:t=0,...s})=>{const n=Zs(),i=300+t*100;return e.jsx(tS,{in:!0,timeout:i,children:e.jsx(z,{...s,sx:{background:n.palette.background.paper,backdropFilter:"blur(10px)",border:`1px solid ${Xe(n.palette.primary.main,.1)}`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-4px)",boxShadow:n.shadows[8],border:`1px solid ${Xe(n.palette.primary.main,.2)}`},...s.sx},children:r})})},Do=({children:r,value:t,index:s,...n})=>e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`market-tabpanel-${s}`,"aria-labelledby":`market-tab-${s}`,...n,children:t===s&&e.jsx(g,{sx:{pt:3},children:r})}),cC=async()=>{try{return await ho()}catch(r){throw na.error("Market overview error:",r.message||r.toString()),r}},dC=async(r=30)=>{try{return await Eu(r)}catch(t){throw na.error("Sentiment history error:",t.message||t.toString()),t}},hC=async()=>{try{console.log("📏 Fetching market breadth...");const r=await Iu();return console.log("📏 Market breadth response:",r),r}catch(r){throw na.error("Market breadth error:",r.message||r.toString()),r}},uC=async()=>{try{console.log("📊 Fetching distribution days...");const r=await gy();return console.log("📊 Distribution days response:",r),r}catch(r){throw na.error("Distribution days error:",r.message||r.toString()),r}},fC=async()=>{try{console.log("📅 Fetching seasonality data...");const r=await Du();return console.log("📅 Seasonality response:",r),r}catch(r){throw na.error("Seasonality error:",r.message||r.toString()),r}},mC=async()=>{try{console.log("🔬 Fetching research indicators...");const r=await Ru();return console.log("🔬 Research indicators response:",r),r}catch(r){throw na.error("Research indicators error:",r.message||r.toString()),r}};function Xj(){const[r,t]=j.useState(0),[s,n]=j.useState(!1),[i,a]=j.useState("cards"),[o,l]=j.useState("all"),c=Zs();j.useEffect(()=>{const ee=setTimeout(()=>n(!0),100);return()=>clearTimeout(ee)},[]);const{data:h,isLoading:u,error:m}=Qe({queryKey:["market-overview"],queryFn:cC,refetchInterval:6e4,retry:2,staleTime:3e4}),{data:p,isLoading:x}=Qe({queryKey:["market-sentiment-history"],queryFn:()=>dC(30),enabled:r===0,staleTime:3e4}),{data:b,isLoading:w}=Qe({queryKey:["market-breadth"],queryFn:hC,enabled:r===1,staleTime:3e4}),{data:C,isLoading:A}=Qe({queryKey:["distribution-days"],queryFn:uC,staleTime:3e4}),{data:_,isLoading:R}=Qe({queryKey:["seasonality-data"],queryFn:fC,enabled:r===2,staleTime:3e4}),{data:E,isLoading:T}=Qe({queryKey:["market-research-indicators"],queryFn:mC,enabled:r===3,staleTime:3e4}),M=(ee,te)=>{t(te)};if(m)return e.jsxs(g,{children:[e.jsx(d,{variant:"h4",sx:{mb:3,fontWeight:600},children:"Market Overview"}),e.jsxs(we,{severity:"error",sx:{mb:3},children:["Failed to load market data. Please check your data sources and try again.",e.jsx("br",{}),e.jsxs("small",{children:["Technical details: ",m?.message||"Unknown error"]}),e.jsx("br",{}),e.jsxs("small",{children:["Debug endpoint:"," ",e.jsxs("code",{children:[window.__CONFIG__?.API_URL,"/market/debug"]})]})]})]});if(u||!h)return e.jsxs(g,{children:[e.jsx(d,{variant:"h4",sx:{mb:3,fontWeight:600},children:"Market Overview"}),e.jsx(Je,{})]});const I=h?.data?.sentiment_indicators||h?.sentiment_indicators||{},N=h?.data?.market_breadth||h?.market_breadth||{},k=h?.data?.market_cap||h?.market_cap||{},S=h?.data?.indices||h?.indices||[];h?.sectors||h?.data?.sectors;const L=h?.movers||{gainers:[],losers:[]},W=b?.data||b||{},F=C?.data||C||{},$=p?.data||p||{};console.log("sentimentHistory",$);const q=$.fear_greed_history||[],ne=$.naaim_history||[],he=$.aaii_history||[];console.log("aaiiHistory",he);const re={};q.forEach(ee=>{const te=ee.date||ee.timestamp;re[te]||(re[te]={date:te}),re[te].fear_greed=ee.value,re[te].fear_greed_text=ee.value_text}),ne.forEach(ee=>{const te=ee.date||ee.timestamp;re[te]||(re[te]={date:te}),re[te].naaim=ee.mean_exposure||ee.average}),he.forEach(ee=>{const te=ee.date||ee.timestamp;re[te]||(re[te]={date:te}),re[te].aaii_bullish=ee.bullish,re[te].aaii_bearish=ee.bearish,re[te].aaii_neutral=ee.neutral});const G=Object.values(re).sort((ee,te)=>new Date(ee.date)-new Date(te.date)).slice(-30);console.log("sentimentChartData",G);const H=q[0]||{},P=ne[0]||{},D=I?.aaii||{},ce=((ee,te)=>{const Pe=ee-te;return Pe>10?{label:"Bullish",color:"success",icon:e.jsx(at,{})}:Pe<-10?{label:"Bearish",color:"error",icon:e.jsx(Tt,{})}:{label:"Neutral",color:"warning",icon:e.jsx(Ml,{})}})(D.bullish||0,D.bearish||0),ae=()=>e.jsx(g,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsx(d,{variant:"h6",children:"AAII Market Sentiment"}),e.jsx(X,{label:ce.label,color:ce.color,icon:ce.icon})]}),e.jsxs(g,{children:[e.jsxs(g,{mb:2,children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",color:"textSecondary",children:"Bullish"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",color:"success.main",children:[D.bullish??"N/A","%"]})]}),e.jsx(rt,{variant:"determinate",value:D.bullish||0,color:"success",sx:{height:8,borderRadius:1}})]}),e.jsxs(g,{mb:2,children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",color:"textSecondary",children:"Neutral"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",color:"warning.main",children:[D.neutral??"N/A","%"]})]}),e.jsx(rt,{variant:"determinate",value:D.neutral||0,color:"warning",sx:{height:8,borderRadius:1}})]}),e.jsxs(g,{children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",color:"textSecondary",children:"Bearish"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",color:"error.main",children:[D.bearish??"N/A","%"]})]}),e.jsx(rt,{variant:"determinate",value:D.bearish||0,color:"error",sx:{height:8,borderRadius:1}})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:8,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"AAII Market Sentiment Trend (Stacked View)"}),e.jsx(st,{width:"100%",height:280,children:e.jsxs(_x,{data:G.slice(0,30).reverse(),children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"bullishGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#4caf50",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#4caf50",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"neutralGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ff9800",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#ff9800",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"bearishGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f44336",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f44336",stopOpacity:0})]})]}),e.jsx(ut,{strokeDasharray:"3 3",stroke:"rgba(0,0,0,0.1)"}),e.jsx(dt,{dataKey:"date",tick:{fontSize:12}}),e.jsx(ht,{domain:[0,100],label:{value:"Sentiment %",angle:-90,position:"insideLeft"}}),e.jsx(ot,{formatter:ee=>`${ee?.toFixed(1)}%`,contentStyle:{backgroundColor:"rgba(0,0,0,0.8)",border:"none",borderRadius:"4px"}}),e.jsx(gu,{wrapperStyle:{paddingTop:"20px"}}),e.jsx(gl,{type:"monotone",dataKey:"aaii_bullish",name:"Bullish %",stackId:"1",fill:"url(#bullishGrad)",stroke:"#4caf50",strokeWidth:1}),e.jsx(gl,{type:"monotone",dataKey:"aaii_neutral",name:"Neutral %",stackId:"1",fill:"url(#neutralGrad)",stroke:"#ff9800",strokeWidth:1}),e.jsx(gl,{type:"monotone",dataKey:"aaii_bearish",name:"Bearish %",stackId:"1",fill:"url(#bearishGrad)",stroke:"#f44336",strokeWidth:1})]})})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Fear & Greed Index History"}),e.jsxs(g,{sx:{mb:2},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Current: ",e.jsx("strong",{children:H.value??"N/A"})," - ",H.value_text||""]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Measures market sentiment (0=Extreme Fear, 100=Extreme Greed)"})]}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Ks,{data:G,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",tick:{fontSize:12}}),e.jsx(ht,{domain:[0,100],label:{value:"Fear & Greed Index",angle:-90,position:"insideLeft",fontSize:12}}),e.jsx(ot,{formatter:ee=>[`${ee}`,"Fear & Greed"]}),e.jsx(Ds,{type:"monotone",dataKey:"fear_greed",name:"Fear & Greed",stroke:"#FF8042",strokeWidth:2,dot:{r:3}})]})})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"NAAIM Exposure History"}),e.jsxs(g,{sx:{mb:2},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Current: ",e.jsxs("strong",{children:[P.mean_exposure??P.average??"N/A","%"]})]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Active manager equity exposure (0=fully out, 100=fully in)"})]}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Ks,{data:G,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",tick:{fontSize:12}}),e.jsx(ht,{domain:[-100,100],label:{value:"NAAIM Exposure %",angle:-90,position:"insideLeft",fontSize:12}}),e.jsx(ot,{formatter:ee=>[`${ee}%`,"NAAIM Exposure"]}),e.jsx(Ds,{type:"monotone",dataKey:"naaim",name:"NAAIM Exposure",stroke:"#0088FE",strokeWidth:2,dot:{r:3}})]})})]})})})]})});return e.jsxs(g,{sx:{minHeight:"100vh",bgcolor:"background.default"},"data-testid":"market-overview-page",children:[e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Fear & Greed Index"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Current Value:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:H.value??"N/A"})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Classification:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:H.value_text||H.classification||"N/A"})]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Scale: 0 (Extreme Fear) - 100 (Extreme Greed)"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"NAAIM Exposure"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Mean Exposure:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:P.mean_exposure??P.average??"N/A"})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Bearish Exposure:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:P.bearish_exposure??"N/A"})]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Active manager equity exposure (0=out, 100=in)"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"AAII Sentiment"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Bullish:"}),e.jsxs(d,{variant:"body2",fontWeight:"600",children:[D.bullish??"N/A","%"]})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Neutral:"}),e.jsxs(d,{variant:"body2",fontWeight:"600",children:[D.neutral??"N/A","%"]})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Bearish:"}),e.jsxs(d,{variant:"body2",fontWeight:"600",children:[D.bearish??"N/A","%"]})]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Retail investor sentiment survey"})]})})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsx(y,{container:!0,spacing:2,alignItems:"center",children:e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:800,background:`linear-gradient(135deg, ${c.palette.primary.main} 0%, ${c.palette.secondary.main} 100%)`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:1},children:"Market Overview"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",children:"Real-time market analysis, sentiment indicators, and institutional-grade research insights"})]})}),u&&e.jsxs(g,{sx:{mt:2},children:[e.jsx(rt,{sx:{borderRadius:1,height:6,bgcolor:Xe(c.palette.primary.main,.1),"& .MuiLinearProgress-bar":{borderRadius:1,background:`linear-gradient(90deg, ${c.palette.primary.main} 0%, ${c.palette.secondary.main} 100%)`}}}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"Fetching real-time market data..."})]})]}),S&&S.length>0&&e.jsx(y,{container:!0,spacing:2,sx:{mb:4},children:S.map((ee,te)=>e.jsx(y,{item:!0,xs:12,sm:4,children:e.jsx(z,{sx:{p:2},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body2",sx:{fontWeight:600,mb:.5},children:ee.symbol}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem"},children:ee.name})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsx(d,{variant:"body1",sx:{fontWeight:700,mb:.25},children:ge(ee.price,2)}),e.jsx(d,{variant:"body2",sx:{color:Ts(ee.changePercent),fontWeight:600},children:Gk(ee.changePercent)})]})]})})},ee.symbol))}),(L.gainers?.length>0||L.losers?.length>0)&&e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(d,{variant:"h5",sx:{mb:2,fontWeight:600},children:"Top Movers"})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,color:"success.main",fontWeight:600},children:"Top Gainers"}),L.gainers?.slice(0,5).map((ee,te)=>e.jsxs(g,{"data-testid":"mover-item",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,borderBottom:te<L.gainers.slice(0,5).length-1?"1px solid":"none",borderColor:"divider"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body1",sx:{fontWeight:600},children:ee.symbol}),e.jsx(d,{variant:"body2",color:"text.secondary",children:ge(ee.price)})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsxs(d,{variant:"body1",sx:{color:"success.main",fontWeight:600},children:["+",Math.abs(ee.change).toFixed(1)]}),e.jsxs(d,{variant:"body2",sx:{color:"success.main"},children:["+",ee.changePercent.toFixed(1),"%"]})]})]},ee.symbol))]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,color:"error.main",fontWeight:600},children:"Top Losers"}),L.losers?.slice(0,5).map((ee,te)=>e.jsxs(g,{"data-testid":"mover-item",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,borderBottom:te<L.losers.slice(0,5).length-1?"1px solid":"none",borderColor:"divider"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body1",sx:{fontWeight:600},children:ee.symbol}),e.jsx(d,{variant:"body2",color:"text.secondary",children:ge(ee.price)})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsx(d,{variant:"body1",sx:{color:"error.main",fontWeight:600},children:ee.change.toFixed(1)}),e.jsxs(d,{variant:"body2",sx:{color:"error.main"},children:[ee.changePercent.toFixed(1),"%"]})]})]},ee.symbol))]})})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(lC,{delay:3,children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Market Breadth"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"success.light",borderRadius:1},children:[e.jsx(d,{variant:"h4",color:"success.contrastText",children:N.advancing!==void 0&&N.advancing!==null?parseInt(N.advancing).toLocaleString():"N/A"}),e.jsx(d,{variant:"body2",color:"success.contrastText",children:"Advancing"})]})}),e.jsx(y,{item:!0,xs:6,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"error.light",borderRadius:1},children:[e.jsx(d,{variant:"h4",color:"error.contrastText",children:N.declining!==void 0&&N.declining!==null?parseInt(N.declining).toLocaleString():"N/A"}),e.jsx(d,{variant:"body2",color:"error.contrastText",children:"Declining"})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(g,{sx:{textAlign:"center",mt:2},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Advance/Decline Ratio:"," ",N.advance_decline_ratio!==void 0?N.advance_decline_ratio:"N/A"]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Average Change:"," ",N.average_change_percent!==void 0?parseFloat(N.average_change_percent).toFixed(2)+"%":"N/A"]})]})})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Market Statistics"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Total Stocks:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:N.total_stocks!==void 0?parseInt(N.total_stocks).toLocaleString():"N/A"})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Total Market Cap:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:k.total!==void 0?ge(k.total):"N/A"})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Unchanged:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:N.unchanged!==void 0?parseInt(N.unchanged).toLocaleString():"N/A"})]})," "]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Market Cap Distribution"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Large Cap:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:ge(k.large_cap)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Mid Cap:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:ge(k.mid_cap)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Small Cap:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:ge(k.small_cap)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Total:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:ge(k.total)})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Distribution Days"}),A?e.jsx(Je,{size:24}):e.jsx(e.Fragment,{children:Object.entries(F).length>0?e.jsxs(e.Fragment,{children:[Object.entries(F).slice(0,3).map(([ee,te])=>{const Pe=et=>{switch(et){case"NORMAL":return"success.main";case"ELEVATED":return"warning.main";case"CAUTION":return"warning.dark";case"UNDER_PRESSURE":return"error.main";default:return"text.secondary"}},Be=et=>{switch(et){case"NORMAL":return"success";case"ELEVATED":return"warning";case"CAUTION":return"warning";case"UNDER_PRESSURE":return"error";default:return"default"}};return e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1.5,p:1,borderRadius:1,backgroundColor:"grey.50"},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:600,children:te.name}),e.jsx(d,{variant:"caption",color:"text.secondary",children:ee})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsx(d,{variant:"h6",sx:{color:Pe(te.signal),fontWeight:600},children:te.count}),e.jsx(X,{label:te.signal,color:Be(te.signal),size:"small"})]})]},ee)}),e.jsx(g,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"IBD Distribution Days: Down 0.2%+ on higher volume over 25 days"})})]}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"No distribution days data available"})})]})})})]}),e.jsxs(g,{children:[e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper"},children:e.jsxs(Ir,{value:r,onChange:M,"aria-label":"market data tabs",variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{minHeight:56,fontWeight:600,fontSize:"0.875rem",textTransform:"none","&.Mui-selected":{color:c.palette.primary.main}},"& .MuiTabs-indicator":{height:3,borderRadius:"3px 3px 0 0",background:`linear-gradient(90deg, ${c.palette.primary.main} 0%, ${c.palette.secondary.main} 100%)`}},children:[e.jsx(it,{value:0,label:"Sentiment History",icon:e.jsx(Lt,{}),iconPosition:"start"}),e.jsx(it,{value:1,label:"Market Breadth",icon:e.jsx(Jw,{}),iconPosition:"start"}),e.jsx(it,{value:2,label:"Seasonality",icon:e.jsx(eS,{}),iconPosition:"start"}),e.jsx(it,{value:3,label:"Research Indicators",icon:e.jsx(xr,{}),iconPosition:"start"})]})}),s&&e.jsxs(e.Fragment,{children:[e.jsx(Do,{value:r,index:0,children:x?e.jsx(rt,{}):e.jsx(ae,{})}),e.jsx(Do,{value:r,index:1,children:w?e.jsx(rt,{}):e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Market Breadth Details"}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Advancing Stocks:"}),e.jsx(d,{variant:"body2",color:"success.main",fontWeight:"600",children:W.advancing||0})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Declining Stocks:"}),e.jsx(d,{variant:"body2",color:"error.main",fontWeight:"600",children:W.declining||0})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Unchanged:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:W.unchanged||0})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"A/D Ratio:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:W.advance_decline_ratio||"N/A"})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(d,{variant:"body2",children:"Average Change:"}),e.jsx(d,{variant:"body2",fontWeight:"600",sx:{color:Ts(parseFloat(W.average_change_percent)||0)},children:Et(parseFloat(W.average_change_percent)||0)})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Breadth Visualization"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Zr,{children:[e.jsxs(Jr,{data:[{name:"Advancing",value:W.advancing||0,color:"#4CAF50"},{name:"Declining",value:W.declining||0,color:"#F44336"},{name:"Unchanged",value:W.unchanged||0,color:"#9E9E9E"}],cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:ee,value:te})=>`${ee}: ${te}`,children:[e.jsx(xt,{fill:"#4CAF50"}),e.jsx(xt,{fill:"#F44336"}),e.jsx(xt,{fill:"#9E9E9E"})]}),e.jsx(ot,{})]})})]})})})]})}),e.jsx(Do,{value:r,index:2,children:R?e.jsx(rt,{}):e.jsx(y,{container:!0,spacing:3,children:_?.data&&e.jsxs(e.Fragment,{children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{sx:{border:"2px solid",borderColor:"primary.main"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Current Seasonal Position"}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"info.light",borderRadius:1},children:[e.jsxs(d,{variant:"h4",color:"info.contrastText",children:[_?.data.currentPosition.seasonalScore,"/100"]}),e.jsx(d,{variant:"body2",color:"info.contrastText",children:"Seasonal Score"}),e.jsx(d,{variant:"caption",color:"info.contrastText",children:_?.data.summary.overallSeasonalBias})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"secondary.light",borderRadius:1},children:[e.jsx(d,{variant:"h6",color:"secondary.contrastText",children:_?.data.currentPosition.presidentialCycle}),e.jsx(d,{variant:"body2",color:"secondary.contrastText",children:"Presidential Cycle"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"warning.light",borderRadius:1},children:[e.jsx(d,{variant:"h6",color:"warning.contrastText",children:_?.data.currentPosition.nextMajorEvent?.name}),e.jsxs(d,{variant:"body2",color:"warning.contrastText",children:["Next Event (",_?.data.currentPosition.nextMajorEvent?.daysAway," ","days)"]})]})})]}),e.jsxs(g,{sx:{mt:3},children:[e.jsxs(d,{variant:"body1",sx:{mb:1},children:[e.jsx("strong",{children:"Recommendation:"})," ",_?.data.summary.recommendation]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Active Periods:"," ",_?.data.currentPosition.activePeriods?.join(", ")]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Monthly Seasonality Pattern"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:_?.data.monthlySeasonality,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",angle:-45,textAnchor:"end",height:80}),e.jsx(ht,{label:{value:"Avg Return %",angle:-90,position:"insideLeft"}}),e.jsx(ot,{formatter:ee=>[`${ee.toFixed(1)}%`,"Average Return"]}),e.jsx(jt,{dataKey:"avgReturn",fill:ee=>ee?.isCurrent?"#82ca9d":"#8884d8",name:"Monthly Average"})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Quarterly Performance"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:_?.data.quarterlySeasonality,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name"}),e.jsx(ht,{label:{value:"Avg Return %",angle:-90,position:"insideLeft"}}),e.jsx(ot,{formatter:(ee,te,Pe)=>[`${ee.toFixed(1)}%`,"Average Return"]}),e.jsx(jt,{dataKey:"avgReturn",fill:"#8884d8",name:"Quarterly Average"})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Presidential Cycle (4-Year Pattern)"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:_?.data.presidentialCycle?.data||[],children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"label",tick:{fontSize:12}}),e.jsx(ht,{label:{value:"Avg Return %",angle:-90,position:"insideLeft"}}),e.jsx(ot,{formatter:ee=>[`${ee.toFixed(2)}%`,"Average Return"]}),e.jsx(jt,{dataKey:"avgReturn",fill:ee=>ee?.isCurrent?"#6366f1":"#8884d8",name:"Average Return"})]})}),e.jsx(g,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Historical average returns by presidential cycle year. Purple bars indicate the current year in the cycle."})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Day of Week Effects"}),(_?.data.dayOfWeekEffects||[]).map(ee=>e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1,p:1,backgroundColor:ee.isCurrent?"primary.light":"transparent",borderRadius:1},children:[e.jsx(d,{variant:"body2",fontWeight:ee.isCurrent?600:400,children:ee.day}),e.jsx(d,{variant:"body2",sx:{color:Ts(ee.avgReturn*100)},fontWeight:600,children:Et(ee.avgReturn)})]},ee.day))]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Seasonal Anomalies & Effects"}),e.jsx(y,{container:!0,spacing:2,children:(_?.data.seasonalAnomalies||[]).map((ee,te)=>e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1,height:"100%"},children:[e.jsx(d,{variant:"subtitle2",fontWeight:600,children:ee.name}),e.jsx(d,{variant:"caption",color:"text.secondary",display:"block",children:ee.period}),e.jsx(d,{variant:"body2",sx:{mt:1,mb:1},children:ee.description}),e.jsx(X,{label:ee.strength,size:"small",color:ee.strength==="Strong"?"error":ee.strength==="Moderate"?"warning":"info"})]})},te))})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Holiday Effects"}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Holiday"}),e.jsx(f,{children:"Dates"}),e.jsx(f,{align:"right",children:"Effect"})]})}),e.jsx(ke,{children:(_?.data.holidayEffects||[]).map((ee,te)=>e.jsxs(V,{children:[e.jsx(f,{children:ee.holiday}),e.jsx(f,{children:ee.dates}),e.jsx(f,{align:"right",sx:{color:Ts(parseFloat(ee.effect.replace("%",""))),fontWeight:600},children:ee.effect})]},te))})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Sector Seasonality"}),(_?.data.sectorSeasonality||[]).map((ee,te)=>e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",fontWeight:600,children:ee.sector}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["Best:"," ",ee.bestMonths.map(Pe=>new Date(0,Pe-1).toLocaleString("default",{month:"short"})).join(", ")]}),e.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",children:["Worst:"," ",ee.worstMonths.map(Pe=>new Date(0,Pe-1).toLocaleString("default",{month:"short"})).join(", ")]}),e.jsx(d,{variant:"body2",sx:{mt:.5},children:ee.rationale})]},te))]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Seasonal Outlook Summary"}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"body2",fontWeight:600,color:"success.main",sx:{mb:1},children:"Favorable Factors:"}),_?.data.summary.favorableFactors?.map((ee,te)=>e.jsxs(d,{variant:"body2",sx:{ml:2,mb:.5},children:["• ",ee]},te))]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"body2",fontWeight:600,color:"error.main",sx:{mb:1},children:"Unfavorable Factors:"}),_?.data.summary.unfavorableFactors?.map((ee,te)=>e.jsxs(d,{variant:"body2",sx:{ml:2,mb:.5},children:["• ",ee]},te))]})]})]})})})]})})}),e.jsx(Do,{value:r,index:3,children:T?e.jsx(rt,{}):e.jsx(y,{container:!0,spacing:3,children:E?.data&&e.jsxs(e.Fragment,{children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Market Research Summary"}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"info.light",borderRadius:1},children:[e.jsx(d,{variant:"h6",color:"info.contrastText",children:E?.data.summary.overallSentiment}),e.jsx(d,{variant:"body2",color:"info.contrastText",children:"Overall Market Sentiment"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"secondary.light",borderRadius:1},children:[e.jsx(d,{variant:"h6",color:"secondary.contrastText",children:E?.data.summary.marketRegime}),e.jsx(d,{variant:"body2",color:"secondary.contrastText",children:"Market Regime"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{sx:{textAlign:"center",p:2,backgroundColor:"warning.light",borderRadius:1},children:[e.jsx(d,{variant:"h6",color:"warning.contrastText",children:E?.data.summary.timeHorizon}),e.jsx(d,{variant:"body2",color:"warning.contrastText",children:"Investment Time Horizon"})]})})]}),e.jsx(g,{sx:{mt:3},children:e.jsxs(d,{variant:"body1",sx:{mb:1},children:[e.jsx("strong",{children:"Recommendation:"})," ",E?.data.summary.recommendation]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Volatility & Sentiment"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"VIX (Fear Index):"}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:600,display:"inline",children:E?.data.volatility.vix.toFixed(1)}),e.jsx(X,{label:E?.data.volatility.vixInterpretation.level,color:E?.data.volatility.vixInterpretation.color,size:"small",sx:{ml:1}})]})]}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["30-day avg:"," ",E?.data.volatility.vixAverage.toFixed(1)," ","|"," ",E?.data.volatility.vixInterpretation.sentiment]})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(d,{variant:"body2",children:"Put/Call Ratio:"}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:600,display:"inline",children:E?.data.sentiment.putCallRatio.toFixed(2)}),e.jsx(X,{label:E?.data.sentiment.putCallInterpretation.sentiment,color:E?.data.sentiment.putCallInterpretation.color,size:"small",sx:{ml:1}})]})]}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["10-day avg:"," ",E?.data.sentiment.putCallAverage.toFixed(2)," ","|"," ",E?.data.sentiment.putCallInterpretation.signal]})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Major Index Technical Levels"}),Object.entries(E?.data.technicalLevels).map(([ee,te])=>e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"body2",fontWeight:600,children:ee}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{variant:"caption",children:"Current:"}),e.jsx(d,{variant:"caption",children:te.current.toFixed(0)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[e.jsx(d,{variant:"caption",children:"Trend:"}),e.jsx(d,{variant:"caption",sx:{color:Ts(te.trend==="Bullish"?1:te.trend==="Bearish"?-1:0)},children:te.trend})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{variant:"caption",children:"RSI:"}),e.jsx(d,{variant:"caption",children:te.rsi.toFixed(1)})]})]},ee))]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Upcoming Economic Events"}),(E?.data.economicCalendar||[]).map((ee,te)=>e.jsxs(g,{sx:{mb:2,p:2,backgroundColor:"grey.50",borderRadius:1},children:[e.jsx(d,{variant:"body2",fontWeight:600,children:ee.event}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[new Date(ee.date).toLocaleDateString()," | Expected: ",ee.expected]}),e.jsxs(g,{sx:{mt:.5},children:[e.jsx(X,{label:ee.importance,color:ee.importance==="High"?"error":ee.importance==="Medium"?"warning":"default",size:"small"}),e.jsx(X,{label:ee.impact,color:"info",size:"small",sx:{ml:1}})]})]},te))]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Key Risks & Opportunities"}),e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"body2",fontWeight:600,color:"error.main",sx:{mb:1},children:"Key Risks:"}),(E?.data.summary?.keyRisks||[]).map((ee,te)=>e.jsxs(d,{variant:"body2",sx:{ml:2,mb:.5},children:["• ",ee]},te))]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:600,color:"success.main",sx:{mb:1},children:"Key Opportunities:"}),(E?.data.summary?.keyOpportunities||[]).map((ee,te)=>e.jsxs(d,{variant:"body2",sx:{ml:2,mb:.5},children:["• ",ee]},te))]})]})})})]})})})]})]})]})}const Mm={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},Ro=Qn("StockExplorer"),Mo={search:"",sector:"",industry:"",country:"",exchange:"",priceMin:"",priceMax:"",marketCapMin:"",marketCapMax:"",peRatioMin:"",peRatioMax:"",pegRatioMin:"",pegRatioMax:"",pbRatioMin:"",pbRatioMax:"",roeMin:"",roeMax:"",roaMin:"",roaMax:"",netMarginMin:"",netMarginMax:"",revenueGrowthMin:"",revenueGrowthMax:"",earningsGrowthMin:"",earningsGrowthMax:"",dividendYieldMin:"",dividendYieldMax:"",payoutRatioMin:"",payoutRatioMax:"",currentRatioMin:"",currentRatioMax:"",debtToEquityMin:"",debtToEquityMax:"",securityType:"stock",minAnalystRating:"",hasEarningsGrowth:!1,hasPositiveCashFlow:!1,paysDividends:!1},pC=["Technology","Healthcare","Financial Services","Consumer Cyclical","Communication Services","Industrials","Consumer Defensive","Energy","Utilities","Real Estate","Basic Materials"],gC=["NYSE","NASDAQ","AMEX","NYSEArca","BATS"];function dd(){const r=On(),[t,s]=U1(),[n,i]=j.useState(Mo),[a,o]=j.useState("advanced"),[l,c]=j.useState(0),[h,u]=j.useState(25),[m,p]=j.useState("symbol"),[x,b]=j.useState("asc"),[w,C]=j.useState(null),[A,_]=j.useState({}),[R,E]=j.useState({open:!1,symbol:"",data:[],loading:!1});j.useEffect(()=>{const D=Object.fromEntries(t);Object.keys(D).length>0&&(i(Y=>({...Y,...D})),D.viewMode&&o(D.viewMode))},[]);const T=()=>{const D=new URLSearchParams;return Object.entries(n).forEach(([Y,ce])=>{ce!==""&&ce!==!1&&D.append(Y,ce.toString())}),D.append("page",(l+1).toString()),D.append("limit",h.toString()),D.append("sortBy",m),D.append("sortOrder",x),D},{data:M,isLoading:I,error:N,refetch:k}=Qe({queryKey:["stockExplorer",n,l,h,m,x],queryFn:async()=>{try{const D=T();Ro.info("buildQueryParams - Parameters built",{params:D.toString()});const Y=await wc(D);return console.log("StockExplorer: Raw API response:",Y),console.log("StockExplorer: Data array:",Y?.data),console.log("StockExplorer: First item structure:",Y?.data?.results?.[0]),Ro.info("screenStocks - Request completed",{resultCount:Y?.data?.length||0,total:Y?.total||0,page:l+1,filters:Object.keys(n).filter(ce=>n[ce]!==""&&n[ce]!==!1).length}),Y}catch(D){throw Ro.error("screenStocks",D,{params:T().toString(),page:l+1,rowsPerPage:h,filters:n,orderBy:m,order:x}),D}},keepPreviousData:!0,staleTime:300*1e3,gcTime:600*1e3,retry:2,retryDelay:1e3,onError:D=>Ro.queryError("stockExplorer",D,{queryKey:["stockExplorer",n,l,h,m,x]})}),S=(D,Y)=>{i(ce=>({...ce,[D]:Y})),c(0),setTimeout(()=>{const ce=new URLSearchParams;Object.entries({...n,[D]:Y}).forEach(([ae,ee])=>{ee!==""&&ee!==!1&&ee!==Mo[ae]&&ce.set(ae,ee.toString())}),s(ce)},100)},L=()=>{i(Mo),c(0),s({})},W=(D,Y)=>{c(Y)},F=D=>{u(parseInt(D.target.value,10)),c(0)},$=D=>{C(w===D?null:D)},q=async D=>{try{E({open:!0,symbol:D,data:[],loading:!0}),console.log("Fetching comprehensive price history for",D);const Y=await Gu(D,90);if(Y&&Y?.data){console.log("Comprehensive price history loaded for",D,Y.data?.length||0,"records");const ce=Y?.data,ae={dataPoints:ce?.length||0,priceStats:{current:ce[0]?.close||0,periodHigh:Math.max(...(ce||[]).map(ee=>ee.high||0)),periodLow:Math.min(...ce.filter(ee=>ee.low>0).map(ee=>ee.low))},dateRange:{start:ce[(ce?.length||0)-1]?.date,end:ce[0]?.date}};E({open:!0,symbol:D,data:ce,loading:!1,summary:ae}),_(ee=>({...ee,[D]:ce}))}else throw new Error("No price data available")}catch(Y){E({open:!0,symbol:D,data:[],loading:!1,error:Y.message})}},ne=()=>{E({open:!1,symbol:"",data:[],loading:!1})},he=()=>Object.keys(n).filter(D=>n[D]!==""&&n[D]!==!1&&n[D]!==Mo[D]).length;let re=[];M&&(Array.isArray(M?.data)?re=M?.data:M?.data&&Array.isArray(M?.data.results)?re=M?.data.results:M?.data&&Array.isArray(M?.data.data)?re=M?.data.data:Array.isArray(M)&&(re=M));const G=new Map;re.forEach(D=>{D?.symbol&&!G.has(D.symbol)&&G.set(D.symbol,D)}),re=Array.from(G.values());const H=M?.data?.length||0,P=re.length;if(H>P){const D=H-P;console.warn(`StockExplorer: Deduplicated ${D} duplicate stock symbols. Original: ${H}, After deduplication: ${P}`)}return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Stock Explorer"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Browse and filter stocks with comprehensive stock information and screening criteria"})]}),e.jsxs(g,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(oe,{variant:"outlined",startIcon:e.jsx(mn,{}),onClick:L,disabled:he()===0,children:"Clear"}),e.jsx(X,{label:`${he()} Filters`,color:he()>0?"primary":"default",icon:e.jsx(Tr,{})})]})]}),M?.performance?.hasComplexFilters&&e.jsxs(we,{severity:"info",sx:{mb:2},children:[e.jsx("strong",{children:"Performance Note:"})," Complex filters are active. Results may take longer to load."]}),N&&e.jsxs(we,{severity:"error",sx:{mb:2},children:[e.jsx("strong",{children:"Error loading stocks:"})," ",N.message,". Try reducing filter complexity or refreshing the page."]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{sx:{position:"sticky",top:20},children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",gap:1,children:[e.jsx(Tr,{}),"Advanced Filters"]}),e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",children:"Search & Basic"})}),e.jsx(os,{children:e.jsxs(g,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(_e,{label:"Search",placeholder:"Ticker or company name",value:n.search,onChange:D=>S("search",D.target.value),size:"small",fullWidth:!0,InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})}}),e.jsxs(_e,{select:!0,label:"Sector",value:n.sector,onChange:D=>S("sector",D.target.value),size:"small",fullWidth:!0,children:[e.jsx(J,{value:"",children:"All Sectors"}),(pC||[]).map(D=>e.jsx(J,{value:D,children:D},D))]}),e.jsxs(_e,{select:!0,label:"Exchange",value:n.exchange,onChange:D=>S("exchange",D.target.value),size:"small",fullWidth:!0,children:[e.jsx(J,{value:"",children:"All Exchanges"}),(gC||[]).map(D=>e.jsx(J,{value:D,children:D},D))]})]})})]}),e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",children:"Additional Options"})}),e.jsx(os,{children:e.jsxs(g,{display:"flex",flexDirection:"column",gap:2,children:[e.jsxs(_e,{select:!0,label:"Financial Status",value:n.financialStatus||"",onChange:D=>S("financialStatus",D.target.value),size:"small",fullWidth:!0,children:[e.jsx(J,{value:"",children:"All Statuses"}),e.jsx(J,{value:"N",children:"Normal"}),e.jsx(J,{value:"D",children:"Deficient"}),e.jsx(J,{value:"Q",children:"Bankruptcy"}),e.jsx(J,{value:"S",children:"Suspended"})]}),e.jsxs(_e,{select:!0,label:"Security Type",value:n.securityType||"",onChange:D=>S("securityType",D.target.value),size:"small",fullWidth:!0,children:[e.jsx(J,{value:"",children:"All Types"}),e.jsx(J,{value:"stock",children:"Stocks Only"}),e.jsx(J,{value:"etf",children:"ETFs Only"})]})]})})]})]})})}),e.jsx(y,{item:!0,xs:12,md:9,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsxs(d,{variant:"h6",children:["Screening Results",(M?.pagination?.total||M?.total)&&e.jsx(X,{label:`${M?.pagination?.total||M?.total} stocks found`,color:"primary",variant:"outlined",sx:{ml:2}}),re.length>0&&e.jsx(X,{label:`Showing ${re?.length||0}`,color:"secondary",variant:"outlined",sx:{ml:1}})]}),e.jsxs(g,{display:"flex",gap:2,children:[e.jsxs(_e,{select:!0,label:"Sort By",value:m,onChange:D=>p(D.target.value),size:"small",sx:{minWidth:150},children:[e.jsx(J,{value:"symbol",children:"Symbol"}),e.jsx(J,{value:"exchange",children:"Exchange"}),e.jsx(J,{value:"marketCap",children:"Market Cap"}),e.jsx(J,{value:"currentPrice",children:"Price"}),e.jsx(J,{value:"volume",children:"Volume"}),e.jsx(J,{value:"risk_score",children:"Risk Score"})]}),e.jsx(oe,{variant:x==="desc"?"contained":"outlined",size:"small",onClick:()=>b(x==="asc"?"desc":"asc"),startIcon:x==="desc"?e.jsx(Tt,{}):e.jsx(at,{}),children:x==="desc"?"Desc":"Asc"})]})]}),I&&e.jsxs(g,{display:"flex",justifyContent:"center",p:4,children:[e.jsx(Je,{size:60}),e.jsxs(g,{ml:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Loading stocks data..."}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["API:"," ",Mm&&"http://localhost:5001"||"http://localhost:3001"]})]})]}),N&&e.jsxs(we,{severity:"error",sx:{mb:3},children:[e.jsx("strong",{children:"Error loading stocks:"})," ",N.message,e.jsx("br",{}),e.jsxs("small",{children:["This could be due to:",e.jsxs("ul",{children:[e.jsx("li",{children:"Backend API not running or accessible"}),e.jsx("li",{children:"Database connection issues"}),e.jsx("li",{children:"Incorrect API endpoint configuration"})]}),"Current API URL:"," ",Mm&&"http://localhost:5001"||"http://localhost:3001"]})]}),M&&!I&&e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{width:"100%"},children:(re||[]).map((D,Y)=>e.jsxs(is,{expanded:w===D.symbol,onChange:()=>$(D.symbol),sx:{mb:1},children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{backgroundColor:"grey.50","&:hover":{backgroundColor:"grey.100"}},children:e.jsxs(y,{container:!0,alignItems:"center",spacing:2,children:[e.jsxs(y,{item:!0,xs:2,children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:D.symbol}),e.jsx(d,{variant:"caption",color:"text.secondary",children:D.exchange})]}),e.jsxs(y,{item:!0,xs:4,children:[e.jsx(d,{variant:"body1",fontWeight:"medium",children:D.displayName||D.shortName||D.name||D.fullName||"N/A"}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[D.sector," • ",D.industry]})]}),e.jsxs(y,{item:!0,xs:2,children:[e.jsx(d,{variant:"body2",fontWeight:"bold",children:D.price?.current?ge(D.price.current):"N/A"}),e.jsx(d,{variant:"caption",color:Ts(D.price?.current-D.price?.previousClose),children:D.price?.current&&D.price?.previousClose?`${D.price.current-D.price.previousClose>0?"+":""}${Kt((D.price.current-D.price.previousClose)/D.price.previousClose)}`:"N/A"})]}),e.jsxs(y,{item:!0,xs:2,children:[e.jsx(d,{variant:"body2",children:D.marketCap?ge(D.marketCap):D.financialMetrics?.marketCap?ge(D.financialMetrics.marketCap):"N/A"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Market Cap"})]}),e.jsxs(y,{item:!0,xs:2,children:[e.jsx(d,{variant:"body2",children:D.financialMetrics?.trailingPE?Me(D.financialMetrics.trailingPE,2):D.displayData?.keyMetrics?.pe?Me(D.displayData.keyMetrics.pe,2):"N/A"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"P/E Ratio"})]}),e.jsx(y,{item:!0,xs:2,children:e.jsx(X,{label:`Risk: ${(D.risk_score||0).toFixed(1)}`,color:(D.risk_score||0)<30?"success":(D.risk_score||0)<50?"warning":"error",variant:"outlined",size:"small"})})]})}),e.jsx(os,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Company Information"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Full Name"}),e.jsx(d,{variant:"body2",children:D.fullName||D.name||D.shortName||D.displayName||"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Website"}),e.jsx(d,{variant:"body2",children:D.website?e.jsx("a",{href:D.website,target:"_blank",rel:"noopener noreferrer",children:(()=>{try{return new URL(D.website).hostname}catch{return D.website}})()}):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Employees"}),e.jsx(d,{variant:"body2",children:D.employeeCount!==void 0&&D.employeeCount!==null&&D.employeeCount!==""?typeof D.employeeCount=="number"?Me(D.employeeCount):D.employeeCount:"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Country"}),e.jsx(d,{variant:"body2",children:D.address?.country||D.country||"N/A"})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Business Summary"}),e.jsx(d,{variant:"body2",sx:{mt:.5},children:D.businessSummary?D.businessSummary.length>200?`${D.businessSummary.substring(0,200)}...`:D.businessSummary:"N/A"})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Market Data"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Current Price"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:D.price?.current!==void 0&&D.price?.current!==null&&D.price?.current!==""?ge(D.price.current):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Previous Close"}),e.jsx(d,{variant:"body2",children:D.price?.previousClose!==void 0&&D.price?.previousClose!==null&&D.price?.previousClose!==""?ge(D.price.previousClose):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Day Range"}),e.jsx(d,{variant:"body2",children:D.price?.dayLow!==void 0&&D.price?.dayHigh!==void 0&&D.price?.dayLow!==null&&D.price?.dayHigh!==null&&D.price?.dayLow!==""&&D.price?.dayHigh!==""?`${ge(D.price.dayLow)} - ${ge(D.price.dayHigh)}`:"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"52W Range"}),e.jsx(d,{variant:"body2",children:D.price?.fiftyTwoWeekLow!==void 0&&D.price?.fiftyTwoWeekHigh!==void 0&&D.price?.fiftyTwoWeekLow!==null&&D.price?.fiftyTwoWeekHigh!==null&&D.price?.fiftyTwoWeekLow!==""&&D.price?.fiftyTwoWeekHigh!==""?`${ge(D.price.fiftyTwoWeekLow)} - ${ge(D.price.fiftyTwoWeekHigh)}`:"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Volume"}),e.jsx(d,{variant:"body2",children:D.volume!==void 0&&D.volume!==null&&D.volume!==""?Me(D.volume):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Avg Volume"}),e.jsx(d,{variant:"body2",children:D.averageVolume!==void 0&&D.averageVolume!==null&&D.averageVolume!==""?Me(D.averageVolume):"N/A"})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Financial Metrics"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"P/E Ratio"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.trailingPE!==void 0&&D.financialMetrics?.trailingPE!==null&&D.financialMetrics?.trailingPE!==""?Me(D.financialMetrics.trailingPE,2):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"PEG Ratio"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.pegRatio!==void 0&&D.financialMetrics?.pegRatio!==null&&D.financialMetrics?.pegRatio!==""?Me(D.financialMetrics.pegRatio,2):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"P/B Ratio"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.priceToBook!==void 0&&D.financialMetrics?.priceToBook!==null&&D.financialMetrics?.priceToBook!==""?Me(D.financialMetrics.priceToBook,2):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"EPS"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.epsTrailing!==void 0&&D.financialMetrics?.epsTrailing!==null&&D.financialMetrics?.epsTrailing!==""?ge(D.financialMetrics.epsTrailing):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Revenue Growth"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.revenueGrowth!==void 0&&D.financialMetrics?.revenueGrowth!==null&&D.financialMetrics?.revenueGrowth!==""?Kt(D.financialMetrics.revenueGrowth):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Profit Margin"}),e.jsx(d,{variant:"body2",children:D.financialMetrics?.profitMargin!==void 0&&D.financialMetrics?.profitMargin!==null&&D.financialMetrics?.profitMargin!==""?Kt(D.financialMetrics.profitMargin):"N/A"})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Actions"}),e.jsxs(g,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(oe,{variant:"contained",startIcon:e.jsx(Gt,{}),onClick:()=>q(D.symbol),size:"small",children:"Price History"}),e.jsx(oe,{variant:"outlined",onClick:()=>r(`/stocks/${D.symbol}`),size:"small",children:"Full Details"}),D.website&&e.jsx(oe,{variant:"outlined",href:D.website,target:"_blank",rel:"noopener noreferrer",size:"small",children:"Company Website"})]}),A[D.symbol]&&e.jsxs(g,{sx:{mt:2},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Recent Price Data Loaded (",A[D.symbol]?.length||0," ","records)"]}),e.jsx(d,{variant:"caption",color:"success.main",children:'Click "Price History" again to see detailed view'})]})]})})})]})})]},D.symbol||`stock-${Y}`))}),e.jsx(g,{sx:{mt:2,display:"flex",justifyContent:"center"},children:e.jsx(yn,{rowsPerPageOptions:[10,25,50,100],component:"div",count:M?.pagination?.total||M?.total||0,rowsPerPage:h,page:l,onPageChange:W,onRowsPerPageChange:F})})]}),M&&(re?.length||0)===0&&!I&&e.jsxs(g,{textAlign:"center",py:6,children:[e.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No stocks match your criteria"}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:3,children:"Try adjusting your search or filter criteria"}),e.jsx(oe,{variant:"outlined",onClick:L,startIcon:e.jsx(mn,{}),children:"Clear All Filters"})]})]})})})]}),e.jsx(sS,{open:R.open,onClose:ne,closeAfterTransition:!0,BackdropComponent:rS,BackdropProps:{timeout:500},children:e.jsx(oo,{in:R.open,children:e.jsx(g,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:1200,maxHeight:"90vh",bgcolor:"background.paper",border:"none",borderRadius:2,boxShadow:24,overflow:"auto"},children:e.jsxs(g,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(d,{variant:"h5",component:"h2",children:["Price History - ",R.symbol]}),e.jsx(Ge,{onClick:ne,children:e.jsx(mn,{})})]}),R.loading?e.jsxs(g,{sx:{display:"flex",justifyContent:"center",py:4},children:[e.jsx(Je,{}),e.jsx(d,{sx:{ml:2},children:"Loading comprehensive price data..."})]}):R.error?e.jsxs(we,{severity:"error",sx:{mb:2},children:["Error loading price data: ",R.error,e.jsx("br",{}),e.jsx("small",{children:"Please try again later or check if the stock symbol is valid."})]}):R?.data.length>0?e.jsxs(e.Fragment,{children:[R.summary&&e.jsx(z,{variant:"outlined",sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Price Summary"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Current Price"}),e.jsx(d,{variant:"h6",children:ge(R.summary.priceStats?.current)})]}),e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Period High"}),e.jsx(d,{variant:"h6",color:"success.main",children:ge(R.summary.priceStats?.periodHigh)})]}),e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Period Low"}),e.jsx(d,{variant:"h6",color:"error.main",children:ge(R.summary.priceStats?.periodLow)})]}),e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Total Records"}),e.jsx(d,{variant:"h6",children:R.summary.dataPoints})]})]})]})}),e.jsx(z,{variant:"outlined",sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Price Chart"}),e.jsx(g,{sx:{width:"100%",height:400},children:e.jsx(st,{"data-testid":"responsive-container",children:e.jsxs(_x,{data:[...R?.data||[]].reverse(),children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorPrice",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#1976d2",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#1976d2",stopOpacity:.1})]})}),e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",interval:"preserveStartEnd"}),e.jsx(ht,{domain:["dataMin","dataMax"]}),e.jsx(ot,{formatter:D=>[`$${D.toFixed(2)}`,"Close"]}),e.jsx(gl,{type:"monotone",dataKey:"close",stroke:"#1976d2",fillOpacity:1,fill:"url(#colorPrice)",strokeWidth:2})]})})})]})}),e.jsx(He,{sx:{width:"100%",overflow:"hidden"},children:e.jsxs(Oe,{stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Date"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Open"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"High"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Low"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Close"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Adj Close"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Volume"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Change"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Change %"})})]})}),e.jsx(ke,{children:(R.data||[]).map((D,Y)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:new Date(D.date).toLocaleDateString()}),e.jsx(f,{align:"right",children:ge(D.open)}),e.jsx(f,{align:"right",sx:{color:"success.main"},children:ge(D.high)}),e.jsx(f,{align:"right",sx:{color:"error.main"},children:ge(D.low)}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:ge(D.close)})}),e.jsx(f,{align:"right",children:ge(D.adjClose)}),e.jsx(f,{align:"right",children:Me(D.volume)}),e.jsx(f,{align:"right",sx:{color:Ts(D.priceChange)},children:D.priceChange?ge(D.priceChange):"N/A"}),e.jsx(f,{align:"right",sx:{color:Ts(D.priceChangePct)},children:D.priceChangePct?Kt(D.priceChangePct):"N/A"})]},`price-${R.symbol}-${D.date}-${Y}`))})]})}),e.jsxs(d,{variant:"caption",sx:{mt:2,display:"block",textAlign:"center",color:"text.secondary"},children:["Showing ",R.data?.length||0," price records from your database tables"]})]}):e.jsxs(we,{severity:"info",children:["No price data available for ",R.symbol]})]})})})})]})}const xC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},yC=({active:r,payload:t,benchmarks:s})=>{if(!r||!t||!t.length)return null;const n=t[0].payload.name,i=t[0].value,o={ROE:"roe","Gross Margin":"gross_margin","Op. Margin":"operating_margin","Net Margin":"profit_margin"}[n],l=s?.data?.data?.benchmarks?.[o];return e.jsxs(g,{sx:{bgcolor:"background.paper",p:1.5,border:"1px solid",borderColor:"divider",borderRadius:1,boxShadow:2},children:[e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.5},children:n}),e.jsxs(d,{variant:"body2",sx:{mb:1},children:["Current: ",e.jsxs("strong",{children:[i.toFixed(1),"%"]})]}),e.jsx(Fe,{sx:{my:.5}}),e.jsxs(d,{variant:"caption",display:"block",sx:{mt:.5},children:[e.jsx("strong",{children:"Sector Median:"})," ",l?.sector?.toFixed(1)||"N/A","%",l?.sector&&(i>l.sector?" ✓":" ✗")]}),e.jsxs(d,{variant:"caption",display:"block",children:[e.jsx("strong",{children:"1yr Historical:"})," ",l?.historical_1yr?.toFixed(1)||"N/A","%",l?.historical_1yr&&(i>l.historical_1yr?" ↑":" ↓")]}),e.jsxs(d,{variant:"caption",display:"block",children:[e.jsx("strong",{children:"Market Average:"})," ",l?.market?.toFixed(1)||"N/A","%",l?.market&&(i>l.market?" ↑":" ↓")]})]})};function jC(){const r=Qn("StockDetail"),{ticker:t}=Wx(),s=t;console.log("📍 StockDetail Component - ticker:",t,"symbol:",s);const{data:n,isLoading:i,error:a}=Qe({queryKey:["stockProfile",s],queryFn:()=>St.getStockProfile(s),enabled:!!s,onError:O=>r.queryError("stockProfile",O,{symbol:s})}),{data:o,isLoading:l,error:c}=Qe({queryKey:["stockMetrics",s],queryFn:()=>St.getStockMetrics(s),enabled:!!s,onError:O=>r.queryError("stockMetrics",O,{symbol:s})}),{data:h,isLoading:u,error:m}=Qe({queryKey:["stockScores",s],queryFn:()=>St.get(`/api/scores/${s}`),enabled:!!s,onError:O=>r.queryError("stockScores",O,{symbol:s})}),{data:p,isLoading:x,error:b}=Qe({queryKey:["stockFinancials",s],queryFn:()=>St.getStockFinancials(s),enabled:!!s,onError:O=>r.queryError("stockFinancials",O,{symbol:s})}),{data:w,isLoading:C,error:A}=Qe({queryKey:["stockRecommendations",s],queryFn:()=>St.getAnalystRecommendations(s),enabled:!!s,onError:O=>r.queryError("analystRecommendations",O,{symbol:s})}),{data:_,isLoading:R,error:E}=Qe({queryKey:["balanceSheet",s,"annual"],queryFn:()=>St.getBalanceSheet(s,"annual"),enabled:!!s,onError:O=>r.queryError("balanceSheet",O,{symbol:s,period:"annual"})}),{data:T,isLoading:M,error:I}=Qe({queryKey:["incomeStatement",s,"annual"],queryFn:()=>St.getIncomeStatement(s,"annual"),enabled:!!s,onError:O=>r.queryError("incomeStatement",O,{symbol:s,period:"annual"})}),{data:N,isLoading:k,error:S}=Qe({queryKey:["cashFlowStatement",s,"annual"],queryFn:()=>St.getCashFlowStatement(s,"annual"),enabled:!!s,onError:O=>r.queryError("cashFlowStatement",O,{symbol:s,period:"annual"})}),{data:L,isLoading:W,error:F}=Qe({queryKey:["analystOverview",s],queryFn:()=>St.getAnalystOverview(s),enabled:!!s,onError:O=>r.queryError("analystOverview",O,{symbol:s})}),{data:$,isLoading:q,error:ne}=Qe({queryKey:["stockPricesRecent",s],queryFn:()=>St.getStockPricesRecent(s,30),enabled:!!s,onError:O=>r.queryError("stockPricesRecent",O,{symbol:s})}),{data:he,isLoading:re,error:G}=Qe({queryKey:["stockBenchmarks",s],queryFn:()=>St.get(`/api/benchmarks/${s}`),enabled:!!s,onError:O=>r.queryError("stockBenchmarks",O,{symbol:s})}),{data:H,isLoading:P,error:D}=Qe({queryKey:["stockEvents",s],queryFn:async()=>{const O=xC&&"http://localhost:5001"||"",Ce=new URLSearchParams({symbol:s,type:"upcoming",page:1,limit:10}),At=await fetch(`${O}/api/calendar/events?${Ce}`);if(!At.ok)throw new Error("Failed to fetch events");return At.json()},enabled:!!s,onError:O=>r.queryError("stockEvents",O,{symbol:s})}),{data:Y,isLoading:ce,error:ae}=Qe({queryKey:["positioning",s],queryFn:()=>St.getPositioningData(s),enabled:!!s,onError:O=>r.queryError("positioning",O,{symbol:s})}),{data:ee,isLoading:te,error:Pe}=Qe({queryKey:["tradingSignals",s,"daily"],queryFn:async()=>{console.log(`🔍 Fetching daily signals for symbol: ${s}`);const O=await St.get(`/api/signals?timeframe=daily&symbol=${s}&limit=10`);return console.log("✅ Daily signals response:",O),O},enabled:!!s,onError:O=>{console.error("❌ Daily signals error:",O),r.queryError("dailySignals",O,{symbol:s})}}),{data:Be,isLoading:et,error:De}=Qe({queryKey:["tradingSignals",s,"weekly"],queryFn:()=>St.get(`/api/signals?timeframe=weekly&symbol=${s}&limit=10`),enabled:!!s,onError:O=>r.queryError("weeklySignals",O,{symbol:s})}),{data:ze,isLoading:ve,error:B}=Qe({queryKey:["tradingSignals",s,"monthly"],queryFn:()=>St.get(`/api/signals?timeframe=monthly&symbol=${s}&limit=10`),enabled:!!s,onError:O=>r.queryError("monthlySignals",O,{symbol:s})});if(i)return e.jsx(lt,{maxWidth:"lg",sx:{py:4},children:e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(Je,{size:60})})});if(a)return e.jsx(lt,{maxWidth:"lg",sx:{py:4},children:e.jsxs(we,{severity:"error",children:["Error loading stock data: ",a.message]})});if(console.log("🔍 StockDetail Debug:",{symbol:s,profile:n,profileType:typeof n,isArray:Array.isArray(n),profileKeys:n?Object.keys(n):"null/undefined",profileLoading:i,profileError:a}),!n||Array.isArray(n)&&n.length===0||typeof n=="object"&&!Array.isArray(n)&&Object.keys(n).length===0)return console.log("❌ Profile is empty, showing Stock not found"),e.jsx(lt,{maxWidth:"lg",sx:{py:4},children:e.jsxs(we,{severity:"warning",children:["Stock not found: ",s]})});const je=Array.isArray(n)?n[0]||{}:n||{},xe=o?.data||o||{},v=p?.data||p||{},ie=Array.isArray(w)?w[0]||{}:w||{},Q=je.price-(je.previous_close||je.price),Z=Q/(je.previous_close||je.price)*100,K=Q>=0,ue=[{label:"Market Cap",value:ge(xe.market_capitalization)},{label:"P/E Ratio",value:xe.pe_ratio?Me(xe.pe_ratio,2):"N/A"},{label:"EPS",value:xe.earnings_per_share?ge(xe.earnings_per_share):"N/A"},{label:"Dividend Yield",value:xe.dividend_yield?Kt(xe.dividend_yield):"N/A"},{label:"Book Value",value:xe.book_value?ge(xe.book_value):"N/A"},{label:"52-Week High",value:je.high52Week?ge(je.high52Week):"N/A"},{label:"52-Week Low",value:je.low52Week?ge(je.low52Week):"N/A"},{label:"Revenue TTM",value:ge(v.revenue)},{label:"Net Income TTM",value:ge(v.net_income)},{label:"Free Cash Flow",value:ge(v.free_cash_flow)}],$e=[{label:"Current Ratio",value:xe.current_ratio?Me(xe.current_ratio,2):"N/A"},{label:"Debt to Equity",value:xe.debt_to_equity?Me(xe.debt_to_equity,2):"N/A"},{label:"ROE",value:xe.return_on_equity?Kt(xe.return_on_equity):"N/A"},{label:"ROA",value:xe.return_on_assets?Kt(xe.return_on_assets):"N/A"},{label:"Gross Margin",value:xe.gross_margin?Kt(xe.gross_margin):"N/A"},{label:"Operating Margin",value:xe.operating_margin?Kt(xe.operating_margin):"N/A"},{label:"Net Margin",value:xe.net_margin?Kt(xe.net_margin):"N/A"},{label:"Asset Turnover",value:xe.asset_turnover?Me(xe.asset_turnover,2):"N/A"}],Le=ie.strong_buy||ie.buy||ie.hold||ie.sell||ie.strong_sell?[{name:"Strong Buy",value:ie.strong_buy||0,color:"#4caf50"},{name:"Buy",value:ie.buy||0,color:"#8bc34a"},{name:"Hold",value:ie.hold||0,color:"#ffc107"},{name:"Sell",value:ie.sell||0,color:"#ff9800"},{name:"Strong Sell",value:ie.strong_sell||0,color:"#f44336"}].filter(O=>O.value>0):[];return e.jsxs(lt,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(g,{mb:4,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Ma,{sx:{fontSize:40,color:"primary.main"}}),e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",fontWeight:"bold",children:je.symbol}),e.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:je.company_name})]})]}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(d,{variant:"h4",fontWeight:"bold",children:ge(je.price)}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[K?e.jsx(at,{sx:{color:"success.main"}}):e.jsx(Tt,{sx:{color:"error.main"}}),e.jsxs(d,{variant:"h6",color:K?"success.main":"error.main",fontWeight:"bold",children:[ge(Q)," (",Z.toFixed(2),"%)"]})]})]}),e.jsxs(g,{display:"flex",gap:1,flexWrap:"wrap",children:[je.sector&&e.jsx(X,{label:je.sector,color:"primary",variant:"outlined"}),je.industry&&e.jsx(X,{label:je.industry,color:"secondary",variant:"outlined"}),je.country&&e.jsx(X,{label:je.country,variant:"outlined"})]})]}),je.description&&e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Company Overview"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:je.description})]})}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(xr,{sx:{verticalAlign:"middle",mr:1}}),"Key Statistics & Metrics"]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Key Statistics"}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:(ue||[]).map((O,Ce)=>e.jsxs(V,{children:[e.jsx(f,{component:"th",scope:"row",children:O.label}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:O.value})]},Ce))})})})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:Le.length>0&&e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Analyst Recommendations"}),e.jsx(g,{height:200,children:e.jsx(st,{width:"100%",height:"100%",children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:Le,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:5,dataKey:"value",children:(Le||[]).map((O,Ce)=>e.jsx(xt,{fill:O.color},`cell-${Ce}`))}),e.jsx(ot,{})]})})}),e.jsx(g,{mt:2,children:(Le||[]).map((O,Ce)=>e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[e.jsx(g,{width:12,height:12,bgcolor:O.color,borderRadius:"50%"}),e.jsxs(d,{variant:"body2",children:[O.name,": ",O.value]})]},Ce))})]})})})]})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(Lt,{sx:{verticalAlign:"middle",mr:1}}),"Price & Volume"]}),e.jsx(y,{container:!0,spacing:3,sx:{mb:3},children:e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Recent Price Chart (30 Days)"}),q?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",height:300,children:e.jsx(Je,{})}):$&&$?.data&&$?.data.data&&$?.data.data.length>0?e.jsx(g,{height:300,children:e.jsx(st,{width:"100%",height:"100%",children:e.jsxs(Ks,{data:$?.data.data.reverse(),margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date"}),e.jsx(ht,{domain:["dataMin - 5","dataMax + 5"]}),e.jsx(ot,{formatter:(O,Ce)=>[`$${O.toFixed(2)}`,Ce==="close"?"Close Price":Ce]}),e.jsx(Ds,{type:"monotone",dataKey:"close",stroke:"#2196f3",strokeWidth:2,dot:{r:0},name:"Close Price"})]})})}):e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",height:300,children:e.jsx(d,{color:"text.secondary",children:ne?`Error loading price data: ${ne.message}`:"Price chart data not available"})})]})})})}),$&&$?.data&&$?.data.summary&&e.jsx(y,{container:!0,spacing:3,sx:{mb:3},children:e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Price Summary (Last 30 Days)"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Latest Price"}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:ge($?.data.summary.latestPrice)})]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Period Return"}),e.jsxs(d,{variant:"h6",fontWeight:"bold",color:$?.data.summary.periodReturn>=0?"success.main":"error.main",children:[$?.data.summary.periodReturn.toFixed(2),"%"]})]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Latest Volume"}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:Me($?.data.summary.latestVolume)})]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Data Points"}),e.jsxs(d,{variant:"h6",fontWeight:"bold",children:[$?.data.dataPoints," days"]})]})})]})]})})})}),e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Recent Price & Volume Data (OHLCV)"}),$&&$?.data&&$?.data.data&&$?.data.data.length>0?e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Date"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Open"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"High"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Low"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Close"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Volume"})})]}),($?.data?.data||[]).slice(0,15).map((O,Ce)=>e.jsxs(V,{children:[e.jsx(f,{children:new Date(O.date).toLocaleDateString()}),e.jsx(f,{align:"right",children:ge(O.open)}),e.jsx(f,{align:"right",children:ge(O.high)}),e.jsx(f,{align:"right",children:ge(O.low)}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:ge(O.close)}),e.jsx(f,{align:"right",children:Me(O.volume)})]},Ce))]})})}):e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",height:200,children:e.jsx(d,{color:"text.secondary",children:ne?`Error: ${ne.message}`:"OHLCV data not available"})})]})})})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(Fs,{sx:{verticalAlign:"middle",mr:1}}),"Financial Statements"]}),R||M||k?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):e.jsxs(g,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{mb:2},children:["Annual Statements - ",s?.toUpperCase()]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,lg:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(Fs,{sx:{mr:1}}),"Income Statement (Annual)"]}),e.jsx(Fe,{sx:{mb:2}}),T?.data?.length>0?e.jsx(g,{children:(T?.data||[]).slice(0,3).map((O,Ce)=>e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:new Date(O.date).getFullYear()}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:O.items&&Object.entries(O.items).filter(([At])=>["Total Revenue","Revenue","Gross Profit","Operating Income","Net Income","Basic EPS"].some(Bt=>At.includes(Bt))).slice(0,6).map(([At,Bt])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem"},children:At.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem"},children:Bt?ge(Bt,0):"N/A"})]},At))})})}),Ce<2&&e.jsx(Fe,{sx:{mt:2}})]},O.date))}):e.jsx(d,{color:"text.secondary",children:"No income statement data available"})]})})}),e.jsx(y,{item:!0,xs:12,lg:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(xr,{sx:{mr:1}}),"Balance Sheet (Annual)"]}),e.jsx(Fe,{sx:{mb:2}}),_?.data?.length>0?e.jsx(g,{children:(_?.data||[]).slice(0,3).map((O,Ce)=>e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:new Date(O.date).getFullYear()}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:O.items&&Object.entries(O.items).filter(([At])=>["Total Assets","Current Assets","Total Debt","Total Equity","Cash","Total Liabilities"].some(Bt=>At.includes(Bt))).slice(0,6).map(([At,Bt])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem"},children:At.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem"},children:Bt?ge(Bt,0):"N/A"})]},At))})})}),Ce<2&&e.jsx(Fe,{sx:{mt:2}})]},O.date))}):e.jsx(d,{color:"text.secondary",children:"No balance sheet data available"})]})})}),e.jsx(y,{item:!0,xs:12,lg:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(Lt,{sx:{mr:1}}),"Cash Flow (Annual)"]}),e.jsx(Fe,{sx:{mb:2}}),N?.data?.length>0?e.jsx(g,{children:(N?.data||[]).slice(0,3).map((O,Ce)=>e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:new Date(O.date).getFullYear()}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:O.items&&Object.entries(O.items).filter(([At])=>["Operating Cash Flow","Free Cash Flow","Capital Expenditure","Dividends Paid","Net Cash Flow","Cash From Operations"].some(Bt=>At.includes(Bt))).slice(0,6).map(([At,Bt])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem"},children:At.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem"},children:Bt?ge(Bt,0):"N/A"})]},At))})})}),Ce<2&&e.jsx(Fe,{sx:{mt:2}})]},O.date))}):e.jsx(d,{color:"text.secondary",children:"No cash flow data available"})]})})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mt:2},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Revenue Trend"}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Ks,{data:T?.data?.slice(0,5).reverse().map(O=>({year:new Date(O.date).getFullYear(),revenue:O.items["Total Revenue"]||O.items.Revenue||0}))||[],children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"year"}),e.jsx(ht,{}),e.jsx(ot,{formatter:O=>[ge(O,0),"Revenue"]}),e.jsx(Ds,{type:"monotone",dataKey:"revenue",stroke:"#1976d2",strokeWidth:2})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Net Income Trend"}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Ks,{data:T?.data?.slice(0,5).reverse().map(O=>({year:new Date(O.date).getFullYear(),netIncome:O.items["Net Income"]||0}))||[],children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"year"}),e.jsx(ht,{}),e.jsx(ot,{formatter:O=>[ge(O,0),"Net Income"]}),e.jsx(Ds,{type:"monotone",dataKey:"netIncome",stroke:"#4caf50",strokeWidth:2})]})})]})})})]})]})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(Lt,{sx:{verticalAlign:"middle",mr:1}}),"Financial Ratios"]}),l?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):e.jsx(z,{children:e.jsx(U,{children:e.jsx(y,{container:!0,spacing:2,children:($e||[]).map((O,Ce)=>e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{p:2,border:1,borderColor:"divider",borderRadius:1,textAlign:"center",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:O.label}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:O.value})]})},Ce))})})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(Ma,{sx:{verticalAlign:"middle",mr:1}}),"Institutional Factor Analysis"]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Multi-factor quantitative analysis using institutional methodologies"}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Composite Factor Score"}),e.jsx(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h2",color:"primary",fontWeight:"bold",children:Math.round(389/6)}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Overall Score (0-100)"})]})}),e.jsx(rt,{variant:"determinate",value:Math.round(389/6),color:"primary",sx:{height:12,borderRadius:6}}),e.jsx(g,{mt:2,textAlign:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Weighted composite of Quality (30%), Growth (25%), Value (20%), Momentum (15%), Sentiment (5%), Positioning (5%)"})})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Multi-Factor Quantitative Analysis"}),e.jsx(Fe,{sx:{mb:3}}),e.jsx(y,{container:!0,spacing:3,children:(()=>{const O=h?.data?.data,Ce=O?.quality_score||50,At=O?.growth_score||50,Bt=O?.value_score||50,or=O?.momentum_score||50,bi=O?.sentiment_score||50,qt=O?.positioning_score||50;return[{factor:"Quality",score:Math.round(Ce),color:"primary",description:"ROE, margins, debt levels, earnings quality",components:[{name:"ROE",value:xe.return_on_equity||0,weight:.3},{name:"Gross Margin",value:xe.gross_margin||0,weight:.25},{name:"Debt/Equity",value:xe.debt_to_equity||0,weight:.25},{name:"Current Ratio",value:xe.current_ratio||0,weight:.2}]},{factor:"Growth",score:Math.round(At),color:"success",description:"Revenue, earnings, and EPS growth trajectories",components:[{name:"Revenue Growth",value:xe.revenue_growth||0,weight:.4},{name:"EPS Growth",value:xe.earnings_growth||0,weight:.4},{name:"Sales Growth 5Y",value:xe.sales_growth_5y||0,weight:.2}]},{factor:"Value",score:Math.round(Bt),color:"warning",description:"P/E, P/B, EV/EBITDA, and DCF valuations",components:[{name:"P/E Ratio",value:xe.pe_ratio||0,weight:.4},{name:"P/B Ratio",value:xe.book_value?je.price/xe.book_value:0,weight:.3},{name:"EV/EBITDA",value:xe.ev_ebitda||0,weight:.3}]},{factor:"Momentum",score:Math.round(or),color:"info",description:"Price trends, earnings revisions, estimate changes",components:[{name:"RSI",value:O?.rsi||0,weight:.4},{name:"MACD",value:O?.macd||0,weight:.3},{name:"Price Change",value:je.price_change_1d||0,weight:.3}]},{factor:"Sentiment",score:Math.round(bi),color:"secondary",description:"Analyst ratings, social sentiment, media coverage",components:[{name:"Analyst Rating",value:xe.analyst_rating||0,weight:.4},{name:"Social Sentiment",value:xe.social_sentiment||0,weight:.3},{name:"News Sentiment",value:xe.news_sentiment||0,weight:.3}]},{factor:"Positioning",score:Math.round(qt),color:qt>=70?"success":qt>=50?"info":"error",description:"Institutional flows, insider activity, short interest",components:[{name:"Institutional Ownership",value:Y?.positioning_metrics?.institutional_ownership||xe.institutional_ownership||0,weight:.4},{name:"Short Interest",value:Y?.positioning_metrics?.short_percent_of_float||xe.short_interest||0,weight:.3},{name:"Insider Ownership",value:Y?.positioning_metrics?.insider_ownership||0,weight:.3}]}]})().map(O=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:2,children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:O.factor}),e.jsx(g,{display:"flex",alignItems:"center",gap:1,children:e.jsx(X,{label:O.score,color:O.color,variant:"filled",size:"small",sx:{fontWeight:"bold"}})})]}),e.jsx(rt,{variant:"determinate",value:O.score,color:O.color,sx:{mb:2,height:8,borderRadius:4}}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:O.description}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["Components:"," ",(O.components||[]).map(Ce=>Ce.name).join(", ")]})]})})},O.factor))})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:(()=>{const O=h?.data?.factors?.quality?.inputs||{};return e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Quality Factor Breakdown"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:"ROE",value:(xe.return_on_equity||0)*100,benchmark:he?.data?.data?.benchmarks?.roe?.sector||15},{name:"Gross Margin",value:(xe.gross_margin||0)*100,benchmark:he?.data?.data?.benchmarks?.gross_margin?.sector||20},{name:"Op. Margin",value:(xe.operating_margin||0)*100,benchmark:he?.data?.data?.benchmarks?.operating_margin?.sector||10},{name:"Net Margin",value:(xe.net_margin||0)*100,benchmark:he?.data?.data?.benchmarks?.profit_margin?.sector||5}],children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name"}),e.jsx(ht,{}),e.jsx(ot,{content:e.jsx(yC,{benchmarks:he})}),e.jsx(jt,{dataKey:"value",fill:"#1976d2"}),e.jsx(jt,{dataKey:"benchmark",fill:"#e0e0e0",opacity:.5})]})})}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Return on Equity"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:xe.return_on_equity?`${Kt(xe.return_on_equity)}`:"N/A",color:xe.return_on_equity>(he?.data?.data?.benchmarks?.roe?.sector||15)/100?"success":"default",size:"small"})}),e.jsx(f,{align:"right",children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.3},children:[e.jsxs(d,{variant:"caption",sx:{fontSize:10,lineHeight:1.2},children:[e.jsx("strong",{children:"S:"})," ",he?.data?.data?.benchmarks?.roe?.sector?.toFixed(1)||"15.0","% ",xe.return_on_equity*100>(he?.data?.data?.benchmarks?.roe?.sector||15)?"✓":"✗"]}),e.jsxs(d,{variant:"caption",sx:{fontSize:10,lineHeight:1.2},children:[e.jsx("strong",{children:"H:"})," ",he?.data?.data?.benchmarks?.roe?.historical_1yr?.toFixed(1)||"N/A","% ",he?.data?.data?.benchmarks?.roe?.historical_1yr&&xe.return_on_equity*100>he.data.data.benchmarks.roe.historical_1yr?"↑":"↓"]}),e.jsxs(d,{variant:"caption",sx:{fontSize:10,lineHeight:1.2},children:[e.jsx("strong",{children:"M:"})," ",he?.data?.data?.benchmarks?.roe?.market?.toFixed(1)||"N/A","% ",he?.data?.data?.benchmarks?.roe?.market&&xe.return_on_equity*100>he.data.data.benchmarks.roe.market?"↑":"↓"]})]})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Debt-to-Equity"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.debt_to_equity?Me(O.debt_to_equity,2):"N/A",color:O.debt_to_equity&&O.debt_to_equity<30?"success":"warning",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"vs 30 optimal"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Current Ratio"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.current_ratio?Me(O.current_ratio,2):"N/A",color:O.current_ratio&&O.current_ratio>1.5?"success":"default",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"vs 1.5 minimum"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"FCF / Net Income"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.fcf_to_net_income?Kt(O.fcf_to_net_income):"N/A",color:O.fcf_to_net_income&&O.fcf_to_net_income>.8?"success":"default",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"vs 80% optimal"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Accruals Ratio"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.accruals_ratio!==null&&O.accruals_ratio!==void 0?Me(O.accruals_ratio,3):"N/A",color:O.accruals_ratio!==null&&O.accruals_ratio<0?"success":"default",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"negative is good"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Asset Turnover"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.asset_turnover?Me(O.asset_turnover,2):"N/A",color:O.asset_turnover&&O.asset_turnover>1?"success":"default",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"vs 1.0 optimal"})})]})]})})})]})})})()}),e.jsx(y,{item:!0,xs:12,md:6,children:(()=>{const O=h?.data?.factors?.growth?.inputs||{},Ce=h?.data?.factors?.growth?.score||0;return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Growth Factor Analysis (Score: ",Ce.toFixed(1),"/100)"]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Growth metrics (6 factors: Revenue, EPS, Op Income, ROE Trend, Sustainable Rate, FCF)"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Revenue Growth (3Y CAGR)"})}),e.jsx(f,{align:"right",children:O.revenue_growth_3y_cagr!=null?`${O.revenue_growth_3y_cagr.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"EPS Growth (3Y CAGR)"})}),e.jsx(f,{align:"right",children:O.eps_growth_3y_cagr!=null?`${O.eps_growth_3y_cagr.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Op Income Growth (YoY)"})}),e.jsx(f,{align:"right",children:O.operating_income_growth_yoy!=null?`${O.operating_income_growth_yoy.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"ROE Trend"})}),e.jsx(f,{align:"right",children:O.roe_trend!=null?`${O.roe_trend.toFixed(2)}`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Sustainable Growth Rate"})}),e.jsx(f,{align:"right",children:O.sustainable_growth_rate!=null?`${O.sustainable_growth_rate.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"FCF Growth (YoY)"})}),e.jsx(f,{align:"right",children:O.fcf_growth_yoy!=null?`${O.fcf_growth_yoy.toFixed(2)}%`:"N/A"})]})]})})})]})})})()}),e.jsx(y,{item:!0,xs:12,md:6,children:(()=>{const O=h?.data?.factors?.value?.inputs||{},Ce=h?.data?.factors?.value?.score||0;return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Value Factor Analysis (Score: ",Ce.toFixed(1),"/100)"]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Percentile-ranked valuation metrics (4 factors: P/E, P/B, P/S, PEG)"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"P/E Ratio"})}),e.jsx(f,{align:"right",children:O.stock_pe?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:["vs ",O.market_pe?.toFixed(2)||"N/A"," market"]})})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Price/Book"})}),e.jsx(f,{align:"right",children:O.stock_pb?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:["vs ",O.market_pb?.toFixed(3)||"N/A"," market"]})})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Price/Sales"})}),e.jsx(f,{align:"right",children:O.stock_ps?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:["vs ",O.market_ps?.toFixed(3)||"N/A"," market"]})})]}),e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"PEG Ratio"})}),e.jsx(f,{align:"right",children:O.peg_ratio?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:O.peg_ratio<1?"✓ Fair value":"Growth premium"})})]})]})})})]})})})()}),e.jsx(y,{item:!0,xs:12,md:6,children:(()=>{const O=h?.data?.factors?.momentum?.components||{},Ce=h?.data?.factors?.momentum?.inputs||{};return e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Momentum Factor Analysis"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{metric:"Momentum Score",score:h?.data?.data?.momentum_score||0,target:70,good:50}],margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"metric"}),e.jsx(ht,{domain:[0,100]}),e.jsx(tt,{}),e.jsx(jt,{dataKey:"score",fill:h?.data?.data?.momentum_score>=70?"#4caf50":h?.data?.data?.momentum_score>=50?"#ff9800":"#f44336",name:"Score"}),e.jsx(jt,{dataKey:"target",fill:"#e0e0e0",opacity:.3,name:"Target (70)"}),e.jsx(jt,{dataKey:"good",fill:"#e0e0e0",opacity:.2,name:"Good (50)"})]})})}),e.jsx(Ae,{sx:{mb:3},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Momentum Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600},children:"Intraweek Trend Confirmation (10pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"RSI (14-day)"}),e.jsx(f,{align:"right",children:scoresData?.rsi!=null?scoresData.rsi.toFixed(1):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"MACD"}),e.jsx(f,{align:"right",children:scoresData?.macd!=null?scoresData.macd.toFixed(4):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs SMA 50"}),e.jsx(f,{align:"right",children:Ce.price_vs_sma_50!=null?`${Ce.price_vs_sma_50.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Short-Term Momentum (25pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"3-Month Return"}),e.jsx(f,{align:"right",children:Ce.momentum_3m!=null?`${Ce.momentum_3m.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Medium-Term Momentum (25pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"6-Month Return"}),e.jsx(f,{align:"right",children:Ce.momentum_6m!=null?`${Ce.momentum_6m.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Long-Term Momentum (15pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"12-Month Return (Excl. Last Month)"}),e.jsx(f,{align:"right",children:Ce.momentum_12m_1!=null?`${Ce.momentum_12m_1.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Relative Strength (15pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Mansfield RS"}),e.jsx(f,{align:"right",children:O?.mansfield_rs!=null?O.mansfield_rs.toFixed(0):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Risk-Adjusted Momentum"}),e.jsx(f,{align:"right",children:Ce.risk_adjusted_momentum!=null?Ce.risk_adjusted_momentum.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Stability (10pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs SMA 200"}),e.jsx(f,{align:"right",children:Ce.price_vs_sma_200!=null?`${Ce.price_vs_sma_200.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs 52-Week High"}),e.jsx(f,{align:"right",children:Ce.price_vs_52w_high!=null?`${Ce.price_vs_52w_high.toFixed(2)}%`:"N/A"})]})]})]})})]})})})()}),e.jsx(y,{item:!0,xs:12,md:6,children:(()=>{const O=h?.data?.factors?.relative_strength?.inputs||{};return e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Relative Strength Factor Analysis"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{metric:"RS Score",score:h?.data?.data?.relative_strength_score||0,target:70,good:50}],margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"metric"}),e.jsx(ht,{domain:[0,100]}),e.jsx(tt,{}),e.jsx(jt,{dataKey:"score",fill:h?.data?.data?.relative_strength_score>=70?"#4caf50":h?.data?.data?.relative_strength_score>=50?"#ff9800":"#f44336",name:"Score"}),e.jsx(jt,{dataKey:"target",fill:"#e0e0e0",opacity:.3,name:"Target (70)"}),e.jsx(jt,{dataKey:"good",fill:"#e0e0e0",opacity:.2,name:"Good (50)"})]})})}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"RS Rating (Percentile)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.rs_rating?`${O.rs_rating}`:"N/A",color:(O.rs_rating||0)>80?"success":(O.rs_rating||0)>60?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Sector Relative (12M)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.sector_relative_12m?`${O.sector_relative_12m>0?"+":""}${O.sector_relative_12m.toFixed(2)}%`:"N/A",color:(O.sector_relative_12m||0)>10?"success":(O.sector_relative_12m||0)>0?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Sector Percentile"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.sector_percentile?`${O.sector_percentile.toFixed(0)}`:"N/A",color:(O.sector_percentile||0)>75?"success":(O.sector_percentile||0)>50?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"RS Momentum (4w)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.rs_momentum_4w?`${O.rs_momentum_4w>0?"+":""}${O.rs_momentum_4w.toFixed(2)}`:"N/A",color:(O.rs_momentum_4w||0)>5?"success":(O.rs_momentum_4w||0)>0?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"RS Momentum (13w)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.rs_momentum_13w?`${O.rs_momentum_13w>0?"+":""}${O.rs_momentum_13w.toFixed(2)}`:"N/A",color:(O.rs_momentum_13w||0)>10?"success":(O.rs_momentum_13w||0)>0?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Positive Months (12M)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.positive_months_12!==null&&O.positive_months_12!==void 0?`${O.positive_months_12}/12`:"N/A",color:(O.positive_months_12||0)>=9?"success":(O.positive_months_12||0)>=6?"warning":"error",size:"small"})})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Timeframe Alignment"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.timeframe_alignment!==null&&O.timeframe_alignment!==void 0?`${O.timeframe_alignment}/4`:"N/A",color:(O.timeframe_alignment||0)===4?"success":(O.timeframe_alignment||0)>=3?"warning":"error",size:"small"})})]})]})})})]})})})()}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Positioning Factor Analysis"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{metric:"Positioning Score",score:h?.data?.data?.positioning_score||0,target:70,good:50}],margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"metric"}),e.jsx(ht,{domain:[0,100]}),e.jsx(tt,{}),e.jsx(jt,{dataKey:"score",fill:h?.data?.data?.positioning_score>=70?"#4caf50":h?.data?.data?.positioning_score>=50?"#ff9800":"#f44336",name:"Score"}),e.jsx(jt,{dataKey:"target",fill:"#e0e0e0",opacity:.3,name:"Target (70)"}),e.jsx(jt,{dataKey:"good",fill:"#e0e0e0",opacity:.2,name:"Good (50)"})]})})}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:e.jsx(V,{children:e.jsx(f,{colSpan:3,children:e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:"Positioning data reflects institutional ownership patterns, insider activity, and short interest."})})})})})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Sentiment Factor Analysis"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{metric:"Sentiment Score",score:h?.data?.data?.sentiment_score||0,target:70,good:50}],margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"metric"}),e.jsx(ht,{domain:[0,100]}),e.jsx(tt,{}),e.jsx(jt,{dataKey:"score",fill:h?.data?.data?.sentiment_score>=70?"#4caf50":h?.data?.data?.sentiment_score>=50?"#ff9800":"#f44336",name:"Score"}),e.jsx(jt,{dataKey:"target",fill:"#e0e0e0",opacity:.3,name:"Target (70)"}),e.jsx(jt,{dataKey:"good",fill:"#e0e0e0",opacity:.2,name:"Good (50)"})]})})}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:e.jsx(V,{children:e.jsx(f,{colSpan:3,children:e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:"Sentiment data aggregates analyst ratings, news sentiment, and social media activity."})})})})})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(d,{variant:"h6",sx:{flexGrow:1},children:"Risk Factor Analysis"}),e.jsx(X,{label:`Risk: ${(h?.data?.factors?.risk?.score||0).toFixed(1)}/100`,color:(h?.data?.factors?.risk?.score||0)<30?"success":(h?.data?.factors?.risk?.score||0)<50?"warning":"error",variant:"outlined"})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(g,{mb:3,children:e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{metric:"Risk Score",score:h?.data?.factors?.risk?.score||0,target:50,good:30}],margin:{top:10,right:10,left:10,bottom:10},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"metric"}),e.jsx(ht,{domain:[0,100]}),e.jsx(tt,{}),e.jsx(jt,{dataKey:"score",fill:h?.data?.factors?.risk?.score>=70?"#f44336":h?.data?.factors?.risk?.score>=50?"#ff9800":"#4caf50",name:"Score"}),e.jsx(jt,{dataKey:"target",fill:"#e0e0e0",opacity:.3,name:"Target (50)"}),e.jsx(jt,{dataKey:"good",fill:"#e0e0e0",opacity:.2,name:"Good (30)"})]})})}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"#f5f5f5"},children:[e.jsx(f,{children:e.jsx("strong",{children:"Risk Component"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Value"})})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Volatility (12M)"}),e.jsxs(f,{align:"right",children:[(h?.data?.factors?.risk?.inputs?.volatility_12m_pct||0).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Max Drawdown (52W)"}),e.jsxs(f,{align:"right",children:[(h?.data?.factors?.risk?.inputs?.max_drawdown_52w_pct||0).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Debt/Equity Ratio"}),e.jsx(f,{align:"right",children:(h?.data?.factors?.risk?.inputs?.debt_to_equity||0).toFixed(2)})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Current Ratio"}),e.jsx(f,{align:"right",children:(h?.data?.factors?.risk?.inputs?.current_ratio||0).toFixed(2)})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EPS Growth Stability"}),e.jsx(f,{align:"right",children:(h?.data?.factors?.risk?.inputs?.eps_growth_stability||0).toFixed(2)})]})]})]})}),e.jsxs(d,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:2,fontStyle:"italic"},children:[e.jsx("strong",{children:"Risk Score Categories:"})," 0-30 (Low Risk), 31-50 (Moderate), 51-70 (High), 71-100 (Very High)"]})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Factor-Based Investment Insights"}),e.jsx(Fe,{sx:{mb:3}}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{p:3,border:1,borderColor:"primary.main",borderRadius:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(xr,{color:"primary"}),e.jsx(d,{variant:"h6",color:"primary",children:"Quality Premium"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:"High-quality companies with strong balance sheets and consistent profitability typically command valuation premiums during market stress."}),e.jsx(X,{label:"Strong Quality Score: 82/100",color:"success",size:"small"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{p:3,border:1,borderColor:"warning.main",borderRadius:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Lt,{color:"warning"}),e.jsx(d,{variant:"h6",color:"warning.main",children:"Value Opportunity"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:"Current valuation metrics suggest potential value opportunity, but consider quality and growth factors for comprehensive assessment."}),e.jsx(X,{label:"Value Score: 45/100",color:"warning",size:"small"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{p:3,border:1,borderColor:"info.main",borderRadius:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(at,{color:"info"}),e.jsx(d,{variant:"h6",color:"info.main",children:"Momentum Strength"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:"Strong price and earnings momentum suggest continued outperformance, though momentum factors can be cyclical."}),e.jsx(X,{label:"Momentum Score: 78/100",color:"info",size:"small"})]})})]})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Institutional Positioning & Flow Analysis"}),e.jsx(Fe,{sx:{mb:3}}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h3",color:"primary",fontWeight:"bold",children:Y?.positioning_metrics?.institutional_ownership?`${formatDecimalAsPercent(Y.positioning_metrics.institutional_ownership)}`:xe.institutional_ownership?`${Kt(xe.institutional_ownership)}`:"N/A"}),e.jsx(d,{variant:"body1",color:"text.secondary",mb:1,children:"Institutional Ownership"}),e.jsx(rt,{variant:"determinate",value:(Y?.positioning_metrics?.institutional_ownership||xe.institutional_ownership||0)*100,color:"primary",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Above 60% indicates institutional confidence"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h3",color:"success.main",fontWeight:"bold",children:Y?.positioning_metrics?.insider_ownership?`${formatDecimalAsPercent(Y.positioning_metrics.insider_ownership)}`:xe.insider_ownership?`${Kt(xe.insider_ownership)}`:"N/A"}),e.jsx(d,{variant:"body1",color:"text.secondary",mb:1,children:"Insider Ownership"}),e.jsx(rt,{variant:"determinate",value:(Y?.positioning_metrics?.insider_ownership||xe.insider_ownership||0)*100*10,color:"success",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"2-5% range indicates aligned interests"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h3",color:"error.main",fontWeight:"bold",children:Y?.positioning_metrics?.short_percent_of_float?`${formatDecimalAsPercent(Y.positioning_metrics.short_percent_of_float)}`:xe.short_interest?`${Kt(xe.short_interest)}`:"N/A"}),e.jsx(d,{variant:"body1",color:"text.secondary",mb:1,children:"Short Interest"}),e.jsx(rt,{variant:"determinate",value:(Y?.positioning_metrics?.short_percent_of_float||xe.short_interest||0)*100*5,color:"error",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Below 5% suggests limited bearish sentiment"})]})})]}),e.jsxs(g,{mt:3,children:[e.jsx(d,{variant:"subtitle1",fontWeight:"bold",mb:2,children:"Recent Institutional Activity (90 Days)"}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[xe.net_institutional_flow&&e.jsxs(V,{children:[e.jsx(f,{children:"Net Institutional Flow"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${xe.net_institutional_flow>0?"+":""}$${Math.abs(xe.net_institutional_flow)}M`,color:xe.net_institutional_flow>0?"success":"error",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:xe.net_institutional_flow>0?"Net buying activity":"Net selling activity"})})]}),xe.num_institutions&&e.jsxs(V,{children:[e.jsx(f,{children:"Number of Institutions"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${xe.num_institutions}${xe.num_institutions_change?` (${xe.num_institutions_change>0?"+":""}${xe.num_institutions_change})`:""}`,color:"info",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:xe.num_institutions_change>0?"Growing institutional base":"Institutional base"})})]}),xe.avg_position_size&&e.jsxs(V,{children:[e.jsx(f,{children:"Avg Position Size"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${Kt(xe.avg_position_size)}`,color:"primary",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Conviction levels"})})]}),xe.days_to_cover&&e.jsxs(V,{children:[e.jsx(f,{children:"Days to Cover (Short)"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${xe.days_to_cover} days`,color:xe.days_to_cover<3?"success":"warning",size:"small"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:xe.days_to_cover<3?"Low short squeeze risk":"Elevated short squeeze risk"})})]})]})})})]})]})})}),Y?.insider_transactions?.length>0&&e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Recent Insider Transactions (90 Days)"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(Ae,{sx:{maxHeight:400},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Date"}),e.jsx(f,{sx:{fontWeight:"bold"},children:"Insider"}),e.jsx(f,{sx:{fontWeight:"bold"},children:"Type"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Shares"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Value"})]})}),e.jsx(ke,{children:Y.insider_transactions.slice(0,10).map((O,Ce)=>e.jsxs(V,{children:[e.jsx(f,{children:O.transaction_date?new Date(O.transaction_date).toLocaleDateString():"N/A"}),e.jsxs(f,{children:[e.jsx(d,{variant:"body2",noWrap:!0,sx:{maxWidth:150},children:O.insider_name||"Unknown"}),e.jsx(d,{variant:"caption",color:"text.secondary",display:"block",children:O.position||""})]}),e.jsx(f,{children:e.jsx(X,{label:O.transaction_type||"N/A",size:"small",color:O.transaction_type?.toLowerCase().includes("buy")||O.transaction_type?.toLowerCase().includes("purchase")?"success":O.transaction_type?.toLowerCase().includes("sell")||O.transaction_type?.toLowerCase().includes("sale")?"error":"default"})}),e.jsx(f,{align:"right",children:O.shares?O.shares.toLocaleString():"N/A"}),e.jsx(f,{align:"right",children:O.value?`$${(O.value/1e3).toFixed(0)}K`:"N/A"})]},Ce))})]})}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Recent buying by insiders may indicate confidence in the company's prospects"})]})})}),Y?.insider_roster?.length>0&&e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Key Insiders & Holdings"}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(Ae,{sx:{maxHeight:400},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Name"}),e.jsx(f,{sx:{fontWeight:"bold"},children:"Position"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Shares Owned"}),e.jsx(f,{sx:{fontWeight:"bold"},children:"Latest Action"})]})}),e.jsx(ke,{children:Y.insider_roster.slice(0,10).map((O,Ce)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",noWrap:!0,sx:{maxWidth:150},children:O.insider_name||"Unknown"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",color:"text.secondary",children:O.position||"N/A"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:O.shares_owned_directly?O.shares_owned_directly.toLocaleString():"N/A"})}),e.jsxs(f,{children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:O.most_recent_transaction||"N/A"}),O.latest_transaction_date&&e.jsx(d,{variant:"caption",display:"block",color:"text.secondary",children:new Date(O.latest_transaction_date).toLocaleDateString()})]})]},Ce))})]})}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"Insiders with significant holdings typically have aligned interests with shareholders"})]})})}),Y?.score_breakdown&&e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Positioning Score Components"}),e.jsx(Fe,{sx:{mb:3}}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h4",color:"primary",fontWeight:"bold",children:Y.score_breakdown.institutional||0}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Institutional Quality"}),e.jsx(rt,{variant:"determinate",value:(Y.score_breakdown.institutional||0)*4,color:"primary",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Ownership % + Institution Count"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h4",color:"success.main",fontWeight:"bold",children:Y.score_breakdown.insider||0}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Insider Conviction"}),e.jsx(rt,{variant:"determinate",value:Math.max(0,(Y.score_breakdown.insider||0)*4),color:"success",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Ownership % + Buy/Sell Activity"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h4",color:"info.main",fontWeight:"bold",children:Y.score_breakdown.short_interest||0}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Short Interest"}),e.jsx(rt,{variant:"determinate",value:Math.max(0,(Y.score_breakdown.short_interest||0)*4),color:"info",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Level + Trend Analysis"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h4",color:"warning.main",fontWeight:"bold",children:Y.score_breakdown.smart_money||0}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Smart Money Flow"}),e.jsx(rt,{variant:"determinate",value:Math.max(0,(Y.score_breakdown.smart_money||0)*4),color:"warning",sx:{mb:1}}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Mutual Fund + Hedge Fund Positioning"})]})})]})]})})})]})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(at,{sx:{verticalAlign:"middle",mr:1}}),"Analyst Coverage & Recommendations"]}),W?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):e.jsx(g,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Earnings Estimates"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.earnings_estimates?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Period"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Avg Estimate"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Analysts"})]})}),e.jsx(ke,{children:(L?.data.earnings_estimates||[]).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:O.period==="0q"?"Current Quarter":O.period==="+1q"?"Next Quarter":O.period==="0y"?"Current Year":O.period==="+1y"?"Next Year":O.period}),e.jsx(f,{align:"right",children:O.avg_estimate?ge(O.avg_estimate):"N/A"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${O.number_of_analysts||0} analysts`,size:"small",variant:"outlined"})})]},O.period))})]})})}):e.jsx(d,{color:"text.secondary",children:"No earnings estimates available"})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Revenue Estimates"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.revenue_estimates?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Period"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Avg Estimate"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Analysts"})]})}),e.jsx(ke,{children:(L?.data.revenue_estimates||[]).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:O.period==="0q"?"Current Quarter":O.period==="+1q"?"Next Quarter":O.period==="0y"?"Current Year":O.period==="+1y"?"Next Year":O.period}),e.jsx(f,{align:"right",children:O.avg_estimate?ge(O.avg_estimate,0):"N/A"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${O.number_of_analysts||0} analysts`,size:"small",variant:"outlined"})})]},O.period))})]})})}):e.jsx(d,{color:"text.secondary",children:"No revenue estimates available"})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"EPS Revisions"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.eps_revisions?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Period"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Avg. Estimate"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Low"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"High"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Analysts"})]})}),e.jsx(ke,{children:(L?.data.eps_revisions||[]).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:O.period==="0q"?"Current Quarter":O.period==="+1q"?"Next Quarter":O.period==="0y"?"Current Year":O.period==="+1y"?"Next Year":O.period}),e.jsx(f,{align:"right",children:O.avg_estimate?ge(O.avg_estimate):"N/A"}),e.jsx(f,{align:"right",children:O.low_estimate?ge(O.low_estimate):"N/A"}),e.jsx(f,{align:"right",children:O.high_estimate?ge(O.high_estimate):"N/A"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${O.number_of_analysts||0} analysts`,size:"small",variant:"outlined"})})]},O.period))})]})})}):e.jsx(d,{color:"text.secondary",children:"No EPS revisions available"})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Growth Estimates"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.growth_estimates?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Period"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Stock Growth"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Index Growth"})]})}),e.jsx(ke,{children:(L?.data.growth_estimates||[]).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:O.period==="0q"?"Current Quarter":O.period==="+1q"?"Next Quarter":O.period==="0y"?"Current Year":O.period==="+1y"?"Next Year":O.period==="+5y"?"Next 5 Years":O.period}),e.jsx(f,{align:"right",children:O.stock_trend?Kt(O.stock_trend/100):"N/A"}),e.jsx(f,{align:"right",children:O.index_trend?Kt(O.index_trend/100):"N/A"})]},O.period))})]})})}):e.jsx(d,{color:"text.secondary",children:"No growth estimates available"})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Analyst Recommendations"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.recommendations?.length>0?e.jsx(g,{children:(L?.data?.recommendations||[]).slice(0,3).map((O,Ce)=>e.jsxs(g,{sx:{mb:2},children:[e.jsxs(d,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:[new Date(O.collected_date).toLocaleDateString()," ","- ",O.period]}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,children:e.jsx(X,{label:`Strong Buy: ${O.strong_buy||0}`,color:"success",variant:"outlined",size:"small"})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Buy: ${O.buy||0}`,color:"success",variant:"outlined",size:"small"})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Hold: ${O.hold||0}`,color:"warning",variant:"outlined",size:"small"})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Sell: ${O.sell||0}`,color:"error",variant:"outlined",size:"small"})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Strong Sell: ${O.strong_sell||0}`,color:"error",variant:"outlined",size:"small"})})]}),Ce<2&&e.jsx(Fe,{sx:{mt:2}})]},Ce))}):e.jsx(d,{color:"text.secondary",children:"No analyst recommendations available"})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Earnings History"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.earnings_history?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Quarter"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Actual EPS"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Estimated EPS"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Surprise"})]})}),e.jsx(ke,{children:(L?.data?.earnings_history||[]).slice(0,8).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:new Date(O.quarter).toLocaleDateString()}),e.jsx(f,{align:"right",children:O.eps_actual?ge(O.eps_actual):"N/A"}),e.jsx(f,{align:"right",children:O.eps_estimate?ge(O.eps_estimate):"N/A"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.surprise_percent?Kt(O.surprise_percent/100):"N/A",color:O.surprise_percent>0?"success":O.surprise_percent<0?"error":"default",size:"small",variant:"outlined"})})]},O.quarter))})]})})}):e.jsx(d,{color:"text.secondary",children:"No earnings history available"})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"EPS Trends"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.eps_trend?.length>0?e.jsx(e.Fragment,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Period"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Avg. Estimate"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Year Ago EPS"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Growth"}),e.jsx(f,{align:"right",sx:{fontWeight:"bold"},children:"Analysts"})]})}),e.jsx(ke,{children:(L?.data.eps_trend||[]).map(O=>e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:O.period==="0q"?"Current Quarter":O.period==="+1q"?"Next Quarter":O.period==="0y"?"Current Year":O.period==="+1y"?"Next Year":O.period}),e.jsx(f,{align:"right",children:O.avg_estimate?ge(O.avg_estimate):"N/A"}),e.jsx(f,{align:"right",children:O.year_ago_eps?ge(O.year_ago_eps):"N/A"}),e.jsx(f,{align:"right",children:O.growth?e.jsx(X,{label:Kt(O.growth/100),size:"small",color:O.growth>0?"success":O.growth<0?"error":"default",variant:"outlined"}):"N/A"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${O.number_of_analysts||0} analysts`,size:"small",variant:"outlined"})})]},O.period))})]})})}):e.jsx(d,{color:"text.secondary",children:"No EPS trends available"})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Earnings Metrics"}),e.jsx(Fe,{sx:{mb:2}}),L?.data?.earnings_metrics?e.jsx(Ae,{children:e.jsx(Oe,{children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Earnings Growth (Quarterly YoY)"}),e.jsx(f,{align:"right",children:L?.data.earnings_metrics.quarterly_earnings_growth?Kt(L.data.earnings_metrics.quarterly_earnings_growth/100):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Revenue Growth (Quarterly YoY)"}),e.jsx(f,{align:"right",children:L?.data.earnings_metrics.quarterly_revenue_growth?Kt(L.data.earnings_metrics.quarterly_revenue_growth/100):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Target Mean Price"}),e.jsx(f,{align:"right",children:L?.data.earnings_metrics.target_mean_price?ge(L.data.earnings_metrics.target_mean_price):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Target High Price"}),e.jsx(f,{align:"right",children:L?.data.earnings_metrics.target_high_price?ge(L.data.earnings_metrics.target_high_price):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Target Low Price"}),e.jsx(f,{align:"right",children:L?.data.earnings_metrics.target_low_price?ge(L.data.earnings_metrics.target_low_price):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:"bold"},children:"Number of Analyst Opinions"}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${L?.data.earnings_metrics.number_of_analyst_opinions||0} analysts`,size:"small",variant:"outlined"})})]})]})})}):e.jsx(d,{color:"text.secondary",children:"No earnings metrics available"})]})})})]})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(xx,{sx:{verticalAlign:"middle",mr:1}}),"Upcoming Events"]}),P?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):D?e.jsx(we,{severity:"error",children:"Failed to load events"}):e.jsx(z,{children:e.jsx(U,{children:e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{children:"Event Type"}),e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Details"}),e.jsx(f,{children:"Days Until"})]})}),e.jsx(ke,{children:(H?.data?.data??H?.data??[]).length===0?e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No upcoming events scheduled"})})}):(H?.data?.data??H?.data??[]).map((O,Ce)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(X,{label:O.event_type?.toUpperCase()||"EVENT",size:"small",color:O.event_type==="earnings"?"primary":O.event_type==="dividend"?"success":"default"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:new Date(O.start_date).toLocaleDateString()})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",noWrap:!0,children:O.title})}),e.jsx(f,{children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:[Math.ceil((new Date(O.start_date)-new Date)/(1e3*60*60*24))," ","days"]})})]},`${O.symbol}-${Ce}`))})]})})})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:600},children:[e.jsx(Lt,{sx:{verticalAlign:"middle",mr:1}}),"Trading Signals"]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:12,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Daily Signals",e.jsx(X,{label:"1D",size:"small",color:"primary"})]}),e.jsx(Fe,{sx:{mb:2}}),te?e.jsx(g,{display:"flex",justifyContent:"center",p:2,children:e.jsx(Je,{size:30})}):Pe?e.jsx(we,{severity:"info",sx:{mb:2},children:"No daily signals available"}):e.jsx(Ae,{sx:{maxHeight:600,overflowY:"auto",overflowX:"auto"},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{minWidth:100},children:"Company"}),e.jsx(f,{sx:{minWidth:80},children:"Date"}),e.jsx(f,{sx:{minWidth:70},children:"Signal"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Open"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"High"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Low"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Close"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Volume"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Buy Level"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Stop"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Sell Level"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Target 25%"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Target 20%"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"R/R"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Risk %"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Gain/Loss %"}),e.jsx(f,{sx:{minWidth:110},children:"Market Stage"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"Stage Conf"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"SATA"}),e.jsx(f,{sx:{minWidth:80},children:"Signal State"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Days State"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"Quality"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"RSI"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"ADX"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"ATR"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"% EMA21"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"% SMA50"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"% SMA200"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Daily Rng%"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Vol Ratio"}),e.jsx(f,{sx:{minWidth:85},children:"Vol Analysis"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Mansfield"}),e.jsx(f,{sx:{minWidth:100},children:"Entry Window"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Ext %"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Days to Pivot"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Dist to Pivot%"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Consol Days"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"ATR Contract"}),e.jsx(f,{sx:{minWidth:100},children:"Pullback Stage"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Pullback Days"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"% Retrace"}),e.jsx(f,{align:"right",sx:{minWidth:100},children:"Avg 5Day Chg"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Consec Up"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Consec Down"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Vol %ile"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Gap %"}),e.jsx(f,{align:"right",sx:{minWidth:85},children:"Pos Size"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Close Pos"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"Dist 21EMA%"}),e.jsx(f,{sx:{minWidth:110},children:"Next Earnings"}),e.jsx(f,{align:"right",sx:{minWidth:75},children:"Days Earnings"}),e.jsx(f,{sx:{minWidth:85},children:"Volatility"})]})}),e.jsxs(ke,{children:[(ee?.data?.data??[]).slice(0,10).map((O,Ce)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"caption",sx:{fontWeight:"bold"},children:O.company_name||O.symbol})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:new Date(O.date).toLocaleDateString()})}),e.jsx(f,{children:e.jsx(X,{label:O.signal||"N/A",size:"small",color:(O.signal||"").toUpperCase()==="BUY"?"success":(O.signal||"").toUpperCase()==="SELL"?"error":"default"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.open?ge(O.open):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.high?ge(O.high):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.low?ge(O.low):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{fontWeight:"bold"},children:ge(O.current_price||0)})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.volume?Me(O.volume):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.buylevel?ge(O.buylevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.stoplevel?ge(O.stoplevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.selllevel?ge(O.selllevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_25pct?ge(O.profit_target_25pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_20pct?ge(O.profit_target_20pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.risk_reward_ratio?O.risk_reward_ratio.toFixed(2):"—",size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.risk_pct?`${O.risk_pct.toFixed(1)}%`:"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{color:(O.current_gain_loss_pct||0)>0?"success.main":(O.current_gain_loss_pct||0)<0?"error.main":"inherit"},children:O.current_gain_loss_pct?`${O.current_gain_loss_pct.toFixed(2)}%`:"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.market_stage||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.stage_confidence||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.sata_score||"—"})}),e.jsx(f,{children:e.jsx(X,{label:O.signal_state||"N/A",size:"small",sx:{fontSize:"0.65rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.days_in_current_state||0})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.entry_quality_score||0,size:"small",color:(O.entry_quality_score||0)>=70?"success":(O.entry_quality_score||0)>=50?"warning":"error",sx:{fontSize:"0.7rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.rsi?O.rsi.toFixed(1):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.adx?O.adx.toFixed(1):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.atr?O.atr.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.pct_from_ema_21?O.pct_from_ema_21.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.pct_from_sma_50?O.pct_from_sma_50.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.pct_from_sma_200?O.pct_from_sma_200.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.daily_range_pct?O.daily_range_pct.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.volume_ratio?O.volume_ratio.toFixed(2):"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.volume_analysis||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.mansfield_rs?O.mansfield_rs.toFixed(2):"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.entry_window||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.extension_from_pivot_pct?O.extension_from_pivot_pct.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.days_since_pivot_break||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.distance_to_pivot_pct?O.distance_to_pivot_pct.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.consolidation_days||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.atr_contraction_ratio?O.atr_contraction_ratio.toFixed(2):"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.pullback_stage||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.pullback_days||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.pct_retraced_from_high?O.pct_retraced_from_high.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.avg_daily_change_last_5days?O.avg_daily_change_last_5days.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.consecutive_up_days||0})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.consecutive_down_days||0})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.volume_percentile||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.gap_from_prev_close_pct?O.gap_from_prev_close_pct.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.position_size_recommendation||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.close_range_position?O.close_range_position.toFixed(2):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.distance_to_21ema_pct?O.distance_to_21ema_pct.toFixed(2):"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.next_earnings_date?new Date(O.next_earnings_date).toLocaleDateString():"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.days_to_earnings||"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.volatility_profile||"—"})})]},Ce)),(!ee?.data?.data||ee.data.data.length===0)&&e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No daily signals available"})})})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Weekly Signals",e.jsx(X,{label:"1W",size:"small",color:"secondary"})]}),e.jsx(Fe,{sx:{mb:2}}),et?e.jsx(g,{display:"flex",justifyContent:"center",p:2,children:e.jsx(Je,{size:30})}):De?e.jsx(we,{severity:"info",sx:{mb:2},children:"No weekly signals available"}):e.jsx(Ae,{sx:{maxHeight:500,overflowY:"auto",overflowX:"auto"},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{minWidth:80},children:"Date"}),e.jsx(f,{sx:{minWidth:70},children:"Signal"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Open"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"High"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Low"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Close"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Volume"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Buy Level"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Stop"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Sell Level"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Target 25%"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Target 20%"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"R/R"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Risk %"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Gain/Loss %"}),e.jsx(f,{sx:{minWidth:100},children:"Market Stage"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"SATA"}),e.jsx(f,{sx:{minWidth:70},children:"Signal State"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Days State"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"Quality"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"RSI"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"ADX"})]})}),e.jsxs(ke,{children:[(Be?.data?.data??[]).slice(0,10).map((O,Ce)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"caption",children:new Date(O.date).toLocaleDateString()})}),e.jsx(f,{children:e.jsx(X,{label:O.signal||"N/A",size:"small",color:(O.signal||"").toUpperCase()==="BUY"?"success":(O.signal||"").toUpperCase()==="SELL"?"error":"default"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.open?ge(O.open):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.high?ge(O.high):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.low?ge(O.low):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{fontWeight:"bold"},children:ge(O.current_price||O.close||0)})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.volume?Me(O.volume):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.buylevel?ge(O.buylevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.stoplevel?ge(O.stoplevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.selllevel?ge(O.selllevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_25pct?ge(O.profit_target_25pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_20pct?ge(O.profit_target_20pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.risk_reward_ratio?O.risk_reward_ratio.toFixed(2):"—",size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.risk_pct?`${O.risk_pct.toFixed(1)}%`:"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{color:(O.current_gain_loss_pct||0)>0?"success.main":(O.current_gain_loss_pct||0)<0?"error.main":"text.secondary"},children:O.current_gain_loss_pct?`${O.current_gain_loss_pct.toFixed(2)}%`:"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.market_stage||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.sata_score||"—"})}),e.jsx(f,{children:e.jsx(X,{label:O.signal_state||"N/A",size:"small",sx:{fontSize:"0.65rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.days_in_current_state||0})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.entry_quality_score||0,size:"small",color:(O.entry_quality_score||0)>=70?"success":(O.entry_quality_score||0)>=50?"warning":"error"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.rsi?O.rsi.toFixed(1):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.adx?O.adx.toFixed(1):"—"})})]},Ce)),(!Be?.data?.data||Be.data.data.length===0)&&e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No weekly signals available"})})})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:["Monthly Signals",e.jsx(X,{label:"1M",size:"small",color:"info"})]}),e.jsx(Fe,{sx:{mb:2}}),ve?e.jsx(g,{display:"flex",justifyContent:"center",p:2,children:e.jsx(Je,{size:30})}):B?e.jsx(we,{severity:"info",sx:{mb:2},children:"No monthly signals available"}):e.jsx(Ae,{sx:{maxHeight:500,overflowY:"auto",overflowX:"auto"},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{sx:{minWidth:80},children:"Date"}),e.jsx(f,{sx:{minWidth:70},children:"Signal"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Open"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"High"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Low"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Close"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Volume"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Buy Level"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Stop"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Sell Level"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Target 25%"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Target 20%"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"R/R"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Risk %"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"Gain/Loss %"}),e.jsx(f,{sx:{minWidth:100},children:"Market Stage"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"SATA"}),e.jsx(f,{sx:{minWidth:70},children:"Signal State"}),e.jsx(f,{align:"right",sx:{minWidth:80},children:"Days State"}),e.jsx(f,{align:"right",sx:{minWidth:60},children:"Quality"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"RSI"}),e.jsx(f,{align:"right",sx:{minWidth:70},children:"ADX"})]})}),e.jsxs(ke,{children:[(ze?.data?.data??[]).slice(0,10).map((O,Ce)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"caption",children:new Date(O.date).toLocaleDateString()})}),e.jsx(f,{children:e.jsx(X,{label:O.signal||"N/A",size:"small",color:(O.signal||"").toUpperCase()==="BUY"?"success":(O.signal||"").toUpperCase()==="SELL"?"error":"default"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.open?ge(O.open):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.high?ge(O.high):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.low?ge(O.low):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{fontWeight:"bold"},children:ge(O.current_price||O.close||0)})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.volume?Me(O.volume):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.buylevel?ge(O.buylevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.stoplevel?ge(O.stoplevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.selllevel?ge(O.selllevel):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_25pct?ge(O.profit_target_25pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.profit_target_20pct?ge(O.profit_target_20pct):"—"})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.risk_reward_ratio?O.risk_reward_ratio.toFixed(2):"—",size:"small",variant:"outlined",sx:{fontSize:"0.7rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.risk_pct?`${O.risk_pct.toFixed(1)}%`:"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",sx:{color:(O.current_gain_loss_pct||0)>0?"success.main":(O.current_gain_loss_pct||0)<0?"error.main":"text.secondary"},children:O.current_gain_loss_pct?`${O.current_gain_loss_pct.toFixed(2)}%`:"—"})}),e.jsx(f,{children:e.jsx(d,{variant:"caption",children:O.market_stage||"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.sata_score||"—"})}),e.jsx(f,{children:e.jsx(X,{label:O.signal_state||"N/A",size:"small",sx:{fontSize:"0.65rem"}})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.days_in_current_state||0})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:O.entry_quality_score||0,size:"small",color:(O.entry_quality_score||0)>=70?"success":(O.entry_quality_score||0)>=50?"warning":"error"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.rsi?O.rsi.toFixed(1):"—"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"caption",children:O.adx?O.adx.toFixed(1):"—"})})]},Ce)),(!ze?.data?.data||ze.data.data.length===0)&&e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",sx:{py:2},children:"No monthly signals available"})})})]})]})})]})})})]})]})]})}const bC=()=>{const[r,t]=j.useState(0),[s,n]=j.useState(!0),[i,a]=j.useState(null),[o,l]=j.useState([]),[c,h]=j.useState([]),[u,m]=j.useState({}),[p,x]=j.useState(""),[b,w]=j.useState(""),[C,A]=j.useState(0),[_,R]=j.useState(1),[E,T]=j.useState("composite_metric"),[M,I]=j.useState("desc"),[N,k]=j.useState(1),[S,L]=j.useState(1);j.useEffect(()=>{W()},[N,p,b,C,_,E,M]),j.useEffect(()=>{r===1?F():r===2&&$()},[r]);const W=async()=>{try{n(!0);const P=new URLSearchParams({page:N.toString(),limit:"50",search:p,sector:b,minMetric:C.toString(),maxMetric:_.toString(),sortBy:E,sortOrder:M}),D=await St.get(`/api/metrics?${P}`);if(!D||!D.data)throw new Error("No data received from metrics API");const Y=D.data;l(Y.stocks||[]),L(Y.pagination?.totalPages||1),a(null)}catch(P){a(P.message)}finally{n(!1)}},F=async()=>{try{const P=await St.get("/api/metrics/sectors/analysis");if(!P||!P.data)throw new Error("No data received from sector analysis API");const D=P.data;h(D.sectors||[])}catch(P){a(P.message)}},$=async()=>{try{const D=(["composite","quality","value"]||[]).map(async ae=>{const ee=await St.get(`/api/metrics/top/${ae}?limit=10`);if(!ee||!ee.data)throw new Error(`No data received from top ${ae} metrics API`);return{category:ae,data:ee.data.topStocks||[]}}),Y=await Promise.all(D),ce={};Y.forEach(({category:ae,data:ee})=>{ce[ae]=ee}),m(ce)}catch(P){a(P.message)}},q=P=>P>=.8?"#4caf50":P>=.7?"#8bc34a":P>=.6?"#ffeb3b":P>=.5?"#ff9800":"#f44336",ne=(P,D)=>e.jsx(X,{label:`${D}: ${P.toFixed(3)}`,size:"small",style:{backgroundColor:q(P),color:P>=.6?"#000":"#fff",fontWeight:"bold",margin:"2px"}}),he=({metric:P,label:D,icon:Y})=>e.jsxs(g,{sx:{mb:2},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",mb:1},children:[Y,e.jsx(d,{variant:"body2",sx:{ml:1,flex:1},children:D}),e.jsx(d,{variant:"body2",sx:{fontWeight:"bold"},children:P.toFixed(3)})]}),e.jsx(rt,{variant:"determinate",value:P*100,sx:{height:8,borderRadius:4,"& .MuiLinearProgress-bar":{backgroundColor:q(P),borderRadius:4}}})]}),re=()=>e.jsx(Ae,{component:He,sx:{mt:3},children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Symbol"})}),e.jsx(f,{children:e.jsx("strong",{children:"Company"})}),e.jsx(f,{children:e.jsx("strong",{children:"Sector"})}),e.jsx(f,{align:"center",children:e.jsx("strong",{children:"Composite Metric"})}),e.jsx(f,{align:"center",children:e.jsx("strong",{children:"Quality"})}),e.jsx(f,{align:"center",children:e.jsx("strong",{children:"Value"})}),e.jsx(f,{align:"center",children:e.jsx("strong",{children:"Growth"})}),e.jsx(f,{children:e.jsx("strong",{children:"Price"})}),e.jsx(f,{children:e.jsx("strong",{children:"Market Cap"})})]})}),e.jsx(ke,{children:(o||[]).map((P,D)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"subtitle2",sx:{fontWeight:"bold",color:"#1976d2"},children:P.symbol})}),e.jsx(f,{children:e.jsxs(d,{variant:"body2",children:[P.companyName?.substring(0,30),P.companyName?.length>30?"...":""]})}),e.jsx(f,{children:e.jsx(X,{label:P.sector,size:"small",variant:"outlined"})}),e.jsx(f,{align:"center",children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(d,{variant:"h6",sx:{color:q(P.metrics.composite),fontWeight:"bold"},children:P.metrics.composite.toFixed(3)}),e.jsx(tt,{title:`Confidence: ${P.metadata.confidence.toFixed(2)}`,children:e.jsx(Ge,{size:"small",children:e.jsx(lo,{fontSize:"small"})})})]})}),e.jsx(f,{align:"center",children:e.jsx(d,{sx:{color:q(P.metrics.quality)},children:P.metrics.quality.toFixed(3)})}),e.jsx(f,{align:"center",children:e.jsx(d,{sx:{color:q(P.metrics.value)},children:P.metrics.value.toFixed(3)})}),e.jsx(f,{align:"center",children:e.jsx(d,{sx:{color:q(P.metrics.growth||0)},children:(P.metrics.growth||0).toFixed(3)})}),e.jsxs(f,{children:["$",P.currentPrice?.toFixed(2)||"N/A"]}),e.jsx(f,{children:P.marketCap?`$${(P.marketCap/1e9).toFixed(1)}B`:"N/A"})]},P.symbol))})]})}),G=()=>e.jsx(y,{container:!0,spacing:3,sx:{mt:2},children:(c||[]).map(P=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:P.sector}),e.jsxs(d,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:[P.stockCount," stocks"]}),e.jsx(he,{metric:parseFloat(P.averageMetrics.composite),label:"Composite",icon:e.jsx(Pr,{})}),e.jsx(he,{metric:parseFloat(P.averageMetrics.quality),label:"Quality",icon:e.jsx(Fs,{})}),e.jsx(he,{metric:parseFloat(P.averageMetrics.value),label:"Value",icon:e.jsx(yx,{})}),e.jsx(he,{metric:parseFloat(P.averageMetrics.growth||0),label:"Growth",icon:e.jsx(at,{})}),e.jsxs(g,{sx:{mt:2,display:"flex",justifyContent:"space-between"},children:[e.jsxs(d,{variant:"caption",children:["Range: ",P.metricRange.min," - ",P.metricRange.max]}),e.jsxs(d,{variant:"caption",children:["Vol: ",P.metricRange.volatility]})]})]})})},P.sector))}),H=()=>e.jsx(y,{container:!0,spacing:3,sx:{mt:2},children:Object.entries(u).map(([P,D])=>e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{textTransform:"capitalize"},children:["Top ",P==="composite"?"Overall":P," Stocks"]}),e.jsx(g,{sx:{maxHeight:400,overflow:"auto"},children:D.slice(0,10).map((Y,ce)=>e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,borderBottom:ce<9?"1px solid #eee":"none"},children:[e.jsxs(g,{children:[e.jsxs(d,{variant:"subtitle2",sx:{fontWeight:"bold"},children:[ce+1,". ",Y.symbol]}),e.jsxs(d,{variant:"caption",color:"textSecondary",children:[Y.companyName?.substring(0,25),Y.companyName?.length>25?"...":""]})]}),e.jsxs(g,{sx:{textAlign:"right"},children:[e.jsx(d,{variant:"body2",sx:{color:q(Y.categoryMetric),fontWeight:"bold"},children:Y.categoryMetric.toFixed(3)}),e.jsx(d,{variant:"caption",color:"textSecondary",children:Y.sector})]})]},Y.symbol))})]})})},P))});return i?e.jsx(lt,{maxWidth:"lg",sx:{mt:4},children:e.jsxs(we,{severity:"error",children:["Error loading metrics: ",i]})}):e.jsxs(lt,{maxWidth:"lg",sx:{mt:4},children:[e.jsxs(g,{sx:{mb:4},children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Institutional-Grade Stock Metrics"}),e.jsx(d,{variant:"subtitle1",color:"textSecondary",children:"Advanced multi-factor analysis based on academic research and institutional methodology"})]}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:r,onChange:(P,D)=>t(D),children:[e.jsx(it,{value:0,label:"Stock Metrics"}),e.jsx(it,{value:1,label:"Sector Analysis"}),e.jsx(it,{value:2,label:"Top Performers"})]})}),r===0&&e.jsx(He,{sx:{p:3,mb:3},children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:12,sm:3,children:e.jsx(_e,{fullWidth:!0,label:"Search Symbol/Company",value:p,onChange:P=>x(P.target.value),size:"small"})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Sector"}),e.jsxs(pt,{value:b,label:"Sector",onChange:P=>w(P.target.value),children:[e.jsx(J,{value:"",children:"All Sectors"}),e.jsx(J,{value:"Technology",children:"Technology"}),e.jsx(J,{value:"Healthcare",children:"Healthcare"}),e.jsx(J,{value:"Financial Services",children:"Financial Services"}),e.jsx(J,{value:"Consumer Cyclical",children:"Consumer Cyclical"}),e.jsx(J,{value:"Industrials",children:"Industrials"}),e.jsx(J,{value:"Communication Services",children:"Communication Services"}),e.jsx(J,{value:"Consumer Defensive",children:"Consumer Defensive"}),e.jsx(J,{value:"Energy",children:"Energy"}),e.jsx(J,{value:"Utilities",children:"Utilities"}),e.jsx(J,{value:"Real Estate",children:"Real Estate"}),e.jsx(J,{value:"Basic Materials",children:"Basic Materials"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(_e,{fullWidth:!0,label:"Min Metric",type:"number",value:C,onChange:P=>A(Number(P.target.value)),size:"small",inputProps:{min:0,max:1,step:.01}})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(_e,{fullWidth:!0,label:"Max Metric",type:"number",value:_,onChange:P=>R(Number(P.target.value)),size:"small",inputProps:{min:0,max:1,step:.01}})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Sort By"}),e.jsxs(pt,{value:E,label:"Sort By",onChange:P=>T(P.target.value),children:[e.jsx(J,{value:"composite_metric",children:"Composite Metric"}),e.jsx(J,{value:"quality_metric",children:"Quality Metric"}),e.jsx(J,{value:"value_metric",children:"Value Metric"}),e.jsx(J,{value:"market_cap",children:"Market Cap"}),e.jsx(J,{value:"symbol",children:"Symbol"})]})]})})]})}),s?e.jsx(g,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Je,{})}):e.jsxs(e.Fragment,{children:[r===0&&e.jsx(re,{}),r===1&&e.jsx(G,{}),r===2&&e.jsx(H,{})]}),r===0&&S>1&&e.jsx(g,{sx:{display:"flex",justifyContent:"center",mt:3},children:e.jsxs(d,{variant:"body2",sx:{mt:1},children:["Page ",N," of ",S]})}),e.jsxs(He,{sx:{p:2,mt:4,backgroundColor:"#f5f5f5"},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Metrics Methodology"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(d,{variant:"subtitle2",children:"Quality Metric"}),e.jsx(d,{variant:"caption",children:"Financial statement quality, balance sheet strength, profitability, management effectiveness using Piotroski F-Score, Altman Z-Score analysis"})]}),e.jsxs(y,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(d,{variant:"subtitle2",children:"Value Metric"}),e.jsx(d,{variant:"caption",children:"Traditional multiples (P/E, P/B, EV/EBITDA), DCF intrinsic value, dividend discount model, and peer comparison analysis"})]}),e.jsxs(y,{item:!0,xs:12,sm:6,md:6,children:[e.jsx(d,{variant:"subtitle2",children:"Growth Metric"}),e.jsx(d,{variant:"caption",children:"Revenue growth analysis, earnings growth quality, fundamental growth drivers, and market expansion potential based on academic research"})]})]}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Metric Ranges (0-1 Scale):"}),e.jsxs(g,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:[ne(.9,"Excellent (0.8-1.0)"),ne(.75,"Good (0.7-0.79)"),ne(.65,"Fair (0.6-0.69)"),ne(.55,"Below Average (0.5-0.59)"),ne(.4,"Poor (0.0-0.49)")]})]})]})]})};function Lm(){const r=Qn("TechnicalAnalysis"),[t,s]=j.useState("daily"),[n,i]=j.useState(""),[a,o]=j.useState(""),[l,c]=j.useState(0),[h,u]=j.useState(10),[m]=j.useState("symbol"),[p]=j.useState("asc"),[x,b]=j.useState(0),[w,C]=j.useState(null),A=On(),[_,R]=j.useState(""),[E,T]=j.useState(""),[M,I]=j.useState(""),N=j.useCallback(async()=>{const P={page:l+1,limit:h,symbol:n||void 0,sortBy:m,sortOrder:p};if(_)switch(_){case"rsi":E&&(P.rsi_min=E),M&&(P.rsi_max=M);break;case"macd":E&&(P.macd_min=E),M&&(P.macd_max=M);break;case"sma_20":E&&(P.sma_min=E),M&&(P.sma_max=M);break}const D=await Sc(t,P);return Array.isArray(D)?{data:D}:Array.isArray(D?.data)?D:{...D,data:[]}},[t,n,_,E,M,l,h,m,p]),{data:k,isLoading:S,error:L,_refetch:W}=Qe({queryKey:["technicalAnalysis",t,n,_,E,M,l,h,m,p],queryFn:N,onError:P=>r.queryError("technicalAnalysis",P,{timeframe:t,symbolFilter:n,page:l}),refetchInterval:3e5,retry:2,staleTime:6e4,refetchOnWindowFocus:!1,refetchOnMount:!1});j.useEffect(()=>{let P=0;n&&P++,_&&P++,(E||M)&&P++,b(P)},[n,_,E,M]);const F=()=>{i(a.trim()),c(0)},$=()=>{o(""),i(""),c(0)},q=P=>{s(P.target.value),c(0)},ne=(P,D)=>{c(D)},he=P=>{u(parseInt(P.target.value,10)),c(0)},re=[{id:"symbol",label:"Symbol",sortable:!0},{id:"date",label:"Date",sortable:!0,format:Aa},{id:"rsi",label:"RSI",sortable:!0},{id:"macd",label:"MACD",sortable:!0},{id:"macd_signal",label:"MACD Signal",sortable:!0},{id:"macd_hist",label:"MACD Hist",sortable:!0},{id:"adx",label:"ADX",sortable:!0},{id:"atr",label:"ATR",sortable:!0},{id:"mfi",label:"MFI",sortable:!0},{id:"roc",label:"ROC",sortable:!0},{id:"mom",label:"MOM",sortable:!0},{id:"bbands_upper",label:"BB Upper",sortable:!0},{id:"bbands_middle",label:"BB Middle",sortable:!0},{id:"bbands_lower",label:"BB Lower",sortable:!0},{id:"sma_10",label:"SMA 10",sortable:!0},{id:"sma_20",label:"SMA 20",sortable:!0},{id:"sma_50",label:"SMA 50",sortable:!0},{id:"sma_150",label:"SMA 150",sortable:!0},{id:"sma_200",label:"SMA 200",sortable:!0},{id:"ema_4",label:"EMA 4",sortable:!0},{id:"ema_9",label:"EMA 9",sortable:!0},{id:"ema_21",label:"EMA 21",sortable:!0},{id:"ad",label:"A/D",sortable:!0},{id:"cmf",label:"CMF",sortable:!0},{id:"td_sequential",label:"TD Seq",sortable:!0},{id:"td_combo",label:"TD Combo",sortable:!0},{id:"marketwatch",label:"MW",sortable:!0},{id:"dm",label:"DM",sortable:!0},{id:"pivot_high",label:"Pivot H",sortable:!0},{id:"pivot_low",label:"Pivot L",sortable:!0},{id:"pivot_high_triggered",label:"Pivot H Triggered",sortable:!0},{id:"pivot_low_triggered",label:"Pivot L Triggered",sortable:!0}],G=P=>{switch(P){case"up":return e.jsx(at,{fontSize:"small",color:"inherit"});case"down":return e.jsx(Tt,{fontSize:"small",color:"inherit"});case"flat":return e.jsx(uu,{fontSize:"small",color:"inherit"});case"neutral":return e.jsx(Gt,{fontSize:"small",color:"inherit"});case"info":default:return e.jsx(nS,{fontSize:"small",color:"inherit"})}},H=()=>e.jsx(g,{sx:{width:"100%"},children:(Array.isArray(k?.data)?k.data:[]).map((P,D)=>e.jsxs(is,{expanded:w===D,onChange:()=>C(w===D?null:D),sx:{mb:1,borderLeft:4,borderColor:P.rsi>70?"error.main":P.rsi<30?"primary.main":"grey.300",boxShadow:w===D?6:1},children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{backgroundColor:w===D?"grey.100":"grey.50","&:hover":{backgroundColor:"grey.200"},minHeight:100,"& .MuiAccordionSummary-content":{margin:"16px 0",flexDirection:"column"}},children:e.jsxs(g,{sx:{width:"100%"},children:[e.jsxs(y,{container:!0,alignItems:"center",spacing:2,sx:{mb:2},children:[e.jsx(y,{item:!0,xs:12,sm:3,children:e.jsxs(g,{children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:P.symbol}),P.company_name&&e.jsx(d,{variant:"body2",color:"text.secondary",noWrap:!0,children:P.company_name}),e.jsx(d,{variant:"caption",color:"text.secondary",children:Aa(P.date)})]})}),e.jsx(y,{item:!0,xs:6,sm:2,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"RSI"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[G(cr("rsi",P.rsi).icon),e.jsx(d,{variant:"body2",color:cr("rsi",P.rsi).color,fontWeight:"bold",children:Me(P.rsi)})]})]})}),e.jsx(y,{item:!0,xs:6,sm:2,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"MACD"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[G(cr("macd",P.macd).icon),e.jsx(d,{variant:"body2",color:cr("macd",P.macd).color,fontWeight:"bold",children:Me(P.macd)})]})]})}),e.jsx(y,{item:!0,xs:6,sm:2,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"ADX"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[G(cr("adx",P.adx).icon),e.jsx(d,{variant:"body2",color:cr("adx",P.adx).color,fontWeight:"bold",children:Me(P.adx)})]})]})}),e.jsx(y,{item:!0,xs:6,sm:1.5,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"ATR"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[G(cr("atr",P.atr).icon),e.jsx(d,{variant:"body2",color:cr("atr",P.atr).color,fontWeight:"bold",children:Me(P.atr)})]})]})}),e.jsx(y,{item:!0,xs:6,sm:1.5,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"MFI"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[G(cr("mfi",P.mfi).icon),e.jsx(d,{variant:"body2",color:cr("mfi",P.mfi).color,fontWeight:"bold",children:Me(P.mfi)})]})]})})]}),e.jsx(Fe,{sx:{mb:1}}),e.jsxs(y,{container:!0,spacing:1,alignItems:"center",children:[e.jsx(y,{item:!0,xs:6,sm:2,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Price"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:["$",P.current_price?Me(P.current_price,2):"N/A"]})]})}),e.jsx(y,{item:!0,xs:6,sm:2,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Change"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[P.price_direction&&G(P.price_direction),e.jsx(d,{variant:"body2",color:P.price_direction==="up"?"success.main":P.price_direction==="down"?"error.main":"text.secondary",fontWeight:"bold",children:P.price_change_percent?`${P.price_change_percent>0?"+":""}${Me(P.price_change_percent,2)}%`:"N/A"})]})]})}),e.jsx(y,{item:!0,xs:6,sm:2.5,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Range"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:P.high_price&&P.low_price?`${Me(P.low_price,2)} - ${Me(P.high_price,2)}`:"N/A"})]})}),e.jsx(y,{item:!0,xs:6,sm:1.5,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Volume"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{fontSize:"0.8rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:P.volume?Me(P.volume):"N/A"})]})}),e.jsx(y,{item:!0,xs:6,sm:1.5,children:e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-start",children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Open"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:["$",P.open_price?Me(P.open_price,2):"N/A"]})]})}),e.jsx(y,{item:!0,xs:12,sm:1.5,children:e.jsx(oe,{variant:"outlined",size:"small",fullWidth:!0,onClick:Y=>{Y.stopPropagation(),A(`/technical-history/${P.symbol}`)},sx:{mt:{xs:1,sm:0}},children:"History"})})]}),P.pattern&&P.pattern.type&&e.jsx(g,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsx(y,{container:!0,spacing:2,alignItems:"center",children:e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Pattern:"}),e.jsx(X,{label:P.pattern.type.split("_").map(Y=>Y.charAt(0).toUpperCase()+Y.slice(1)).join(" "),color:P.pattern.direction==="bullish"?"success":P.pattern.direction==="bearish"?"error":"default",size:"small",icon:P.pattern.direction==="bullish"?e.jsx(at,{}):P.pattern.direction==="bearish"?e.jsx(Tt,{}):null}),P.pattern.confidence&&e.jsx(X,{label:`${Math.round(P.pattern.confidence*100)}% confidence`,size:"small",variant:"outlined"})]})})})})]})}),e.jsxs(os,{children:[e.jsx(y,{container:!0,spacing:2,children:re.filter(Y=>Y.id!=="symbol"&&Y.id!=="date").map(Y=>e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[G(cr(Y.id,P[Y.id]).icon),e.jsx(d,{variant:"subtitle2",children:Y.label})]}),e.jsx(d,{variant:"h6",color:cr(Y.id,P[Y.id]).color,fontWeight:"bold",children:Y.format?Y.format(P[Y.id]):P[Y.id]!==void 0&&P[Y.id]!==null?Me(P[Y.id]):"N/A"})]})})},Y.id))}),P.pattern&&P.pattern.type&&e.jsx(g,{sx:{mt:3},children:e.jsx(z,{variant:"outlined",sx:{bgcolor:P.pattern.direction==="bullish"?"success.50":P.pattern.direction==="bearish"?"error.50":"grey.50"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Pattern Recognition"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Pattern Type"}),e.jsx(d,{variant:"body2",fontWeight:"medium",children:P.pattern.type.split("_").map(Y=>Y.charAt(0).toUpperCase()+Y.slice(1)).join(" ")})]}),e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Direction"}),e.jsx(d,{variant:"body2",fontWeight:"medium",color:P.pattern.direction==="bullish"?"success.dark":P.pattern.direction==="bearish"?"error.dark":"text.primary",children:P.pattern.direction?P.pattern.direction.charAt(0).toUpperCase()+P.pattern.direction.slice(1):"N/A"})]}),e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Confidence"}),e.jsx(d,{variant:"body2",fontWeight:"medium",children:P.pattern.confidence?`${Math.round(P.pattern.confidence*100)}%`:"N/A"})]}),P.pattern.strength&&e.jsxs(y,{item:!0,xs:6,sm:3,children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Strength"}),e.jsxs(d,{variant:"body2",fontWeight:"medium",children:[P.pattern.strength,"%"]})]})]})]})})})]})]},P.symbol+"-"+P.date+"-"+D))});return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,sx:{fontWeight:600},children:"Technical Analysis"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Technical indicators and market screening"})]}),e.jsxs(g,{display:"flex",alignItems:"flex-start",gap:4,sx:{mt:3},children:[e.jsx(g,{minWidth:260,maxWidth:320,children:e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Filter Technicals"}),e.jsxs(ft,{fullWidth:!0,size:"small",sx:{mb:2},children:[e.jsx(mt,{children:"Timeframe"}),e.jsxs(pt,{value:t,label:"Timeframe",onChange:q,children:[e.jsx(J,{value:"daily",children:"Daily"}),e.jsx(J,{value:"weekly",children:"Weekly"}),e.jsx(J,{value:"monthly",children:"Monthly"})]})]}),e.jsx(_e,{label:"Search Symbol",value:a,onChange:P=>o(P.target.value.toUpperCase()),onKeyPress:P=>P.key==="Enter"&&F(),size:"small",fullWidth:!0,sx:{mb:2},placeholder:"e.g., AAPL",InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})}}),e.jsxs(ft,{fullWidth:!0,size:"small",sx:{mb:2},children:[e.jsx(mt,{children:"Indicator"}),e.jsxs(pt,{value:_,label:"Indicator",onChange:P=>R(P.target.value),children:[e.jsx(J,{value:"",children:"All"}),e.jsx(J,{value:"rsi",children:"RSI"}),e.jsx(J,{value:"macd",children:"MACD"}),e.jsx(J,{value:"adx",children:"ADX"}),e.jsx(J,{value:"atr",children:"ATR"}),e.jsx(J,{value:"mfi",children:"MFI"}),e.jsx(J,{value:"roc",children:"ROC"}),e.jsx(J,{value:"mom",children:"MOM"}),e.jsx(J,{value:"bbands_upper",children:"BB Upper"}),e.jsx(J,{value:"bbands_middle",children:"BB Middle"}),e.jsx(J,{value:"bbands_lower",children:"BB Lower"}),e.jsx(J,{value:"sma_10",children:"SMA 10"}),e.jsx(J,{value:"sma_20",children:"SMA 20"}),e.jsx(J,{value:"sma_50",children:"SMA 50"}),e.jsx(J,{value:"sma_150",children:"SMA 150"}),e.jsx(J,{value:"sma_200",children:"SMA 200"}),e.jsx(J,{value:"ema_4",children:"EMA 4"}),e.jsx(J,{value:"ema_9",children:"EMA 9"}),e.jsx(J,{value:"ema_21",children:"EMA 21"}),e.jsx(J,{value:"ad",children:"A/D"}),e.jsx(J,{value:"cmf",children:"CMF"}),e.jsx(J,{value:"td_sequential",children:"TD Seq"}),e.jsx(J,{value:"td_combo",children:"TD Combo"}),e.jsx(J,{value:"marketwatch",children:"MW"}),e.jsx(J,{value:"dm",children:"DM"}),e.jsx(J,{value:"pivot_high",children:"Pivot H"}),e.jsx(J,{value:"pivot_low",children:"Pivot L"}),e.jsx(J,{value:"pivot_high_triggered",children:"Pivot H Triggered"}),e.jsx(J,{value:"pivot_low_triggered",children:"Pivot L Triggered"})]})]}),e.jsxs(g,{display:"flex",gap:1,mb:2,children:[e.jsx(_e,{label:"Min Value",type:"number",value:E,onChange:P=>T(P.target.value),size:"small",fullWidth:!0,disabled:!_}),e.jsx(_e,{label:"Max Value",type:"number",value:M,onChange:P=>I(P.target.value),size:"small",fullWidth:!0,disabled:!_})]}),e.jsxs(g,{display:"flex",gap:1,mb:2,children:[e.jsx(oe,{variant:"outlined",onClick:F,startIcon:e.jsx(ar,{}),disabled:S,children:n?"Search":"Filter"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(mn,{}),onClick:$,disabled:S||!n,children:"Clear"}),e.jsx(X,{label:`${x} Filters`,color:x>0?"primary":"default",icon:e.jsx(Tr,{})})]})]})})}),e.jsxs(g,{flex:1,children:[e.jsx(Fe,{sx:{mb:2}}),L&&e.jsxs(we,{severity:"error",sx:{mb:2},children:["Error loading technical data: ",L.message]}),S?e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"center",p:4,children:[e.jsx(Je,{sx:{mb:2}}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Loading technical data..."})]}):e.jsxs(e.Fragment,{children:[(Array.isArray(k?.data)?k.data:[]).length===0?e.jsx(we,{severity:"warning",sx:{mb:2},children:"No technical data found."}):H(),e.jsx(yn,{component:"div",count:k?.pagination?.total||0,page:l,onPageChange:ne,rowsPerPage:h,onRowsPerPageChange:he,rowsPerPageOptions:[10,25,50,100],sx:{mt:2}})]})]})]})]})}const vC={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},wC=Qn("EarningsCalendar");function SC(){const[r,t]=j.useState(0),[s,n]=j.useState(25),[i,a]=j.useState(""),[o,l]=j.useState(""),[c,h]=j.useState(null),u=vC&&"http://localhost:5001"||"",{data:m,isLoading:p,error:x}=Qe({queryKey:["weeklyEarningsCalendar"],queryFn:async()=>{const S=new URLSearchParams({type:"this_week",event_type:"earnings"}),L=await fetch(`${u}/api/calendar/events?${S}`);if(!L.ok){const W=await L.text();throw wC.error("Weekly calendar fetch failed",{status:L.status,text:W}),new Error(`Failed to fetch weekly calendar: ${L.status} ${W}`)}return L.json()},refetchInterval:3e5}),{data:b,isLoading:w,error:C}=Qe({queryKey:["earningsAll",o,r,s],queryFn:async()=>{const S=new URLSearchParams({page:r+1,limit:s});o&&S.append("symbol",o);const L=await fetch(`${u}/api/calendar/earnings-estimates?${S}`);if(!L.ok)throw new Error("Failed to fetch earnings data");return L.json()},refetchInterval:3e5}),{data:A,isLoading:_}=Qe({queryKey:["earningsDetails",c],queryFn:async()=>{if(!c)return null;const[S,L,W,F]=await Promise.all([fetch(`${u}/api/calendar/earnings-history?symbol=${c}`).then($=>$.ok?$.json():{data:{}}),fetch(`${u}/api/analysts/${encodeURIComponent(c)}/eps-revisions`).then($=>$.ok?$.json():{data:[]}),fetch(`${u}/api/analysts/${encodeURIComponent(c)}/eps-trend`).then($=>$.ok?$.json():{data:[]}),fetch(`${u}/api/analysts/revenue-estimates?symbol=${c}`).then($=>$.ok?$.json():{data:[]})]);return{history:S,epsRevisions:L,epsTrend:W,revenueEstimates:F}},enabled:!!c,staleTime:6e4}),R=()=>{l(i.toUpperCase()),t(0)},E=()=>{a(""),l(""),t(0)},T=S=>{h(c===S?null:S)},M=S=>S>5?"success.main":S>0?"success.light":S<-5?"error.main":S<0?"error.light":"grey.500",I=S=>S>0?e.jsx(at,{sx:{fontSize:16}}):S<0?e.jsx(Tt,{sx:{fontSize:16}}):e.jsx(Gt,{sx:{fontSize:16}}),N=j.useMemo(()=>{const S=new Date,L=S.getDay(),W=L===0?-6:1-L,F={};for(let q=0;q<5;q++){const ne=new Date(S);ne.setDate(S.getDate()+W+q);const he=ne.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});F[he]=[]}return(m?.data?.data??m?.data??[]).forEach(q=>{const ne=new Date(q.start_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});F[ne]&&F[ne].push(q)}),F},[m]),k=Object.entries(b?.data||{}).map(([S,L])=>({symbol:S,company_name:L.company_name,estimates:L.estimates||[]})).sort((S,L)=>S.symbol.localeCompare(L.symbol));return p&&!m?e.jsx(lt,{maxWidth:"xl",sx:{py:4},children:e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(Je,{})})}):e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Earnings Calendar"}),e.jsxs(y,{container:!0,spacing:3,mb:4,children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(xx,{color:"primary",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Upcoming Events"})]}),e.jsx(d,{variant:"h4",fontWeight:"bold",color:"primary",children:m?.summary?.upcoming_events||0}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Next 30 days"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(Gt,{color:"success",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"This Week"})]}),e.jsx(d,{variant:"h4",fontWeight:"bold",color:"success.main",children:Object.values(N).reduce((S,L)=>S+L.length,0)}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Companies reporting"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:1,children:[e.jsx(at,{color:"success",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Total Companies"})]}),e.jsx(d,{variant:"h4",fontWeight:"bold",color:"text.primary",children:k.length}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"With estimates"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Overall score"})})})})]}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:3,children:[e.jsx(jx,{color:"primary"}),e.jsx(d,{variant:"h6",children:"This Week's Earnings"})]}),x&&e.jsx(we,{severity:"error",sx:{mb:2},children:"Failed to load weekly calendar. Please try again later."}),p?e.jsx(g,{display:"flex",justifyContent:"center",py:3,children:e.jsx(Je,{size:28})}):e.jsx(y,{container:!0,spacing:2,children:Object.entries(N).map(([S,L])=>e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsx(z,{variant:"outlined",sx:{height:"100%"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:S}),e.jsx(Fe,{sx:{mb:1}}),e.jsx(g,{sx:{maxHeight:200,overflowY:"auto"},children:L.length>0?L.map((W,F)=>e.jsxs(g,{sx:{mb:1,cursor:"pointer"},onClick:()=>{a(W.symbol),l(W.symbol),h(W.symbol),t(0)},children:[e.jsx(d,{variant:"body2",fontWeight:"bold",color:"primary",children:W.symbol}),e.jsx(d,{variant:"caption",color:"text.secondary",children:W.title})]},`${W.symbol}-${F}`)):e.jsx(d,{variant:"body2",color:"text.secondary",align:"center",sx:{py:2},children:"None"})})]})})},S))})]})}),e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(g,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(_e,{placeholder:"Search symbol (e.g., AAPL)",value:i,onChange:S=>a(S.target.value.toUpperCase()),onKeyPress:S=>{S.key==="Enter"&&R()},size:"small",sx:{flex:1,maxWidth:400},InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})}}),e.jsx(oe,{variant:"contained",onClick:R,disabled:!i,children:"Search"}),o&&e.jsx(oe,{variant:"outlined",onClick:E,startIcon:e.jsx(mn,{}),children:"Clear"})]})})}),C&&e.jsx(we,{severity:"error",sx:{mb:3},children:"Failed to load earnings data. Please try again later."}),e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Earnings Estimates & Details"}),w?e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(Je,{})}):k.length===0?e.jsx(d,{variant:"body2",color:"text.secondary",align:"center",py:4,children:"No earnings data found. Try a different search."}):e.jsx(Ae,{component:He,elevation:0,children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.50"},children:[e.jsx(f,{width:50}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Company"})]})}),e.jsx(ke,{children:k.map((S,L)=>e.jsxs(gn.Fragment,{children:[e.jsxs(V,{hover:!0,onClick:()=>T(S.symbol),sx:{cursor:"pointer"},children:[e.jsx(f,{children:e.jsx(Vt,{sx:{transform:c===S.symbol?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:S.symbol})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:S.company_name})})]}),c===S.symbol&&e.jsx(V,{children:e.jsx(f,{colSpan:4,sx:{p:0},children:e.jsx(g,{sx:{p:3,backgroundColor:"grey.50"},children:_?e.jsx(g,{display:"flex",justifyContent:"center",py:3,children:e.jsx(Je,{size:28})}):A?e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"Earnings Estimates"})}),e.jsx(os,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Period"}),e.jsx(f,{align:"right",children:"Avg Est"}),e.jsx(f,{align:"right",children:"Range"}),e.jsx(f,{align:"right",children:"Analysts"}),e.jsx(f,{align:"right",children:"Growth"})]})}),e.jsx(ke,{children:S.estimates?.length>0?S.estimates.map((W,F)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(X,{label:W.period,size:"small",variant:"outlined"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:ge(W.avg_estimate)})}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:[ge(W.low_estimate)," - ",ge(W.high_estimate)]})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:W.number_of_analysts,size:"small",variant:"outlined"})}),e.jsx(f,{align:"right",children:W.growth!=null?e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:.5,children:[I(W.growth),e.jsx(d,{variant:"body2",sx:{color:M(W.growth)},children:Et(W.growth/100)})]}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"N/A"})})]},F)):e.jsx(V,{children:e.jsx(f,{colSpan:5,align:"center",children:"No estimates data"})})})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"Earnings History"})}),e.jsx(os,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Quarter"}),e.jsx(f,{align:"right",children:"Actual"}),e.jsx(f,{align:"right",children:"Estimate"}),e.jsx(f,{align:"right",children:"Surprise %"})]})}),e.jsx(ke,{children:A.history?.data?.[c]?.history?.slice(0,4).map((W,F)=>e.jsxs(V,{children:[e.jsx(f,{children:new Date(W.quarter).toLocaleDateString()}),e.jsx(f,{align:"right",children:ge(W.eps_actual)}),e.jsx(f,{align:"right",children:ge(W.eps_estimate)}),e.jsx(f,{align:"right",children:e.jsx(X,{label:Et(W.surprise_percent/100),size:"small",color:W.surprise_percent>0?"success":W.surprise_percent<0?"error":"default"})})]},F))||e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:"No history data"})})})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"EPS Revisions"})}),e.jsx(os,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Period"}),e.jsx(f,{align:"right",children:"Avg Est"}),e.jsx(f,{align:"right",children:"Low"}),e.jsx(f,{align:"right",children:"High"})]})}),e.jsx(ke,{children:A.epsRevisions?.data?.slice(0,4).map((W,F)=>e.jsxs(V,{children:[e.jsx(f,{children:W.period}),e.jsx(f,{align:"right",children:ge(W.avg_estimate)}),e.jsx(f,{align:"right",children:ge(W.low_estimate)}),e.jsx(f,{align:"right",children:ge(W.high_estimate)})]},F))||e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:"No revisions data"})})})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"EPS Trend"})}),e.jsx(os,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Period"}),e.jsx(f,{align:"right",children:"Current Est"}),e.jsx(f,{align:"right",children:"Year Ago"}),e.jsx(f,{align:"right",children:"Growth"})]})}),e.jsx(ke,{children:A.epsTrend?.data?.slice(0,4).map((W,F)=>e.jsxs(V,{children:[e.jsx(f,{children:W.period}),e.jsx(f,{align:"right",children:ge(W.avg_estimate)}),e.jsx(f,{align:"right",children:ge(W.year_ago_eps)}),e.jsx(f,{align:"right",children:e.jsx(X,{label:Et(W.growth/100),size:"small",color:W.growth>0?"success":W.growth<0?"error":"default"})})]},F))||e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:"No trend data"})})})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"Revenue Estimates"})}),e.jsx(os,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Period"}),e.jsx(f,{align:"right",children:"Avg Est"}),e.jsx(f,{align:"right",children:"Range"}),e.jsx(f,{align:"right",children:"Analysts"})]})}),e.jsx(ke,{children:A.revenueEstimates?.data?.slice(0,4).map((W,F)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(X,{label:W.period,size:"small",variant:"outlined"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:ge(W.avg_estimate,0)})}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"caption",color:"text.secondary",children:[ge(W.low_estimate,0)," - ",ge(W.high_estimate,0)]})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:W.number_of_analysts,size:"small",variant:"outlined"})})]},F))||e.jsx(V,{children:e.jsx(f,{colSpan:4,align:"center",children:"No revenue estimates data"})})})]})})})]})})]}):e.jsx(d,{color:"text.secondary",children:"No detailed data available"})})})})]},`${S.symbol}-${L}`))})]})}),e.jsx(yn,{component:"div",count:b?.pagination?.total||k.length,page:r,onPageChange:(S,L)=>t(L),rowsPerPage:s,onRowsPerPageChange:S=>{n(parseInt(S.target.value,10)),t(0)},rowsPerPageOptions:[10,25,50,100]})]})})]})}function Lo({children:r,value:t,index:s,...n}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`financial-tabpanel-${s}`,"aria-labelledby":`financial-tab-${s}`,...n,children:t===s&&e.jsx(g,{sx:{py:3},children:r})})}function OC(){const r=Qn("FinancialData"),[t,s]=j.useState("AAPL"),[n,i]=j.useState("AAPL"),[a,o]=j.useState(0),[l,c]=j.useState("annual"),{data:h}=Qe({queryKey:["companies"],queryFn:()=>vc({limit:1e3,sortBy:"ticker"}),staleTime:300*1e3}),u=h?.data?.data??h?.data??h??[],m=Array.isArray(u)?u:[],p=(W,F)=>{o(F)},x=(W,F)=>{F!==null&&c(F)},{data:b,isLoading:w,error:C}=Qe({queryKey:["balanceSheet",t,l],queryFn:()=>Vu(t,l),enabled:!!t&&a===0}),{data:A,isLoading:_,error:R}=Qe({queryKey:["incomeStatement",t,l],queryFn:()=>Wu(t,l),enabled:!!t&&a===1}),{data:E,isLoading:T,error:M}=Qe({queryKey:["cashFlowStatement",t,l],queryFn:()=>$u(t,l),enabled:!!t&&a===2});j.useEffect(()=>{C&&(console.error("❌ FinancialData: Balance sheet error:",C),r.queryError("balanceSheet",C,{ticker:t,period:l}))},[C,t,l,r]),j.useEffect(()=>{R&&(console.error("❌ FinancialData: Income statement error:",R),r.queryError("incomeStatement",R,{ticker:t,period:l}))},[R,t,l,r]),j.useEffect(()=>{M&&(console.error("❌ FinancialData: Cash flow statement error:",M),r.queryError("cashFlowStatement",M,{ticker:t,period:l}))},[M,t,l,r]);const{data:I,isLoading:N,error:k}=Qe({queryKey:["keyMetrics",t],queryFn:()=>zu(t),enabled:!!t&&a===3});j.useEffect(()=>{k&&r.queryError("keyMetrics",k,{ticker:t})},[k,t,r]);const S=W=>{if(W?.error)return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(Gt,{}),e.jsx(g,{sx:{ml:1},children:"Key Metrics"})]}),e.jsxs(we,{severity:"error",children:["Error loading key metrics: ",W.error]})]})});const F=W?.data||W;return F?e.jsxs(g,{children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(Gt,{}),e.jsxs(g,{sx:{ml:1},children:["Key Metrics - ",t]})]}),e.jsx(y,{container:!0,spacing:3,children:Object.entries(F).map(([$,q])=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:e.jsx(g,{sx:{ml:0},children:q.title})}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsx(ke,{children:Object.entries(q.metrics).map(([ne,he])=>e.jsxs(V,{children:[e.jsx(f,{component:"th",scope:"row",sx:{py:1,fontSize:"0.875rem"},children:ne}),e.jsx(f,{align:"right",sx:{py:1,fontSize:"0.875rem",fontWeight:"medium"},children:he!=null?typeof he=="number"?ne.includes("%")||ne.includes("Margin")||ne.includes("Growth")||ne.includes("Yield")||ne.includes("Return")?Et(he):ne.includes("$")||ne.includes("Revenue")||ne.includes("Income")||ne.includes("Cash")||ne.includes("Value")||ne.includes("Debt")?ge(he):Me(he):he:"N/A"})]},ne))})})})]})})},$))})]}):e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[e.jsx(Gt,{}),e.jsx(g,{sx:{ml:1},children:"Key Metrics"})]}),e.jsxs(we,{severity:"info",children:["No key metrics data available for ",t]})]})})},L=(W,F,$)=>{if(W?.error)return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[$,e.jsx(g,{sx:{ml:1},children:F})]}),e.jsxs(we,{severity:"error",children:["Error loading ",F.toLowerCase(),": ",W.error]})]})});let q=W?.data||W;if(q&&typeof q=="object"&&!Array.isArray(q)&&"data"in q&&(q=q?.data),!q||!Array.isArray(q)||(q?.length||0)===0)return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[$,e.jsx(g,{sx:{ml:1},children:F})]}),e.jsxs(we,{severity:"info",children:["No ",F.toLowerCase()," data available for ",t]})]})});if(q.length>0&&q[0].totalAssets!==void 0){const re=q.map(G=>{const H={};return Object.entries(G).forEach(([P,D])=>{!["symbol","date","raw"].includes(P)&&D!==void 0&&(H[P]=D)}),{date:G.date,items:H}});return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[$,e.jsxs(g,{sx:{ml:1},children:[F," - ",t]})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(y,{container:!0,spacing:3,children:re.slice(0,5).map((G,H)=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{sx:{p:2},children:[e.jsx(d,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:G.date?new Date(G.date).getFullYear():"N/A"}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[G.items&&Object.entries(G.items).slice(0,10).map(([P,D])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem",border:"none"},children:P.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem",fontWeight:"bold",border:"none"},children:D||D===0?ge(D,0):"N/A"})]},P)),!G.items&&e.jsx(V,{children:e.jsx(f,{colSpan:2,sx:{py:1,fontSize:"0.875rem",border:"none",textAlign:"center",color:"text.secondary"},children:"No financial data available for this period"})})]})})})]})})},G.date||H))}),e.jsxs(g,{sx:{mt:4},children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Trend Analysis - ",F==="Balance Sheet"?"Total Assets":F==="Income Statement"?"Revenue":"Operating Cash Flow"]}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Ks,{data:re.slice(0,5).reverse().map(G=>{let H=0,P="Value";if(F==="Balance Sheet"&&G.items?.totalAssets)H=Number(G.items.totalAssets)||0,P="Total Assets";else if(F==="Income Statement"&&G.items?.revenue)H=Number(G.items.revenue)||0,P="Revenue";else if(F==="Cash Flow Statement"&&G.items?.operatingCashFlow)H=Number(G.items.operatingCashFlow)||0,P="Operating Cash Flow";else{const D=G.items,Y=D&&Object.keys(D).length>0?Object.entries(D)[0]:null;H=Y&&Number(Y[1])||0,P=Y?Y[0]:"Value"}return{year:G.date?new Date(G.date).getFullYear():"N/A",value:H,name:P}}),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"year"}),e.jsx(ht,{}),e.jsx(tt,{formatter:(G,H)=>G==null||isNaN(G)?["N/A","Value"]:[ge(G,0),"Value"]}),e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:"#1976d2",strokeWidth:2})]})})]})]})})}if(q.length>0&&q[0].item_name!==void 0){const re={};q.forEach(H=>{re[H.date]||(re[H.date]=[]),re[H.date].push(H)});const G=Object.entries(re).map(([H,P])=>({date:H,items:P.reduce((D,Y)=>(D[Y.item_name]=Y.value,D),{})}));return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[$,e.jsxs(g,{sx:{ml:1},children:[F," - ",t]})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(y,{container:!0,spacing:3,children:G.slice(0,5).map((H,P)=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{sx:{p:2},children:[e.jsx(d,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:H.date?new Date(H.date).getFullYear():"N/A"}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[H.items&&Object.entries(H.items).slice(0,10).map(([D,Y])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem",border:"none"},children:D.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem",fontWeight:"bold",border:"none"},children:Y||Y===0?ge(Y,0):"N/A"})]},D)),!H.items&&e.jsx(V,{children:e.jsx(f,{colSpan:2,sx:{py:1,fontSize:"0.875rem",border:"none",textAlign:"center",color:"text.secondary"},children:"No financial data available for this period"})})]})})})]})})},H.date||P))}),e.jsxs(g,{sx:{mt:4},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Trend Analysis"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Ks,{data:G.slice(0,5).reverse().map(H=>{const P=H.items,D=P&&Object.keys(P).length>0?Object.entries(P)[0]:null;return{year:H.date?new Date(H.date).getFullYear():"N/A",value:D&&Number(D[1])||0,name:D?D[0]:"N/A"}}),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"year"}),e.jsx(ht,{}),e.jsx(tt,{formatter:(H,P)=>H==null||isNaN(H)?["N/A","Value"]:[ge(H,0),"Value"]}),e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:"#1976d2",strokeWidth:2})]})})]})]})})}return e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[$,e.jsxs(g,{sx:{ml:1},children:[F," - ",t]})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(y,{container:!0,spacing:3,children:q.slice(0,5).map((re,G)=>e.jsx(y,{item:!0,xs:12,md:6,lg:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{sx:{p:2},children:[e.jsx(d,{variant:"subtitle1",sx:{fontWeight:"bold",mb:2},children:re.date?new Date(re.date).getFullYear():"N/A"}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[re.items&&Object.entries(re.items).slice(0,10).map(([H,P])=>e.jsxs(V,{children:[e.jsx(f,{sx:{py:.5,fontSize:"0.875rem",border:"none"},children:H.replace(/([A-Z])/g," $1").trim()}),e.jsx(f,{align:"right",sx:{py:.5,fontSize:"0.875rem",fontWeight:"bold",border:"none"},children:P||P===0?ge(P,0):"N/A"})]},H)),!re.items&&e.jsx(V,{children:e.jsx(f,{colSpan:2,sx:{py:1,fontSize:"0.875rem",border:"none",textAlign:"center",color:"text.secondary"},children:"No financial data available for this period"})})]})})})]})})},re.date||G))}),e.jsxs(g,{sx:{mt:4},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Trend Analysis"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Ks,{data:q.slice(0,5).reverse().map(re=>{const G=re.items,H=G&&Object.keys(G).length>0?Object.entries(G)[0]:null;return{year:re.date?new Date(re.date).getFullYear():"N/A",value:H&&Number(H[1])||0,name:H?H[0]:"N/A"}}),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"year"}),e.jsx(ht,{}),e.jsx(tt,{formatter:(re,G)=>re==null||isNaN(re)?["N/A","Value"]:[ge(re,0),"Value"]}),e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:"#1976d2",strokeWidth:2})]})})]})]})})};return e.jsx(lt,{maxWidth:"xl",children:e.jsxs(g,{sx:{py:3},children:[e.jsxs(g,{sx:{mb:4},children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:"primary.main"},children:"📊 Financial Data Analysis"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",sx:{mb:3},children:"Comprehensive financial statements, earnings data, and institutional-grade fundamental analysis"})]}),e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(hu,{options:m,getOptionLabel:W=>`${W.ticker} - ${W.short_name||W.ticker}`,value:m.find(W=>W.ticker===t)||null,onChange:(W,F)=>{F&&s(F.ticker)},renderInput:W=>e.jsx(_e,{...W,label:"Select Company",placeholder:"Search companies...",InputProps:{...W.InputProps,startAdornment:e.jsx(ar,{sx:{mr:1,color:"text.secondary"}})}}),renderOption:(W,F)=>e.jsx(g,{component:"li",...W,children:e.jsxs(g,{children:[e.jsx(d,{variant:"body2",sx:{fontWeight:"bold"},children:F.ticker}),e.jsx(d,{variant:"caption",color:"text.secondary",children:F.short_name})]})})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(iS,{value:l,exclusive:!0,onChange:x,size:"small",children:[e.jsx(Gc,{value:"annual",children:"Annual"}),e.jsx(Gc,{value:"quarterly",children:"Quarterly"}),e.jsx(Gc,{value:"ttm",children:"TTM"})," "]})})]})})})," ",e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:a,onChange:p,children:[e.jsx(it,{value:0,label:"Balance Sheet",icon:e.jsx(Fs,{})}),e.jsx(it,{value:1,label:"Income Statement",icon:e.jsx(xr,{})}),e.jsx(it,{value:2,label:"Cash Flow",icon:e.jsx(Lt,{})}),e.jsx(it,{value:3,label:"Key Metrics",icon:e.jsx(Gt,{})})]})}),e.jsx(Lo,{value:a,index:0,children:w?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):C?e.jsxs(we,{severity:"error",children:["Failed to load balance sheet: ",C.message]}):L(b,"Balance Sheet",e.jsx(Fs,{}))}),e.jsx(Lo,{value:a,index:1,children:_?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):R?e.jsxs(we,{severity:"error",children:["Failed to load income statement: ",R.message]}):L(A,"Income Statement",e.jsx(xr,{}))}),e.jsx(Lo,{value:a,index:2,children:T?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):M?e.jsxs(we,{severity:"error",children:["Failed to load cash flow: ",M.message]}):L(E,"Cash Flow Statement",e.jsx(Lt,{}))}),e.jsx(Lo,{value:a,index:3,children:N?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):k?e.jsxs(we,{severity:"error",children:["Failed to load key metrics: ",k.message]}):S(I)})]})})}const an={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"};var hd={};function Fo(r){return r&&typeof r=="object"&&!Array.isArray(r)}function kC(){const[r,t]=j.useState({}),[s,n]=j.useState({}),[i,a]=j.useState(!1),[o,l]=j.useState(null),[c,h]=j.useState(!1),u=j.useMemo(()=>{try{return qu()}catch(G){return console.error("Error getting diagnostic info:",G),{}}},[]);j.useMemo(()=>{try{return Xt()}catch(G){return console.error("Error getting API config:",G),{}}},[]),j.useMemo(()=>{try{return bc()}catch(G){return console.error("Error getting current base URL:",G),""}},[]),j.useEffect(()=>{const G=H=>{console.error("ServiceHealth component error:",H.error),l(H.error.message)};return window.addEventListener("error",G),()=>window.removeEventListener("error",G)},[]);const{data:m,isLoading:p,error:x,refetch:b}=Qe({queryKey:["ecsTasks"],queryFn:async()=>{try{const P=await(await fetch("https://qda42av7je.execute-api.us-east-1.amazonaws.com/dev/api/health/ecs-tasks",{method:"GET",headers:{"Content-Type":"application/json"}})).json();return P?.success,P}catch(G){return console.error("ECS tasks check failed:",G),{error:!0,message:G.message||"Unknown ECS tasks error",timestamp:new Date().toISOString()}}},refetchInterval:6e4,retry:1,staleTime:3e4,enabled:!0,onError:G=>{console.error("React Query ECS tasks error:",G)}}),{data:w,isLoading:C,error:A,refetch:_}=Qe({queryKey:["databaseHealth"],queryFn:async()=>{try{const G=await le.get("/health/database",{timeout:6e4,validateStatus:P=>P<500}),H=G?.data?.success?G?.data.data:G?.data;if(H&&typeof H=="object")return H;throw new Error("Invalid response structure from database health endpoint")}catch(G){return console.error("Database health check failed:",G),console.error("Error details:",{message:G.message,response:G.response?.data,status:G.response?.status}),{error:!0,message:G.message||"Unknown database health error",details:G.response?.data||G.response?.status||"No additional details",timestamp:new Date().toISOString(),database:{status:"error",currentTime:new Date().toISOString(),postgresVersion:"unknown",tables:{},summary:{total_tables:0,healthy_tables:0,stale_tables:0,empty_tables:0,error_tables:1,missing_tables:0,total_records:0,total_missing_data:0}}}}},refetchInterval:!1,retry:1,staleTime:3e4,enabled:!0,onError:G=>{console.error("React Query database health error:",G)}}),R=j.useMemo(()=>[{name:"Health Check",fn:()=>Hu()},{name:"API Connection",fn:()=>Qu()},{name:"Stocks",fn:()=>vc({limit:5})},{name:"Technical Data",fn:()=>Sc("daily",{limit:5})},{name:"Market Overview",fn:()=>ho()},{name:"Stock Screener",fn:()=>wc({limit:5})},{name:"Buy Signals",fn:()=>Fu()},{name:"Sell Signals",fn:()=>Nu()},{name:"NAAIM Data",fn:()=>Bu({limit:5})},{name:"Fear & Greed",fn:()=>Uu({limit:5})}],[]),E=j.useCallback(async()=>{a(!0);const G={};for(const H of R)try{const P=Date.now();await Promise.race([H.fn(),new Promise((Y,ce)=>setTimeout(()=>ce(new Error("Timeout")),1e4))]);const D=Date.now();G[H.name]={status:"success",response:"OK",responseTime:D-P,critical:H.critical}}catch(P){console.error(`❌ ${H.name} failed:`,P),G[H.name]={status:"error",error:P.message||"Unknown error",responseTime:0,critical:H.critical}}n(G),a(!1)},[R]),{data:T,isLoading:M,error:I,refetch:N}=Qe({queryKey:["serviceHealth"],queryFn:async()=>{try{return(await le.get("/health"))?.data}catch(G){throw console.error("Service health error:",G),G}},refetchInterval:!1,retry:1,staleTime:3e4,enabled:!0});j.useEffect(()=>{E()},[E]),j.useEffect(()=>{const G={Frontend:{API_URL:hd.REACT_APP_API_URL||"Not set",Environment:"production",Build_Time:hd.REACT_APP_BUILD_TIME||"Unknown",Version:hd.REACT_APP_VERSION||"1.0.0"},Browser:{User_Agent:navigator.userAgent,Language:navigator.language,Platform:navigator.platform,Online:navigator.onLine,Cookies_Enabled:navigator.cookieEnabled},Runtime:{React_Version:gn.version,Timestamp:new Date().toISOString(),Timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}};t(G)},[]);const k=Fo(T)?T:{},S=Fo(w)?w:{},L=Fo(s)?s:{},W=Fo(u)?u:{},F=G=>{switch(G){case"success":return e.jsx(Yr,{color:"success"});case"error":return e.jsx(Vr,{color:"error"});case"warning":return e.jsx(Ar,{color:"warning"});default:return e.jsx(Es,{})}};if(o)return e.jsx(lt,{maxWidth:"lg",sx:{py:4},children:e.jsxs(we,{severity:"error",children:[e.jsx(d,{variant:"h6",children:"Service Health Error"}),e.jsx(d,{variant:"body2",children:o}),e.jsx(oe,{onClick:()=>window.location.reload(),sx:{mt:2},children:"Reload Page"})]})});const $=async()=>{try{h(!0),await _()}catch(G){console.error("Failed to refresh health status:",G)}finally{h(!1)}},q=G=>{switch(G){case"success":case"healthy":case"connected":return"success";case"error":case"failed":case"disconnected":return"error";case"warning":case"stale":case"incomplete":return"warning";case"empty":return"info";default:return"default"}},ne=G=>G==null?"N/A":new Intl.NumberFormat().format(G),he=G=>G?new Date(G).toLocaleString():"N/A",re=G=>{if(!G)return"N/A";const H=new Date,P=new Date(G),D=H-P,Y=Math.floor(D/(1e3*60*60)),ce=Math.floor(Y/24);if(ce>0)return`${ce} day${ce>1?"s":""} ago`;if(Y>0)return`${Y} hour${Y>1?"s":""} ago`;{const ae=Math.floor(D/6e4);return`${ae} minute${ae>1?"s":""} ago`}};return e.jsxs(lt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"Service Health Dashboard"}),e.jsx(d,{variant:"subtitle1",color:"textSecondary",children:"Monitor system status, API health, and data integrity"})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[M?e.jsx(Je,{}):I?e.jsxs(e.Fragment,{children:[e.jsx(Vr,{color:"error",sx:{fontSize:40,mb:1}}),e.jsx(d,{variant:"h6",color:"error",children:"Service Down"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{color:"success",sx:{fontSize:40,mb:1}}),e.jsx(d,{variant:"h6",color:"success.main",children:"Service Healthy"})]}),e.jsx(oe,{variant:"outlined",size:"small",startIcon:e.jsx(Es,{}),onClick:N,sx:{mt:1},disabled:c,children:c?"Refreshing...":"Refresh Health Status"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Jd,{sx:{fontSize:40,mb:1,color:"primary.main"}}),e.jsx(d,{variant:"h6",children:"API Gateway"}),e.jsx(d,{variant:"body2",color:"textSecondary",children:W?.isConfigured?"Configured":"Not Configured"}),e.jsx(d,{variant:"caption",display:"block",sx:{mt:1},children:W?.urlsMatch?"URLs Match":"URL Mismatch"})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(eh,{sx:{fontSize:40,mb:1,color:"primary.main"}}),e.jsx(d,{variant:"h6",children:"Database"}),e.jsx(d,{variant:"body2",color:"textSecondary",children:C?"Checking...":A?"Error":S?.database?.status==="connected"?"Connected":S?.database?.status==="disconnected"?"Disconnected":S?.error?"Error":"Unknown"}),A&&e.jsxs(we,{severity:"error",sx:{mt:2},children:[e.jsx(d,{variant:"subtitle2",children:"Failed to load database health:"}),e.jsx(d,{variant:"body2",sx:{wordBreak:"break-all"},children:typeof A=="string"?A:A?.message||"Unknown error"})]}),S?.error&&e.jsxs(we,{severity:"error",sx:{mt:2},children:[e.jsx(d,{variant:"subtitle2",children:"Database Error:"}),e.jsx(d,{variant:"body2",sx:{wordBreak:"break-all"},children:S.message||"Unknown error"})]})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Hf,{sx:{fontSize:40,mb:1,color:"primary.main"}}),e.jsx(d,{variant:"h6",children:"Environment"}),e.jsx(d,{variant:"body2",color:"textSecondary",children:(()=>{const G=an&&"production"||"";return G.toLowerCase().startsWith("prod")?"Production":G.toLowerCase().startsWith("stag")?"Staging":G.toLowerCase().startsWith("dev")?"Development":G?G.charAt(0).toUpperCase()+G.slice(1):"Production"})()}),e.jsx(d,{variant:"caption",display:"block",sx:{mt:1},title:an&&"http://localhost:5001"||"",children:an?"API: http://localhost:5001":""})]})})})]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsxs(d,{variant:"h6",children:[e.jsx(Jd,{sx:{mr:1,verticalAlign:"middle"}}),"API Health"]})}),e.jsxs(os,{children:[k&&e.jsxs(g,{children:[e.jsxs(d,{variant:"subtitle2",gutterBottom:!0,children:["Status: ",k.status]}),e.jsxs(d,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Last Updated:"," ",new Date(k.timestamp).toLocaleString()]}),k.api&&e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"subtitle2",children:"API Information:"}),e.jsxs(d,{variant:"body2",children:["Version: ",k.api.version]}),e.jsxs(d,{variant:"body2",children:["Environment: ",k.api.environment]})]})]}),e.jsx(g,{sx:{mt:2},children:e.jsx(oe,{variant:"outlined",size:"small",startIcon:e.jsx(xn,{}),onClick:E,disabled:i,children:i?"Testing...":"Test All Endpoints"})}),Object.keys(L).length>0&&e.jsx(Ae,{component:He,sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Endpoint"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Response Time"}),e.jsx(f,{children:"Error"})]})}),e.jsx(ke,{children:Object.entries(L).map(([G,H])=>e.jsxs(V,{children:[e.jsx(f,{children:G}),e.jsx(f,{children:e.jsx(X,{icon:F(H?.status),label:H?.status||"Unknown",color:q(H?.status),size:"small"})}),e.jsx(f,{children:H.responseTime?`${H.responseTime}ms`:"-"}),e.jsx(f,{children:H.error||"-"})]},G))})]})})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsxs(d,{variant:"h6",children:[e.jsx(Hf,{sx:{mr:1,verticalAlign:"middle"}}),"Scheduled Tasks Status"]})}),e.jsxs(os,{children:[e.jsx(g,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:e.jsx(oe,{variant:"outlined",size:"small",startIcon:e.jsx(Es,{}),onClick:()=>b(),children:"Refresh"})}),p&&e.jsxs(g,{sx:{display:"flex",justifyContent:"center",p:2},children:[e.jsx(Je,{size:24}),e.jsx(d,{sx:{ml:2},children:"Loading scheduled tasks status..."})]}),x&&e.jsxs(we,{severity:"error",sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",children:"Failed to load ECS tasks status:"}),e.jsx(d,{variant:"body2",sx:{wordBreak:"break-all"},children:typeof x=="string"?x:x?.message||"Unknown error"})]}),!p&&!x&&m&&m.tasks&&e.jsx(Ae,{component:He,children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Task Name"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Last Run"}),e.jsx(f,{children:"Freshness"}),e.jsx(f,{children:"Details"})]})}),e.jsx(ke,{children:Object.entries(m.tasks).map(([G,H])=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:G})}),e.jsx(f,{children:e.jsx(X,{icon:H.status==="success"?e.jsx(Yr,{}):H.status==="failure"?e.jsx(Vr,{}):H.status==="never_run"?e.jsx(lo,{}):e.jsx(Ar,{}),label:H.status||"unknown",color:H.status==="success"?"success":H.status==="failure"?"error":H.status==="never_run"?"default":"warning",size:"small"})}),e.jsx(f,{children:H.last_run?e.jsx(tt,{title:new Date(H.last_run).toLocaleString(),children:e.jsx(d,{variant:"body2",children:H.hours_since_run!==void 0?`${H.hours_since_run}h ago`:new Date(H.last_run).toLocaleDateString()})}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"Never"})}),e.jsx(f,{children:H.freshness&&e.jsx(X,{label:H.freshness,color:H.freshness==="current"?"success":H.freshness==="warning"?"warning":"error",size:"small"})}),e.jsx(f,{children:H.error_message?e.jsx(tt,{title:H.error_message,children:e.jsxs(d,{variant:"body2",color:"error",noWrap:!0,children:[H.error_message.substring(0,50),"..."]})}):H.message?e.jsx(d,{variant:"body2",color:"text.secondary",children:H.message}):H.exit_code!==null&&H.exit_code!==void 0?e.jsxs(d,{variant:"body2",children:["Exit code: ",H.exit_code]}):"-"})]},G))})]})}),!p&&!x&&(!m||!m.tasks||Object.keys(m.tasks).length===0)&&e.jsxs(we,{severity:"info",children:[e.jsx(d,{variant:"subtitle2",children:"No scheduled tasks configured"}),e.jsx(d,{variant:"body2",children:"Configure scheduled tasks in GitHub Actions workflows or AWS EventBridge."})]})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(is,{defaultExpanded:!0,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsxs(d,{variant:"h6",children:[e.jsx(eh,{sx:{mr:1,verticalAlign:"middle"}}),"Database Health"]})}),e.jsxs(os,{children:[e.jsx(g,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:e.jsx(oe,{variant:"outlined",size:"small",startIcon:e.jsx(Es,{}),onClick:$,disabled:c,children:c?"Updating...":"Update All Tables"})}),C&&e.jsxs(g,{sx:{display:"flex",justifyContent:"center",p:2},children:[e.jsx(Je,{size:24}),e.jsx(d,{sx:{ml:2},children:"Loading database health..."})]}),A&&e.jsxs(we,{severity:"error",sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",children:"Failed to load database health:"}),e.jsx(d,{variant:"body2",sx:{wordBreak:"break-all"},children:typeof A=="string"?A:A?.message||"Unknown error"})]}),S&&e.jsxs(g,{children:[e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Database Status:"}),e.jsxs(d,{variant:"body2",children:["Status: ",S.database?.status||"Unknown"]}),S.database?.currentTime&&e.jsxs(d,{variant:"body2",children:["Current Time:"," ",new Date(S.database.currentTime).toLocaleString()]}),S.database?.postgresVersion&&e.jsxs(d,{variant:"body2",children:["PostgreSQL Version:"," ",S.database.postgresVersion]})]}),S.error||S.message||S.details?e.jsxs(we,{severity:"error",sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",children:"Backend Error:"}),S.error&&e.jsxs(d,{variant:"body2",sx:{wordBreak:"break-all"},children:[e.jsx("b",{children:"Error:"})," ",S.error]}),S.message&&e.jsxs(d,{variant:"body2",sx:{wordBreak:"break-all"},children:[e.jsx("b",{children:"Message:"})," ",S.message]}),S.details&&e.jsxs(d,{variant:"body2",sx:{wordBreak:"break-all"},children:[e.jsx("b",{children:"Details:"})," ",S.details]})]}):null,S.database?.summary&&e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Summary:"}),e.jsxs(y,{container:!0,spacing:1,children:[e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Total Tables:"," ",S.database.summary.total_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"success.main",children:["Healthy:"," ",S.database.summary.healthy_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Stale: ",S.database.summary.stale_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"error.main",children:["Errors: ",S.database.summary.error_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"info.dark",children:["Empty: ",S.database.summary.empty_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Missing:"," ",S.database.summary.missing_tables]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Total Records:"," ",ne(S.database.summary.total_records)]})}),e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Missing Data:"," ",ne(S.database.summary.total_missing_data)]})})]})]}),S.database?.tables&&Object.keys(S.database.tables).length>0&&e.jsxs(g,{sx:{mt:2},children:[e.jsxs(d,{variant:"subtitle2",gutterBottom:!0,children:["Table Details (",Object.keys(S.database.tables).length," ","tables monitored):"]}),e.jsx(Ae,{component:He,sx:{maxHeight:600},children:e.jsxs(Oe,{size:"small",stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Table"}),e.jsx(f,{align:"right",children:"Records"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Last Updated"}),e.jsx(f,{children:"Missing Data"}),e.jsx(f,{children:"Last Checked"}),e.jsx(f,{children:"Error"})]})}),e.jsx(ke,{children:Object.entries(S.database.tables).sort(([G],[H])=>G.localeCompare(H)).map(([G,H])=>e.jsxs(V,{sx:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[e.jsx(f,{component:"th",scope:"row",children:e.jsx(d,{variant:"body2",fontFamily:"monospace",fontWeight:600,children:G})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:600,children:ne(H.record_count)})}),e.jsx(f,{children:e.jsxs(g,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[e.jsx(X,{icon:F(H.status),label:H.status,color:q(H.status),size:"small",sx:{minWidth:80}}),H.is_stale&&e.jsx(X,{label:"Stale",color:"warning",size:"small"})]})}),e.jsx(f,{children:e.jsxs(g,{children:[e.jsx(d,{variant:"body2",children:he(H.last_updated)}),e.jsx(d,{variant:"caption",color:"text.secondary",children:re(H.last_updated)})]})}),e.jsx(f,{align:"right",children:H.missing_data_count>0?e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:600,children:ne(H.missing_data_count)}):e.jsx(d,{variant:"body2",color:"success.main",children:"0"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:he(H.last_checked)})}),e.jsx(f,{children:H.error&&e.jsx(tt,{title:H.error,children:e.jsx(d,{variant:"body2",color:"error",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",cursor:"help"},children:H.error.length>30?`${H.error.substring(0,30)}...`:H.error})})})]},G))})]})})]}),(!S.database?.tables||Object.keys(S.database.tables).length===0)&&e.jsxs(we,{severity:"warning",sx:{mt:2},children:[e.jsx(d,{variant:"subtitle2",children:"No table data found"}),e.jsx(d,{variant:"body2",children:"The database health check did not return any table information. This could mean the health_status table is empty or the backend is not properly configured."})]}),S.database?.note&&e.jsx(we,{severity:"info",sx:{mt:2},children:S.database.note})]})]})]})})]})]})}function CC(){const{symbol:r}=Wx(),t=On(),[s,n]=j.useState([]),[i,a]=j.useState(!1),[o,l]=j.useState(null),[c,h]=j.useState(0),[u,m]=j.useState(0),[p,x]=j.useState(25),[b,w]=j.useState(""),[C,A]=j.useState("daily"),[_,R]=j.useState(""),[E,T]=j.useState(""),[M,I]=j.useState(0),[N,k]=j.useState("table"),[S,L]=j.useState(!1),[W,F]=j.useState({rsi_min:"",rsi_max:"",macd_min:"",macd_max:"",sma_min:"",sma_max:""}),[$,q]=j.useState({price_min:"",price_max:"",volume_min:"",volume_max:""}),[ne,he]=j.useState({date:!0,close:!0,volume:!0,rsi:!0,macd:!0,sma_20:!0,sma_50:!0,ema_12:!0,bollinger_middle:!1,stochastic_k:!1,adx:!1,atr:!1}),re={price:[{id:"date",label:"Date",format:Aa},{id:"open",label:"Open",format:ge},{id:"high",label:"High",format:ge},{id:"low",label:"Low",format:ge},{id:"close",label:"Close",format:ge},{id:"volume",label:"Volume",format:B=>Me(B,0)}],momentum:[{id:"rsi",label:"RSI",format:B=>Me(B,2)},{id:"macd",label:"MACD",format:B=>Me(B,4)},{id:"macd_signal",label:"MACD Signal",format:B=>Me(B,4)},{id:"stochastic_k",label:"Stoch %K",format:B=>Me(B,2)},{id:"stochastic_d",label:"Stoch %D",format:B=>Me(B,2)},{id:"williams_r",label:"Williams %R",format:B=>Me(B,2)},{id:"cci",label:"CCI",format:B=>Me(B,2)},{id:"momentum",label:"Momentum",format:B=>Me(B,2)},{id:"roc",label:"ROC",format:B=>Me(B,2)}],trend:[{id:"sma_20",label:"SMA 20",format:ge},{id:"sma_50",label:"SMA 50",format:ge},{id:"ema_12",label:"EMA 12",format:ge},{id:"ema_26",label:"EMA 26",format:ge},{id:"adx",label:"ADX",format:B=>Me(B,2)}],volatility:[{id:"bollinger_upper",label:"BB Upper",format:ge},{id:"bollinger_middle",label:"BB Middle",format:ge},{id:"bollinger_lower",label:"BB Lower",format:ge},{id:"atr",label:"ATR",format:B=>Me(B,4)}],volume:[{id:"obv",label:"OBV",format:B=>Me(B,0)},{id:"mfi",label:"MFI",format:B=>Me(B,2)},{id:"ad",label:"A/D",format:B=>Me(B,0)},{id:"cmf",label:"CMF",format:B=>Me(B,4)}]},G=Object.values(re).flat(),H=j.useMemo(()=>G.filter(B=>ne[B.id]),[ne]),P=async()=>{if(r){a(!0),l(null);try{const B={symbol:r.toUpperCase(),page:u+1,limit:p,start_date:_||void 0,end_date:E||void 0,...Object.fromEntries(Object.entries($).filter(([je,xe])=>xe!==""))};console.log("🔍 Fetching price history:",{timeframe:C,params:B});const pe=await nj(C,B);pe&&pe?.data?(n(pe?.data),h(pe.pagination?.total||0)):(n([]),h(0))}catch(B){l(B.message||"Failed to load price history"),n([]),h(0)}finally{a(!1)}}};j.useEffect(()=>{P()},[r,C,u,p,_,E,$]);const D=j.useMemo(()=>b?s.filter(B=>Object.values(B).some(pe=>String(pe).toLowerCase().includes(b.toLowerCase()))):s,[s,b]),Y=(B,pe)=>m(pe),ce=B=>{x(parseInt(B.target.value,10)),m(0)},ae=(B,pe)=>{I(pe)},ee=B=>{A(B.target.value),m(0)},te=(B,pe)=>{q(je=>({...je,[B]:pe})),m(0)},Pe=()=>{R(""),T(""),w(""),q({price_min:"",price_max:"",volume_min:"",volume_max:""}),m(0)},Be=B=>{he(pe=>({...pe,[B]:!pe[B]}))},et=()=>{if(!D?.length)return;const B=(H||[]).map(Q=>Q.label).join(","),pe=D.map(Q=>H.map(Z=>{const K=Q[Z.id];return Z.format?Z.format(K):K||""}).join(",")).join(`
`),je=`${B}
${pe}`,xe=new Blob([je],{type:"text/csv"}),v=URL.createObjectURL(xe),ie=document.createElement("a");ie.href=v,ie.download=`${r}_${C}_price_history.csv`,ie.click(),URL.revokeObjectURL(v)},De=()=>{if(!s?.length)return null;const B=s[0],pe=s.length>1?B.close-s[1].close:0,je=s.length>1?pe/s[1].close*100:0,xe=[{label:"Latest Close",value:ge(B.close),color:"primary"},{label:"Day Change",value:`${pe>=0?"+":""}${ge(pe)}`,color:pe>=0?"success":"error"},{label:"Day Change %",value:`${je>=0?"+":""}${je.toFixed(2)}%`,color:je>=0?"success":"error"},{label:"Volume",value:Me(B.volume,0),color:"info"}];return e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Latest Data (",Aa(B.date),")"]}),e.jsx(y,{container:!0,spacing:2,children:(xe||[]).map((v,ie)=>e.jsx(y,{item:!0,xs:6,sm:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h6",color:`${v.color}.main`,children:v.value}),e.jsx(d,{variant:"body2",color:"text.secondary",children:v.label})]})},ie))})]})})},ze=()=>e.jsxs(He,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(g,{sx:{overflowX:"auto"},children:e.jsxs(Oe,{stickyHeader:!0,size:"small",children:[e.jsx(Ve,{children:e.jsx(V,{children:(H||[]).map(B=>e.jsx(f,{sx:{fontWeight:"bold",minWidth:100},children:B.label},B.id))})}),e.jsx(ke,{children:(D||[]).map((B,pe)=>e.jsx(V,{hover:!0,children:(H||[]).map(je=>{const xe=B[je.id];return e.jsx(f,{align:typeof xe=="number"?"right":"left",children:je.format?je.format(xe):xe||"N/A"},je.id)})},`${B.date}-${pe}`))})]})}),e.jsx(yn,{component:"div",count:c,page:u,onPageChange:Y,rowsPerPage:p,onRowsPerPageChange:ce,rowsPerPageOptions:[10,25,50,100]})]}),ve=()=>e.jsxs(g,{children:[e.jsx(y,{container:!0,spacing:2,children:(D||[]).map((B,pe)=>e.jsx(y,{item:!0,xs:12,sm:6,md:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:Aa(B.date)}),e.jsxs(Or,{spacing:1,children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Close:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:ge(B.close)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Volume:"}),e.jsx(d,{variant:"body2",children:Me(B.volume,0)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Open:"}),e.jsx(d,{variant:"body2",children:ge(B.open)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"High:"}),e.jsx(d,{variant:"body2",color:"success.main",children:ge(B.high)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Low:"}),e.jsx(d,{variant:"body2",color:"error.main",children:ge(B.low)})]})]})]})})},`${B.date}-${pe}`))}),e.jsx(g,{display:"flex",justifyContent:"center",mt:3,children:e.jsx(yn,{component:"div",count:c,page:u,onPageChange:Y,rowsPerPage:p,onRowsPerPageChange:ce,rowsPerPageOptions:[6,12,24,48]})})]});return e.jsxs(lt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Ge,{onClick:()=>t(-1),children:e.jsx(aS,{})}),e.jsxs(d,{variant:"h4",children:["Price History - ",r]})]}),e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(tt,{title:"Export Data",children:e.jsx("span",{children:e.jsx(Ge,{onClick:et,disabled:!s?.length,children:e.jsx(oS,{})})})}),e.jsx(tt,{title:"Toggle View",children:e.jsx(Ge,{onClick:()=>k(N==="table"?"cards":"table"),children:N==="table"?e.jsx(lS,{}):e.jsx(cS,{})})})]})]}),e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Timeframe"}),e.jsxs(pt,{value:C,onChange:ee,children:[e.jsx(J,{value:"daily",children:"Daily"}),e.jsx(J,{value:"weekly",children:"Weekly"}),e.jsx(J,{value:"monthly",children:"Monthly"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_e,{fullWidth:!0,size:"small",label:"Search",value:b,onChange:B=>w(B.target.value),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})}),endAdornment:b&&e.jsx(ts,{position:"end",children:e.jsx(Ge,{size:"small",onClick:()=>w(""),children:e.jsx(mn,{})})})}})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2,children:e.jsx(_e,{fullWidth:!0,size:"small",type:"date",label:"From Date",value:_,onChange:B=>R(B.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2,children:e.jsx(_e,{fullWidth:!0,size:"small",type:"date",label:"To Date",value:E,onChange:B=>T(B.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Tr,{}),onClick:()=>L(!S),size:"small",children:"Filters"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(mn,{}),onClick:Pe,size:"small",children:"Clear"})]})})]})})}),S&&e.jsxs(is,{expanded:S,children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{children:"Advanced Filters & Column Selection"})}),e.jsx(os,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Price & Volume Filters"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,children:e.jsx(_e,{fullWidth:!0,size:"small",label:"Min Price",type:"number",step:"0.01",value:$.price_min,onChange:B=>te("price_min",B.target.value)})}),e.jsx(y,{item:!0,xs:6,children:e.jsx(_e,{fullWidth:!0,size:"small",label:"Max Price",type:"number",step:"0.01",value:$.price_max,onChange:B=>te("price_max",B.target.value)})}),e.jsx(y,{item:!0,xs:6,children:e.jsx(_e,{fullWidth:!0,size:"small",label:"Min Volume",type:"number",value:$.volume_min,onChange:B=>te("volume_min",B.target.value)})}),e.jsx(y,{item:!0,xs:6,children:e.jsx(_e,{fullWidth:!0,size:"small",label:"Max Volume",type:"number",value:$.volume_max,onChange:B=>te("volume_max",B.target.value)})})]})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Visible Columns"}),e.jsx(Ir,{value:M,onChange:ae,variant:"scrollable",children:Object.keys(re).map((B,pe)=>e.jsx(it,{value:pe,label:B.charAt(0).toUpperCase()+B.slice(1)},B))}),e.jsx(g,{sx:{mt:2,maxHeight:200,overflow:"auto"},children:Object.entries(re).map(([B,pe],je)=>M===je&&e.jsx(y,{container:!0,spacing:1,children:(pe||[]).map(xe=>e.jsx(y,{item:!0,xs:6,children:e.jsx(Jt,{control:e.jsx(rs,{checked:ne[xe.id]||!1,onChange:()=>Be(xe.id),size:"small"}),label:xe.label})},xe.id))},B))})]})]})})]}),De(),i?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400,children:e.jsx(Je,{size:60})}):o?e.jsxs(we,{severity:"error",sx:{mb:3},children:[o,e.jsx(oe,{onClick:P,sx:{ml:2},children:"Retry"})]}):s?.length?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Showing ",D?.length||0," of ",c," records"]}),N==="table"?ze():ve()]}):e.jsxs(we,{severity:"info",children:["No technical data found for ",r," in the ",C," timeframe."]})]})}let mh=[],Zj=[];(()=>{let r="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(t=>t?parseInt(t,36):1);for(let t=0,s=0;t<r.length;t++)(t%2?Zj:mh).push(s=s+r[t])})();function AC(r){if(r<768)return!1;for(let t=0,s=mh.length;;){let n=t+s>>1;if(r<mh[n])s=n;else if(r>=Zj[n])t=n+1;else return!0;if(t==s)return!1}}function Fm(r){return r>=127462&&r<=127487}const Nm=8205;function TC(r,t,s=!0,n=!0){return(s?Jj:PC)(r,t,n)}function Jj(r,t,s){if(t==r.length)return t;t&&eb(r.charCodeAt(t))&&tb(r.charCodeAt(t-1))&&t--;let n=ud(r,t);for(t+=Wm(n);t<r.length;){let i=ud(r,t);if(n==Nm||i==Nm||s&&AC(i))t+=Wm(i),n=i;else if(Fm(i)){let a=0,o=t-2;for(;o>=0&&Fm(ud(r,o));)a++,o-=2;if(a%2==0)break;t+=2}else break}return t}function PC(r,t,s){for(;t>0;){let n=Jj(r,t-2,s);if(n<t)return n;t--}return 0}function ud(r,t){let s=r.charCodeAt(t);if(!tb(s)||t+1==r.length)return s;let n=r.charCodeAt(t+1);return eb(n)?(s-55296<<10)+(n-56320)+65536:s}function eb(r){return r>=56320&&r<57344}function tb(r){return r>=55296&&r<56320}function Wm(r){return r<65536?1:2}class wt{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,s,n){[t,s]=Ki(this,t,s);let i=[];return this.decompose(0,t,i,2),n.length&&n.decompose(0,n.length,i,3),this.decompose(s,this.length,i,1),zr.from(i,this.length-(s-t)+n.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,s=this.length){[t,s]=Ki(this,t,s);let n=[];return this.decompose(t,s,n,0),zr.from(n,s-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let s=this.scanIdentical(t,1),n=this.length-this.scanIdentical(t,-1),i=new Ta(this),a=new Ta(t);for(let o=s,l=s;;){if(i.next(o),a.next(o),o=0,i.lineBreak!=a.lineBreak||i.done!=a.done||i.value!=a.value)return!1;if(l+=i.value.length,i.done||l>=n)return!0}}iter(t=1){return new Ta(this,t)}iterRange(t,s=this.length){return new sb(this,t,s)}iterLines(t,s){let n;if(t==null)n=this.iter();else{s==null&&(s=this.lines+1);let i=this.line(t).from;n=this.iterRange(i,Math.max(i,s==this.lines+1?this.length:s<=1?0:this.line(s-1).to))}return new rb(n)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?wt.empty:t.length<=32?new es(t):zr.from(es.split(t,[]))}}class es extends wt{constructor(t,s=_C(t)){super(),this.text=t,this.length=s}get lines(){return this.text.length}get children(){return null}lineInner(t,s,n,i){for(let a=0;;a++){let o=this.text[a],l=i+o.length;if((s?n:l)>=t)return new EC(i,l,n,o);i=l+1,n++}}decompose(t,s,n,i){let a=t<=0&&s>=this.length?this:new es($m(this.text,t,s),Math.min(s,this.length)-Math.max(0,t));if(i&1){let o=n.pop(),l=xl(a.text,o.text.slice(),0,a.length);if(l.length<=32)n.push(new es(l,o.length+a.length));else{let c=l.length>>1;n.push(new es(l.slice(0,c)),new es(l.slice(c)))}}else n.push(a)}replace(t,s,n){if(!(n instanceof es))return super.replace(t,s,n);[t,s]=Ki(this,t,s);let i=xl(this.text,xl(n.text,$m(this.text,0,t)),s),a=this.length+n.length-(s-t);return i.length<=32?new es(i,a):zr.from(es.split(i,[]),a)}sliceString(t,s=this.length,n=`
`){[t,s]=Ki(this,t,s);let i="";for(let a=0,o=0;a<=s&&o<this.text.length;o++){let l=this.text[o],c=a+l.length;a>t&&o&&(i+=n),t<c&&s>a&&(i+=l.slice(Math.max(0,t-a),s-a)),a=c+1}return i}flatten(t){for(let s of this.text)t.push(s)}scanIdentical(){return 0}static split(t,s){let n=[],i=-1;for(let a of t)n.push(a),i+=a.length+1,n.length==32&&(s.push(new es(n,i)),n=[],i=-1);return i>-1&&s.push(new es(n,i)),s}}class zr extends wt{constructor(t,s){super(),this.children=t,this.length=s,this.lines=0;for(let n of t)this.lines+=n.lines}lineInner(t,s,n,i){for(let a=0;;a++){let o=this.children[a],l=i+o.length,c=n+o.lines-1;if((s?c:l)>=t)return o.lineInner(t,s,n,i);i=l+1,n=c+1}}decompose(t,s,n,i){for(let a=0,o=0;o<=s&&a<this.children.length;a++){let l=this.children[a],c=o+l.length;if(t<=c&&s>=o){let h=i&((o<=t?1:0)|(c>=s?2:0));o>=t&&c<=s&&!h?n.push(l):l.decompose(t-o,s-o,n,h)}o=c+1}}replace(t,s,n){if([t,s]=Ki(this,t,s),n.lines<this.lines)for(let i=0,a=0;i<this.children.length;i++){let o=this.children[i],l=a+o.length;if(t>=a&&s<=l){let c=o.replace(t-a,s-a,n),h=this.lines-o.lines+c.lines;if(c.lines<h>>4&&c.lines>h>>6){let u=this.children.slice();return u[i]=c,new zr(u,this.length-(s-t)+n.length)}return super.replace(a,l,c)}a=l+1}return super.replace(t,s,n)}sliceString(t,s=this.length,n=`
`){[t,s]=Ki(this,t,s);let i="";for(let a=0,o=0;a<this.children.length&&o<=s;a++){let l=this.children[a],c=o+l.length;o>t&&a&&(i+=n),t<c&&s>o&&(i+=l.sliceString(t-o,s-o,n)),o=c+1}return i}flatten(t){for(let s of this.children)s.flatten(t)}scanIdentical(t,s){if(!(t instanceof zr))return 0;let n=0,[i,a,o,l]=s>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;i+=s,a+=s){if(i==o||a==l)return n;let c=this.children[i],h=t.children[a];if(c!=h)return n+c.scanIdentical(h,s);n+=c.length+1}}static from(t,s=t.reduce((n,i)=>n+i.length+1,-1)){let n=0;for(let x of t)n+=x.lines;if(n<32){let x=[];for(let b of t)b.flatten(x);return new es(x,s)}let i=Math.max(32,n>>5),a=i<<1,o=i>>1,l=[],c=0,h=-1,u=[];function m(x){let b;if(x.lines>a&&x instanceof zr)for(let w of x.children)m(w);else x.lines>o&&(c>o||!c)?(p(),l.push(x)):x instanceof es&&c&&(b=u[u.length-1])instanceof es&&x.lines+b.lines<=32?(c+=x.lines,h+=x.length+1,u[u.length-1]=new es(b.text.concat(x.text),b.length+1+x.length)):(c+x.lines>i&&p(),c+=x.lines,h+=x.length+1,u.push(x))}function p(){c!=0&&(l.push(u.length==1?u[0]:zr.from(u,h)),h=-1,c=u.length=0)}for(let x of t)m(x);return p(),l.length==1?l[0]:new zr(l,s)}}wt.empty=new es([""],0);function _C(r){let t=-1;for(let s of r)t+=s.length+1;return t}function xl(r,t,s=0,n=1e9){for(let i=0,a=0,o=!0;a<r.length&&i<=n;a++){let l=r[a],c=i+l.length;c>=s&&(c>n&&(l=l.slice(0,n-i)),i<s&&(l=l.slice(s-i)),o?(t[t.length-1]+=l,o=!1):t.push(l)),i=c+1}return t}function $m(r,t,s){return xl(r,[""],t,s)}class Ta{constructor(t,s=1){this.dir=s,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[s>0?1:(t instanceof es?t.text.length:t.children.length)<<1]}nextInner(t,s){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,i=this.nodes[n],a=this.offsets[n],o=a>>1,l=i instanceof es?i.text.length:i.children.length;if(o==(s>0?l:0)){if(n==0)return this.done=!0,this.value="",this;s>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop()}else if((a&1)==(s>0?0:1)){if(this.offsets[n]+=s,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(i instanceof es){let c=i.text[o+(s<0?-1:0)];if(this.offsets[n]+=s,c.length>Math.max(0,t))return this.value=t==0?c:s>0?c.slice(t):c.slice(0,c.length-t),this;t-=c.length}else{let c=i.children[o+(s<0?-1:0)];t>c.length?(t-=c.length,this.offsets[n]+=s):(s<0&&this.offsets[n]--,this.nodes.push(c),this.offsets.push(s>0?1:(c instanceof es?c.text.length:c.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class sb{constructor(t,s,n){this.value="",this.done=!1,this.cursor=new Ta(t,s>n?-1:1),this.pos=s>n?t.length:0,this.from=Math.min(s,n),this.to=Math.max(s,n)}nextInner(t,s){if(s<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,s<0?this.pos-this.to:this.from-this.pos);let n=s<0?this.pos-this.from:this.to-this.pos;t>n&&(t=n),n-=t;let{value:i}=this.cursor.next(t);return this.pos+=(i.length+t)*s,this.value=i.length<=n?i:s<0?i.slice(i.length-n):i.slice(0,n),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class rb{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:s,lineBreak:n,value:i}=this.inner.next(t);return s&&this.afterBreak?(this.value="",this.afterBreak=!1):s?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=i,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(wt.prototype[Symbol.iterator]=function(){return this.iter()},Ta.prototype[Symbol.iterator]=sb.prototype[Symbol.iterator]=rb.prototype[Symbol.iterator]=function(){return this});class EC{constructor(t,s,n,i){this.from=t,this.to=s,this.number=n,this.text=i}get length(){return this.to-this.from}}function Ki(r,t,s){return t=Math.max(0,Math.min(r.length,t)),[t,Math.max(t,Math.min(r.length,s))]}function Ss(r,t,s=!0,n=!0){return TC(r,t,s,n)}function IC(r){return r>=56320&&r<57344}function DC(r){return r>=55296&&r<56320}function Us(r,t){let s=r.charCodeAt(t);if(!DC(s)||t+1==r.length)return s;let n=r.charCodeAt(t+1);return IC(n)?(s-55296<<10)+(n-56320)+65536:s}function Zu(r){return r<=65535?String.fromCharCode(r):(r-=65536,String.fromCharCode((r>>10)+55296,(r&1023)+56320))}function Br(r){return r<65536?1:2}const ph=/\r\n?|\n/;var ws=(function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r})(ws||(ws={}));class Xr{constructor(t){this.sections=t}get length(){let t=0;for(let s=0;s<this.sections.length;s+=2)t+=this.sections[s];return t}get newLength(){let t=0;for(let s=0;s<this.sections.length;s+=2){let n=this.sections[s+1];t+=n<0?this.sections[s]:n}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let s=0,n=0,i=0;s<this.sections.length;){let a=this.sections[s++],o=this.sections[s++];o<0?(t(n,i,a),i+=a):i+=o,n+=a}}iterChangedRanges(t,s=!1){gh(this,t,s)}get invertedDesc(){let t=[];for(let s=0;s<this.sections.length;){let n=this.sections[s++],i=this.sections[s++];i<0?t.push(n,i):t.push(i,n)}return new Xr(t)}composeDesc(t){return this.empty?t:t.empty?this:nb(this,t)}mapDesc(t,s=!1){return t.empty?this:xh(this,t,s)}mapPos(t,s=-1,n=ws.Simple){let i=0,a=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],c=this.sections[o++],h=i+l;if(c<0){if(h>t)return a+(t-i);a+=l}else{if(n!=ws.Simple&&h>=t&&(n==ws.TrackDel&&i<t&&h>t||n==ws.TrackBefore&&i<t||n==ws.TrackAfter&&h>t))return null;if(h>t||h==t&&s<0&&!l)return t==i||s<0?a:a+c;a+=c}i=h}if(t>i)throw new RangeError(`Position ${t} is out of range for changeset of length ${i}`);return a}touchesRange(t,s=t){for(let n=0,i=0;n<this.sections.length&&i<=s;){let a=this.sections[n++],o=this.sections[n++],l=i+a;if(o>=0&&i<=s&&l>=t)return i<t&&l>s?"cover":!0;i=l}return!1}toString(){let t="";for(let s=0;s<this.sections.length;){let n=this.sections[s++],i=this.sections[s++];t+=(t?" ":"")+n+(i>=0?":"+i:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(s=>typeof s!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Xr(t)}static create(t){return new Xr(t)}}class hs extends Xr{constructor(t,s){super(t),this.inserted=s}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return gh(this,(s,n,i,a,o)=>t=t.replace(i,i+(n-s),o),!1),t}mapDesc(t,s=!1){return xh(this,t,s,!0)}invert(t){let s=this.sections.slice(),n=[];for(let i=0,a=0;i<s.length;i+=2){let o=s[i],l=s[i+1];if(l>=0){s[i]=l,s[i+1]=o;let c=i>>1;for(;n.length<c;)n.push(wt.empty);n.push(o?t.slice(a,a+o):wt.empty)}a+=o}return new hs(s,n)}compose(t){return this.empty?t:t.empty?this:nb(this,t,!0)}map(t,s=!1){return t.empty?this:xh(this,t,s,!0)}iterChanges(t,s=!1){gh(this,t,s)}get desc(){return Xr.create(this.sections)}filter(t){let s=[],n=[],i=[],a=new za(this);e:for(let o=0,l=0;;){let c=o==t.length?1e9:t[o++];for(;l<c||l==c&&a.len==0;){if(a.done)break e;let u=Math.min(a.len,c-l);Ps(i,u,-1);let m=a.ins==-1?-1:a.off==0?a.ins:0;Ps(s,u,m),m>0&&En(n,s,a.text),a.forward(u),l+=u}let h=t[o++];for(;l<h;){if(a.done)break e;let u=Math.min(a.len,h-l);Ps(s,u,-1),Ps(i,u,a.ins==-1?-1:a.off==0?a.ins:0),a.forward(u),l+=u}}return{changes:new hs(s,n),filtered:Xr.create(i)}}toJSON(){let t=[];for(let s=0;s<this.sections.length;s+=2){let n=this.sections[s],i=this.sections[s+1];i<0?t.push(n):i==0?t.push([n]):t.push([n].concat(this.inserted[s>>1].toJSON()))}return t}static of(t,s,n){let i=[],a=[],o=0,l=null;function c(u=!1){if(!u&&!i.length)return;o<s&&Ps(i,s-o,-1);let m=new hs(i,a);l=l?l.compose(m.map(l)):m,i=[],a=[],o=0}function h(u){if(Array.isArray(u))for(let m of u)h(m);else if(u instanceof hs){if(u.length!=s)throw new RangeError(`Mismatched change set length (got ${u.length}, expected ${s})`);c(),l=l?l.compose(u.map(l)):u}else{let{from:m,to:p=m,insert:x}=u;if(m>p||m<0||p>s)throw new RangeError(`Invalid change range ${m} to ${p} (in doc of length ${s})`);let b=x?typeof x=="string"?wt.of(x.split(n||ph)):x:wt.empty,w=b.length;if(m==p&&w==0)return;m<o&&c(),m>o&&Ps(i,m-o,-1),Ps(i,p-m,w),En(a,i,b),o=p}}return h(t),c(!l),l}static empty(t){return new hs(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let s=[],n=[];for(let i=0;i<t.length;i++){let a=t[i];if(typeof a=="number")s.push(a,-1);else{if(!Array.isArray(a)||typeof a[0]!="number"||a.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(a.length==1)s.push(a[0],0);else{for(;n.length<i;)n.push(wt.empty);n[i]=wt.of(a.slice(1)),s.push(a[0],n[i].length)}}}return new hs(s,n)}static createSet(t,s){return new hs(t,s)}}function Ps(r,t,s,n=!1){if(t==0&&s<=0)return;let i=r.length-2;i>=0&&s<=0&&s==r[i+1]?r[i]+=t:i>=0&&t==0&&r[i]==0?r[i+1]+=s:n?(r[i]+=t,r[i+1]+=s):r.push(t,s)}function En(r,t,s){if(s.length==0)return;let n=t.length-2>>1;if(n<r.length)r[r.length-1]=r[r.length-1].append(s);else{for(;r.length<n;)r.push(wt.empty);r.push(s)}}function gh(r,t,s){let n=r.inserted;for(let i=0,a=0,o=0;o<r.sections.length;){let l=r.sections[o++],c=r.sections[o++];if(c<0)i+=l,a+=l;else{let h=i,u=a,m=wt.empty;for(;h+=l,u+=c,c&&n&&(m=m.append(n[o-2>>1])),!(s||o==r.sections.length||r.sections[o+1]<0);)l=r.sections[o++],c=r.sections[o++];t(i,h,a,u,m),i=h,a=u}}}function xh(r,t,s,n=!1){let i=[],a=n?[]:null,o=new za(r),l=new za(t);for(let c=-1;;){if(o.done&&l.len||l.done&&o.len)throw new Error("Mismatched change set lengths");if(o.ins==-1&&l.ins==-1){let h=Math.min(o.len,l.len);Ps(i,h,-1),o.forward(h),l.forward(h)}else if(l.ins>=0&&(o.ins<0||c==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!s))){let h=l.len;for(Ps(i,l.ins,-1);h;){let u=Math.min(o.len,h);o.ins>=0&&c<o.i&&o.len<=u&&(Ps(i,0,o.ins),a&&En(a,i,o.text),c=o.i),o.forward(u),h-=u}l.next()}else if(o.ins>=0){let h=0,u=o.len;for(;u;)if(l.ins==-1){let m=Math.min(u,l.len);h+=m,u-=m,l.forward(m)}else if(l.ins==0&&l.len<u)u-=l.len,l.next();else break;Ps(i,h,c<o.i?o.ins:0),a&&c<o.i&&En(a,i,o.text),c=o.i,o.forward(o.len-u)}else{if(o.done&&l.done)return a?hs.createSet(i,a):Xr.create(i);throw new Error("Mismatched change set lengths")}}}function nb(r,t,s=!1){let n=[],i=s?[]:null,a=new za(r),o=new za(t);for(let l=!1;;){if(a.done&&o.done)return i?hs.createSet(n,i):Xr.create(n);if(a.ins==0)Ps(n,a.len,0,l),a.next();else if(o.len==0&&!o.done)Ps(n,0,o.ins,l),i&&En(i,n,o.text),o.next();else{if(a.done||o.done)throw new Error("Mismatched change set lengths");{let c=Math.min(a.len2,o.len),h=n.length;if(a.ins==-1){let u=o.ins==-1?-1:o.off?0:o.ins;Ps(n,c,u,l),i&&u&&En(i,n,o.text)}else o.ins==-1?(Ps(n,a.off?0:a.len,c,l),i&&En(i,n,a.textBit(c))):(Ps(n,a.off?0:a.len,o.off?0:o.ins,l),i&&!o.off&&En(i,n,o.text));l=(a.ins>c||o.ins>=0&&o.len>c)&&(l||n.length>h),a.forward2(c),o.forward(c)}}}}class za{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,s=this.i-2>>1;return s>=t.length?wt.empty:t[s]}textBit(t){let{inserted:s}=this.set,n=this.i-2>>1;return n>=s.length&&!t?wt.empty:s[n].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class ri{constructor(t,s,n){this.from=t,this.to=s,this.flags=n}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,s=-1){let n,i;return this.empty?n=i=t.mapPos(this.from,s):(n=t.mapPos(this.from,1),i=t.mapPos(this.to,-1)),n==this.from&&i==this.to?this:new ri(n,i,this.flags)}extend(t,s=t){if(t<=this.anchor&&s>=this.anchor)return ye.range(t,s);let n=Math.abs(t-this.anchor)>Math.abs(s-this.anchor)?t:s;return ye.range(this.anchor,n)}eq(t,s=!1){return this.anchor==t.anchor&&this.head==t.head&&(!s||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ye.range(t.anchor,t.head)}static create(t,s,n){return new ri(t,s,n)}}class ye{constructor(t,s){this.ranges=t,this.mainIndex=s}map(t,s=-1){return t.empty?this:ye.create(this.ranges.map(n=>n.map(t,s)),this.mainIndex)}eq(t,s=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(t.ranges[n],s))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ye([this.main],0)}addRange(t,s=!0){return ye.create([t].concat(this.ranges),s?0:this.mainIndex+1)}replaceRange(t,s=this.mainIndex){let n=this.ranges.slice();return n[s]=t,ye.create(n,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ye(t.ranges.map(s=>ri.fromJSON(s)),t.main)}static single(t,s=t){return new ye([ye.range(t,s)],0)}static create(t,s=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let n=0,i=0;i<t.length;i++){let a=t[i];if(a.empty?a.from<=n:a.from<n)return ye.normalized(t.slice(),s);n=a.to}return new ye(t,s)}static cursor(t,s=0,n,i){return ri.create(t,t,(s==0?0:s<0?8:16)|(n==null?7:Math.min(6,n))|(i??16777215)<<6)}static range(t,s,n,i){let a=(n??16777215)<<6|(i==null?7:Math.min(6,i));return s<t?ri.create(s,t,48|a):ri.create(t,s,(s>t?8:0)|a)}static normalized(t,s=0){let n=t[s];t.sort((i,a)=>i.from-a.from),s=t.indexOf(n);for(let i=1;i<t.length;i++){let a=t[i],o=t[i-1];if(a.empty?a.from<=o.to:a.from<o.to){let l=o.from,c=Math.max(a.to,o.to);i<=s&&s--,t.splice(--i,2,a.anchor>a.head?ye.range(c,l):ye.range(l,c))}}return new ye(t,s)}}function ib(r,t){for(let s of r.ranges)if(s.to>t)throw new RangeError("Selection points outside of document")}let Ju=0;class We{constructor(t,s,n,i,a){this.combine=t,this.compareInput=s,this.compare=n,this.isStatic=i,this.id=Ju++,this.default=t([]),this.extensions=typeof a=="function"?a(this):a}get reader(){return this}static define(t={}){return new We(t.combine||(s=>s),t.compareInput||((s,n)=>s===n),t.compare||(t.combine?(s,n)=>s===n:ef),!!t.static,t.enables)}of(t){return new yl([],this,0,t)}compute(t,s){if(this.isStatic)throw new Error("Can't compute a static facet");return new yl(t,this,1,s)}computeN(t,s){if(this.isStatic)throw new Error("Can't compute a static facet");return new yl(t,this,2,s)}from(t,s){return s||(s=n=>n),this.compute([t],n=>s(n.field(t)))}}function ef(r,t){return r==t||r.length==t.length&&r.every((s,n)=>s===t[n])}class yl{constructor(t,s,n,i){this.dependencies=t,this.facet=s,this.type=n,this.value=i,this.id=Ju++}dynamicSlot(t){var s;let n=this.value,i=this.facet.compareInput,a=this.id,o=t[a]>>1,l=this.type==2,c=!1,h=!1,u=[];for(let m of this.dependencies)m=="doc"?c=!0:m=="selection"?h=!0:(((s=t[m.id])!==null&&s!==void 0?s:1)&1)==0&&u.push(t[m.id]);return{create(m){return m.values[o]=n(m),1},update(m,p){if(c&&p.docChanged||h&&(p.docChanged||p.selection)||yh(m,u)){let x=n(m);if(l?!Vm(x,m.values[o],i):!i(x,m.values[o]))return m.values[o]=x,1}return 0},reconfigure:(m,p)=>{let x,b=p.config.address[a];if(b!=null){let w=Wl(p,b);if(this.dependencies.every(C=>C instanceof We?p.facet(C)===m.facet(C):C instanceof ys?p.field(C,!1)==m.field(C,!1):!0)||(l?Vm(x=n(m),w,i):i(x=n(m),w)))return m.values[o]=w,0}else x=n(m);return m.values[o]=x,1}}}}function Vm(r,t,s){if(r.length!=t.length)return!1;for(let n=0;n<r.length;n++)if(!s(r[n],t[n]))return!1;return!0}function yh(r,t){let s=!1;for(let n of t)Pa(r,n)&1&&(s=!0);return s}function RC(r,t,s){let n=s.map(c=>r[c.id]),i=s.map(c=>c.type),a=n.filter(c=>!(c&1)),o=r[t.id]>>1;function l(c){let h=[];for(let u=0;u<n.length;u++){let m=Wl(c,n[u]);if(i[u]==2)for(let p of m)h.push(p);else h.push(m)}return t.combine(h)}return{create(c){for(let h of n)Pa(c,h);return c.values[o]=l(c),1},update(c,h){if(!yh(c,a))return 0;let u=l(c);return t.compare(u,c.values[o])?0:(c.values[o]=u,1)},reconfigure(c,h){let u=yh(c,n),m=h.config.facets[t.id],p=h.facet(t);if(m&&!u&&ef(s,m))return c.values[o]=p,0;let x=l(c);return t.compare(x,p)?(c.values[o]=p,0):(c.values[o]=x,1)}}}const No=We.define({static:!0});class ys{constructor(t,s,n,i,a){this.id=t,this.createF=s,this.updateF=n,this.compareF=i,this.spec=a,this.provides=void 0}static define(t){let s=new ys(Ju++,t.create,t.update,t.compare||((n,i)=>n===i),t);return t.provide&&(s.provides=t.provide(s)),s}create(t){let s=t.facet(No).find(n=>n.field==this);return(s?.create||this.createF)(t)}slot(t){let s=t[this.id]>>1;return{create:n=>(n.values[s]=this.create(n),1),update:(n,i)=>{let a=n.values[s],o=this.updateF(a,i);return this.compareF(a,o)?0:(n.values[s]=o,1)},reconfigure:(n,i)=>{let a=n.facet(No),o=i.facet(No),l;return(l=a.find(c=>c.field==this))&&l!=o.find(c=>c.field==this)?(n.values[s]=l.create(n),1):i.config.address[this.id]!=null?(n.values[s]=i.field(this),0):(n.values[s]=this.create(n),1)}}}init(t){return[this,No.of({field:this,create:t})]}get extension(){return this}}const ei={lowest:4,low:3,default:2,high:1,highest:0};function fa(r){return t=>new ab(t,r)}const qn={highest:fa(ei.highest),high:fa(ei.high),default:fa(ei.default),low:fa(ei.low),lowest:fa(ei.lowest)};class ab{constructor(t,s){this.inner=t,this.prec=s}}class Cc{of(t){return new jh(this,t)}reconfigure(t){return Cc.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class jh{constructor(t,s){this.compartment=t,this.inner=s}}class Nl{constructor(t,s,n,i,a,o){for(this.base=t,this.compartments=s,this.dynamicSlots=n,this.address=i,this.staticValues=a,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<n.length;)this.statusTemplate.push(0)}staticFacet(t){let s=this.address[t.id];return s==null?t.default:this.staticValues[s>>1]}static resolve(t,s,n){let i=[],a=Object.create(null),o=new Map;for(let p of MC(t,s,o))p instanceof ys?i.push(p):(a[p.facet.id]||(a[p.facet.id]=[])).push(p);let l=Object.create(null),c=[],h=[];for(let p of i)l[p.id]=h.length<<1,h.push(x=>p.slot(x));let u=n?.config.facets;for(let p in a){let x=a[p],b=x[0].facet,w=u&&u[p]||[];if(x.every(C=>C.type==0))if(l[b.id]=c.length<<1|1,ef(w,x))c.push(n.facet(b));else{let C=b.combine(x.map(A=>A.value));c.push(n&&b.compare(C,n.facet(b))?n.facet(b):C)}else{for(let C of x)C.type==0?(l[C.id]=c.length<<1|1,c.push(C.value)):(l[C.id]=h.length<<1,h.push(A=>C.dynamicSlot(A)));l[b.id]=h.length<<1,h.push(C=>RC(C,b,x))}}let m=h.map(p=>p(l));return new Nl(t,o,m,l,c,a)}}function MC(r,t,s){let n=[[],[],[],[],[]],i=new Map;function a(o,l){let c=i.get(o);if(c!=null){if(c<=l)return;let h=n[c].indexOf(o);h>-1&&n[c].splice(h,1),o instanceof jh&&s.delete(o.compartment)}if(i.set(o,l),Array.isArray(o))for(let h of o)a(h,l);else if(o instanceof jh){if(s.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=t.get(o.compartment)||o.inner;s.set(o.compartment,h),a(h,l)}else if(o instanceof ab)a(o.inner,o.prec);else if(o instanceof ys)n[l].push(o),o.provides&&a(o.provides,l);else if(o instanceof yl)n[l].push(o),o.facet.extensions&&a(o.facet.extensions,ei.default);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);a(h,l)}}return a(r,ei.default),n.reduce((o,l)=>o.concat(l))}function Pa(r,t){if(t&1)return 2;let s=t>>1,n=r.status[s];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;r.status[s]=4;let i=r.computeSlot(r,r.config.dynamicSlots[s]);return r.status[s]=2|i}function Wl(r,t){return t&1?r.config.staticValues[t>>1]:r.values[t>>1]}const ob=We.define(),bh=We.define({combine:r=>r.some(t=>t),static:!0}),lb=We.define({combine:r=>r.length?r[0]:void 0,static:!0}),cb=We.define(),db=We.define(),hb=We.define(),ub=We.define({combine:r=>r.length?r[0]:!1});class tn{constructor(t,s){this.type=t,this.value=s}static define(){return new LC}}class LC{of(t){return new tn(this,t)}}class FC{constructor(t){this.map=t}of(t){return new nt(this,t)}}class nt{constructor(t,s){this.type=t,this.value=s}map(t){let s=this.type.map(this.value,t);return s===void 0?void 0:s==this.value?this:new nt(this.type,s)}is(t){return this.type==t}static define(t={}){return new FC(t.map||(s=>s))}static mapEffects(t,s){if(!t.length)return t;let n=[];for(let i of t){let a=i.map(s);a&&n.push(a)}return n}}nt.reconfigure=nt.define();nt.appendConfig=nt.define();class ls{constructor(t,s,n,i,a,o){this.startState=t,this.changes=s,this.selection=n,this.effects=i,this.annotations=a,this.scrollIntoView=o,this._doc=null,this._state=null,n&&ib(n,s.newLength),a.some(l=>l.type==ls.time)||(this.annotations=a.concat(ls.time.of(Date.now())))}static create(t,s,n,i,a,o){return new ls(t,s,n,i,a,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let s of this.annotations)if(s.type==t)return s.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let s=this.annotation(ls.userEvent);return!!(s&&(s==t||s.length>t.length&&s.slice(0,t.length)==t&&s[t.length]=="."))}}ls.time=tn.define();ls.userEvent=tn.define();ls.addToHistory=tn.define();ls.remote=tn.define();function NC(r,t){let s=[];for(let n=0,i=0;;){let a,o;if(n<r.length&&(i==t.length||t[i]>=r[n]))a=r[n++],o=r[n++];else if(i<t.length)a=t[i++],o=t[i++];else return s;!s.length||s[s.length-1]<a?s.push(a,o):s[s.length-1]<o&&(s[s.length-1]=o)}}function fb(r,t,s){var n;let i,a,o;return s?(i=t.changes,a=hs.empty(t.changes.length),o=r.changes.compose(t.changes)):(i=t.changes.map(r.changes),a=r.changes.mapDesc(t.changes,!0),o=r.changes.compose(i)),{changes:o,selection:t.selection?t.selection.map(a):(n=r.selection)===null||n===void 0?void 0:n.map(i),effects:nt.mapEffects(r.effects,i).concat(nt.mapEffects(t.effects,a)),annotations:r.annotations.length?r.annotations.concat(t.annotations):t.annotations,scrollIntoView:r.scrollIntoView||t.scrollIntoView}}function vh(r,t,s){let n=t.selection,i=Wi(t.annotations);return t.userEvent&&(i=i.concat(ls.userEvent.of(t.userEvent))),{changes:t.changes instanceof hs?t.changes:hs.of(t.changes||[],s,r.facet(lb)),selection:n&&(n instanceof ye?n:ye.single(n.anchor,n.head)),effects:Wi(t.effects),annotations:i,scrollIntoView:!!t.scrollIntoView}}function mb(r,t,s){let n=vh(r,t.length?t[0]:{},r.doc.length);t.length&&t[0].filter===!1&&(s=!1);for(let a=1;a<t.length;a++){t[a].filter===!1&&(s=!1);let o=!!t[a].sequential;n=fb(n,vh(r,t[a],o?n.changes.newLength:r.doc.length),o)}let i=ls.create(r,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return $C(s?WC(i):i)}function WC(r){let t=r.startState,s=!0;for(let i of t.facet(cb)){let a=i(r);if(a===!1){s=!1;break}Array.isArray(a)&&(s=s===!0?a:NC(s,a))}if(s!==!0){let i,a;if(s===!1)a=r.changes.invertedDesc,i=hs.empty(t.doc.length);else{let o=r.changes.filter(s);i=o.changes,a=o.filtered.mapDesc(o.changes).invertedDesc}r=ls.create(t,i,r.selection&&r.selection.map(a),nt.mapEffects(r.effects,a),r.annotations,r.scrollIntoView)}let n=t.facet(db);for(let i=n.length-1;i>=0;i--){let a=n[i](r);a instanceof ls?r=a:Array.isArray(a)&&a.length==1&&a[0]instanceof ls?r=a[0]:r=mb(t,Wi(a),!1)}return r}function $C(r){let t=r.startState,s=t.facet(hb),n=r;for(let i=s.length-1;i>=0;i--){let a=s[i](r);a&&Object.keys(a).length&&(n=fb(n,vh(t,a,r.changes.newLength),!0))}return n==r?r:ls.create(t,r.changes,r.selection,n.effects,n.annotations,n.scrollIntoView)}const VC=[];function Wi(r){return r==null?VC:Array.isArray(r)?r:[r]}var Qt=(function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r})(Qt||(Qt={}));const zC=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wh;try{wh=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function BC(r){if(wh)return wh.test(r);for(let t=0;t<r.length;t++){let s=r[t];if(/\w/.test(s)||s>""&&(s.toUpperCase()!=s.toLowerCase()||zC.test(s)))return!0}return!1}function UC(r){return t=>{if(!/\S/.test(t))return Qt.Space;if(BC(t))return Qt.Word;for(let s=0;s<r.length;s++)if(t.indexOf(r[s])>-1)return Qt.Word;return Qt.Other}}class bt{constructor(t,s,n,i,a,o){this.config=t,this.doc=s,this.selection=n,this.values=i,this.status=t.statusTemplate.slice(),this.computeSlot=a,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Pa(this,l<<1);this.computeSlot=null}field(t,s=!0){let n=this.config.address[t.id];if(n==null){if(s)throw new RangeError("Field is not present in this state");return}return Pa(this,n),Wl(this,n)}update(...t){return mb(this,t,!0)}applyTransaction(t){let s=this.config,{base:n,compartments:i}=s;for(let l of t.effects)l.is(Cc.reconfigure)?(s&&(i=new Map,s.compartments.forEach((c,h)=>i.set(h,c)),s=null),i.set(l.value.compartment,l.value.extension)):l.is(nt.reconfigure)?(s=null,n=l.value):l.is(nt.appendConfig)&&(s=null,n=Wi(n).concat(l.value));let a;s?a=t.startState.values.slice():(s=Nl.resolve(n,i,this),a=new bt(s,this.doc,this.selection,s.dynamicSlots.map(()=>null),(c,h)=>h.reconfigure(c,this),null).values);let o=t.startState.facet(bh)?t.newSelection:t.newSelection.asSingle();new bt(s,t.newDoc,o,a,(l,c)=>c.update(l,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(s=>({changes:{from:s.from,to:s.to,insert:t},range:ye.cursor(s.from+t.length)}))}changeByRange(t){let s=this.selection,n=t(s.ranges[0]),i=this.changes(n.changes),a=[n.range],o=Wi(n.effects);for(let l=1;l<s.ranges.length;l++){let c=t(s.ranges[l]),h=this.changes(c.changes),u=h.map(i);for(let p=0;p<l;p++)a[p]=a[p].map(u);let m=i.mapDesc(h,!0);a.push(c.range.map(m)),i=i.compose(u),o=nt.mapEffects(o,u).concat(nt.mapEffects(Wi(c.effects),m))}return{changes:i,selection:ye.create(a,s.mainIndex),effects:o}}changes(t=[]){return t instanceof hs?t:hs.of(t,this.doc.length,this.facet(bt.lineSeparator))}toText(t){return wt.of(t.split(this.facet(bt.lineSeparator)||ph))}sliceDoc(t=0,s=this.doc.length){return this.doc.sliceString(t,s,this.lineBreak)}facet(t){let s=this.config.address[t.id];return s==null?t.default:(Pa(this,s),Wl(this,s))}toJSON(t){let s={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let n in t){let i=t[n];i instanceof ys&&this.config.address[i.id]!=null&&(s[n]=i.spec.toJSON(this.field(t[n]),this))}return s}static fromJSON(t,s={},n){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let i=[];if(n){for(let a in n)if(Object.prototype.hasOwnProperty.call(t,a)){let o=n[a],l=t[a];i.push(o.init(c=>o.spec.fromJSON(l,c)))}}return bt.create({doc:t.doc,selection:ye.fromJSON(t.selection),extensions:s.extensions?i.concat([s.extensions]):i})}static create(t={}){let s=Nl.resolve(t.extensions||[],new Map),n=t.doc instanceof wt?t.doc:wt.of((t.doc||"").split(s.staticFacet(bt.lineSeparator)||ph)),i=t.selection?t.selection instanceof ye?t.selection:ye.single(t.selection.anchor,t.selection.head):ye.single(0);return ib(i,n.length),s.staticFacet(bh)||(i=i.asSingle()),new bt(s,n,i,s.dynamicSlots.map(()=>null),(a,o)=>o.create(a),null)}get tabSize(){return this.facet(bt.tabSize)}get lineBreak(){return this.facet(bt.lineSeparator)||`
`}get readOnly(){return this.facet(ub)}phrase(t,...s){for(let n of this.facet(bt.phrases))if(Object.prototype.hasOwnProperty.call(n,t)){t=n[t];break}return s.length&&(t=t.replace(/\$(\$|\d*)/g,(n,i)=>{if(i=="$")return"$";let a=+(i||1);return!a||a>s.length?n:s[a-1]})),t}languageDataAt(t,s,n=-1){let i=[];for(let a of this.facet(ob))for(let o of a(this,s,n))Object.prototype.hasOwnProperty.call(o,t)&&i.push(o[t]);return i}charCategorizer(t){return UC(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:s,from:n,length:i}=this.doc.lineAt(t),a=this.charCategorizer(t),o=t-n,l=t-n;for(;o>0;){let c=Ss(s,o,!1);if(a(s.slice(c,o))!=Qt.Word)break;o=c}for(;l<i;){let c=Ss(s,l);if(a(s.slice(l,c))!=Qt.Word)break;l=c}return o==l?null:ye.range(o+n,l+n)}}bt.allowMultipleSelections=bh;bt.tabSize=We.define({combine:r=>r.length?r[0]:4});bt.lineSeparator=lb;bt.readOnly=ub;bt.phrases=We.define({compare(r,t){let s=Object.keys(r),n=Object.keys(t);return s.length==n.length&&s.every(i=>r[i]==t[i])}});bt.languageData=ob;bt.changeFilter=cb;bt.transactionFilter=db;bt.transactionExtender=hb;Cc.reconfigure=nt.define();function sn(r,t,s={}){let n={};for(let i of r)for(let a of Object.keys(i)){let o=i[a],l=n[a];if(l===void 0)n[a]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(s,a))n[a]=s[a](l,o);else throw new Error("Config merge conflict for field "+a)}for(let i in t)n[i]===void 0&&(n[i]=t[i]);return n}class ui{eq(t){return this==t}range(t,s=t){return Sh.create(t,s,this)}}ui.prototype.startSide=ui.prototype.endSide=0;ui.prototype.point=!1;ui.prototype.mapMode=ws.TrackDel;let Sh=class pb{constructor(t,s,n){this.from=t,this.to=s,this.value=n}static create(t,s,n){return new pb(t,s,n)}};function Oh(r,t){return r.from-t.from||r.value.startSide-t.value.startSide}class tf{constructor(t,s,n,i){this.from=t,this.to=s,this.value=n,this.maxPoint=i}get length(){return this.to[this.to.length-1]}findIndex(t,s,n,i=0){let a=n?this.to:this.from;for(let o=i,l=a.length;;){if(o==l)return o;let c=o+l>>1,h=a[c]-t||(n?this.value[c].endSide:this.value[c].startSide)-s;if(c==o)return h>=0?o:l;h>=0?l=c:o=c+1}}between(t,s,n,i){for(let a=this.findIndex(s,-1e9,!0),o=this.findIndex(n,1e9,!1,a);a<o;a++)if(i(this.from[a]+t,this.to[a]+t,this.value[a])===!1)return!1}map(t,s){let n=[],i=[],a=[],o=-1,l=-1;for(let c=0;c<this.value.length;c++){let h=this.value[c],u=this.from[c]+t,m=this.to[c]+t,p,x;if(u==m){let b=s.mapPos(u,h.startSide,h.mapMode);if(b==null||(p=x=b,h.startSide!=h.endSide&&(x=s.mapPos(u,h.endSide),x<p)))continue}else if(p=s.mapPos(u,h.startSide),x=s.mapPos(m,h.endSide),p>x||p==x&&h.startSide>0&&h.endSide<=0)continue;(x-p||h.endSide-h.startSide)<0||(o<0&&(o=p),h.point&&(l=Math.max(l,x-p)),n.push(h),i.push(p-o),a.push(x-o))}return{mapped:n.length?new tf(i,a,n,l):null,pos:o}}}class Ot{constructor(t,s,n,i){this.chunkPos=t,this.chunk=s,this.nextLayer=n,this.maxPoint=i}static create(t,s,n,i){return new Ot(t,s,n,i)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let s of this.chunk)t+=s.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:s=[],sort:n=!1,filterFrom:i=0,filterTo:a=this.length}=t,o=t.filter;if(s.length==0&&!o)return this;if(n&&(s=s.slice().sort(Oh)),this.isEmpty)return s.length?Ot.of(s):this;let l=new gb(this,null,-1).goto(0),c=0,h=[],u=new bn;for(;l.value||c<s.length;)if(c<s.length&&(l.from-s[c].from||l.startSide-s[c].value.startSide)>=0){let m=s[c++];u.addInner(m.from,m.to,m.value)||h.push(m)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(c==s.length||this.chunkEnd(l.chunkIndex)<s[c].from)&&(!o||i>this.chunkEnd(l.chunkIndex)||a<this.chunkPos[l.chunkIndex])&&u.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||i>l.to||a<l.from||o(l.from,l.to,l.value))&&(u.addInner(l.from,l.to,l.value)||h.push(Sh.create(l.from,l.to,l.value))),l.next());return u.finishInner(this.nextLayer.isEmpty&&!h.length?Ot.empty:this.nextLayer.update({add:h,filter:o,filterFrom:i,filterTo:a}))}map(t){if(t.empty||this.isEmpty)return this;let s=[],n=[],i=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],c=this.chunk[o],h=t.touchesRange(l,l+c.length);if(h===!1)i=Math.max(i,c.maxPoint),s.push(c),n.push(t.mapPos(l));else if(h===!0){let{mapped:u,pos:m}=c.map(l,t);u&&(i=Math.max(i,u.maxPoint),s.push(u),n.push(m))}}let a=this.nextLayer.map(t);return s.length==0?a:new Ot(n,s,a||Ot.empty,i)}between(t,s,n){if(!this.isEmpty){for(let i=0;i<this.chunk.length;i++){let a=this.chunkPos[i],o=this.chunk[i];if(s>=a&&t<=a+o.length&&o.between(a,t-a,s-a,n)===!1)return}this.nextLayer.between(t,s,n)}}iter(t=0){return Ba.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,s=0){return Ba.from(t).goto(s)}static compare(t,s,n,i,a=-1){let o=t.filter(m=>m.maxPoint>0||!m.isEmpty&&m.maxPoint>=a),l=s.filter(m=>m.maxPoint>0||!m.isEmpty&&m.maxPoint>=a),c=zm(o,l,n),h=new ma(o,c,a),u=new ma(l,c,a);n.iterGaps((m,p,x)=>Bm(h,m,u,p,x,i)),n.empty&&n.length==0&&Bm(h,0,u,0,0,i)}static eq(t,s,n=0,i){i==null&&(i=999999999);let a=t.filter(u=>!u.isEmpty&&s.indexOf(u)<0),o=s.filter(u=>!u.isEmpty&&t.indexOf(u)<0);if(a.length!=o.length)return!1;if(!a.length)return!0;let l=zm(a,o),c=new ma(a,l,0).goto(n),h=new ma(o,l,0).goto(n);for(;;){if(c.to!=h.to||!kh(c.active,h.active)||c.point&&(!h.point||!c.point.eq(h.point)))return!1;if(c.to>i)return!0;c.next(),h.next()}}static spans(t,s,n,i,a=-1){let o=new ma(t,null,a).goto(s),l=s,c=o.openStart;for(;;){let h=Math.min(o.to,n);if(o.point){let u=o.activeForPoint(o.to),m=o.pointFrom<s?u.length+1:o.point.startSide<0?u.length:Math.min(u.length,c);i.point(l,h,o.point,u,m,o.pointRank),c=Math.min(o.openEnd(h),u.length)}else h>l&&(i.span(l,h,o.active,c),c=o.openEnd(h));if(o.to>n)return c+(o.point&&o.to>n?1:0);l=o.to,o.next()}}static of(t,s=!1){let n=new bn;for(let i of t instanceof Sh?[t]:s?QC(t):t)n.add(i.from,i.to,i.value);return n.finish()}static join(t){if(!t.length)return Ot.empty;let s=t[t.length-1];for(let n=t.length-2;n>=0;n--)for(let i=t[n];i!=Ot.empty;i=i.nextLayer)s=new Ot(i.chunkPos,i.chunk,s,Math.max(i.maxPoint,s.maxPoint));return s}}Ot.empty=new Ot([],[],null,-1);function QC(r){if(r.length>1)for(let t=r[0],s=1;s<r.length;s++){let n=r[s];if(Oh(t,n)>0)return r.slice().sort(Oh);t=n}return r}Ot.empty.nextLayer=Ot.empty;class bn{finishChunk(t){this.chunks.push(new tf(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,s,n){this.addInner(t,s,n)||(this.nextLayer||(this.nextLayer=new bn)).add(t,s,n)}addInner(t,s,n){let i=t-this.lastTo||n.startSide-this.last.endSide;if(i<=0&&(t-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return i<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(s-this.chunkStart),this.last=n,this.lastFrom=t,this.lastTo=s,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,s-t)),!0)}addChunk(t,s){if((t-this.lastTo||s.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,s.maxPoint),this.chunks.push(s),this.chunkPos.push(t);let n=s.value.length-1;return this.last=s.value[n],this.lastFrom=s.from[n]+t,this.lastTo=s.to[n]+t,!0}finish(){return this.finishInner(Ot.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let s=Ot.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,s}}function zm(r,t,s){let n=new Map;for(let a of r)for(let o=0;o<a.chunk.length;o++)a.chunk[o].maxPoint<=0&&n.set(a.chunk[o],a.chunkPos[o]);let i=new Set;for(let a of t)for(let o=0;o<a.chunk.length;o++){let l=n.get(a.chunk[o]);l!=null&&(s?s.mapPos(l):l)==a.chunkPos[o]&&!s?.touchesRange(l,l+a.chunk[o].length)&&i.add(a.chunk[o])}return i}class gb{constructor(t,s,n,i=0){this.layer=t,this.skip=s,this.minPoint=n,this.rank=i}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,s=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,s,!1),this}gotoInner(t,s,n){for(;this.chunkIndex<this.layer.chunk.length;){let i=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(i)||this.layer.chunkEnd(this.chunkIndex)<t||i.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1}if(this.chunkIndex<this.layer.chunk.length){let i=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],s,!0);(!n||this.rangeIndex<i)&&this.setRangeIndex(i)}this.next()}forward(t,s){(this.to-t||this.endSide-s)<0&&this.gotoInner(t,s,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],s=this.layer.chunk[this.chunkIndex],n=t+s.from[this.rangeIndex];if(this.from=n,this.to=t+s.to[this.rangeIndex],this.value=s.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class Ba{constructor(t){this.heap=t}static from(t,s=null,n=-1){let i=[];for(let a=0;a<t.length;a++)for(let o=t[a];!o.isEmpty;o=o.nextLayer)o.maxPoint>=n&&i.push(new gb(o,s,n,a));return i.length==1?i[0]:new Ba(i)}get startSide(){return this.value?this.value.startSide:0}goto(t,s=-1e9){for(let n of this.heap)n.goto(t,s);for(let n=this.heap.length>>1;n>=0;n--)fd(this.heap,n);return this.next(),this}forward(t,s){for(let n of this.heap)n.forward(t,s);for(let n=this.heap.length>>1;n>=0;n--)fd(this.heap,n);(this.to-t||this.value.endSide-s)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),fd(this.heap,0)}}}function fd(r,t){for(let s=r[t];;){let n=(t<<1)+1;if(n>=r.length)break;let i=r[n];if(n+1<r.length&&i.compare(r[n+1])>=0&&(i=r[n+1],n++),s.compare(i)<0)break;r[n]=s,r[t]=i,t=n}}class ma{constructor(t,s,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ba.from(t,s,n)}goto(t,s=-1e9){return this.cursor.goto(t,s),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=s,this.openStart=-1,this.next(),this}forward(t,s){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-s)<0;)this.removeActive(this.minActive);this.cursor.forward(t,s)}removeActive(t){Wo(this.active,t),Wo(this.activeTo,t),Wo(this.activeRank,t),this.minActive=Um(this.active,this.activeTo)}addActive(t){let s=0,{value:n,to:i,rank:a}=this.cursor;for(;s<this.activeRank.length&&(a-this.activeRank[s]||i-this.activeTo[s])>0;)s++;$o(this.active,s,n),$o(this.activeTo,s,i),$o(this.activeRank,s,a),t&&$o(t,s,this.cursor.from),this.minActive=Um(this.active,this.activeTo)}next(){let t=this.to,s=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>t){this.to=this.activeTo[i],this.endSide=this.active[i].endSide;break}this.removeActive(i),n&&Wo(n,i)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let a=this.cursor.value;if(!a.point)this.addActive(n),this.cursor.next();else if(s&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=a,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=a.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let i=n.length-1;i>=0&&n[i]<t;i--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let s=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>t||this.activeTo[n]==t&&this.active[n].endSide>=this.point.endSide)&&s.push(this.active[n]);return s.reverse()}openEnd(t){let s=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>t;n--)s++;return s}}function Bm(r,t,s,n,i,a){r.goto(t),s.goto(n);let o=n+i,l=n,c=n-t;for(;;){let h=r.to+c-s.to,u=h||r.endSide-s.endSide,m=u<0?r.to+c:s.to,p=Math.min(m,o);if(r.point||s.point?r.point&&s.point&&(r.point==s.point||r.point.eq(s.point))&&kh(r.activeForPoint(r.to),s.activeForPoint(s.to))||a.comparePoint(l,p,r.point,s.point):p>l&&!kh(r.active,s.active)&&a.compareRange(l,p,r.active,s.active),m>o)break;(h||r.openEnd!=s.openEnd)&&a.boundChange&&a.boundChange(m),l=m,u<=0&&r.next(),u>=0&&s.next()}}function kh(r,t){if(r.length!=t.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!=t[s]&&!r[s].eq(t[s]))return!1;return!0}function Wo(r,t){for(let s=t,n=r.length-1;s<n;s++)r[s]=r[s+1];r.pop()}function $o(r,t,s){for(let n=r.length-1;n>=t;n--)r[n+1]=r[n];r[t]=s}function Um(r,t){let s=-1,n=1e9;for(let i=0;i<t.length;i++)(t[i]-n||r[i].endSide-r[s].endSide)<0&&(s=i,n=t[i]);return s}function ia(r,t,s=r.length){let n=0;for(let i=0;i<s&&i<r.length;)r.charCodeAt(i)==9?(n+=t-n%t,i++):(n++,i=Ss(r,i));return n}function Ch(r,t,s,n){for(let i=0,a=0;;){if(a>=t)return i;if(i==r.length)break;a+=r.charCodeAt(i)==9?s-a%s:1,i=Ss(r,i)}return n===!0?-1:r.length}const Ah="ͼ",Qm=typeof Symbol>"u"?"__"+Ah:Symbol.for(Ah),Th=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),qm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Wn{constructor(t,s){this.rules=[];let{finish:n}=s||{};function i(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function a(o,l,c,h){let u=[],m=/^@(\w+)\b/.exec(o[0]),p=m&&m[1]=="keyframes";if(m&&l==null)return c.push(o[0]+";");for(let x in l){let b=l[x];if(/&/.test(x))a(x.split(/,\s*/).map(w=>o.map(C=>w.replace(/&/,C))).reduce((w,C)=>w.concat(C)),b,c);else if(b&&typeof b=="object"){if(!m)throw new RangeError("The value of a property ("+x+") should be a primitive value.");a(i(x),b,u,p)}else b!=null&&u.push(x.replace(/_.*/,"").replace(/[A-Z]/g,w=>"-"+w.toLowerCase())+": "+b+";")}(u.length||p)&&c.push((n&&!m&&!h?o.map(n):o).join(", ")+" {"+u.join(" ")+"}")}for(let o in t)a(i(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=qm[Qm]||1;return qm[Qm]=t+1,Ah+t.toString(36)}static mount(t,s,n){let i=t[Th],a=n&&n.nonce;i?a&&i.setNonce(a):i=new qC(t,a),i.mount(Array.isArray(s)?s:[s],t)}}let Hm=new Map;class qC{constructor(t,s){let n=t.ownerDocument||t,i=n.defaultView;if(!t.head&&t.adoptedStyleSheets&&i.CSSStyleSheet){let a=Hm.get(n);if(a)return t[Th]=a;this.sheet=new i.CSSStyleSheet,Hm.set(n,this)}else this.styleTag=n.createElement("style"),s&&this.styleTag.setAttribute("nonce",s);this.modules=[],t[Th]=this}mount(t,s){let n=this.sheet,i=0,a=0;for(let o=0;o<t.length;o++){let l=t[o],c=this.modules.indexOf(l);if(c<a&&c>-1&&(this.modules.splice(c,1),a--,c=-1),c==-1){if(this.modules.splice(a++,0,l),n)for(let h=0;h<l.rules.length;h++)n.insertRule(l.rules[h],i++)}else{for(;a<c;)i+=this.modules[a++].rules.length;i+=l.rules.length,a++}}if(n)s.adoptedStyleSheets.indexOf(this.sheet)<0&&(s.adoptedStyleSheets=[this.sheet,...s.adoptedStyleSheets]);else{let o="";for(let c=0;c<this.modules.length;c++)o+=this.modules[c].getRules()+`
`;this.styleTag.textContent=o;let l=s.head||s;this.styleTag.parentNode!=l&&l.insertBefore(this.styleTag,l.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}var $n={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ua={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},HC=typeof navigator<"u"&&/Mac/.test(navigator.platform),GC=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var vs=0;vs<10;vs++)$n[48+vs]=$n[96+vs]=String(vs);for(var vs=1;vs<=24;vs++)$n[vs+111]="F"+vs;for(var vs=65;vs<=90;vs++)$n[vs]=String.fromCharCode(vs+32),Ua[vs]=String.fromCharCode(vs);for(var md in $n)Ua.hasOwnProperty(md)||(Ua[md]=$n[md]);function KC(r){var t=HC&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||GC&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",s=!t&&r.key||(r.shiftKey?Ua:$n)[r.keyCode]||r.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}function _t(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var t=1,s=arguments[1];if(s&&typeof s=="object"&&s.nodeType==null&&!Array.isArray(s)){for(var n in s)if(Object.prototype.hasOwnProperty.call(s,n)){var i=s[n];typeof i=="string"?r.setAttribute(n,i):i!=null&&(r[n]=i)}t++}for(;t<arguments.length;t++)xb(r,arguments[t]);return r}function xb(r,t){if(typeof t=="string")r.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)r.appendChild(t);else if(Array.isArray(t))for(var s=0;s<t.length;s++)xb(r,t[s]);else throw new RangeError("Unsupported child node: "+t)}function Qa(r){let t;return r.nodeType==11?t=r.getSelection?r:r.ownerDocument:t=r,t.getSelection()}function Ph(r,t){return t?r==t||r.contains(t.nodeType!=1?t.parentNode:t):!1}function jl(r,t){if(!t.anchorNode)return!1;try{return Ph(r,t.anchorNode)}catch{return!1}}function Yi(r){return r.nodeType==3?mi(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function _a(r,t,s,n){return s?Gm(r,t,s,n,-1)||Gm(r,t,s,n,1):!1}function fi(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t}function $l(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}function Gm(r,t,s,n,i){for(;;){if(r==s&&t==n)return!0;if(t==(i<0?0:en(r))){if(r.nodeName=="DIV")return!1;let a=r.parentNode;if(!a||a.nodeType!=1)return!1;t=fi(r)+(i<0?0:1),r=a}else if(r.nodeType==1){if(r=r.childNodes[t+(i<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;t=i<0?en(r):0}else return!1}}function en(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function fo(r,t){let s=t?r.left:r.right;return{left:s,right:s,top:r.top,bottom:r.bottom}}function YC(r){let t=r.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function yb(r,t){let s=t.width/r.offsetWidth,n=t.height/r.offsetHeight;return(s>.995&&s<1.005||!isFinite(s)||Math.abs(t.width-r.offsetWidth)<1)&&(s=1),(n>.995&&n<1.005||!isFinite(n)||Math.abs(t.height-r.offsetHeight)<1)&&(n=1),{scaleX:s,scaleY:n}}function XC(r,t,s,n,i,a,o,l){let c=r.ownerDocument,h=c.defaultView||window;for(let u=r,m=!1;u&&!m;)if(u.nodeType==1){let p,x=u==c.body,b=1,w=1;if(x)p=YC(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(u).position)&&(m=!0),u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.assignedSlot||u.parentNode;continue}let _=u.getBoundingClientRect();({scaleX:b,scaleY:w}=yb(u,_)),p={left:_.left,right:_.left+u.clientWidth*b,top:_.top,bottom:_.top+u.clientHeight*w}}let C=0,A=0;if(i=="nearest")t.top<p.top?(A=t.top-(p.top+o),s>0&&t.bottom>p.bottom+A&&(A=t.bottom-p.bottom+o)):t.bottom>p.bottom&&(A=t.bottom-p.bottom+o,s<0&&t.top-A<p.top&&(A=t.top-(p.top+o)));else{let _=t.bottom-t.top,R=p.bottom-p.top;A=(i=="center"&&_<=R?t.top+_/2-R/2:i=="start"||i=="center"&&s<0?t.top-o:t.bottom-R+o)-p.top}if(n=="nearest"?t.left<p.left?(C=t.left-(p.left+a),s>0&&t.right>p.right+C&&(C=t.right-p.right+a)):t.right>p.right&&(C=t.right-p.right+a,s<0&&t.left<p.left+C&&(C=t.left-(p.left+a))):C=(n=="center"?t.left+(t.right-t.left)/2-(p.right-p.left)/2:n=="start"==l?t.left-a:t.right-(p.right-p.left)+a)-p.left,C||A)if(x)h.scrollBy(C,A);else{let _=0,R=0;if(A){let E=u.scrollTop;u.scrollTop+=A/w,R=(u.scrollTop-E)*w}if(C){let E=u.scrollLeft;u.scrollLeft+=C/b,_=(u.scrollLeft-E)*b}t={left:t.left-_,top:t.top-R,right:t.right-_,bottom:t.bottom-R},_&&Math.abs(_-C)<1&&(n="nearest"),R&&Math.abs(R-A)<1&&(i="nearest")}if(x)break;(t.top<p.top||t.bottom>p.bottom||t.left<p.left||t.right>p.right)&&(t={left:Math.max(t.left,p.left),right:Math.min(t.right,p.right),top:Math.max(t.top,p.top),bottom:Math.min(t.bottom,p.bottom)}),u=u.assignedSlot||u.parentNode}else if(u.nodeType==11)u=u.host;else break}function ZC(r){let t=r.ownerDocument,s,n;for(let i=r.parentNode;i&&!(i==t.body||s&&n);)if(i.nodeType==1)!n&&i.scrollHeight>i.clientHeight&&(n=i),!s&&i.scrollWidth>i.clientWidth&&(s=i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;return{x:s,y:n}}class JC{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:s,focusNode:n}=t;this.set(s,Math.min(t.anchorOffset,s?en(s):0),n,Math.min(t.focusOffset,n?en(n):0))}set(t,s,n,i){this.anchorNode=t,this.anchorOffset=s,this.focusNode=n,this.focusOffset=i}}let Oi=null;function jb(r){if(r.setActive)return r.setActive();if(Oi)return r.focus(Oi);let t=[];for(let s=r;s&&(t.push(s,s.scrollTop,s.scrollLeft),s!=s.ownerDocument);s=s.parentNode);if(r.focus(Oi==null?{get preventScroll(){return Oi={preventScroll:!0},!0}}:void 0),!Oi){Oi=!1;for(let s=0;s<t.length;){let n=t[s++],i=t[s++],a=t[s++];n.scrollTop!=i&&(n.scrollTop=i),n.scrollLeft!=a&&(n.scrollLeft=a)}}}let Km;function mi(r,t,s=t){let n=Km||(Km=document.createRange());return n.setEnd(r,s),n.setStart(r,t),n}function $i(r,t,s,n){let i={key:t,code:t,keyCode:s,which:s,cancelable:!0};n&&({altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey}=n);let a=new KeyboardEvent("keydown",i);a.synthetic=!0,r.dispatchEvent(a);let o=new KeyboardEvent("keyup",i);return o.synthetic=!0,r.dispatchEvent(o),a.defaultPrevented||o.defaultPrevented}function e2(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function bb(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}function t2(r,t){let s=t.focusNode,n=t.focusOffset;if(!s||t.anchorNode!=s||t.anchorOffset!=n)return!1;for(n=Math.min(n,en(s));;)if(n){if(s.nodeType!=1)return!1;let i=s.childNodes[n-1];i.contentEditable=="false"?n--:(s=i,n=en(s))}else{if(s==r)return!0;n=fi(s),s=s.parentNode}}function vb(r){return r.scrollTop>Math.max(1,r.scrollHeight-r.clientHeight-4)}function wb(r,t){for(let s=r,n=t;;){if(s.nodeType==3&&n>0)return{node:s,offset:n};if(s.nodeType==1&&n>0){if(s.contentEditable=="false")return null;s=s.childNodes[n-1],n=en(s)}else if(s.parentNode&&!$l(s))n=fi(s),s=s.parentNode;else return null}}function Sb(r,t){for(let s=r,n=t;;){if(s.nodeType==3&&n<s.nodeValue.length)return{node:s,offset:n};if(s.nodeType==1&&n<s.childNodes.length){if(s.contentEditable=="false")return null;s=s.childNodes[n],n=0}else if(s.parentNode&&!$l(s))n=fi(s)+1,s=s.parentNode;else return null}}class _s{constructor(t,s,n=!0){this.node=t,this.offset=s,this.precise=n}static before(t,s){return new _s(t.parentNode,fi(t),s)}static after(t,s){return new _s(t.parentNode,fi(t)+1,s)}}const sf=[];class Rt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let s=this.posAtStart;for(let n of this.children){if(n==t)return s;s+=n.length+n.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(t,s){if(this.flags&2){let n=this.dom,i=null,a;for(let o of this.children){if(o.flags&7){if(!o.dom&&(a=i?i.nextSibling:n.firstChild)){let l=Rt.get(a);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(a)}o.sync(t,s),o.flags&=-8}if(a=i?i.nextSibling:n.firstChild,s&&!s.written&&s.node==n&&a!=o.dom&&(s.written=!0),o.dom.parentNode==n)for(;a&&a!=o.dom;)a=Ym(a);else n.insertBefore(o.dom,a);i=o.dom}for(a=i?i.nextSibling:n.firstChild,a&&s&&s.node==n&&(s.written=!0);a;)a=Ym(a)}else if(this.flags&1)for(let n of this.children)n.flags&7&&(n.sync(t,s),n.flags&=-8)}reuseDOM(t){}localPosFromDOM(t,s){let n;if(t==this.dom)n=this.dom.childNodes[s];else{let i=en(t)==0?0:s==0?-1:1;for(;;){let a=t.parentNode;if(a==this.dom)break;i==0&&a.firstChild!=a.lastChild&&(t==a.firstChild?i=-1:i=1),t=a}i<0?n=t:n=t.nextSibling}if(n==this.dom.firstChild)return 0;for(;n&&!Rt.get(n);)n=n.nextSibling;if(!n)return this.length;for(let i=0,a=0;;i++){let o=this.children[i];if(o.dom==n)return a;a+=o.length+o.breakAfter}}domBoundsAround(t,s,n=0){let i=-1,a=-1,o=-1,l=-1;for(let c=0,h=n,u=n;c<this.children.length;c++){let m=this.children[c],p=h+m.length;if(h<t&&p>s)return m.domBoundsAround(t,s,h);if(p>=t&&i==-1&&(i=c,a=h),h>s&&m.dom.parentNode==this.dom){o=c,l=u;break}u=p,h=p+m.breakAfter}return{from:a,to:l<0?n+this.length:l,startDOM:(i?this.children[i-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.flags|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let s=this.parent;s;s=s.parent){if(t&&(s.flags|=2),s.flags&1)return;s.flags|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.flags&7&&this.markParentsDirty(!0))}setDOM(t){this.dom!=t&&(this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this)}get rootView(){for(let t=this;;){let s=t.parent;if(!s)return t;t=s}}replaceChildren(t,s,n=sf){this.markDirty();for(let i=t;i<s;i++){let a=this.children[i];a.parent==this&&n.indexOf(a)<0&&a.destroy()}n.length<250?this.children.splice(t,s-t,...n):this.children=[].concat(this.children.slice(0,t),n,this.children.slice(s));for(let i=0;i<n.length;i++)n[i].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Ob(this.children,t,this.children.length)}childPos(t,s=1){return this.childCursor().findPos(t,s)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,s,n,i,a,o){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor&&!((this.flags|t.flags)&8)}getSide(){return 0}destroy(){for(let t of this.children)t.parent==this&&t.destroy();this.parent=null}}Rt.prototype.breakAfter=0;function Ym(r){let t=r.nextSibling;return r.parentNode.removeChild(r),t}class Ob{constructor(t,s,n){this.children=t,this.pos=s,this.i=n,this.off=0}findPos(t,s=1){for(;;){if(t>this.pos||t==this.pos&&(s>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let n=this.children[--this.i];this.pos-=n.length+n.breakAfter}}}function kb(r,t,s,n,i,a,o,l,c){let{children:h}=r,u=h.length?h[t]:null,m=a.length?a[a.length-1]:null,p=m?m.breakAfter:o;if(!(t==n&&u&&!o&&!p&&a.length<2&&u.merge(s,i,a.length?m:null,s==0,l,c))){if(n<h.length){let x=h[n];x&&(i<x.length||x.breakAfter&&m?.breakAfter)?(t==n&&(x=x.split(i),i=0),!p&&m&&x.merge(0,i,m,!0,0,c)?a[a.length-1]=x:((i||x.children.length&&!x.children[0].length)&&x.merge(0,i,null,!1,0,c),a.push(x))):x?.breakAfter&&(m?m.breakAfter=1:o=1),n++}for(u&&(u.breakAfter=o,s>0&&(!o&&a.length&&u.merge(s,u.length,a[0],!1,l,0)?u.breakAfter=a.shift().breakAfter:(s<u.length||u.children.length&&u.children[u.children.length-1].length==0)&&u.merge(s,u.length,null,!1,l,0),t++));t<n&&a.length;)if(h[n-1].become(a[a.length-1]))n--,a.pop(),c=a.length?0:l;else if(h[t].become(a[0]))t++,a.shift(),l=a.length?0:c;else break;!a.length&&t&&n<h.length&&!h[t-1].breakAfter&&h[n].merge(0,0,h[t-1],!1,l,c)&&t--,(t<n||a.length)&&r.replaceChildren(t,n,a)}}function Cb(r,t,s,n,i,a){let o=r.childCursor(),{i:l,off:c}=o.findPos(s,1),{i:h,off:u}=o.findPos(t,-1),m=t-s;for(let p of n)m+=p.length;r.length+=m,kb(r,h,u,l,c,n,0,i,a)}let Qs=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},_h=typeof document<"u"?document:{documentElement:{style:{}}};const Eh=/Edge\/(\d+)/.exec(Qs.userAgent),Ab=/MSIE \d/.test(Qs.userAgent),Ih=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Qs.userAgent),Ac=!!(Ab||Ih||Eh),Xm=!Ac&&/gecko\/(\d+)/i.test(Qs.userAgent),pd=!Ac&&/Chrome\/(\d+)/.exec(Qs.userAgent),s2="webkitFontSmoothing"in _h.documentElement.style,Tb=!Ac&&/Apple Computer/.test(Qs.vendor),Zm=Tb&&(/Mobile\/\w+/.test(Qs.userAgent)||Qs.maxTouchPoints>2);var Ne={mac:Zm||/Mac/.test(Qs.platform),windows:/Win/.test(Qs.platform),linux:/Linux|X11/.test(Qs.platform),ie:Ac,ie_version:Ab?_h.documentMode||6:Ih?+Ih[1]:Eh?+Eh[1]:0,gecko:Xm,gecko_version:Xm?+(/Firefox\/(\d+)/.exec(Qs.userAgent)||[0,0])[1]:0,chrome:!!pd,chrome_version:pd?+pd[1]:0,ios:Zm,android:/Android\b/.test(Qs.userAgent),safari:Tb,webkit_version:s2?+(/\bAppleWebKit\/(\d+)/.exec(Qs.userAgent)||[0,0])[1]:0,tabSize:_h.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const r2=256;class _r extends Rt{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,s){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(s&&s.node==this.dom&&(s.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,s,n){return this.flags&8||n&&(!(n instanceof _r)||this.length-(s-t)+n.length>r2||n.flags&8)?!1:(this.text=this.text.slice(0,t)+(n?n.text:"")+this.text.slice(s),this.markDirty(),!0)}split(t){let s=new _r(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),s.flags|=this.flags&8,s}localPosFromDOM(t,s){return t==this.dom?s:s?this.text.length:0}domAtPos(t){return new _s(this.dom,t)}domBoundsAround(t,s,n){return{from:n,to:n+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,s){return n2(this.dom,t,s)}}class vn extends Rt{constructor(t,s=[],n=0){super(),this.mark=t,this.children=s,this.length=n;for(let i of s)i.setParent(this)}setAttrs(t){if(bb(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let s in this.mark.attrs)t.setAttribute(s,this.mark.attrs[s]);return t}canReuseDOM(t){return super.canReuseDOM(t)&&!((this.flags|t.flags)&8)}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.flags|=6)}sync(t,s){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,s)}merge(t,s,n,i,a,o){return n&&(!(n instanceof vn&&n.mark.eq(this.mark))||t&&a<=0||s<this.length&&o<=0)?!1:(Cb(this,t,s,n?n.children.slice():[],a-1,o-1),this.markDirty(),!0)}split(t){let s=[],n=0,i=-1,a=0;for(let l of this.children){let c=n+l.length;c>t&&s.push(n<t?l.split(t-n):l),i<0&&n>=t&&(i=a),n=c,a++}let o=this.length-t;return this.length=t,i>-1&&(this.children.length=i,this.markDirty()),new vn(this.mark,s,o)}domAtPos(t){return Pb(this,t)}coordsAt(t,s){return Eb(this,t,s)}}function n2(r,t,s){let n=r.nodeValue.length;t>n&&(t=n);let i=t,a=t,o=0;t==0&&s<0||t==n&&s>=0?Ne.chrome||Ne.gecko||(t?(i--,o=1):a<n&&(a++,o=-1)):s<0?i--:a<n&&a++;let l=mi(r,i,a).getClientRects();if(!l.length)return null;let c=l[(o?o<0:s>=0)?0:l.length-1];return Ne.safari&&!o&&c.width==0&&(c=Array.prototype.find.call(l,h=>h.width)||c),o?fo(c,o<0):c||null}class In extends Rt{static create(t,s,n){return new In(t,s,n)}constructor(t,s,n){super(),this.widget=t,this.length=s,this.side=n,this.prevWidget=null}split(t){let s=In.create(this.widget,this.length-t,this.side);return this.length-=t,s}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,s,n,i,a,o){return n&&(!(n instanceof In)||!this.widget.compare(n.widget)||t>0&&a<=0||s<this.length&&o<=0)?!1:(this.length=t+(n?n.length:0)+(this.length-s),!0)}become(t){return t instanceof In&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return wt.empty;let t=this;for(;t.parent;)t=t.parent;let{view:s}=t,n=s&&s.state.doc,i=this.posAtStart;return n?n.slice(i,i+this.length):wt.empty}domAtPos(t){return(this.length?t==0:this.side>0)?_s.before(this.dom):_s.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,s){let n=this.widget.coordsAt(this.dom,t,s);if(n)return n;let i=this.dom.getClientRects(),a=null;if(!i.length)return null;let o=this.side?this.side<0:t>0;for(let l=o?i.length-1:0;a=i[l],!(t>0?l==0:l==i.length-1||a.top<a.bottom);l+=o?-1:1);return fo(a,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Xi extends Rt{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Xi&&t.side==this.side}split(){return new Xi(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return this.side>0?_s.before(this.dom):_s.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return wt.empty}get isHidden(){return!0}}_r.prototype.children=In.prototype.children=Xi.prototype.children=sf;function Pb(r,t){let s=r.dom,{children:n}=r,i=0;for(let a=0;i<n.length;i++){let o=n[i],l=a+o.length;if(!(l==a&&o.getSide()<=0)){if(t>a&&t<l&&o.dom.parentNode==s)return o.domAtPos(t-a);if(t<=a)break;a=l}}for(let a=i;a>0;a--){let o=n[a-1];if(o.dom.parentNode==s)return o.domAtPos(o.length)}for(let a=i;a<n.length;a++){let o=n[a];if(o.dom.parentNode==s)return o.domAtPos(0)}return new _s(s,0)}function _b(r,t,s){let n,{children:i}=r;s>0&&t instanceof vn&&i.length&&(n=i[i.length-1])instanceof vn&&n.mark.eq(t.mark)?_b(n,t.children[0],s-1):(i.push(t),t.setParent(r)),r.length+=t.length}function Eb(r,t,s){let n=null,i=-1,a=null,o=-1;function l(h,u){for(let m=0,p=0;m<h.children.length&&p<=u;m++){let x=h.children[m],b=p+x.length;b>=u&&(x.children.length?l(x,u-p):(!a||a.isHidden&&(s>0||a2(a,x)))&&(b>u||p==b&&x.getSide()>0)?(a=x,o=u-p):(p<u||p==b&&x.getSide()<0&&!x.isHidden)&&(n=x,i=u-p)),p=b}}l(r,t);let c=(s<0?n:a)||n||a;return c?c.coordsAt(Math.max(0,c==n?i:o),s):i2(r)}function i2(r){let t=r.dom.lastChild;if(!t)return r.dom.getBoundingClientRect();let s=Yi(t);return s[s.length-1]||null}function a2(r,t){let s=r.coordsAt(0,1),n=t.coordsAt(0,1);return s&&n&&n.top<s.bottom}function Dh(r,t){for(let s in r)s=="class"&&t.class?t.class+=" "+r.class:s=="style"&&t.style?t.style+=";"+r.style:t[s]=r[s];return t}const Jm=Object.create(null);function Vl(r,t,s){if(r==t)return!0;r||(r=Jm),t||(t=Jm);let n=Object.keys(r),i=Object.keys(t);if(n.length-(s&&n.indexOf(s)>-1?1:0)!=i.length-(s&&i.indexOf(s)>-1?1:0))return!1;for(let a of n)if(a!=s&&(i.indexOf(a)==-1||r[a]!==t[a]))return!1;return!0}function Rh(r,t,s){let n=!1;if(t)for(let i in t)s&&i in s||(n=!0,i=="style"?r.style.cssText="":r.removeAttribute(i));if(s)for(let i in s)t&&t[i]==s[i]||(n=!0,i=="style"?r.style.cssText=s[i]:r.setAttribute(i,s[i]));return n}function o2(r){let t=Object.create(null);for(let s=0;s<r.attributes.length;s++){let n=r.attributes[s];t[n.name]=n.value}return t}class rn{eq(t){return!1}updateDOM(t,s){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,s,n){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var Ns=(function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r})(Ns||(Ns={}));class qe extends ui{constructor(t,s,n,i){super(),this.startSide=t,this.endSide=s,this.widget=n,this.spec=i}get heightRelevant(){return!1}static mark(t){return new mo(t)}static widget(t){let s=Math.max(-1e4,Math.min(1e4,t.side||0)),n=!!t.block;return s+=n&&!t.inlineOrder?s>0?3e8:-4e8:s>0?1e8:-1e8,new Vn(t,s,s,n,t.widget||null,!1)}static replace(t){let s=!!t.block,n,i;if(t.isBlockGap)n=-5e8,i=4e8;else{let{start:a,end:o}=Ib(t,s);n=(a?s?-3e8:-1:5e8)-1,i=(o?s?2e8:1:-6e8)+1}return new Vn(t,n,i,s,t.widget||null,!0)}static line(t){return new po(t)}static set(t,s=!1){return Ot.of(t,s)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}qe.none=Ot.empty;class mo extends qe{constructor(t){let{start:s,end:n}=Ib(t);super(s?-1:5e8,n?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){var s,n;return this==t||t instanceof mo&&this.tagName==t.tagName&&(this.class||((s=this.attrs)===null||s===void 0?void 0:s.class))==(t.class||((n=t.attrs)===null||n===void 0?void 0:n.class))&&Vl(this.attrs,t.attrs,"class")}range(t,s=t){if(t>=s)throw new RangeError("Mark decorations may not be empty");return super.range(t,s)}}mo.prototype.point=!1;class po extends qe{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof po&&this.spec.class==t.spec.class&&Vl(this.spec.attributes,t.spec.attributes)}range(t,s=t){if(s!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,s)}}po.prototype.mapMode=ws.TrackBefore;po.prototype.point=!0;class Vn extends qe{constructor(t,s,n,i,a,o){super(s,n,a,t),this.block=i,this.isReplace=o,this.mapMode=i?s<=0?ws.TrackBefore:ws.TrackAfter:ws.TrackDel}get type(){return this.startSide!=this.endSide?Ns.WidgetRange:this.startSide<=0?Ns.WidgetBefore:Ns.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof Vn&&l2(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,s=t){if(this.isReplace&&(t>s||t==s&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&s!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,s)}}Vn.prototype.point=!0;function Ib(r,t=!1){let{inclusiveStart:s,inclusiveEnd:n}=r;return s==null&&(s=r.inclusive),n==null&&(n=r.inclusive),{start:s??t,end:n??t}}function l2(r,t){return r==t||!!(r&&t&&r.compare(t))}function bl(r,t,s,n=0){let i=s.length-1;i>=0&&s[i]+n>=r?s[i]=Math.max(s[i],t):s.push(r,t)}class ns extends Rt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,s,n,i,a,o){if(n){if(!(n instanceof ns))return!1;this.dom||n.transferDOM(this)}return i&&this.setDeco(n?n.attrs:null),Cb(this,t,s,n?n.children.slice():[],a,o),!0}split(t){let s=new ns;if(s.breakAfter=this.breakAfter,this.length==0)return s;let{i:n,off:i}=this.childPos(t);i&&(s.append(this.children[n].split(i),0),this.children[n].merge(i,this.children[n].length,null,!1,0,0),n++);for(let a=n;a<this.children.length;a++)s.append(this.children[a],0);for(;n>0&&this.children[n-1].length==0;)this.children[--n].destroy();return this.children.length=n,this.markDirty(),this.length=t,s}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Vl(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,s){_b(this,t,s)}addLineDeco(t){let s=t.spec.attributes,n=t.spec.class;s&&(this.attrs=Dh(s,this.attrs||{})),n&&(this.attrs=Dh({class:n},this.attrs||{}))}domAtPos(t){return Pb(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.flags|=6)}sync(t,s){var n;this.dom?this.flags&4&&(bb(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Rh(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,s);let i=this.dom.lastChild;for(;i&&Rt.get(i)instanceof vn;)i=i.lastChild;if(!i||!this.length||i.nodeName!="BR"&&((n=Rt.get(i))===null||n===void 0?void 0:n.isEditable)==!1&&(!Ne.ios||!this.children.some(a=>a instanceof _r))){let a=document.createElement("BR");a.cmIgnore=!0,this.dom.appendChild(a)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0,s;for(let n of this.children){if(!(n instanceof _r)||/[^ -~]/.test(n.text))return null;let i=Yi(n.dom);if(i.length!=1)return null;t+=i[0].width,s=i[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:s}:null}coordsAt(t,s){let n=Eb(this,t,s);if(!this.children.length&&n&&this.parent){let{heightOracle:i}=this.parent.view.viewState,a=n.bottom-n.top;if(Math.abs(a-i.lineHeight)<2&&i.textHeight<a){let o=(a-i.textHeight)/2;return{top:n.top+o,bottom:n.bottom-o,left:n.left,right:n.left}}}return n}become(t){return t instanceof ns&&this.children.length==0&&t.children.length==0&&Vl(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,s){for(let n=0,i=0;n<t.children.length;n++){let a=t.children[n],o=i+a.length;if(o>=s){if(a instanceof ns)return a;if(o>s)break}i=o+a.breakAfter}return null}}class pn extends Rt{constructor(t,s,n){super(),this.widget=t,this.length=s,this.deco=n,this.breakAfter=0,this.prevWidget=null}merge(t,s,n,i,a,o){return n&&(!(n instanceof pn)||!this.widget.compare(n.widget)||t>0&&a<=0||s<this.length&&o<=0)?!1:(this.length=t+(n?n.length:0)+(this.length-s),!0)}domAtPos(t){return t==0?_s.before(this.dom):_s.after(this.dom,t==this.length)}split(t){let s=this.length-t;this.length=t;let n=new pn(this.widget,s,this.deco);return n.breakAfter=this.breakAfter,n}get children(){return sf}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):wt.empty}domBoundsAround(){return null}become(t){return t instanceof pn&&t.widget.constructor==this.widget.constructor?(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,s){let n=this.widget.coordsAt(this.dom,t,s);return n||(this.widget instanceof Mh?null:fo(this.dom.getBoundingClientRect(),this.length?t==0:s<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(t){let{startSide:s,endSide:n}=this.deco;return s==n?!1:t<0?s<0:n>0}}class Mh extends rn{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class Ea{constructor(t,s,n,i){this.doc=t,this.pos=s,this.end=n,this.disallowBlockEffectsFor=i,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=s}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof pn&&t.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new ns),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Vo(new Xi(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(t&&this.content.length&&this.content[this.content.length-1]instanceof pn)&&this.getLine()}buildText(t,s,n){for(;t>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}else this.text=a,this.textOff=0}let i=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(s.slice(s.length-n)),this.getLine().append(Vo(new _r(this.text.slice(this.textOff,this.textOff+i)),s),n),this.atCursorPos=!0,this.textOff+=i,t-=i,n=0}}span(t,s,n,i){this.buildText(s-t,n,i),this.pos=s,this.openStart<0&&(this.openStart=i)}point(t,s,n,i,a,o){if(this.disallowBlockEffectsFor[o]&&n instanceof Vn){if(n.block)throw new RangeError("Block decorations may not be specified via plugins");if(s>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=s-t;if(n instanceof Vn)if(n.block)n.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new pn(n.widget||Zi.block,l,n));else{let c=In.create(n.widget||Zi.inline,l,l?0:n.startSide),h=this.atCursorPos&&!c.isEditable&&a<=i.length&&(t<s||n.startSide>0),u=!c.isEditable&&(t<s||a>i.length||n.startSide<=0),m=this.getLine();this.pendingBuffer==2&&!h&&!c.isEditable&&(this.pendingBuffer=0),this.flushBuffer(i),h&&(m.append(Vo(new Xi(1),i),a),a=i.length+Math.max(0,a-i.length)),m.append(Vo(c,i),a),this.atCursorPos=u,this.pendingBuffer=u?t<s||a>i.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=i.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(n);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=s),this.openStart<0&&(this.openStart=a)}static build(t,s,n,i,a){let o=new Ea(t,s,n,a);return o.openEnd=Ot.spans(i,s,n,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Vo(r,t){for(let s of t)r=new vn(s,[r],r.length);return r}class Zi extends rn{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Zi.inline=new Zi("span");Zi.block=new Zi("div");var zt=(function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r})(zt||(zt={}));const pi=zt.LTR,rf=zt.RTL;function Db(r){let t=[];for(let s=0;s<r.length;s++)t.push(1<<+r[s]);return t}const c2=Db("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),d2=Db("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Lh=Object.create(null),Mr=[];for(let r of["()","[]","{}"]){let t=r.charCodeAt(0),s=r.charCodeAt(1);Lh[t]=s,Lh[s]=-t}function Rb(r){return r<=247?c2[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?d2[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8204?256:64336<=r&&r<=65023?4:1}const h2=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Dn{get dir(){return this.level%2?rf:pi}constructor(t,s,n){this.from=t,this.to=s,this.level=n}side(t,s){return this.dir==s==t?this.to:this.from}forward(t,s){return t==(this.dir==s)}static find(t,s,n,i){let a=-1;for(let o=0;o<t.length;o++){let l=t[o];if(l.from<=s&&l.to>=s){if(l.level==n)return o;(a<0||(i!=0?i<0?l.from<s:l.to>s:t[a].level>l.level))&&(a=o)}}if(a<0)throw new RangeError("Index out of range");return a}}function Mb(r,t){if(r.length!=t.length)return!1;for(let s=0;s<r.length;s++){let n=r[s],i=t[s];if(n.from!=i.from||n.to!=i.to||n.direction!=i.direction||!Mb(n.inner,i.inner))return!1}return!0}const It=[];function u2(r,t,s,n,i){for(let a=0;a<=n.length;a++){let o=a?n[a-1].to:t,l=a<n.length?n[a].from:s,c=a?256:i;for(let h=o,u=c,m=c;h<l;h++){let p=Rb(r.charCodeAt(h));p==512?p=u:p==8&&m==4&&(p=16),It[h]=p==4?2:p,p&7&&(m=p),u=p}for(let h=o,u=c,m=c;h<l;h++){let p=It[h];if(p==128)h<l-1&&u==It[h+1]&&u&24?p=It[h]=u:It[h]=256;else if(p==64){let x=h+1;for(;x<l&&It[x]==64;)x++;let b=h&&u==8||x<s&&It[x]==8?m==1?1:8:256;for(let w=h;w<x;w++)It[w]=b;h=x-1}else p==8&&m==1&&(It[h]=1);u=p,p&7&&(m=p)}}}function f2(r,t,s,n,i){let a=i==1?2:1;for(let o=0,l=0,c=0;o<=n.length;o++){let h=o?n[o-1].to:t,u=o<n.length?n[o].from:s;for(let m=h,p,x,b;m<u;m++)if(x=Lh[p=r.charCodeAt(m)])if(x<0){for(let w=l-3;w>=0;w-=3)if(Mr[w+1]==-x){let C=Mr[w+2],A=C&2?i:C&4?C&1?a:i:0;A&&(It[m]=It[Mr[w]]=A),l=w;break}}else{if(Mr.length==189)break;Mr[l++]=m,Mr[l++]=p,Mr[l++]=c}else if((b=It[m])==2||b==1){let w=b==i;c=w?0:1;for(let C=l-3;C>=0;C-=3){let A=Mr[C+2];if(A&2)break;if(w)Mr[C+2]|=2;else{if(A&4)break;Mr[C+2]|=4}}}}}function m2(r,t,s,n){for(let i=0,a=n;i<=s.length;i++){let o=i?s[i-1].to:r,l=i<s.length?s[i].from:t;for(let c=o;c<l;){let h=It[c];if(h==256){let u=c+1;for(;;)if(u==l){if(i==s.length)break;u=s[i++].to,l=i<s.length?s[i].from:t}else if(It[u]==256)u++;else break;let m=a==1,p=(u<t?It[u]:n)==1,x=m==p?m?1:2:n;for(let b=u,w=i,C=w?s[w-1].to:r;b>c;)b==C&&(b=s[--w].from,C=w?s[w-1].to:r),It[--b]=x;c=u}else a=h,c++}}}function Fh(r,t,s,n,i,a,o){let l=n%2?2:1;if(n%2==i%2)for(let c=t,h=0;c<s;){let u=!0,m=!1;if(h==a.length||c<a[h].from){let w=It[c];w!=l&&(u=!1,m=w==16)}let p=!u&&l==1?[]:null,x=u?n:n+1,b=c;e:for(;;)if(h<a.length&&b==a[h].from){if(m)break e;let w=a[h];if(!u)for(let C=w.to,A=h+1;;){if(C==s)break e;if(A<a.length&&a[A].from==C)C=a[A++].to;else{if(It[C]==l)break e;break}}if(h++,p)p.push(w);else{w.from>c&&o.push(new Dn(c,w.from,x));let C=w.direction==pi!=!(x%2);Nh(r,C?n+1:n,i,w.inner,w.from,w.to,o),c=w.to}b=w.to}else{if(b==s||(u?It[b]!=l:It[b]==l))break;b++}p?Fh(r,c,b,n+1,i,p,o):c<b&&o.push(new Dn(c,b,x)),c=b}else for(let c=s,h=a.length;c>t;){let u=!0,m=!1;if(!h||c>a[h-1].to){let w=It[c-1];w!=l&&(u=!1,m=w==16)}let p=!u&&l==1?[]:null,x=u?n:n+1,b=c;e:for(;;)if(h&&b==a[h-1].to){if(m)break e;let w=a[--h];if(!u)for(let C=w.from,A=h;;){if(C==t)break e;if(A&&a[A-1].to==C)C=a[--A].from;else{if(It[C-1]==l)break e;break}}if(p)p.push(w);else{w.to<c&&o.push(new Dn(w.to,c,x));let C=w.direction==pi!=!(x%2);Nh(r,C?n+1:n,i,w.inner,w.from,w.to,o),c=w.from}b=w.from}else{if(b==t||(u?It[b-1]!=l:It[b-1]==l))break;b--}p?Fh(r,b,c,n+1,i,p,o):b<c&&o.push(new Dn(b,c,x)),c=b}}function Nh(r,t,s,n,i,a,o){let l=t%2?2:1;u2(r,i,a,n,l),f2(r,i,a,n,l),m2(i,a,n,l),Fh(r,i,a,t,s,n,o)}function p2(r,t,s){if(!r)return[new Dn(0,0,t==rf?1:0)];if(t==pi&&!s.length&&!h2.test(r))return Lb(r.length);if(s.length)for(;r.length>It.length;)It[It.length]=256;let n=[],i=t==pi?0:1;return Nh(r,i,i,s,0,r.length,n),n}function Lb(r){return[new Dn(0,r,0)]}let Fb="";function g2(r,t,s,n,i){var a;let o=n.head-r.from,l=Dn.find(t,o,(a=n.bidiLevel)!==null&&a!==void 0?a:-1,n.assoc),c=t[l],h=c.side(i,s);if(o==h){let p=l+=i?1:-1;if(p<0||p>=t.length)return null;c=t[l=p],o=c.side(!i,s),h=c.side(i,s)}let u=Ss(r.text,o,c.forward(i,s));(u<c.from||u>c.to)&&(u=h),Fb=r.text.slice(Math.min(o,u),Math.max(o,u));let m=l==(i?t.length-1:0)?null:t[l+(i?1:-1)];return m&&u==h&&m.level+(i?0:1)<c.level?ye.cursor(m.side(!i,s)+r.from,m.forward(i,s)?1:-1,m.level):ye.cursor(u+r.from,c.forward(i,s)?-1:1,c.level)}function x2(r,t,s){for(let n=t;n<s;n++){let i=Rb(r.charCodeAt(n));if(i==1)return pi;if(i==2||i==4)return rf}return pi}const Nb=We.define(),Wb=We.define(),$b=We.define(),Vb=We.define(),Wh=We.define(),zb=We.define(),Bb=We.define(),nf=We.define(),af=We.define(),Ub=We.define({combine:r=>r.some(t=>t)}),Qb=We.define({combine:r=>r.some(t=>t)}),qb=We.define();class Vi{constructor(t,s="nearest",n="nearest",i=5,a=5,o=!1){this.range=t,this.y=s,this.x=n,this.yMargin=i,this.xMargin=a,this.isSnapshot=o}map(t){return t.empty?this:new Vi(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new Vi(ye.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const zo=nt.define({map:(r,t)=>r.map(t)}),Hb=nt.define();function Hs(r,t,s){let n=r.facet(Vb);n.length?n[0](t):window.onerror&&window.onerror(String(t),s,void 0,void 0,t)||(s?console.error(s+":",t):console.error(t))}const fn=We.define({combine:r=>r.length?r[0]:!0});let y2=0;const Di=We.define({combine(r){return r.filter((t,s)=>{for(let n=0;n<s;n++)if(r[n].plugin==t.plugin)return!1;return!0})}});class ss{constructor(t,s,n,i,a){this.id=t,this.create=s,this.domEventHandlers=n,this.domEventObservers=i,this.baseExtensions=a(this),this.extension=this.baseExtensions.concat(Di.of({plugin:this,arg:void 0}))}of(t){return this.baseExtensions.concat(Di.of({plugin:this,arg:t}))}static define(t,s){const{eventHandlers:n,eventObservers:i,provide:a,decorations:o}=s||{};return new ss(y2++,t,n,i,l=>{let c=[];return o&&c.push(qa.of(h=>{let u=h.plugin(l);return u?o(u):qe.none})),a&&c.push(a(l)),c})}static fromClass(t,s){return ss.define((n,i)=>new t(n,i),s)}}class gd{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(t){if(this.value){if(this.mustUpdate){let s=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(s)}catch(n){if(Hs(s.state,n,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(t,this.spec.arg)}catch(s){Hs(t.state,s,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var s;if(!((s=this.value)===null||s===void 0)&&s.destroy)try{this.value.destroy()}catch(n){Hs(t.state,n,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const Gb=We.define(),of=We.define(),qa=We.define(),Kb=We.define(),Tc=We.define(),Yb=We.define();function ep(r,t){let s=r.state.facet(Yb);if(!s.length)return s;let n=s.map(a=>a instanceof Function?a(r):a),i=[];return Ot.spans(n,t.from,t.to,{point(){},span(a,o,l,c){let h=a-t.from,u=o-t.from,m=i;for(let p=l.length-1;p>=0;p--,c--){let x=l[p].spec.bidiIsolate,b;if(x==null&&(x=x2(t.text,h,u)),c>0&&m.length&&(b=m[m.length-1]).to==h&&b.direction==x)b.to=u,m=b.inner;else{let w={from:h,to:u,direction:x,inner:[]};m.push(w),m=w.inner}}}}),i}const Xb=We.define();function lf(r){let t=0,s=0,n=0,i=0;for(let a of r.state.facet(Xb)){let o=a(r);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(s=Math.max(s,o.right)),o.top!=null&&(n=Math.max(n,o.top)),o.bottom!=null&&(i=Math.max(i,o.bottom)))}return{left:t,right:s,top:n,bottom:i}}const wa=We.define();class yr{constructor(t,s,n,i){this.fromA=t,this.toA=s,this.fromB=n,this.toB=i}join(t){return new yr(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let s=t.length,n=this;for(;s>0;s--){let i=t[s-1];if(!(i.fromA>n.toA)){if(i.toA<n.fromA)break;n=n.join(i),t.splice(s-1,1)}}return t.splice(s,0,n),t}static extendWithRanges(t,s){if(s.length==0)return t;let n=[];for(let i=0,a=0,o=0,l=0;;i++){let c=i==t.length?null:t[i],h=o-l,u=c?c.fromB:1e9;for(;a<s.length&&s[a]<u;){let m=s[a],p=s[a+1],x=Math.max(l,m),b=Math.min(u,p);if(x<=b&&new yr(x+h,b+h,x,b).addToSet(n),p>u)break;a+=2}if(!c)return n;new yr(c.fromA,c.toA,c.fromB,c.toB).addToSet(n),o=c.toA,l=c.toB}}}class zl{constructor(t,s,n){this.view=t,this.state=s,this.transactions=n,this.flags=0,this.startState=t.state,this.changes=hs.empty(this.startState.doc.length);for(let a of n)this.changes=this.changes.compose(a.changes);let i=[];this.changes.iterChangedRanges((a,o,l,c)=>i.push(new yr(a,o,l,c))),this.changedRanges=i}static create(t,s,n){return new zl(t,s,n)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class tp extends Rt{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=qe.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new ns],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new yr(0,0,0,t.state.doc.length)],0,null)}update(t){var s;let n=t.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:h,toA:u})=>u<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let i=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((s=this.domChanged)===null||s===void 0)&&s.newSel?i=this.domChanged.newSel.head:!k2(t.changes,this.hasComposition)&&!t.selectionSet&&(i=t.state.selection.main.head));let a=i>-1?b2(this.view,t.changes,i):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:h,to:u}=this.hasComposition;n=new yr(h,u,t.changes.mapPos(h,-1),t.changes.mapPos(u,1)).addToSet(n.slice())}this.hasComposition=a?{from:a.range.fromB,to:a.range.toB}:null,(Ne.ie||Ne.chrome)&&!a&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.updateDeco(),c=S2(o,l,t.changes);return n=yr.extendWithRanges(n,c),!(this.flags&7)&&n.length==0?!1:(this.updateInner(n,t.startState.doc.length,a),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,s,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,s,n);let{observer:i}=this.view;i.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=Ne.chrome||Ne.ios?{node:i.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||i.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let a=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof pn&&o.widget instanceof Mh&&a.push(o.dom);i.updateGaps(a)}updateChildren(t,s,n){let i=n?n.range.addToSet(t.slice()):t,a=this.childCursor(s);for(let o=i.length-1;;o--){let l=o>=0?i[o]:null;if(!l)break;let{fromA:c,toA:h,fromB:u,toB:m}=l,p,x,b,w;if(n&&n.range.fromB<m&&n.range.toB>u){let E=Ea.build(this.view.state.doc,u,n.range.fromB,this.decorations,this.dynamicDecorationMap),T=Ea.build(this.view.state.doc,n.range.toB,m,this.decorations,this.dynamicDecorationMap);x=E.breakAtStart,b=E.openStart,w=T.openEnd;let M=this.compositionView(n);T.breakAtStart?M.breakAfter=1:T.content.length&&M.merge(M.length,M.length,T.content[0],!1,T.openStart,0)&&(M.breakAfter=T.content[0].breakAfter,T.content.shift()),E.content.length&&M.merge(0,0,E.content[E.content.length-1],!0,0,E.openEnd)&&E.content.pop(),p=E.content.concat(M).concat(T.content)}else({content:p,breakAtStart:x,openStart:b,openEnd:w}=Ea.build(this.view.state.doc,u,m,this.decorations,this.dynamicDecorationMap));let{i:C,off:A}=a.findPos(h,1),{i:_,off:R}=a.findPos(c,-1);kb(this,_,R,C,A,p,x,b,w)}n&&this.fixCompositionDOM(n)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let s of t.transactions)for(let n of s.effects)n.is(Hb)&&(this.editContextFormatting=n.value)}compositionView(t){let s=new _r(t.text.nodeValue);s.flags|=8;for(let{deco:i}of t.marks)s=new vn(i,[s],s.length);let n=new ns;return n.append(s,0),n}fixCompositionDOM(t){let s=(a,o)=>{o.flags|=8|(o.children.some(c=>c.flags&7)?1:0),this.markedForComposition.add(o);let l=Rt.get(a);l&&l!=o&&(l.dom=null),o.setDOM(a)},n=this.childPos(t.range.fromB,1),i=this.children[n.i];s(t.line,i);for(let a=t.marks.length-1;a>=-1;a--)n=i.childPos(n.off,1),i=i.children[n.i],s(a>=0?t.marks[a].node:t.text,i)}updateSelection(t=!1,s=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let n=this.view.root.activeElement,i=n==this.dom,a=!i&&!(this.view.state.facet(fn)||this.dom.tabIndex>-1)&&jl(this.dom,this.view.observer.selectionRange)&&!(n&&this.dom.contains(n));if(!(i||s||a))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,c=this.moveToLine(this.domAtPos(l.anchor)),h=l.empty?c:this.moveToLine(this.domAtPos(l.head));if(Ne.gecko&&l.empty&&!this.hasComposition&&j2(c)){let m=document.createTextNode("");this.view.observer.ignore(()=>c.node.insertBefore(m,c.node.childNodes[c.offset]||null)),c=h=new _s(m,0),o=!0}let u=this.view.observer.selectionRange;(o||!u.focusNode||(!_a(c.node,c.offset,u.anchorNode,u.anchorOffset)||!_a(h.node,h.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,l))&&(this.view.observer.ignore(()=>{Ne.android&&Ne.chrome&&this.dom.contains(u.focusNode)&&O2(u.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let m=Qa(this.view.root);if(m)if(l.empty){if(Ne.gecko){let p=v2(c.node,c.offset);if(p&&p!=3){let x=(p==1?wb:Sb)(c.node,c.offset);x&&(c=new _s(x.node,x.offset))}}m.collapse(c.node,c.offset),l.bidiLevel!=null&&m.caretBidiLevel!==void 0&&(m.caretBidiLevel=l.bidiLevel)}else if(m.extend){m.collapse(c.node,c.offset);try{m.extend(h.node,h.offset)}catch{}}else{let p=document.createRange();l.anchor>l.head&&([c,h]=[h,c]),p.setEnd(h.node,h.offset),p.setStart(c.node,c.offset),m.removeAllRanges(),m.addRange(p)}a&&this.view.root.activeElement==this.dom&&(this.dom.blur(),n&&n.focus())}),this.view.observer.setSelectionRange(c,h)),this.impreciseAnchor=c.precise?null:new _s(u.anchorNode,u.anchorOffset),this.impreciseHead=h.precise?null:new _s(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(t,s){return this.hasComposition&&s.empty&&_a(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==s.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,s=t.state.selection.main,n=Qa(t.root),{anchorNode:i,anchorOffset:a}=t.observer.selectionRange;if(!n||!s.empty||!s.assoc||!n.modify)return;let o=ns.find(this,s.head);if(!o)return;let l=o.posAtStart;if(s.head==l||s.head==l+o.length)return;let c=this.coordsAt(s.head,-1),h=this.coordsAt(s.head,1);if(!c||!h||c.bottom>h.top)return;let u=this.domAtPos(s.head+s.assoc);n.collapse(u.node,u.offset),n.modify("move",s.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let m=t.observer.selectionRange;t.docView.posFromDOM(m.anchorNode,m.anchorOffset)!=s.from&&n.collapse(i,a)}moveToLine(t){let s=this.dom,n;if(t.node!=s)return t;for(let i=t.offset;!n&&i<s.childNodes.length;i++){let a=Rt.get(s.childNodes[i]);a instanceof ns&&(n=a.domAtPos(0))}for(let i=t.offset-1;!n&&i>=0;i--){let a=Rt.get(s.childNodes[i]);a instanceof ns&&(n=a.domAtPos(a.length))}return n?new _s(n.node,n.offset,!0):t}nearest(t){for(let s=t;s;){let n=Rt.get(s);if(n&&n.rootView==this)return n;s=s.parentNode}return null}posFromDOM(t,s){let n=this.nearest(t);if(!n)throw new RangeError("Trying to find position for a DOM position outside of the document");return n.localPosFromDOM(t,s)+n.posAtStart}domAtPos(t){let{i:s,off:n}=this.childCursor().findPos(t,-1);for(;s<this.children.length-1;){let i=this.children[s];if(n<i.length||i instanceof ns)break;s++,n=0}return this.children[s].domAtPos(n)}coordsAt(t,s){let n=null,i=0;for(let a=this.length,o=this.children.length-1;o>=0;o--){let l=this.children[o],c=a-l.breakAfter,h=c-l.length;if(c<t)break;if(h<=t&&(h<t||l.covers(-1))&&(c>t||l.covers(1))&&(!n||l instanceof ns&&!(n instanceof ns&&s>=0)))n=l,i=h;else if(n&&h==t&&c==t&&l instanceof pn&&Math.abs(s)<2){if(l.deco.startSide<0)break;o&&(n=null)}a=h}return n?n.coordsAt(t-i,s):null}coordsForChar(t){let{i:s,off:n}=this.childPos(t,1),i=this.children[s];if(!(i instanceof ns))return null;for(;i.children.length;){let{i:l,off:c}=i.childPos(n,1);for(;;l++){if(l==i.children.length)return null;if((i=i.children[l]).length)break}n=c}if(!(i instanceof _r))return null;let a=Ss(i.text,n);if(a==n)return null;let o=mi(i.dom,n,a).getClientRects();for(let l=0;l<o.length;l++){let c=o[l];if(l==o.length-1||c.top<c.bottom&&c.left<c.right)return c}return null}measureVisibleLineHeights(t){let s=[],{from:n,to:i}=t,a=this.view.contentDOM.clientWidth,o=a>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,c=this.view.textDirection==zt.LTR;for(let h=0,u=0;u<this.children.length;u++){let m=this.children[u],p=h+m.length;if(p>i)break;if(h>=n){let x=m.dom.getBoundingClientRect();if(s.push(x.height),o){let b=m.dom.lastChild,w=b?Yi(b):[];if(w.length){let C=w[w.length-1],A=c?C.right-x.left:x.right-C.left;A>l&&(l=A,this.minWidth=a,this.minWidthFrom=h,this.minWidthTo=p)}}}h=p+m.breakAfter}return s}textDirectionAt(t){let{i:s}=this.childPos(t,1);return getComputedStyle(this.children[s].dom).direction=="rtl"?zt.RTL:zt.LTR}measureTextSize(){for(let a of this.children)if(a instanceof ns){let o=a.measureTextSize();if(o)return o}let t=document.createElement("div"),s,n,i;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let a=Yi(t.firstChild)[0];s=t.getBoundingClientRect().height,n=a?a.width/27:7,i=a?a.height:s,t.remove()}),{lineHeight:s,charWidth:n,textHeight:i}}childCursor(t=this.length){let s=this.children.length;return s&&(t-=this.children[--s].length),new Ob(this.children,t,s)}computeBlockGapDeco(){let t=[],s=this.view.viewState;for(let n=0,i=0;;i++){let a=i==s.viewports.length?null:s.viewports[i],o=a?a.from-1:this.length;if(o>n){let l=(s.lineBlockAt(o).bottom-s.lineBlockAt(n).top)/this.view.scaleY;t.push(qe.replace({widget:new Mh(l),block:!0,inclusive:!0,isBlockGap:!0}).range(n,o))}if(!a)break;n=a.to+1}return qe.set(t)}updateDeco(){let t=1,s=this.view.state.facet(qa).map(a=>(this.dynamicDecorationMap[t++]=typeof a=="function")?a(this.view):a),n=!1,i=this.view.state.facet(Kb).map((a,o)=>{let l=typeof a=="function";return l&&(n=!0),l?a(this.view):a});for(i.length&&(this.dynamicDecorationMap[t++]=n,s.push(Ot.join(i))),this.decorations=[this.editContextFormatting,...s,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;return this.decorations}scrollIntoView(t){if(t.isSnapshot){let h=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=h.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let h of this.view.state.facet(qb))try{if(h(this.view,t.range,t))return!0}catch(u){Hs(this.view.state,u,"scroll handler")}let{range:s}=t,n=this.coordsAt(s.head,s.empty?s.assoc:s.head>s.anchor?-1:1),i;if(!n)return;!s.empty&&(i=this.coordsAt(s.anchor,s.anchor>s.head?-1:1))&&(n={left:Math.min(n.left,i.left),top:Math.min(n.top,i.top),right:Math.max(n.right,i.right),bottom:Math.max(n.bottom,i.bottom)});let a=lf(this.view),o={left:n.left-a.left,top:n.top-a.top,right:n.right+a.right,bottom:n.bottom+a.bottom},{offsetWidth:l,offsetHeight:c}=this.view.scrollDOM;XC(this.view.scrollDOM,o,s.head<s.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,l),-l),Math.max(Math.min(t.yMargin,c),-c),this.view.textDirection==zt.LTR)}}function j2(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}function Zb(r,t){let s=r.observer.selectionRange;if(!s.focusNode)return null;let n=wb(s.focusNode,s.focusOffset),i=Sb(s.focusNode,s.focusOffset),a=n||i;if(i&&n&&i.node!=n.node){let l=Rt.get(i.node);if(!l||l instanceof _r&&l.text!=i.node.nodeValue)a=i;else if(r.docView.lastCompositionAfterCursor){let c=Rt.get(n.node);!c||c instanceof _r&&c.text!=n.node.nodeValue||(a=i)}}if(r.docView.lastCompositionAfterCursor=a!=n,!a)return null;let o=t-a.offset;return{from:o,to:o+a.node.nodeValue.length,node:a.node}}function b2(r,t,s){let n=Zb(r,s);if(!n)return null;let{node:i,from:a,to:o}=n,l=i.nodeValue;if(/[\n\r]/.test(l)||r.state.doc.sliceString(n.from,n.to)!=l)return null;let c=t.invertedDesc,h=new yr(c.mapPos(a),c.mapPos(o),a,o),u=[];for(let m=i.parentNode;;m=m.parentNode){let p=Rt.get(m);if(p instanceof vn)u.push({node:m,deco:p.mark});else{if(p instanceof ns||m.nodeName=="DIV"&&m.parentNode==r.contentDOM)return{range:h,text:i,marks:u,line:m};if(m!=r.contentDOM)u.push({node:m,deco:new mo({inclusive:!0,attributes:o2(m),tagName:m.tagName.toLowerCase()})});else return null}}}function v2(r,t){return r.nodeType!=1?0:(t&&r.childNodes[t-1].contentEditable=="false"?1:0)|(t<r.childNodes.length&&r.childNodes[t].contentEditable=="false"?2:0)}let w2=class{constructor(){this.changes=[]}compareRange(t,s){bl(t,s,this.changes)}comparePoint(t,s){bl(t,s,this.changes)}boundChange(t){bl(t,t,this.changes)}};function S2(r,t,s){let n=new w2;return Ot.compare(r,t,s,n),n.changes}function O2(r,t){for(let s=r;s&&s!=t;s=s.assignedSlot||s.parentNode)if(s.nodeType==1&&s.contentEditable=="false")return!0;return!1}function k2(r,t){let s=!1;return t&&r.iterChangedRanges((n,i)=>{n<t.to&&i>t.from&&(s=!0)}),s}function C2(r,t,s=1){let n=r.charCategorizer(t),i=r.doc.lineAt(t),a=t-i.from;if(i.length==0)return ye.cursor(t);a==0?s=1:a==i.length&&(s=-1);let o=a,l=a;s<0?o=Ss(i.text,a,!1):l=Ss(i.text,a);let c=n(i.text.slice(o,l));for(;o>0;){let h=Ss(i.text,o,!1);if(n(i.text.slice(h,o))!=c)break;o=h}for(;l<i.length;){let h=Ss(i.text,l);if(n(i.text.slice(l,h))!=c)break;l=h}return ye.range(o+i.from,l+i.from)}function A2(r,t){return t.left>r?t.left-r:Math.max(0,r-t.right)}function T2(r,t){return t.top>r?t.top-r:Math.max(0,r-t.bottom)}function xd(r,t){return r.top<t.bottom-1&&r.bottom>t.top+1}function sp(r,t){return t<r.top?{top:t,left:r.left,right:r.right,bottom:r.bottom}:r}function rp(r,t){return t>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:t}:r}function $h(r,t,s){let n,i,a,o,l=!1,c,h,u,m;for(let b=r.firstChild;b;b=b.nextSibling){let w=Yi(b);for(let C=0;C<w.length;C++){let A=w[C];i&&xd(i,A)&&(A=sp(rp(A,i.bottom),i.top));let _=A2(t,A),R=T2(s,A);if(_==0&&R==0)return b.nodeType==3?np(b,t,s):$h(b,t,s);(!n||o>R||o==R&&a>_)&&(n=b,i=A,a=_,o=R,l=_?t<A.left?C>0:C<w.length-1:!0),_==0?s>A.bottom&&(!u||u.bottom<A.bottom)?(c=b,u=A):s<A.top&&(!m||m.top>A.top)&&(h=b,m=A):u&&xd(u,A)?u=rp(u,A.bottom):m&&xd(m,A)&&(m=sp(m,A.top))}}if(u&&u.bottom>=s?(n=c,i=u):m&&m.top<=s&&(n=h,i=m),!n)return{node:r,offset:0};let p=Math.max(i.left,Math.min(i.right,t));if(n.nodeType==3)return np(n,p,s);if(l&&n.contentEditable!="false")return $h(n,p,s);let x=Array.prototype.indexOf.call(r.childNodes,n)+(t>=(i.left+i.right)/2?1:0);return{node:r,offset:x}}function np(r,t,s){let n=r.nodeValue.length,i=-1,a=1e9,o=0;for(let l=0;l<n;l++){let c=mi(r,l,l+1).getClientRects();for(let h=0;h<c.length;h++){let u=c[h];if(u.top==u.bottom)continue;o||(o=t-u.left);let m=(u.top>s?u.top-s:s-u.bottom)-1;if(u.left-1<=t&&u.right+1>=t&&m<a){let p=t>=(u.left+u.right)/2,x=p;if((Ne.chrome||Ne.gecko)&&mi(r,l).getBoundingClientRect().left==u.right&&(x=!p),m<=0)return{node:r,offset:l+(x?1:0)};i=l+(x?1:0),a=m}}}return{node:r,offset:i>-1?i:o>0?r.nodeValue.length:0}}function Jb(r,t,s,n=-1){var i,a;let o=r.contentDOM.getBoundingClientRect(),l=o.top+r.viewState.paddingTop,c,{docHeight:h}=r.viewState,{x:u,y:m}=t,p=m-l;if(p<0)return 0;if(p>h)return r.state.doc.length;for(let E=r.viewState.heightOracle.textHeight/2,T=!1;c=r.elementAtHeight(p),c.type!=Ns.Text;)for(;p=n>0?c.bottom+E:c.top-E,!(p>=0&&p<=h);){if(T)return s?null:0;T=!0,n=-n}m=l+p;let x=c.from;if(x<r.viewport.from)return r.viewport.from==0?0:s?null:ip(r,o,c,u,m);if(x>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:s?null:ip(r,o,c,u,m);let b=r.dom.ownerDocument,w=r.root.elementFromPoint?r.root:b,C=w.elementFromPoint(u,m);C&&!r.contentDOM.contains(C)&&(C=null),C||(u=Math.max(o.left+1,Math.min(o.right-1,u)),C=w.elementFromPoint(u,m),C&&!r.contentDOM.contains(C)&&(C=null));let A,_=-1;if(C&&((i=r.docView.nearest(C))===null||i===void 0?void 0:i.isEditable)!=!1){if(b.caretPositionFromPoint){let E=b.caretPositionFromPoint(u,m);E&&({offsetNode:A,offset:_}=E)}else if(b.caretRangeFromPoint){let E=b.caretRangeFromPoint(u,m);E&&({startContainer:A,startOffset:_}=E,(!r.contentDOM.contains(A)||Ne.safari&&P2(A,_,u)||Ne.chrome&&_2(A,_,u))&&(A=void 0))}A&&(_=Math.min(en(A),_))}if(!A||!r.docView.dom.contains(A)){let E=ns.find(r.docView,x);if(!E)return p>c.top+c.height/2?c.to:c.from;({node:A,offset:_}=$h(E.dom,u,m))}let R=r.docView.nearest(A);if(!R)return null;if(R.isWidget&&((a=R.dom)===null||a===void 0?void 0:a.nodeType)==1){let E=R.dom.getBoundingClientRect();return t.y<E.top||t.y<=E.bottom&&t.x<=(E.left+E.right)/2?R.posAtStart:R.posAtEnd}else return R.localPosFromDOM(A,_)+R.posAtStart}function ip(r,t,s,n,i){let a=Math.round((n-t.left)*r.defaultCharacterWidth);if(r.lineWrapping&&s.height>r.defaultLineHeight*1.5){let l=r.viewState.heightOracle.textHeight,c=Math.floor((i-s.top-(r.defaultLineHeight-l)*.5)/l);a+=c*r.viewState.heightOracle.lineLength}let o=r.state.sliceDoc(s.from,s.to);return s.from+Ch(o,a,r.state.tabSize)}function P2(r,t,s){let n,i=r;if(r.nodeType!=3||t!=(n=r.nodeValue.length))return!1;for(;;){let a=i.nextSibling;if(a){if(a.nodeName=="BR")break;return!1}else{let o=i.parentNode;if(!o||o.nodeName=="DIV")break;i=o}}return mi(r,n-1,n).getBoundingClientRect().right>s}function _2(r,t,s){if(t!=0)return!1;for(let i=r;;){let a=i.parentNode;if(!a||a.nodeType!=1||a.firstChild!=i)return!1;if(a.classList.contains("cm-line"))break;i=a}let n=r.nodeType==1?r.getBoundingClientRect():mi(r,0,Math.max(r.nodeValue.length,1)).getBoundingClientRect();return s-n.left>5}function Vh(r,t,s){let n=r.lineBlockAt(t);if(Array.isArray(n.type)){let i;for(let a of n.type){if(a.from>t)break;if(!(a.to<t)){if(a.from<t&&a.to>t)return a;(!i||a.type==Ns.Text&&(i.type!=a.type||(s<0?a.from<t:a.to>t)))&&(i=a)}}return i||n}return n}function E2(r,t,s,n){let i=Vh(r,t.head,t.assoc||-1),a=!n||i.type!=Ns.Text||!(r.lineWrapping||i.widgetLineBreaks)?null:r.coordsAtPos(t.assoc<0&&t.head>i.from?t.head-1:t.head);if(a){let o=r.dom.getBoundingClientRect(),l=r.textDirectionAt(i.from),c=r.posAtCoords({x:s==(l==zt.LTR)?o.right-1:o.left+1,y:(a.top+a.bottom)/2});if(c!=null)return ye.cursor(c,s?-1:1)}return ye.cursor(s?i.to:i.from,s?-1:1)}function ap(r,t,s,n){let i=r.state.doc.lineAt(t.head),a=r.bidiSpans(i),o=r.textDirectionAt(i.from);for(let l=t,c=null;;){let h=g2(i,a,o,l,s),u=Fb;if(!h){if(i.number==(s?r.state.doc.lines:1))return l;u=`
`,i=r.state.doc.line(i.number+(s?1:-1)),a=r.bidiSpans(i),h=r.visualLineSide(i,!s)}if(c){if(!c(u))return l}else{if(!n)return h;c=n(u)}l=h}}function I2(r,t,s){let n=r.state.charCategorizer(t),i=n(s);return a=>{let o=n(a);return i==Qt.Space&&(i=o),i==o}}function D2(r,t,s,n){let i=t.head,a=s?1:-1;if(i==(s?r.state.doc.length:0))return ye.cursor(i,t.assoc);let o=t.goalColumn,l,c=r.contentDOM.getBoundingClientRect(),h=r.coordsAtPos(i,t.assoc||-1),u=r.documentTop;if(h)o==null&&(o=h.left-c.left),l=a<0?h.top:h.bottom;else{let x=r.viewState.lineBlockAt(i);o==null&&(o=Math.min(c.right-c.left,r.defaultCharacterWidth*(i-x.from))),l=(a<0?x.top:x.bottom)+u}let m=c.left+o,p=n??r.viewState.heightOracle.textHeight>>1;for(let x=0;;x+=10){let b=l+(p+x)*a,w=Jb(r,{x:m,y:b},!1,a);if(b<c.top||b>c.bottom||(a<0?w<i:w>i)){let C=r.docView.coordsForChar(w),A=!C||b<C.top?-1:1;return ye.cursor(w,A,void 0,o)}}}function vl(r,t,s){for(;;){let n=0;for(let i of r)i.between(t-1,t+1,(a,o,l)=>{if(t>a&&t<o){let c=n||s||(t-a<o-t?-1:1);t=c<0?a:o,n=c}});if(!n)return t}}function e0(r,t){let s=null;for(let n=0;n<t.ranges.length;n++){let i=t.ranges[n],a=null;if(i.empty){let o=vl(r,i.from,0);o!=i.from&&(a=ye.cursor(o,-1))}else{let o=vl(r,i.from,-1),l=vl(r,i.to,1);(o!=i.from||l!=i.to)&&(a=ye.range(i.from==i.anchor?o:l,i.from==i.head?o:l))}a&&(s||(s=t.ranges.slice()),s[n]=a)}return s?ye.create(s,t.mainIndex):t}function yd(r,t,s){let n=vl(r.state.facet(Tc).map(i=>i(r)),s.from,t.head>s.from?-1:1);return n==s.from?s:ye.cursor(n,n<s.from?1:-1)}const Sa="￿";class R2{constructor(t,s){this.points=t,this.text="",this.lineSeparator=s.facet(bt.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=Sa}readRange(t,s){if(!t)return this;let n=t.parentNode;for(let i=t;;){this.findPointBefore(n,i);let a=this.text.length;this.readNode(i);let o=i.nextSibling;if(o==s)break;let l=Rt.get(i),c=Rt.get(o);(l&&c?l.breakAfter:(l?l.breakAfter:$l(i))||$l(o)&&(i.nodeName!="BR"||i.cmIgnore)&&this.text.length>a)&&this.lineBreak(),i=o}return this.findPointBefore(n,s),this}readTextNode(t){let s=t.nodeValue;for(let n of this.points)n.node==t&&(n.pos=this.text.length+Math.min(n.offset,s.length));for(let n=0,i=this.lineSeparator?null:/\r\n?|\n/g;;){let a=-1,o=1,l;if(this.lineSeparator?(a=s.indexOf(this.lineSeparator,n),o=this.lineSeparator.length):(l=i.exec(s))&&(a=l.index,o=l[0].length),this.append(s.slice(n,a<0?s.length:a)),a<0)break;if(this.lineBreak(),o>1)for(let c of this.points)c.node==t&&c.pos>this.text.length&&(c.pos-=o-1);n=a+o}}readNode(t){if(t.cmIgnore)return;let s=Rt.get(t),n=s&&s.overrideDOMText;if(n!=null){this.findPointInside(t,n.length);for(let i=n.iter();!i.next().done;)i.lineBreak?this.lineBreak():this.append(i.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,s){for(let n of this.points)n.node==t&&t.childNodes[n.offset]==s&&(n.pos=this.text.length)}findPointInside(t,s){for(let n of this.points)(t.nodeType==3?n.node==t:t.contains(n.node))&&(n.pos=this.text.length+(M2(t,n.node,n.offset)?s:0))}}function M2(r,t,s){for(;;){if(!t||s<en(t))return!1;if(t==r)return!0;s=fi(t)+1,t=t.parentNode}}class op{constructor(t,s){this.node=t,this.offset=s,this.pos=-1}}class L2{constructor(t,s,n,i){this.typeOver=i,this.bounds=null,this.text="",this.domChanged=s>-1;let{impreciseHead:a,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&s>-1)this.newSel=null;else if(s>-1&&(this.bounds=t.docView.domBoundsAround(s,n,0))){let l=a||o?[]:W2(t),c=new R2(l,t.state);c.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=c.text,this.newSel=$2(l,this.bounds.from)}else{let l=t.observer.selectionRange,c=a&&a.node==l.focusNode&&a.offset==l.focusOffset||!Ph(t.contentDOM,l.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(l.focusNode,l.focusOffset),h=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!Ph(t.contentDOM,l.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(l.anchorNode,l.anchorOffset),u=t.viewport;if((Ne.ios||Ne.chrome)&&t.state.selection.main.empty&&c!=h&&(u.from>0||u.to<t.state.doc.length)){let m=Math.min(c,h),p=Math.max(c,h),x=u.from-m,b=u.to-p;(x==0||x==1||m==0)&&(b==0||b==-1||p==t.state.doc.length)&&(c=0,h=t.state.doc.length)}this.newSel=ye.single(h,c)}}}function t0(r,t){let s,{newSel:n}=t,i=r.state.selection.main,a=r.inputState.lastKeyTime>Date.now()-100?r.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:l}=t.bounds,c=i.from,h=null;(a===8||Ne.android&&t.text.length<l-o)&&(c=i.to,h="end");let u=N2(r.state.doc.sliceString(o,l,Sa),t.text,c-o,h);u&&(Ne.chrome&&a==13&&u.toB==u.from+2&&t.text.slice(u.from,u.toB)==Sa+Sa&&u.toB--,s={from:o+u.from,to:o+u.toA,insert:wt.of(t.text.slice(u.from,u.toB).split(Sa))})}else n&&(!r.hasFocus&&r.state.facet(fn)||n.main.eq(i))&&(n=null);if(!s&&!n)return!1;if(!s&&t.typeOver&&!i.empty&&n&&n.main.empty?s={from:i.from,to:i.to,insert:r.state.doc.slice(i.from,i.to)}:(Ne.mac||Ne.android)&&s&&s.from==s.to&&s.from==i.head-1&&/^\. ?$/.test(s.insert.toString())&&r.contentDOM.getAttribute("autocorrect")=="off"?(n&&s.insert.length==2&&(n=ye.single(n.main.anchor-1,n.main.head-1)),s={from:s.from,to:s.to,insert:wt.of([s.insert.toString().replace("."," ")])}):s&&s.from>=i.from&&s.to<=i.to&&(s.from!=i.from||s.to!=i.to)&&i.to-i.from-(s.to-s.from)<=4?s={from:i.from,to:i.to,insert:r.state.doc.slice(i.from,s.from).append(s.insert).append(r.state.doc.slice(s.to,i.to))}:Ne.chrome&&s&&s.from==s.to&&s.from==i.head&&s.insert.toString()==`
 `&&r.lineWrapping&&(n&&(n=ye.single(n.main.anchor-1,n.main.head-1)),s={from:i.from,to:i.to,insert:wt.of([" "])}),s)return cf(r,s,n,a);if(n&&!n.main.eq(i)){let o=!1,l="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(o=!0),l=r.inputState.lastSelectionOrigin,l=="select.pointer"&&(n=e0(r.state.facet(Tc).map(c=>c(r)),n))),r.dispatch({selection:n,scrollIntoView:o,userEvent:l}),!0}else return!1}function cf(r,t,s,n=-1){if(Ne.ios&&r.inputState.flushIOSKey(t))return!0;let i=r.state.selection.main;if(Ne.android&&(t.to==i.to&&(t.from==i.from||t.from==i.from-1&&r.state.sliceDoc(t.from,i.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&$i(r.contentDOM,"Enter",13)||(t.from==i.from-1&&t.to==i.to&&t.insert.length==0||n==8&&t.insert.length<t.to-t.from&&t.to>i.head)&&$i(r.contentDOM,"Backspace",8)||t.from==i.from&&t.to==i.to+1&&t.insert.length==0&&$i(r.contentDOM,"Delete",46)))return!0;let a=t.insert.toString();r.inputState.composing>=0&&r.inputState.composing++;let o,l=()=>o||(o=F2(r,t,s));return r.state.facet(zb).some(c=>c(r,t.from,t.to,a,l))||r.dispatch(l()),!0}function F2(r,t,s){let n,i=r.state,a=i.selection.main;if(t.from>=a.from&&t.to<=a.to&&t.to-t.from>=(a.to-a.from)/3&&(!s||s.main.empty&&s.main.from==t.from+t.insert.length)&&r.inputState.composing<0){let l=a.from<t.from?i.sliceDoc(a.from,t.from):"",c=a.to>t.to?i.sliceDoc(t.to,a.to):"";n=i.replaceSelection(r.state.toText(l+t.insert.sliceString(0,void 0,r.state.lineBreak)+c))}else{let l=i.changes(t),c=s&&s.main.to<=l.newLength?s.main:void 0;if(i.selection.ranges.length>1&&r.inputState.composing>=0&&t.to<=a.to&&t.to>=a.to-10){let h=r.state.sliceDoc(t.from,t.to),u,m=s&&Zb(r,s.main.head);if(m){let b=t.insert.length-(t.to-t.from);u={from:m.from,to:m.to-b}}else u=r.state.doc.lineAt(a.head);let p=a.to-t.to,x=a.to-a.from;n=i.changeByRange(b=>{if(b.from==a.from&&b.to==a.to)return{changes:l,range:c||b.map(l)};let w=b.to-p,C=w-h.length;if(b.to-b.from!=x||r.state.sliceDoc(C,w)!=h||b.to>=u.from&&b.from<=u.to)return{range:b};let A=i.changes({from:C,to:w,insert:t.insert}),_=b.to-a.to;return{changes:A,range:c?ye.range(Math.max(0,c.anchor+_),Math.max(0,c.head+_)):b.map(A)}})}else n={changes:l,selection:c&&i.selection.replaceRange(c)}}let o="input.type";return(r.composing||r.inputState.compositionPendingChange&&r.inputState.compositionEndedAt>Date.now()-50)&&(r.inputState.compositionPendingChange=!1,o+=".compose",r.inputState.compositionFirstChange&&(o+=".start",r.inputState.compositionFirstChange=!1)),i.update(n,{userEvent:o,scrollIntoView:!0})}function N2(r,t,s,n){let i=Math.min(r.length,t.length),a=0;for(;a<i&&r.charCodeAt(a)==t.charCodeAt(a);)a++;if(a==i&&r.length==t.length)return null;let o=r.length,l=t.length;for(;o>0&&l>0&&r.charCodeAt(o-1)==t.charCodeAt(l-1);)o--,l--;if(n=="end"){let c=Math.max(0,a-Math.min(o,l));s-=o+c-a}if(o<a&&r.length<t.length){let c=s<=a&&s>=o?a-s:0;a-=c,l=a+(l-o),o=a}else if(l<a){let c=s<=a&&s>=l?a-s:0;a-=c,o=a+(o-l),l=a}return{from:a,toA:o,toB:l}}function W2(r){let t=[];if(r.root.activeElement!=r.contentDOM)return t;let{anchorNode:s,anchorOffset:n,focusNode:i,focusOffset:a}=r.observer.selectionRange;return s&&(t.push(new op(s,n)),(i!=s||a!=n)&&t.push(new op(i,a))),t}function $2(r,t){if(r.length==0)return null;let s=r[0].pos,n=r.length==2?r[1].pos:s;return s>-1&&n>-1?ye.single(s+t,n+t):null}class V2{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,Ne.safari&&t.contentDOM.addEventListener("input",()=>null),Ne.gecko&&rA(t.contentDOM.ownerDocument)}handleEvent(t){!K2(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(t.type,t)):this.runHandlers(t.type,t))}runHandlers(t,s){let n=this.handlers[t];if(n){for(let i of n.observers)i(this.view,s);for(let i of n.handlers){if(s.defaultPrevented)break;if(i(this.view,s)){s.preventDefault();break}}}}ensureHandlers(t){let s=z2(t),n=this.handlers,i=this.view.contentDOM;for(let a in s)if(a!="scroll"){let o=!s[a].handlers.length,l=n[a];l&&o!=!l.handlers.length&&(i.removeEventListener(a,this.handleEvent),l=null),l||i.addEventListener(a,this.handleEvent,{passive:o})}for(let a in n)a!="scroll"&&!s[a]&&i.removeEventListener(a,this.handleEvent);this.handlers=s}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&r0.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),Ne.android&&Ne.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let s;return Ne.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((s=s0.find(n=>n.keyCode==t.keyCode))&&!t.ctrlKey||B2.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=s||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let s=this.pendingIOSKey;return!s||s.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,$i(this.view.contentDOM,s.key,s.keyCode,s instanceof KeyboardEvent?s:void 0))}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:Ne.safari&&!Ne.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function lp(r,t){return(s,n)=>{try{return t.call(r,n,s)}catch(i){Hs(s.state,i)}}}function z2(r){let t=Object.create(null);function s(n){return t[n]||(t[n]={observers:[],handlers:[]})}for(let n of r){let i=n.spec,a=i&&i.plugin.domEventHandlers,o=i&&i.plugin.domEventObservers;if(a)for(let l in a){let c=a[l];c&&s(l).handlers.push(lp(n.value,c))}if(o)for(let l in o){let c=o[l];c&&s(l).observers.push(lp(n.value,c))}}for(let n in Er)s(n).handlers.push(Er[n]);for(let n in br)s(n).observers.push(br[n]);return t}const s0=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],B2="dthko",r0=[16,17,18,20,91,92,224,225],Bo=6;function Uo(r){return Math.max(0,r)*.7+8}function U2(r,t){return Math.max(Math.abs(r.clientX-t.clientX),Math.abs(r.clientY-t.clientY))}class Q2{constructor(t,s,n,i){this.view=t,this.startEvent=s,this.style=n,this.mustSelect=i,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=s,this.scrollParents=ZC(t.contentDOM),this.atoms=t.state.facet(Tc).map(o=>o(t));let a=t.contentDOM.ownerDocument;a.addEventListener("mousemove",this.move=this.move.bind(this)),a.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=s.shiftKey,this.multiple=t.state.facet(bt.allowMultipleSelections)&&q2(t,s),this.dragging=G2(t,s)&&a0(s)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&U2(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let s=0,n=0,i=0,a=0,o=this.view.win.innerWidth,l=this.view.win.innerHeight;this.scrollParents.x&&({left:i,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:a,bottom:l}=this.scrollParents.y.getBoundingClientRect());let c=lf(this.view);t.clientX-c.left<=i+Bo?s=-Uo(i-t.clientX):t.clientX+c.right>=o-Bo&&(s=Uo(t.clientX-o)),t.clientY-c.top<=a+Bo?n=-Uo(a-t.clientY):t.clientY+c.bottom>=l-Bo&&(n=Uo(t.clientY-l)),this.setScrollSpeed(s,n)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,s){this.scrollSpeed={x:t,y:s},t||s?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:s}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),s&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=s,s=0),(t||s)&&this.view.win.scrollBy(t,s),this.dragging===!1&&this.select(this.lastEvent)}select(t){let{view:s}=this,n=e0(this.atoms,this.style.get(t,this.extend,this.multiple));(this.mustSelect||!n.eq(s.state.selection,this.dragging===!1))&&this.view.dispatch({selection:n,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(s=>s.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function q2(r,t){let s=r.state.facet(Nb);return s.length?s[0](t):Ne.mac?t.metaKey:t.ctrlKey}function H2(r,t){let s=r.state.facet(Wb);return s.length?s[0](t):Ne.mac?!t.altKey:!t.ctrlKey}function G2(r,t){let{main:s}=r.state.selection;if(s.empty)return!1;let n=Qa(r.root);if(!n||n.rangeCount==0)return!0;let i=n.getRangeAt(0).getClientRects();for(let a=0;a<i.length;a++){let o=i[a];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function K2(r,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let s=t.target,n;s!=r.contentDOM;s=s.parentNode)if(!s||s.nodeType==11||(n=Rt.get(s))&&n.ignoreEvent(t))return!1;return!0}const Er=Object.create(null),br=Object.create(null),n0=Ne.ie&&Ne.ie_version<15||Ne.ios&&Ne.webkit_version<604;function Y2(r){let t=r.dom.parentNode;if(!t)return;let s=t.appendChild(document.createElement("textarea"));s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus(),setTimeout(()=>{r.focus(),s.remove(),i0(r,s.value)},50)}function Pc(r,t,s){for(let n of r.facet(t))s=n(s,r);return s}function i0(r,t){t=Pc(r.state,nf,t);let{state:s}=r,n,i=1,a=s.toText(t),o=a.lines==s.selection.ranges.length;if(zh!=null&&s.selection.ranges.every(c=>c.empty)&&zh==a.toString()){let c=-1;n=s.changeByRange(h=>{let u=s.doc.lineAt(h.from);if(u.from==c)return{range:h};c=u.from;let m=s.toText((o?a.line(i++).text:t)+s.lineBreak);return{changes:{from:u.from,insert:m},range:ye.cursor(h.from+m.length)}})}else o?n=s.changeByRange(c=>{let h=a.line(i++);return{changes:{from:c.from,to:c.to,insert:h.text},range:ye.cursor(c.from+h.length)}}):n=s.replaceSelection(a);r.dispatch(n,{userEvent:"input.paste",scrollIntoView:!0})}br.scroll=r=>{r.inputState.lastScrollTop=r.scrollDOM.scrollTop,r.inputState.lastScrollLeft=r.scrollDOM.scrollLeft};Er.keydown=(r,t)=>(r.inputState.setSelectionOrigin("select"),t.keyCode==27&&r.inputState.tabFocusMode!=0&&(r.inputState.tabFocusMode=Date.now()+2e3),!1);br.touchstart=(r,t)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")};br.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")};Er.mousedown=(r,t)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3)return!1;let s=null;for(let n of r.state.facet($b))if(s=n(r,t),s)break;if(!s&&t.button==0&&(s=J2(r,t)),s){let n=!r.hasFocus;r.inputState.startMouseSelection(new Q2(r,t,s,n)),n&&r.observer.ignore(()=>{jb(r.contentDOM);let a=r.root.activeElement;a&&!a.contains(r.contentDOM)&&a.blur()});let i=r.inputState.mouseSelection;if(i)return i.start(t),i.dragging===!1}else r.inputState.setSelectionOrigin("select.pointer");return!1};function cp(r,t,s,n){if(n==1)return ye.cursor(t,s);if(n==2)return C2(r.state,t,s);{let i=ns.find(r.docView,t),a=r.state.doc.lineAt(i?i.posAtEnd:t),o=i?i.posAtStart:a.from,l=i?i.posAtEnd:a.to;return l<r.state.doc.length&&l==a.to&&l++,ye.range(o,l)}}let dp=(r,t,s)=>t>=s.top&&t<=s.bottom&&r>=s.left&&r<=s.right;function X2(r,t,s,n){let i=ns.find(r.docView,t);if(!i)return 1;let a=t-i.posAtStart;if(a==0)return 1;if(a==i.length)return-1;let o=i.coordsAt(a,-1);if(o&&dp(s,n,o))return-1;let l=i.coordsAt(a,1);return l&&dp(s,n,l)?1:o&&o.bottom>=n?-1:1}function hp(r,t){let s=r.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:s,bias:X2(r,s,t.clientX,t.clientY)}}const Z2=Ne.ie&&Ne.ie_version<=11;let up=null,fp=0,mp=0;function a0(r){if(!Z2)return r.detail;let t=up,s=mp;return up=r,mp=Date.now(),fp=!t||s>Date.now()-400&&Math.abs(t.clientX-r.clientX)<2&&Math.abs(t.clientY-r.clientY)<2?(fp+1)%3:1}function J2(r,t){let s=hp(r,t),n=a0(t),i=r.state.selection;return{update(a){a.docChanged&&(s.pos=a.changes.mapPos(s.pos),i=i.map(a.changes))},get(a,o,l){let c=hp(r,a),h,u=cp(r,c.pos,c.bias,n);if(s.pos!=c.pos&&!o){let m=cp(r,s.pos,s.bias,n),p=Math.min(m.from,u.from),x=Math.max(m.to,u.to);u=p<u.from?ye.range(p,x):ye.range(x,p)}return o?i.replaceRange(i.main.extend(u.from,u.to)):l&&n==1&&i.ranges.length>1&&(h=eA(i,c.pos))?h:l?i.addRange(u):ye.create([u])}}}function eA(r,t){for(let s=0;s<r.ranges.length;s++){let{from:n,to:i}=r.ranges[s];if(n<=t&&i>=t)return ye.create(r.ranges.slice(0,s).concat(r.ranges.slice(s+1)),r.mainIndex==s?0:r.mainIndex-(r.mainIndex>s?1:0))}return null}Er.dragstart=(r,t)=>{let{selection:{main:s}}=r.state;if(t.target.draggable){let i=r.docView.nearest(t.target);if(i&&i.isWidget){let a=i.posAtStart,o=a+i.length;(a>=s.to||o<=s.from)&&(s=ye.range(a,o))}}let{inputState:n}=r;return n.mouseSelection&&(n.mouseSelection.dragging=!0),n.draggedContent=s,t.dataTransfer&&(t.dataTransfer.setData("Text",Pc(r.state,af,r.state.sliceDoc(s.from,s.to))),t.dataTransfer.effectAllowed="copyMove"),!1};Er.dragend=r=>(r.inputState.draggedContent=null,!1);function pp(r,t,s,n){if(s=Pc(r.state,nf,s),!s)return;let i=r.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:a}=r.inputState,o=n&&a&&H2(r,t)?{from:a.from,to:a.to}:null,l={from:i,insert:s},c=r.state.changes(o?[o,l]:l);r.focus(),r.dispatch({changes:c,selection:{anchor:c.mapPos(i,-1),head:c.mapPos(i,1)},userEvent:o?"move.drop":"input.drop"}),r.inputState.draggedContent=null}Er.drop=(r,t)=>{if(!t.dataTransfer)return!1;if(r.state.readOnly)return!0;let s=t.dataTransfer.files;if(s&&s.length){let n=Array(s.length),i=0,a=()=>{++i==s.length&&pp(r,t,n.filter(o=>o!=null).join(r.state.lineBreak),!1)};for(let o=0;o<s.length;o++){let l=new FileReader;l.onerror=a,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(n[o]=l.result),a()},l.readAsText(s[o])}return!0}else{let n=t.dataTransfer.getData("Text");if(n)return pp(r,t,n,!0),!0}return!1};Er.paste=(r,t)=>{if(r.state.readOnly)return!0;r.observer.flush();let s=n0?null:t.clipboardData;return s?(i0(r,s.getData("text/plain")||s.getData("text/uri-list")),!0):(Y2(r),!1)};function tA(r,t){let s=r.dom.parentNode;if(!s)return;let n=s.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.value=t,n.focus(),n.selectionEnd=t.length,n.selectionStart=0,setTimeout(()=>{n.remove(),r.focus()},50)}function sA(r){let t=[],s=[],n=!1;for(let i of r.selection.ranges)i.empty||(t.push(r.sliceDoc(i.from,i.to)),s.push(i));if(!t.length){let i=-1;for(let{from:a}of r.selection.ranges){let o=r.doc.lineAt(a);o.number>i&&(t.push(o.text),s.push({from:o.from,to:Math.min(r.doc.length,o.to+1)})),i=o.number}n=!0}return{text:Pc(r,af,t.join(r.lineBreak)),ranges:s,linewise:n}}let zh=null;Er.copy=Er.cut=(r,t)=>{let{text:s,ranges:n,linewise:i}=sA(r.state);if(!s&&!i)return!1;zh=i?s:null,t.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:n,scrollIntoView:!0,userEvent:"delete.cut"});let a=n0?null:t.clipboardData;return a?(a.clearData(),a.setData("text/plain",s),!0):(tA(r,s),!1)};const o0=tn.define();function l0(r,t){let s=[];for(let n of r.facet(Bb)){let i=n(r,t);i&&s.push(i)}return s.length?r.update({effects:s,annotations:o0.of(!0)}):null}function c0(r){setTimeout(()=>{let t=r.hasFocus;if(t!=r.inputState.notifiedFocused){let s=l0(r.state,t);s?r.dispatch(s):r.update([])}},10)}br.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),c0(r)};br.blur=r=>{r.observer.clearSelectionRange(),c0(r)};br.compositionstart=br.compositionupdate=r=>{r.observer.editContext||(r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0))};br.compositionend=r=>{r.observer.editContext||(r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionPendingKey=!0,r.inputState.compositionPendingChange=r.observer.pendingRecords().length>0,r.inputState.compositionFirstChange=null,Ne.chrome&&Ne.android?r.observer.flushSoon():r.inputState.compositionPendingChange?Promise.resolve().then(()=>r.observer.flush()):setTimeout(()=>{r.inputState.composing<0&&r.docView.hasComposition&&r.update([])},50))};br.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()};Er.beforeinput=(r,t)=>{var s,n;if(t.inputType=="insertReplacementText"&&r.observer.editContext){let a=(s=t.dataTransfer)===null||s===void 0?void 0:s.getData("text/plain"),o=t.getTargetRanges();if(a&&o.length){let l=o[0],c=r.posAtDOM(l.startContainer,l.startOffset),h=r.posAtDOM(l.endContainer,l.endOffset);return cf(r,{from:c,to:h,insert:r.state.toText(a)},null),!0}}let i;if(Ne.chrome&&Ne.android&&(i=s0.find(a=>a.inputType==t.inputType))&&(r.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let a=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>a+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}return Ne.ios&&t.inputType=="deleteContentForward"&&r.observer.flushSoon(),Ne.safari&&t.inputType=="insertText"&&r.inputState.composing>=0&&setTimeout(()=>br.compositionend(r,t),20),!1};const gp=new Set;function rA(r){gp.has(r)||(gp.add(r),r.addEventListener("copy",()=>{}),r.addEventListener("cut",()=>{}))}const xp=["pre-wrap","normal","pre-line","break-spaces"];let Ji=!1;function yp(){Ji=!1}class nA{constructor(t){this.lineWrapping=t,this.doc=wt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(t,s){let n=this.doc.lineAt(s).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(n+=Math.max(0,Math.ceil((s-t-n*this.lineLength*.5)/this.lineLength))),this.lineHeight*n}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return xp.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let s=!1;for(let n=0;n<t.length;n++){let i=t[n];i<0?n++:this.heightSamples[Math.floor(i*10)]||(s=!0,this.heightSamples[Math.floor(i*10)]=!0)}return s}refresh(t,s,n,i,a,o){let l=xp.indexOf(t)>-1,c=Math.round(s)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=s,this.charWidth=n,this.textHeight=i,this.lineLength=a,c){this.heightSamples={};for(let h=0;h<o.length;h++){let u=o[h];u<0?h++:this.heightSamples[Math.floor(u*10)]=!0}}return c}}class iA{constructor(t,s){this.from=t,this.heights=s,this.index=0}get more(){return this.index<this.heights.length}}class Ur{constructor(t,s,n,i,a){this.from=t,this.length=s,this.top=n,this.height=i,this._content=a}get type(){return typeof this._content=="number"?Ns.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Vn?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let s=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new Ur(this.from,this.length+t.length,this.top,this.height+t.height,s)}}var $t=(function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r})($t||($t={}));const wl=.001;class Ws{constructor(t,s,n=2){this.length=t,this.height=s,this.flags=n}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t){this.height!=t&&(Math.abs(this.height-t)>wl&&(Ji=!0),this.height=t)}replace(t,s,n){return Ws.of(n)}decomposeLeft(t,s){s.push(this)}decomposeRight(t,s){s.push(this)}applyChanges(t,s,n,i){let a=this,o=n.doc;for(let l=i.length-1;l>=0;l--){let{fromA:c,toA:h,fromB:u,toB:m}=i[l],p=a.lineAt(c,$t.ByPosNoHeight,n.setDoc(s),0,0),x=p.to>=h?p:a.lineAt(h,$t.ByPosNoHeight,n,0,0);for(m+=x.to-h,h=x.to;l>0&&p.from<=i[l-1].toA;)c=i[l-1].fromA,u=i[l-1].fromB,l--,c<p.from&&(p=a.lineAt(c,$t.ByPosNoHeight,n,0,0));u+=p.from-c,c=p.from;let b=df.build(n.setDoc(o),t,u,m);a=Bl(a,a.replace(c,h,b))}return a.updateHeight(n,0)}static empty(){return new rr(0,0)}static of(t){if(t.length==1)return t[0];let s=0,n=t.length,i=0,a=0;for(;;)if(s==n)if(i>a*2){let l=t[s-1];l.break?t.splice(--s,1,l.left,null,l.right):t.splice(--s,1,l.left,l.right),n+=1+l.break,i-=l.size}else if(a>i*2){let l=t[n];l.break?t.splice(n,1,l.left,null,l.right):t.splice(n,1,l.left,l.right),n+=2+l.break,a-=l.size}else break;else if(i<a){let l=t[s++];l&&(i+=l.size)}else{let l=t[--n];l&&(a+=l.size)}let o=0;return t[s-1]==null?(o=1,s--):t[s]==null&&(o=1,n++),new aA(Ws.of(t.slice(0,s)),o,Ws.of(t.slice(n)))}}function Bl(r,t){return r==t?r:(r.constructor!=t.constructor&&(Ji=!0),t)}Ws.prototype.size=1;class d0 extends Ws{constructor(t,s,n){super(t,s),this.deco=n}blockAt(t,s,n,i){return new Ur(i,this.length,n,this.height,this.deco||0)}lineAt(t,s,n,i,a){return this.blockAt(0,n,i,a)}forEachLine(t,s,n,i,a,o){t<=a+this.length&&s>=a&&o(this.blockAt(0,n,i,a))}updateHeight(t,s=0,n=!1,i){return i&&i.from<=s&&i.more&&this.setHeight(i.heights[i.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class rr extends d0{constructor(t,s){super(t,s,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(t,s,n,i){return new Ur(i,this.length,n,this.height,this.breaks)}replace(t,s,n){let i=n[0];return n.length==1&&(i instanceof rr||i instanceof js&&i.flags&4)&&Math.abs(this.length-i.length)<10?(i instanceof js?i=new rr(i.length,this.height):i.height=this.height,this.outdated||(i.outdated=!1),i):Ws.of(n)}updateHeight(t,s=0,n=!1,i){return i&&i.from<=s&&i.more?this.setHeight(i.heights[i.index++]):(n||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class js extends Ws{constructor(t){super(t,0)}heightMetrics(t,s){let n=t.doc.lineAt(s).number,i=t.doc.lineAt(s+this.length).number,a=i-n+1,o,l=0;if(t.lineWrapping){let c=Math.min(this.height,t.lineHeight*a);o=c/a,this.length>a+1&&(l=(this.height-c)/(this.length-a-1))}else o=this.height/a;return{firstLine:n,lastLine:i,perLine:o,perChar:l}}blockAt(t,s,n,i){let{firstLine:a,lastLine:o,perLine:l,perChar:c}=this.heightMetrics(s,i);if(s.lineWrapping){let h=i+(t<s.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-n)/this.height))*this.length)),u=s.doc.lineAt(h),m=l+u.length*c,p=Math.max(n,t-m/2);return new Ur(u.from,u.length,p,m,0)}else{let h=Math.max(0,Math.min(o-a,Math.floor((t-n)/l))),{from:u,length:m}=s.doc.line(a+h);return new Ur(u,m,n+l*h,l,0)}}lineAt(t,s,n,i,a){if(s==$t.ByHeight)return this.blockAt(t,n,i,a);if(s==$t.ByPosNoHeight){let{from:x,to:b}=n.doc.lineAt(t);return new Ur(x,b-x,0,0,0)}let{firstLine:o,perLine:l,perChar:c}=this.heightMetrics(n,a),h=n.doc.lineAt(t),u=l+h.length*c,m=h.number-o,p=i+l*m+c*(h.from-a-m);return new Ur(h.from,h.length,Math.max(i,Math.min(p,i+this.height-u)),u,0)}forEachLine(t,s,n,i,a,o){t=Math.max(t,a),s=Math.min(s,a+this.length);let{firstLine:l,perLine:c,perChar:h}=this.heightMetrics(n,a);for(let u=t,m=i;u<=s;){let p=n.doc.lineAt(u);if(u==t){let b=p.number-l;m+=c*b+h*(t-a-b)}let x=c+h*p.length;o(new Ur(p.from,p.length,m,x,0)),m+=x,u=p.to+1}}replace(t,s,n){let i=this.length-s;if(i>0){let a=n[n.length-1];a instanceof js?n[n.length-1]=new js(a.length+i):n.push(null,new js(i-1))}if(t>0){let a=n[0];a instanceof js?n[0]=new js(t+a.length):n.unshift(new js(t-1),null)}return Ws.of(n)}decomposeLeft(t,s){s.push(new js(t-1),null)}decomposeRight(t,s){s.push(null,new js(this.length-t-1))}updateHeight(t,s=0,n=!1,i){let a=s+this.length;if(i&&i.from<=s+this.length&&i.more){let o=[],l=Math.max(s,i.from),c=-1;for(i.from>s&&o.push(new js(i.from-s-1).updateHeight(t,s));l<=a&&i.more;){let u=t.doc.lineAt(l).length;o.length&&o.push(null);let m=i.heights[i.index++];c==-1?c=m:Math.abs(m-c)>=wl&&(c=-2);let p=new rr(u,m);p.outdated=!1,o.push(p),l+=u+1}l<=a&&o.push(null,new js(a-l).updateHeight(t,l));let h=Ws.of(o);return(c<0||Math.abs(h.height-this.height)>=wl||Math.abs(c-this.heightMetrics(t,s).perLine)>=wl)&&(Ji=!0),Bl(this,h)}else(n||this.outdated)&&(this.setHeight(t.heightForGap(s,s+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class aA extends Ws{constructor(t,s,n){super(t.length+s+n.length,t.height+n.height,s|(t.outdated||n.outdated?2:0)),this.left=t,this.right=n,this.size=t.size+n.size}get break(){return this.flags&1}blockAt(t,s,n,i){let a=n+this.left.height;return t<a?this.left.blockAt(t,s,n,i):this.right.blockAt(t,s,a,i+this.left.length+this.break)}lineAt(t,s,n,i,a){let o=i+this.left.height,l=a+this.left.length+this.break,c=s==$t.ByHeight?t<o:t<l,h=c?this.left.lineAt(t,s,n,i,a):this.right.lineAt(t,s,n,o,l);if(this.break||(c?h.to<l:h.from>l))return h;let u=s==$t.ByPosNoHeight?$t.ByPosNoHeight:$t.ByPos;return c?h.join(this.right.lineAt(l,u,n,o,l)):this.left.lineAt(l,u,n,i,a).join(h)}forEachLine(t,s,n,i,a,o){let l=i+this.left.height,c=a+this.left.length+this.break;if(this.break)t<c&&this.left.forEachLine(t,s,n,i,a,o),s>=c&&this.right.forEachLine(t,s,n,l,c,o);else{let h=this.lineAt(c,$t.ByPos,n,i,a);t<h.from&&this.left.forEachLine(t,h.from-1,n,i,a,o),h.to>=t&&h.from<=s&&o(h),s>h.to&&this.right.forEachLine(h.to+1,s,n,l,c,o)}}replace(t,s,n){let i=this.left.length+this.break;if(s<i)return this.balanced(this.left.replace(t,s,n),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-i,s-i,n));let a=[];t>0&&this.decomposeLeft(t,a);let o=a.length;for(let l of n)a.push(l);if(t>0&&jp(a,o-1),s<this.length){let l=a.length;this.decomposeRight(s,a),jp(a,l)}return Ws.of(a)}decomposeLeft(t,s){let n=this.left.length;if(t<=n)return this.left.decomposeLeft(t,s);s.push(this.left),this.break&&(n++,t>=n&&s.push(null)),t>n&&this.right.decomposeLeft(t-n,s)}decomposeRight(t,s){let n=this.left.length,i=n+this.break;if(t>=i)return this.right.decomposeRight(t-i,s);t<n&&this.left.decomposeRight(t,s),this.break&&t<i&&s.push(null),s.push(this.right)}balanced(t,s){return t.size>2*s.size||s.size>2*t.size?Ws.of(this.break?[t,null,s]:[t,s]):(this.left=Bl(this.left,t),this.right=Bl(this.right,s),this.setHeight(t.height+s.height),this.outdated=t.outdated||s.outdated,this.size=t.size+s.size,this.length=t.length+this.break+s.length,this)}updateHeight(t,s=0,n=!1,i){let{left:a,right:o}=this,l=s+a.length+this.break,c=null;return i&&i.from<=s+a.length&&i.more?c=a=a.updateHeight(t,s,n,i):a.updateHeight(t,s,n),i&&i.from<=l+o.length&&i.more?c=o=o.updateHeight(t,l,n,i):o.updateHeight(t,l,n),c?this.balanced(a,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function jp(r,t){let s,n;r[t]==null&&(s=r[t-1])instanceof js&&(n=r[t+1])instanceof js&&r.splice(t-1,3,new js(s.length+1+n.length))}const oA=5;class df{constructor(t,s){this.pos=t,this.oracle=s,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,s){if(this.lineStart>-1){let n=Math.min(s,this.lineEnd),i=this.nodes[this.nodes.length-1];i instanceof rr?i.length+=n-this.pos:(n>this.pos||!this.isCovered)&&this.nodes.push(new rr(n-this.pos,-1)),this.writtenTo=n,s>n&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=s}point(t,s,n){if(t<s||n.heightRelevant){let i=n.widget?n.widget.estimatedHeight:0,a=n.widget?n.widget.lineBreaks:0;i<0&&(i=this.oracle.lineHeight);let o=s-t;n.block?this.addBlock(new d0(o,i,n)):(o||a||i>=oA)&&this.addLineDeco(i,a,o)}else s>t&&this.span(t,s);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:s}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=s,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new rr(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,s){let n=new js(s-t);return this.oracle.doc.lineAt(t).to==s&&(n.flags|=4),n}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof rr)return t;let s=new rr(0,-1);return this.nodes.push(s),s}addBlock(t){this.enterLine();let s=t.deco;s&&s.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,s&&s.endSide>0&&(this.covering=t)}addLineDeco(t,s,n){let i=this.ensureLine();i.length+=n,i.collapsed+=n,i.widgetHeight=Math.max(i.widgetHeight,t),i.breaks+=s,this.writtenTo=this.pos=this.pos+n}finish(t){let s=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(s instanceof rr)&&!this.isCovered?this.nodes.push(new rr(0,-1)):(this.writtenTo<this.pos||s==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let n=t;for(let i of this.nodes)i instanceof rr&&i.updateHeight(this.oracle,n),n+=i?i.length:1;return this.nodes}static build(t,s,n,i){let a=new df(n,t);return Ot.spans(s,n,i,a,0),a.finish(n)}}function lA(r,t,s){let n=new cA;return Ot.compare(r,t,s,n,0),n.changes}class cA{constructor(){this.changes=[]}compareRange(){}comparePoint(t,s,n,i){(t<s||n&&n.heightRelevant||i&&i.heightRelevant)&&bl(t,s,this.changes,5)}}function dA(r,t){let s=r.getBoundingClientRect(),n=r.ownerDocument,i=n.defaultView||window,a=Math.max(0,s.left),o=Math.min(i.innerWidth,s.right),l=Math.max(0,s.top),c=Math.min(i.innerHeight,s.bottom);for(let h=r.parentNode;h&&h!=n.body;)if(h.nodeType==1){let u=h,m=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&m.overflow!="visible"){let p=u.getBoundingClientRect();a=Math.max(a,p.left),o=Math.min(o,p.right),l=Math.max(l,p.top),c=Math.min(h==r.parentNode?i.innerHeight:c,p.bottom)}h=m.position=="absolute"||m.position=="fixed"?u.offsetParent:u.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:a-s.left,right:Math.max(a,o)-s.left,top:l-(s.top+t),bottom:Math.max(l,c)-(s.top+t)}}function hA(r){let t=r.getBoundingClientRect(),s=r.ownerDocument.defaultView||window;return t.left<s.innerWidth&&t.right>0&&t.top<s.innerHeight&&t.bottom>0}function uA(r,t){let s=r.getBoundingClientRect();return{left:0,right:s.right-s.left,top:t,bottom:s.bottom-(s.top+t)}}class jd{constructor(t,s,n,i){this.from=t,this.to=s,this.size=n,this.displaySize=i}static same(t,s){if(t.length!=s.length)return!1;for(let n=0;n<t.length;n++){let i=t[n],a=s[n];if(i.from!=a.from||i.to!=a.to||i.size!=a.size)return!1}return!0}draw(t,s){return qe.replace({widget:new fA(this.displaySize*(s?t.scaleY:t.scaleX),s)}).range(this.from,this.to)}}class fA extends rn{constructor(t,s){super(),this.size=t,this.vertical=s}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class bp{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=vp,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=zt.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let s=t.facet(of).some(n=>typeof n!="function"&&n.class=="cm-lineWrapping");this.heightOracle=new nA(s),this.stateDeco=t.facet(qa).filter(n=>typeof n!="function"),this.heightMap=Ws.empty().applyChanges(this.stateDeco,wt.empty,this.heightOracle.setDoc(t.doc),[new yr(0,0,0,t.doc.length)]);for(let n=0;n<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());n++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=qe.set(this.lineGaps.map(n=>n.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:s}=this.state.selection;for(let n=0;n<=1;n++){let i=n?s.head:s.anchor;if(!t.some(({from:a,to:o})=>i>=a&&i<=o)){let{from:a,to:o}=this.lineBlockAt(i);t.push(new Qo(a,o))}}return this.viewports=t.sort((n,i)=>n.from-i.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?vp:new hf(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(Oa(t,this.scaler))})}update(t,s=null){this.state=t.state;let n=this.stateDeco;this.stateDeco=this.state.facet(qa).filter(u=>typeof u!="function");let i=t.changedRanges,a=yr.extendWithRanges(i,lA(n,this.stateDeco,t?t.changes:hs.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);yp(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),a),(this.heightMap.height!=o||Ji)&&(t.flags|=2),l?(this.scrollAnchorPos=t.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=o);let c=a.length?this.mapViewport(this.viewport,t.changes):this.viewport;(s&&(s.range.head<c.from||s.range.head>c.to)||!this.viewportIsAppropriate(c))&&(c=this.getViewport(0,s));let h=c.from!=this.viewport.from||c.to!=this.viewport.to;this.viewport=c,t.flags|=this.updateForViewport(),(h||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(t.changes),s&&(this.scrollTarget=s),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(Qb)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let s=t.contentDOM,n=window.getComputedStyle(s),i=this.heightOracle,a=n.whiteSpace;this.defaultTextDirection=n.direction=="rtl"?zt.RTL:zt.LTR;let o=this.heightOracle.mustRefreshForWrapping(a),l=s.getBoundingClientRect(),c=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let h=0,u=0;if(l.width&&l.height){let{scaleX:E,scaleY:T}=yb(s,l);(E>.005&&Math.abs(this.scaleX-E)>.005||T>.005&&Math.abs(this.scaleY-T)>.005)&&(this.scaleX=E,this.scaleY=T,h|=16,o=c=!0)}let m=(parseInt(n.paddingTop)||0)*this.scaleY,p=(parseInt(n.paddingBottom)||0)*this.scaleY;(this.paddingTop!=m||this.paddingBottom!=p)&&(this.paddingTop=m,this.paddingBottom=p,h|=18),this.editorWidth!=t.scrollDOM.clientWidth&&(i.lineWrapping&&(c=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=16);let x=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=x&&(this.scrollAnchorHeight=-1,this.scrollTop=x),this.scrolledToBottom=vb(t.scrollDOM);let b=(this.printing?uA:dA)(s,this.paddingTop),w=b.top-this.pixelViewport.top,C=b.bottom-this.pixelViewport.bottom;this.pixelViewport=b;let A=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(A!=this.inView&&(this.inView=A,A&&(c=!0)),!this.inView&&!this.scrollTarget&&!hA(t.dom))return 0;let _=l.width;if((this.contentDOMWidth!=_||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=t.scrollDOM.clientHeight,h|=16),c){let E=t.docView.measureVisibleLineHeights(this.viewport);if(i.mustRefreshForHeights(E)&&(o=!0),o||i.lineWrapping&&Math.abs(_-this.contentDOMWidth)>i.charWidth){let{lineHeight:T,charWidth:M,textHeight:I}=t.docView.measureTextSize();o=T>0&&i.refresh(a,T,M,I,Math.max(5,_/M),E),o&&(t.docView.minWidth=0,h|=16)}w>0&&C>0?u=Math.max(w,C):w<0&&C<0&&(u=Math.min(w,C)),yp();for(let T of this.viewports){let M=T.from==this.viewport.from?E:t.docView.measureVisibleLineHeights(T);this.heightMap=(o?Ws.empty().applyChanges(this.stateDeco,wt.empty,this.heightOracle,[new yr(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(i,0,o,new iA(T.from,M))}Ji&&(h|=2)}let R=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return R&&(h&2&&(h|=this.updateScaler()),this.viewport=this.getViewport(u,this.scrollTarget),h|=this.updateForViewport()),(h&2||R)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,s){let n=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),i=this.heightMap,a=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,c=new Qo(i.lineAt(o-n*1e3,$t.ByHeight,a,0,0).from,i.lineAt(l+(1-n)*1e3,$t.ByHeight,a,0,0).to);if(s){let{head:h}=s.range;if(h<c.from||h>c.to){let u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),m=i.lineAt(h,$t.ByPos,a,0,0),p;s.y=="center"?p=(m.top+m.bottom)/2-u/2:s.y=="start"||s.y=="nearest"&&h<c.from?p=m.top:p=m.bottom-u,c=new Qo(i.lineAt(p-1e3/2,$t.ByHeight,a,0,0).from,i.lineAt(p+u+1e3/2,$t.ByHeight,a,0,0).to)}}return c}mapViewport(t,s){let n=s.mapPos(t.from,-1),i=s.mapPos(t.to,1);return new Qo(this.heightMap.lineAt(n,$t.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(i,$t.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:s},n=0){if(!this.inView)return!0;let{top:i}=this.heightMap.lineAt(t,$t.ByPos,this.heightOracle,0,0),{bottom:a}=this.heightMap.lineAt(s,$t.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(t==0||i<=o-Math.max(10,Math.min(-n,250)))&&(s==this.state.doc.length||a>=l+Math.max(10,Math.min(n,250)))&&i>o-2*1e3&&a<l+2*1e3}mapLineGaps(t,s){if(!t.length||s.empty)return t;let n=[];for(let i of t)s.touchesRange(i.from,i.to)||n.push(new jd(s.mapPos(i.from),s.mapPos(i.to),i.size,i.displaySize));return n}ensureLineGaps(t,s){let n=this.heightOracle.lineWrapping,i=n?1e4:2e3,a=i>>1,o=i<<1;if(this.defaultTextDirection!=zt.LTR&&!n)return[];let l=[],c=(u,m,p,x)=>{if(m-u<a)return;let b=this.state.selection.main,w=[b.from];b.empty||w.push(b.to);for(let A of w)if(A>u&&A<m){c(u,A-10,p,x),c(A+10,m,p,x);return}let C=pA(t,A=>A.from>=p.from&&A.to<=p.to&&Math.abs(A.from-u)<a&&Math.abs(A.to-m)<a&&!w.some(_=>A.from<_&&A.to>_));if(!C){if(m<p.to&&s&&n&&s.visibleRanges.some(R=>R.from<=m&&R.to>=m)){let R=s.moveToLineBoundary(ye.cursor(m),!1,!0).head;R>u&&(m=R)}let A=this.gapSize(p,u,m,x),_=n||A<2e6?A:2e6;C=new jd(u,m,A,_)}l.push(C)},h=u=>{if(u.length<o||u.type!=Ns.Text)return;let m=mA(u.from,u.to,this.stateDeco);if(m.total<o)return;let p=this.scrollTarget?this.scrollTarget.range.head:null,x,b;if(n){let w=i/this.heightOracle.lineLength*this.heightOracle.lineHeight,C,A;if(p!=null){let _=Ho(m,p),R=((this.visibleBottom-this.visibleTop)/2+w)/u.height;C=_-R,A=_+R}else C=(this.visibleTop-u.top-w)/u.height,A=(this.visibleBottom-u.top+w)/u.height;x=qo(m,C),b=qo(m,A)}else{let w=m.total*this.heightOracle.charWidth,C=i*this.heightOracle.charWidth,A=0;if(w>2e6)for(let M of t)M.from>=u.from&&M.from<u.to&&M.size!=M.displaySize&&M.from*this.heightOracle.charWidth+A<this.pixelViewport.left&&(A=M.size-M.displaySize);let _=this.pixelViewport.left+A,R=this.pixelViewport.right+A,E,T;if(p!=null){let M=Ho(m,p),I=((R-_)/2+C)/w;E=M-I,T=M+I}else E=(_-C)/w,T=(R+C)/w;x=qo(m,E),b=qo(m,T)}x>u.from&&c(u.from,x,u,m),b<u.to&&c(b,u.to,u,m)};for(let u of this.viewportLines)Array.isArray(u.type)?u.type.forEach(h):h(u);return l}gapSize(t,s,n,i){let a=Ho(i,n)-Ho(i,s);return this.heightOracle.lineWrapping?t.height*a:i.total*this.heightOracle.charWidth*a}updateLineGaps(t){jd.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=qe.set(t.map(s=>s.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(t){let s=this.stateDeco;this.lineGaps.length&&(s=s.concat(this.lineGapDeco));let n=[];Ot.spans(s,this.viewport.from,this.viewport.to,{span(a,o){n.push({from:a,to:o})},point(){}},20);let i=0;if(n.length!=this.visibleRanges.length)i=12;else for(let a=0;a<n.length&&!(i&8);a++){let o=this.visibleRanges[a],l=n[a];(o.from!=l.from||o.to!=l.to)&&(i|=4,t&&t.mapPos(o.from,-1)==l.from&&t.mapPos(o.to,1)==l.to||(i|=8))}return this.visibleRanges=n,i}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(s=>s.from<=t&&s.to>=t)||Oa(this.heightMap.lineAt(t,$t.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(s=>s.top<=t&&s.bottom>=t)||Oa(this.heightMap.lineAt(this.scaler.fromDOM(t),$t.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let s=this.lineBlockAtHeight(t+8);return s.from>=this.viewport.from||this.viewportLines[0].top-t>200?s:this.viewportLines[0]}elementAtHeight(t){return Oa(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Qo{constructor(t,s){this.from=t,this.to=s}}function mA(r,t,s){let n=[],i=r,a=0;return Ot.spans(s,r,t,{span(){},point(o,l){o>i&&(n.push({from:i,to:o}),a+=o-i),i=l}},20),i<t&&(n.push({from:i,to:t}),a+=t-i),{total:a,ranges:n}}function qo({total:r,ranges:t},s){if(s<=0)return t[0].from;if(s>=1)return t[t.length-1].to;let n=Math.floor(r*s);for(let i=0;;i++){let{from:a,to:o}=t[i],l=o-a;if(n<=l)return a+n;n-=l}}function Ho(r,t){let s=0;for(let{from:n,to:i}of r.ranges){if(t<=i){s+=t-n;break}s+=i-n}return s/r.total}function pA(r,t){for(let s of r)if(t(s))return s}const vp={toDOM(r){return r},fromDOM(r){return r},scale:1,eq(r){return r==this}};class hf{constructor(t,s,n){let i=0,a=0,o=0;this.viewports=n.map(({from:l,to:c})=>{let h=s.lineAt(l,$t.ByPos,t,0,0).top,u=s.lineAt(c,$t.ByPos,t,0,0).bottom;return i+=u-h,{from:l,to:c,top:h,bottom:u,domTop:0,domBottom:0}}),this.scale=(7e6-i)/(s.height-i);for(let l of this.viewports)l.domTop=o+(l.top-a)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),a=l.bottom}toDOM(t){for(let s=0,n=0,i=0;;s++){let a=s<this.viewports.length?this.viewports[s]:null;if(!a||t<a.top)return i+(t-n)*this.scale;if(t<=a.bottom)return a.domTop+(t-a.top);n=a.bottom,i=a.domBottom}}fromDOM(t){for(let s=0,n=0,i=0;;s++){let a=s<this.viewports.length?this.viewports[s]:null;if(!a||t<a.domTop)return n+(t-i)/this.scale;if(t<=a.domBottom)return a.top+(t-a.domTop);n=a.bottom,i=a.domBottom}}eq(t){return t instanceof hf?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((s,n)=>s.from==t.viewports[n].from&&s.to==t.viewports[n].to):!1}}function Oa(r,t){if(t.scale==1)return r;let s=t.toDOM(r.top),n=t.toDOM(r.bottom);return new Ur(r.from,r.length,s,n-s,Array.isArray(r._content)?r._content.map(i=>Oa(i,t)):r._content)}const Go=We.define({combine:r=>r.join(" ")}),Bh=We.define({combine:r=>r.indexOf(!0)>-1}),Uh=Wn.newName(),h0=Wn.newName(),u0=Wn.newName(),f0={"&light":"."+h0,"&dark":"."+u0};function Qh(r,t,s){return new Wn(t,{finish(n){return/&/.test(n)?n.replace(/&\w*/,i=>{if(i=="&")return r;if(!s||!s[i])throw new RangeError(`Unsupported selector: ${i}`);return s[i]}):r+" "+n}})}const gA=Qh("."+Uh,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},f0),xA={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},bd=Ne.ie&&Ne.ie_version<=11;class yA{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new JC,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(s=>{for(let n of s)this.queue.push(n);(Ne.ie&&Ne.ie_version<=11||Ne.ios&&t.composing)&&s.some(n=>n.type=="childList"&&n.removedNodes.length||n.type=="characterData"&&n.oldValue.length>n.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&Ne.android&&t.constructor.EDIT_CONTEXT!==!1&&!(Ne.chrome&&Ne.chrome_version<126)&&(this.editContext=new bA(t),t.state.facet(fn)&&(t.contentDOM.editContext=this.editContext.editContext)),bd&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var s;((s=this.view.docView)===null||s===void 0?void 0:s.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(s=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),s.length>0&&s[s.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(s=>{s.length>0&&s[s.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){(t.type=="change"||!t.type)&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((s,n)=>s!=t[n]))){this.gapIntersection.disconnect();for(let s of t)this.gapIntersection.observe(s);this.gaps=t}}onSelectionChange(t){let s=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:n}=this,i=this.selectionRange;if(n.state.facet(fn)?n.root.activeElement!=this.dom:!jl(this.dom,i))return;let a=i.anchorNode&&n.docView.nearest(i.anchorNode);if(a&&a.ignoreEvent(t)){s||(this.selectionChanged=!1);return}(Ne.ie&&Ne.ie_version<=11||Ne.android&&Ne.chrome)&&!n.state.selection.main.empty&&i.focusNode&&_a(i.focusNode,i.focusOffset,i.anchorNode,i.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,s=Qa(t.root);if(!s)return!1;let n=Ne.safari&&t.root.nodeType==11&&t.root.activeElement==this.dom&&jA(this.view,s)||s;if(!n||this.selectionRange.eq(n))return!1;let i=jl(this.dom,n);return i&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&t2(this.dom,n)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(n),i&&(this.selectionChanged=!0),!0)}setSelectionRange(t,s){this.selectionRange.set(t.node,t.offset,s.node,s.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,s=null;for(let n=this.dom;n;)if(n.nodeType==1)!s&&t<this.scrollTargets.length&&this.scrollTargets[t]==n?t++:s||(s=this.scrollTargets.slice(0,t)),s&&s.push(n),n=n.assignedSlot||n.parentNode;else if(n.nodeType==11)n=n.host;else break;if(t<this.scrollTargets.length&&!s&&(s=this.scrollTargets.slice(0,t)),s){for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);for(let n of this.scrollTargets=s)n.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,xA),bd&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),bd&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,s){var n;if(!this.delayedAndroidKey){let i=()=>{let a=this.delayedAndroidKey;a&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=a.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&a.force&&$i(this.dom,a.key,a.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(i)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:s,force:this.lastChange<Date.now()-50||!!(!((n=this.delayedAndroidKey)===null||n===void 0)&&n.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let s=-1,n=-1,i=!1;for(let a of t){let o=this.readMutation(a);o&&(o.typeOver&&(i=!0),s==-1?{from:s,to:n}=o:(s=Math.min(o.from,s),n=Math.max(o.to,n)))}return{from:s,to:n,typeOver:i}}readChange(){let{from:t,to:s,typeOver:n}=this.processRecords(),i=this.selectionChanged&&jl(this.dom,this.selectionRange);if(t<0&&!i)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let a=new L2(this.view,t,s,n);return this.view.docView.domChanged={newSel:a.newSel?a.newSel.main:null},a}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let s=this.readChange();if(!s)return this.view.requestMeasure(),!1;let n=this.view.state,i=t0(this.view,s);return this.view.state==n&&(s.domChanged||s.newSel&&!s.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),i}readMutation(t){let s=this.view.docView.nearest(t.target);if(!s||s.ignoreMutation(t))return null;if(s.markDirty(t.type=="attributes"),t.type=="attributes"&&(s.flags|=4),t.type=="childList"){let n=wp(s,t.previousSibling||t.target.previousSibling,-1),i=wp(s,t.nextSibling||t.target.nextSibling,1);return{from:n?s.posAfter(n):s.posAtStart,to:i?s.posBefore(i):s.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:s.posAtStart,to:s.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(fn)!=t.state.facet(fn)&&(t.view.contentDOM.editContext=t.state.facet(fn)?this.editContext.editContext:null))}destroy(){var t,s,n;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(s=this.gapIntersection)===null||s===void 0||s.disconnect(),(n=this.resizeScroll)===null||n===void 0||n.disconnect();for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function wp(r,t,s){for(;t;){let n=Rt.get(t);if(n&&n.parent==r)return n;let i=t.parentNode;t=i!=r.dom?i:s>0?t.nextSibling:t.previousSibling}return null}function Sp(r,t){let s=t.startContainer,n=t.startOffset,i=t.endContainer,a=t.endOffset,o=r.docView.domAtPos(r.state.selection.main.anchor);return _a(o.node,o.offset,i,a)&&([s,n,i,a]=[i,a,s,n]),{anchorNode:s,anchorOffset:n,focusNode:i,focusOffset:a}}function jA(r,t){if(t.getComposedRanges){let i=t.getComposedRanges(r.root)[0];if(i)return Sp(r,i)}let s=null;function n(i){i.preventDefault(),i.stopImmediatePropagation(),s=i.getTargetRanges()[0]}return r.contentDOM.addEventListener("beforeinput",n,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",n,!0),s?Sp(r,s):null}class bA{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(t.state);let s=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=n=>{let i=t.state.selection.main,{anchor:a,head:o}=i,l=this.toEditorPos(n.updateRangeStart),c=this.toEditorPos(n.updateRangeEnd);t.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:n.updateRangeStart,editorBase:l,drifted:!1});let h={from:l,to:c,insert:wt.of(n.text.split(`
`))};if(h.from==this.from&&a<this.from?h.from=a:h.to==this.to&&a>this.to&&(h.to=a),h.from==h.to&&!h.insert.length){let u=ye.single(this.toEditorPos(n.selectionStart),this.toEditorPos(n.selectionEnd));u.main.eq(i)||t.dispatch({selection:u,userEvent:"select"});return}if((Ne.mac||Ne.android)&&h.from==o-1&&/^\. ?$/.test(n.text)&&t.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:l,to:c,insert:wt.of([n.text.replace("."," ")])}),this.pendingContextChange=h,!t.state.readOnly){let u=this.to-this.from+(h.to-h.from+h.insert.length);cf(t,h,ye.single(this.toEditorPos(n.selectionStart,u),this.toEditorPos(n.selectionEnd,u)))}this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state))},this.handlers.characterboundsupdate=n=>{let i=[],a=null;for(let o=this.toEditorPos(n.rangeStart),l=this.toEditorPos(n.rangeEnd);o<l;o++){let c=t.coordsForChar(o);a=c&&new DOMRect(c.left,c.top,c.right-c.left,c.bottom-c.top)||a||new DOMRect,i.push(a)}s.updateCharacterBounds(n.rangeStart,i)},this.handlers.textformatupdate=n=>{let i=[];for(let a of n.getTextFormats()){let o=a.underlineStyle,l=a.underlineThickness;if(o!="None"&&l!="None"){let c=this.toEditorPos(a.rangeStart),h=this.toEditorPos(a.rangeEnd);if(c<h){let u=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${l=="Thin"?1:2}px`;i.push(qe.mark({attributes:{style:u}}).range(c,h))}}}t.dispatch({effects:Hb.of(qe.set(i))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(t.inputState.composing=-1,t.inputState.compositionFirstChange=null,this.composing){let{drifted:n}=this.composing;this.composing=null,n&&this.reset(t.state)}};for(let n in this.handlers)s.addEventListener(n,this.handlers[n]);this.measureReq={read:n=>{this.editContext.updateControlBounds(n.contentDOM.getBoundingClientRect());let i=Qa(n.root);i&&i.rangeCount&&this.editContext.updateSelectionBounds(i.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let s=0,n=!1,i=this.pendingContextChange;return t.changes.iterChanges((a,o,l,c,h)=>{if(n)return;let u=h.length-(o-a);if(i&&o>=i.to)if(i.from==a&&i.to==o&&i.insert.eq(h)){i=this.pendingContextChange=null,s+=u,this.to+=u;return}else i=null,this.revertPending(t.state);if(a+=s,o+=s,o<=this.from)this.from+=u,this.to+=u;else if(a<this.to){if(a<this.from||o>this.to||this.to-this.from+h.length>3e4){n=!0;return}this.editContext.updateText(this.toContextPos(a),this.toContextPos(o),h.toString()),this.to+=u}s+=u}),i&&!n&&this.revertPending(t.state),!n}update(t){let s=this.pendingContextChange,n=t.startState.selection.main;this.composing&&(this.composing.drifted||!t.changes.touchesRange(n.from,n.to)&&t.transactions.some(i=>!i.isUserEvent("input.type")&&i.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=t.changes.mapPos(this.composing.editorBase)):!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.reset(t.state)):(t.docChanged||t.selectionSet||s)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:s}=t.selection.main;this.from=Math.max(0,s-1e4),this.to=Math.min(t.doc.length,s+1e4)}reset(t){this.resetRange(t),this.editContext.updateText(0,this.editContext.text.length,t.doc.sliceString(this.from,this.to)),this.setSelection(t)}revertPending(t){let s=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(s.from),this.toContextPos(s.from+s.insert.length),t.doc.sliceString(s.from,s.to))}setSelection(t){let{main:s}=t.selection,n=this.toContextPos(Math.max(this.from,Math.min(this.to,s.anchor))),i=this.toContextPos(s.head);(this.editContext.selectionStart!=n||this.editContext.selectionEnd!=i)&&this.editContext.updateSelection(n,i)}rangeIsValid(t){let{head:s}=t.selection.main;return!(this.from>0&&s-this.from<500||this.to<t.doc.length&&this.to-s<500||this.to-this.from>1e4*3)}toEditorPos(t,s=this.to-this.from){t=Math.min(t,s);let n=this.composing;return n&&n.drifted?n.editorBase+(t-n.contextBase):t+this.from}toContextPos(t){let s=this.composing;return s&&s.drifted?s.contextBase+(t-s.editorBase):t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class Ie{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){var s;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:n}=t;this.dispatchTransactions=t.dispatchTransactions||n&&(i=>i.forEach(a=>n(a,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=t.root||e2(t.parent)||document,this.viewState=new bp(t.state||bt.create(t)),t.scrollTo&&t.scrollTo.is(zo)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Di).map(i=>new gd(i));for(let i of this.plugins)i.update(this);this.observer=new yA(this),this.inputState=new V2(this),this.inputState.ensureHandlers(this.plugins),this.docView=new tp(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((s=document.fonts)===null||s===void 0)&&s.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...t){let s=t.length==1&&t[0]instanceof ls?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(s,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let s=!1,n=!1,i,a=this.state;for(let p of t){if(p.startState!=a)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");a=p.state}if(this.destroyed){this.viewState.state=a;return}let o=this.hasFocus,l=0,c=null;t.some(p=>p.annotation(o0))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,c=l0(a,o),c||(l=1));let h=this.observer.delayedAndroidKey,u=null;if(h?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(a.doc)||!this.state.selection.eq(a.selection))&&(u=null)):this.observer.clear(),a.facet(bt.phrases)!=this.state.facet(bt.phrases))return this.setState(a);i=zl.create(this,a,t),i.flags|=l;let m=this.viewState.scrollTarget;try{this.updateState=2;for(let p of t){if(m&&(m=m.map(p.changes)),p.scrollIntoView){let{main:x}=p.state.selection;m=new Vi(x.empty?x:ye.cursor(x.head,x.head>x.anchor?-1:1))}for(let x of p.effects)x.is(zo)&&(m=x.value.clip(this.state))}this.viewState.update(i,m),this.bidiCache=Ul.update(this.bidiCache,i.changes),i.empty||(this.updatePlugins(i),this.inputState.update(i)),s=this.docView.update(i),this.state.facet(wa)!=this.styleModules&&this.mountStyles(),n=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(s,t.some(p=>p.isUserEvent("select.pointer")))}finally{this.updateState=0}if(i.startState.facet(Go)!=i.state.facet(Go)&&(this.viewState.mustMeasureContent=!0),(s||n||m||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),s&&this.docViewUpdate(),!i.empty)for(let p of this.state.facet(Wh))try{p(i)}catch(x){Hs(this.state,x,"update listener")}(c||u)&&Promise.resolve().then(()=>{c&&this.state==c.startState&&this.dispatch(c),u&&!t0(this,u)&&h.force&&$i(this.contentDOM,h.key,h.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let s=this.hasFocus;try{for(let n of this.plugins)n.destroy(this);this.viewState=new bp(t),this.plugins=t.facet(Di).map(n=>new gd(n)),this.pluginMap.clear();for(let n of this.plugins)n.update(this);this.docView.destroy(),this.docView=new tp(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}s&&this.focus(),this.requestMeasure()}updatePlugins(t){let s=t.startState.facet(Di),n=t.state.facet(Di);if(s!=n){let i=[];for(let a of n){let o=s.indexOf(a);if(o<0)i.push(new gd(a));else{let l=this.plugins[o];l.mustUpdate=t,i.push(l)}}for(let a of this.plugins)a.mustUpdate!=t&&a.destroy(this);this.plugins=i,this.pluginMap.clear()}else for(let i of this.plugins)i.mustUpdate=t;for(let i=0;i<this.plugins.length;i++)this.plugins[i].update(this);s!=n&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let s=t.value;if(s&&s.docViewUpdate)try{s.docViewUpdate(this)}catch(n){Hs(this.state,n,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let s=null,n=this.scrollDOM,i=n.scrollTop*this.scaleY,{scrollAnchorPos:a,scrollAnchorHeight:o}=this.viewState;Math.abs(i-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(vb(n))a=-1,o=this.viewState.heightMap.height;else{let x=this.viewState.scrollAnchorAt(i);a=x.from,o=x.top}this.updateState=1;let c=this.viewState.measure(this);if(!c&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];c&4||([this.measureRequests,h]=[h,this.measureRequests]);let u=h.map(x=>{try{return x.read(this)}catch(b){return Hs(this.state,b),Op}}),m=zl.create(this,this.state,[]),p=!1;m.flags|=c,s?s.flags|=c:s=m,this.updateState=2,m.empty||(this.updatePlugins(m),this.inputState.update(m),this.updateAttrs(),p=this.docView.update(m),p&&this.docViewUpdate());for(let x=0;x<h.length;x++)if(u[x]!=Op)try{let b=h[x];b.write&&b.write(u[x],this)}catch(b){Hs(this.state,b)}if(p&&this.docView.updateSelection(!0),!m.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let b=(a<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(a).top)-o;if(b>1||b<-1){i=i+b,n.scrollTop=i/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(s&&!s.empty)for(let l of this.state.facet(Wh))l(s)}get themeClasses(){return Uh+" "+(this.state.facet(Bh)?u0:h0)+" "+this.state.facet(Go)}updateAttrs(){let t=kp(this,Gb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),s={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(fn)?"true":"false",class:"cm-content",style:`${Ne.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(s["aria-readonly"]="true"),kp(this,of,s);let n=this.observer.ignore(()=>{let i=Rh(this.contentDOM,this.contentAttrs,s),a=Rh(this.dom,this.editorAttrs,t);return i||a});return this.editorAttrs=t,this.contentAttrs=s,n}showAnnouncements(t){let s=!0;for(let n of t)for(let i of n.effects)if(i.is(Ie.announce)){s&&(this.announceDOM.textContent=""),s=!1;let a=this.announceDOM.appendChild(document.createElement("div"));a.textContent=i.value}}mountStyles(){this.styleModules=this.state.facet(wa);let t=this.state.facet(Ie.cspNonce);Wn.mount(this.root,this.styleModules.concat(gA).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let s=0;s<this.measureRequests.length;s++)if(this.measureRequests[s].key===t.key){this.measureRequests[s]=t;return}}this.measureRequests.push(t)}}plugin(t){let s=this.pluginMap.get(t);return(s===void 0||s&&s.plugin!=t)&&this.pluginMap.set(t,s=this.plugins.find(n=>n.plugin==t)||null),s&&s.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,s,n){return yd(this,t,ap(this,t,s,n))}moveByGroup(t,s){return yd(this,t,ap(this,t,s,n=>I2(this,t.head,n)))}visualLineSide(t,s){let n=this.bidiSpans(t),i=this.textDirectionAt(t.from),a=n[s?n.length-1:0];return ye.cursor(a.side(s,i)+t.from,a.forward(!s,i)?1:-1)}moveToLineBoundary(t,s,n=!0){return E2(this,t,s,n)}moveVertically(t,s,n){return yd(this,t,D2(this,t,s,n))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,s=0){return this.docView.posFromDOM(t,s)}posAtCoords(t,s=!0){return this.readMeasured(),Jb(this,t,s)}coordsAtPos(t,s=1){this.readMeasured();let n=this.docView.coordsAt(t,s);if(!n||n.left==n.right)return n;let i=this.state.doc.lineAt(t),a=this.bidiSpans(i),o=a[Dn.find(a,t-i.from,-1,s)];return fo(n,o.dir==zt.LTR==s>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(Ub)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>vA)return Lb(t.length);let s=this.textDirectionAt(t.from),n;for(let a of this.bidiCache)if(a.from==t.from&&a.dir==s&&(a.fresh||Mb(a.isolates,n=ep(this,t))))return a.order;n||(n=ep(this,t));let i=p2(t.text,s,n);return this.bidiCache.push(new Ul(t.from,t.to,s,n,!0,i)),i}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||Ne.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{jb(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,s={}){return zo.of(new Vi(typeof t=="number"?ye.cursor(t):t,s.y,s.x,s.yMargin,s.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:s}=this.scrollDOM,n=this.viewState.scrollAnchorAt(t);return zo.of(new Vi(ye.cursor(n.from),"start","start",n.top-t,s,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return ss.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return ss.define(()=>({}),{eventObservers:t})}static theme(t,s){let n=Wn.newName(),i=[Go.of(n),wa.of(Qh(`.${n}`,t))];return s&&s.dark&&i.push(Bh.of(!0)),i}static baseTheme(t){return qn.lowest(wa.of(Qh("."+Uh,t,f0)))}static findFromDOM(t){var s;let n=t.querySelector(".cm-content"),i=n&&Rt.get(n)||Rt.get(t);return((s=i?.rootView)===null||s===void 0?void 0:s.view)||null}}Ie.styleModule=wa;Ie.inputHandler=zb;Ie.clipboardInputFilter=nf;Ie.clipboardOutputFilter=af;Ie.scrollHandler=qb;Ie.focusChangeEffect=Bb;Ie.perLineTextDirection=Ub;Ie.exceptionSink=Vb;Ie.updateListener=Wh;Ie.editable=fn;Ie.mouseSelectionStyle=$b;Ie.dragMovesSelection=Wb;Ie.clickAddsSelectionRange=Nb;Ie.decorations=qa;Ie.outerDecorations=Kb;Ie.atomicRanges=Tc;Ie.bidiIsolatedRanges=Yb;Ie.scrollMargins=Xb;Ie.darkTheme=Bh;Ie.cspNonce=We.define({combine:r=>r.length?r[0]:""});Ie.contentAttributes=of;Ie.editorAttributes=Gb;Ie.lineWrapping=Ie.contentAttributes.of({class:"cm-lineWrapping"});Ie.announce=nt.define();const vA=4096,Op={};class Ul{constructor(t,s,n,i,a,o){this.from=t,this.to=s,this.dir=n,this.isolates=i,this.fresh=a,this.order=o}static update(t,s){if(s.empty&&!t.some(a=>a.fresh))return t;let n=[],i=t.length?t[t.length-1].dir:zt.LTR;for(let a=Math.max(0,t.length-10);a<t.length;a++){let o=t[a];o.dir==i&&!s.touchesRange(o.from,o.to)&&n.push(new Ul(s.mapPos(o.from,1),s.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return n}}function kp(r,t,s){for(let n=r.state.facet(t),i=n.length-1;i>=0;i--){let a=n[i],o=typeof a=="function"?a(r):a;o&&Dh(o,s)}return s}const wA=Ne.mac?"mac":Ne.windows?"win":Ne.linux?"linux":"key";function SA(r,t){const s=r.split(/-(?!$)/);let n=s[s.length-1];n=="Space"&&(n=" ");let i,a,o,l;for(let c=0;c<s.length-1;++c){const h=s[c];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))i=!0;else if(/^(c|ctrl|control)$/i.test(h))a=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))t=="mac"?l=!0:a=!0;else throw new Error("Unrecognized modifier name: "+h)}return i&&(n="Alt-"+n),a&&(n="Ctrl-"+n),l&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function Ko(r,t,s){return t.altKey&&(r="Alt-"+r),t.ctrlKey&&(r="Ctrl-"+r),t.metaKey&&(r="Meta-"+r),s!==!1&&t.shiftKey&&(r="Shift-"+r),r}const OA=qn.default(Ie.domEventHandlers({keydown(r,t){return p0(m0(t.state),r,t,"editor")}})),go=We.define({enables:OA}),Cp=new WeakMap;function m0(r){let t=r.facet(go),s=Cp.get(t);return s||Cp.set(t,s=AA(t.reduce((n,i)=>n.concat(i),[]))),s}function kA(r,t,s){return p0(m0(r.state),t,r,s)}let Pn=null;const CA=4e3;function AA(r,t=wA){let s=Object.create(null),n=Object.create(null),i=(o,l)=>{let c=n[o];if(c==null)n[o]=l;else if(c!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},a=(o,l,c,h,u)=>{var m,p;let x=s[o]||(s[o]=Object.create(null)),b=l.split(/ (?!$)/).map(A=>SA(A,t));for(let A=1;A<b.length;A++){let _=b.slice(0,A).join(" ");i(_,!0),x[_]||(x[_]={preventDefault:!0,stopPropagation:!1,run:[R=>{let E=Pn={view:R,prefix:_,scope:o};return setTimeout(()=>{Pn==E&&(Pn=null)},CA),!0}]})}let w=b.join(" ");i(w,!1);let C=x[w]||(x[w]={preventDefault:!1,stopPropagation:!1,run:((p=(m=x._any)===null||m===void 0?void 0:m.run)===null||p===void 0?void 0:p.slice())||[]});c&&C.run.push(c),h&&(C.preventDefault=!0),u&&(C.stopPropagation=!0)};for(let o of r){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let h of l){let u=s[h]||(s[h]=Object.create(null));u._any||(u._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:m}=o;for(let p in u)u[p].run.push(x=>m(x,qh))}let c=o[t]||o.key;if(c)for(let h of l)a(h,c,o.run,o.preventDefault,o.stopPropagation),o.shift&&a(h,"Shift-"+c,o.shift,o.preventDefault,o.stopPropagation)}return s}let qh=null;function p0(r,t,s,n){qh=t;let i=KC(t),a=Us(i,0),o=Br(a)==i.length&&i!=" ",l="",c=!1,h=!1,u=!1;Pn&&Pn.view==s&&Pn.scope==n&&(l=Pn.prefix+" ",r0.indexOf(t.keyCode)<0&&(h=!0,Pn=null));let m=new Set,p=C=>{if(C){for(let A of C.run)if(!m.has(A)&&(m.add(A),A(s)))return C.stopPropagation&&(u=!0),!0;C.preventDefault&&(C.stopPropagation&&(u=!0),h=!0)}return!1},x=r[n],b,w;return x&&(p(x[l+Ko(i,t,!o)])?c=!0:o&&(t.altKey||t.metaKey||t.ctrlKey)&&!(Ne.windows&&t.ctrlKey&&t.altKey)&&!(Ne.mac&&t.altKey&&!(t.ctrlKey||t.metaKey))&&(b=$n[t.keyCode])&&b!=i?(p(x[l+Ko(b,t,!0)])||t.shiftKey&&(w=Ua[t.keyCode])!=i&&w!=b&&p(x[l+Ko(w,t,!1)]))&&(c=!0):o&&t.shiftKey&&p(x[l+Ko(i,t,!0)])&&(c=!0),!c&&p(x._any)&&(c=!0)),h&&(c=!0),c&&u&&t.stopPropagation(),qh=null,c}class xo{constructor(t,s,n,i,a){this.className=t,this.left=s,this.top=n,this.width=i,this.height=a}draw(){let t=document.createElement("div");return t.className=this.className,this.adjust(t),t}update(t,s){return s.className!=this.className?!1:(this.adjust(t),!0)}adjust(t){t.style.left=this.left+"px",t.style.top=this.top+"px",this.width!=null&&(t.style.width=this.width+"px"),t.style.height=this.height+"px"}eq(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className}static forRange(t,s,n){if(n.empty){let i=t.coordsAtPos(n.head,n.assoc||1);if(!i)return[];let a=g0(t);return[new xo(s,i.left-a.left,i.top-a.top,null,i.bottom-i.top)]}else return TA(t,s,n)}}function g0(r){let t=r.scrollDOM.getBoundingClientRect();return{left:(r.textDirection==zt.LTR?t.left:t.right-r.scrollDOM.clientWidth*r.scaleX)-r.scrollDOM.scrollLeft*r.scaleX,top:t.top-r.scrollDOM.scrollTop*r.scaleY}}function Ap(r,t,s,n){let i=r.coordsAtPos(t,s*2);if(!i)return n;let a=r.dom.getBoundingClientRect(),o=(i.top+i.bottom)/2,l=r.posAtCoords({x:a.left+1,y:o}),c=r.posAtCoords({x:a.right-1,y:o});return l==null||c==null?n:{from:Math.max(n.from,Math.min(l,c)),to:Math.min(n.to,Math.max(l,c))}}function TA(r,t,s){if(s.to<=r.viewport.from||s.from>=r.viewport.to)return[];let n=Math.max(s.from,r.viewport.from),i=Math.min(s.to,r.viewport.to),a=r.textDirection==zt.LTR,o=r.contentDOM,l=o.getBoundingClientRect(),c=g0(r),h=o.querySelector(".cm-line"),u=h&&window.getComputedStyle(h),m=l.left+(u?parseInt(u.paddingLeft)+Math.min(0,parseInt(u.textIndent)):0),p=l.right-(u?parseInt(u.paddingRight):0),x=Vh(r,n,1),b=Vh(r,i,-1),w=x.type==Ns.Text?x:null,C=b.type==Ns.Text?b:null;if(w&&(r.lineWrapping||x.widgetLineBreaks)&&(w=Ap(r,n,1,w)),C&&(r.lineWrapping||b.widgetLineBreaks)&&(C=Ap(r,i,-1,C)),w&&C&&w.from==C.from&&w.to==C.to)return _(R(s.from,s.to,w));{let T=w?R(s.from,null,w):E(x,!1),M=C?R(null,s.to,C):E(b,!0),I=[];return(w||x).to<(C||b).from-(w&&C?1:0)||x.widgetLineBreaks>1&&T.bottom+r.defaultLineHeight/2<M.top?I.push(A(m,T.bottom,p,M.top)):T.bottom<M.top&&r.elementAtHeight((T.bottom+M.top)/2).type==Ns.Text&&(T.bottom=M.top=(T.bottom+M.top)/2),_(T).concat(I).concat(_(M))}function A(T,M,I,N){return new xo(t,T-c.left,M-c.top,I-T,N-M)}function _({top:T,bottom:M,horizontal:I}){let N=[];for(let k=0;k<I.length;k+=2)N.push(A(I[k],T,I[k+1],M));return N}function R(T,M,I){let N=1e9,k=-1e9,S=[];function L($,q,ne,he,re){let G=r.coordsAtPos($,$==I.to?-2:2),H=r.coordsAtPos(ne,ne==I.from?2:-2);!G||!H||(N=Math.min(G.top,H.top,N),k=Math.max(G.bottom,H.bottom,k),re==zt.LTR?S.push(a&&q?m:G.left,a&&he?p:H.right):S.push(!a&&he?m:H.left,!a&&q?p:G.right))}let W=T??I.from,F=M??I.to;for(let $ of r.visibleRanges)if($.to>W&&$.from<F)for(let q=Math.max($.from,W),ne=Math.min($.to,F);;){let he=r.state.doc.lineAt(q);for(let re of r.bidiSpans(he)){let G=re.from+he.from,H=re.to+he.from;if(G>=ne)break;H>q&&L(Math.max(G,q),T==null&&G<=W,Math.min(H,ne),M==null&&H>=F,re.dir)}if(q=he.to+1,q>=ne)break}return S.length==0&&L(W,T==null,F,M==null,r.textDirection),{top:N,bottom:k,horizontal:S}}function E(T,M){let I=l.top+(M?T.top:T.bottom);return{top:I,bottom:I,horizontal:[]}}}function PA(r,t){return r.constructor==t.constructor&&r.eq(t)}class _A{constructor(t,s){this.view=t,this.layer=s,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=t.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),s.above&&this.dom.classList.add("cm-layer-above"),s.class&&this.dom.classList.add(s.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(t.state),t.requestMeasure(this.measureReq),s.mount&&s.mount(this.dom,t)}update(t){t.startState.facet(Sl)!=t.state.facet(Sl)&&this.setOrder(t.state),(this.layer.update(t,this.dom)||t.geometryChanged)&&(this.scale(),t.view.requestMeasure(this.measureReq))}docViewUpdate(t){this.layer.updateOnDocViewUpdate!==!1&&t.requestMeasure(this.measureReq)}setOrder(t){let s=0,n=t.facet(Sl);for(;s<n.length&&n[s]!=this.layer;)s++;this.dom.style.zIndex=String((this.layer.above?150:-1)-s)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:t,scaleY:s}=this.view;(t!=this.scaleX||s!=this.scaleY)&&(this.scaleX=t,this.scaleY=s,this.dom.style.transform=`scale(${1/t}, ${1/s})`)}draw(t){if(t.length!=this.drawn.length||t.some((s,n)=>!PA(s,this.drawn[n]))){let s=this.dom.firstChild,n=0;for(let i of t)i.update&&s&&i.constructor&&this.drawn[n].constructor&&i.update(s,this.drawn[n])?(s=s.nextSibling,n++):this.dom.insertBefore(i.draw(),s);for(;s;){let i=s.nextSibling;s.remove(),s=i}this.drawn=t}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Sl=We.define();function x0(r){return[ss.define(t=>new _A(t,r)),Sl.of(r)]}const Ha=We.define({combine(r){return sn(r,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(t,s)=>Math.min(t,s),drawRangeCursor:(t,s)=>t||s})}});function EA(r={}){return[Ha.of(r),IA,DA,RA,Qb.of(!0)]}function y0(r){return r.startState.facet(Ha)!=r.state.facet(Ha)}const IA=x0({above:!0,markers(r){let{state:t}=r,s=t.facet(Ha),n=[];for(let i of t.selection.ranges){let a=i==t.selection.main;if(i.empty||s.drawRangeCursor){let o=a?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=i.empty?i:ye.cursor(i.head,i.head>i.anchor?-1:1);for(let c of xo.forRange(r,o,l))n.push(c)}}return n},update(r,t){r.transactions.some(n=>n.selection)&&(t.style.animationName=t.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let s=y0(r);return s&&Tp(r.state,t),r.docChanged||r.selectionSet||s},mount(r,t){Tp(t.state,r)},class:"cm-cursorLayer"});function Tp(r,t){t.style.animationDuration=r.facet(Ha).cursorBlinkRate+"ms"}const DA=x0({above:!1,markers(r){return r.state.selection.ranges.map(t=>t.empty?[]:xo.forRange(r,"cm-selectionBackground",t)).reduce((t,s)=>t.concat(s))},update(r,t){return r.docChanged||r.selectionSet||r.viewportChanged||y0(r)},class:"cm-selectionLayer"}),RA=qn.highest(Ie.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}})),j0=nt.define({map(r,t){return r==null?null:t.mapPos(r)}}),ka=ys.define({create(){return null},update(r,t){return r!=null&&(r=t.changes.mapPos(r)),t.effects.reduce((s,n)=>n.is(j0)?n.value:s,r)}}),MA=ss.fromClass(class{constructor(r){this.view=r,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(r){var t;let s=r.state.field(ka);s==null?this.cursor!=null&&((t=this.cursor)===null||t===void 0||t.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(r.startState.field(ka)!=s||r.docChanged||r.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:r}=this,t=r.state.field(ka),s=t!=null&&r.coordsAtPos(t);if(!s)return null;let n=r.scrollDOM.getBoundingClientRect();return{left:s.left-n.left+r.scrollDOM.scrollLeft*r.scaleX,top:s.top-n.top+r.scrollDOM.scrollTop*r.scaleY,height:s.bottom-s.top}}drawCursor(r){if(this.cursor){let{scaleX:t,scaleY:s}=this.view;r?(this.cursor.style.left=r.left/t+"px",this.cursor.style.top=r.top/s+"px",this.cursor.style.height=r.height/s+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(r){this.view.state.field(ka)!=r&&this.view.dispatch({effects:j0.of(r)})}},{eventObservers:{dragover(r){this.setDropPos(this.view.posAtCoords({x:r.clientX,y:r.clientY}))},dragleave(r){(r.target==this.view.contentDOM||!this.view.contentDOM.contains(r.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function LA(){return[ka,MA]}function Pp(r,t,s,n,i){t.lastIndex=0;for(let a=r.iterRange(s,n),o=s,l;!a.next().done;o+=a.value.length)if(!a.lineBreak)for(;l=t.exec(a.value);)i(o+l.index,l)}function FA(r,t){let s=r.visibleRanges;if(s.length==1&&s[0].from==r.viewport.from&&s[0].to==r.viewport.to)return s;let n=[];for(let{from:i,to:a}of s)i=Math.max(r.state.doc.lineAt(i).from,i-t),a=Math.min(r.state.doc.lineAt(a).to,a+t),n.length&&n[n.length-1].to>=i?n[n.length-1].to=a:n.push({from:i,to:a});return n}class NA{constructor(t){const{regexp:s,decoration:n,decorate:i,boundary:a,maxLength:o=1e3}=t;if(!s.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=s,i)this.addMatch=(l,c,h,u)=>i(u,h,h+l[0].length,l,c);else if(typeof n=="function")this.addMatch=(l,c,h,u)=>{let m=n(l,c,h);m&&u(h,h+l[0].length,m)};else if(n)this.addMatch=(l,c,h,u)=>u(h,h+l[0].length,n);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=a,this.maxLength=o}createDeco(t){let s=new bn,n=s.add.bind(s);for(let{from:i,to:a}of FA(t,this.maxLength))Pp(t.state.doc,this.regexp,i,a,(o,l)=>this.addMatch(l,t,o,n));return s.finish()}updateDeco(t,s){let n=1e9,i=-1;return t.docChanged&&t.changes.iterChanges((a,o,l,c)=>{c>=t.view.viewport.from&&l<=t.view.viewport.to&&(n=Math.min(l,n),i=Math.max(c,i))}),t.viewportMoved||i-n>1e3?this.createDeco(t.view):i>-1?this.updateRange(t.view,s.map(t.changes),n,i):s}updateRange(t,s,n,i){for(let a of t.visibleRanges){let o=Math.max(a.from,n),l=Math.min(a.to,i);if(l>=o){let c=t.state.doc.lineAt(o),h=c.to<l?t.state.doc.lineAt(l):c,u=Math.max(a.from,c.from),m=Math.min(a.to,h.to);if(this.boundary){for(;o>c.from;o--)if(this.boundary.test(c.text[o-1-c.from])){u=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){m=l;break}}let p=[],x,b=(w,C,A)=>p.push(A.range(w,C));if(c==h)for(this.regexp.lastIndex=u-c.from;(x=this.regexp.exec(c.text))&&x.index<m-c.from;)this.addMatch(x,t,x.index+c.from,b);else Pp(t.state.doc,this.regexp,u,m,(w,C)=>this.addMatch(C,t,w,b));s=s.update({filterFrom:u,filterTo:m,filter:(w,C)=>w<u||C>m,add:p})}}return s}}const Hh=/x/.unicode!=null?"gu":"g",WA=new RegExp(`[\0-\b
--­؜​‎‏\u2028\u2029‭‮⁦⁧⁩\uFEFF￹-￼]`,Hh),$A={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let vd=null;function VA(){var r;if(vd==null&&typeof document<"u"&&document.body){let t=document.body.style;vd=((r=t.tabSize)!==null&&r!==void 0?r:t.MozTabSize)!=null}return vd||!1}const Ol=We.define({combine(r){let t=sn(r,{render:null,specialChars:WA,addSpecialChars:null});return(t.replaceTabs=!VA())&&(t.specialChars=new RegExp("	|"+t.specialChars.source,Hh)),t.addSpecialChars&&(t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,Hh)),t}});function zA(r={}){return[Ol.of(r),BA()]}let _p=null;function BA(){return _p||(_p=ss.fromClass(class{constructor(r){this.view=r,this.decorations=qe.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(r.state.facet(Ol)),this.decorations=this.decorator.createDeco(r)}makeDecorator(r){return new NA({regexp:r.specialChars,decoration:(t,s,n)=>{let{doc:i}=s.state,a=Us(t[0],0);if(a==9){let o=i.lineAt(n),l=s.state.tabSize,c=ia(o.text,l,n-o.from);return qe.replace({widget:new HA((l-c%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[a]||(this.decorationCache[a]=qe.replace({widget:new qA(r,a)}))},boundary:r.replaceTabs?void 0:/[^]/})}update(r){let t=r.state.facet(Ol);r.startState.facet(Ol)!=t?(this.decorator=this.makeDecorator(t),this.decorations=this.decorator.createDeco(r.view)):this.decorations=this.decorator.updateDeco(r,this.decorations)}},{decorations:r=>r.decorations}))}const UA="•";function QA(r){return r>=32?UA:r==10?"␤":String.fromCharCode(9216+r)}class qA extends rn{constructor(t,s){super(),this.options=t,this.code=s}eq(t){return t.code==this.code}toDOM(t){let s=QA(this.code),n=t.state.phrase("Control character")+" "+($A[this.code]||"0x"+this.code.toString(16)),i=this.options.render&&this.options.render(this.code,n,s);if(i)return i;let a=document.createElement("span");return a.textContent=s,a.title=n,a.setAttribute("aria-label",n),a.className="cm-specialChar",a}ignoreEvent(){return!1}}class HA extends rn{constructor(t){super(),this.width=t}eq(t){return t.width==this.width}toDOM(){let t=document.createElement("span");return t.textContent="	",t.className="cm-tab",t.style.width=this.width+"px",t}ignoreEvent(){return!1}}function GA(){return YA}const KA=qe.line({class:"cm-activeLine"}),YA=ss.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.docChanged||r.selectionSet)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let t=-1,s=[];for(let n of r.state.selection.ranges){let i=r.lineBlockAt(n.head);i.from>t&&(s.push(KA.range(i.from)),t=i.from)}return qe.set(s)}},{decorations:r=>r.decorations});class XA extends rn{constructor(t){super(),this.content=t}toDOM(t){let s=document.createElement("span");return s.className="cm-placeholder",s.style.pointerEvents="none",s.appendChild(typeof this.content=="string"?document.createTextNode(this.content):typeof this.content=="function"?this.content(t):this.content.cloneNode(!0)),s.setAttribute("aria-hidden","true"),s}coordsAt(t){let s=t.firstChild?Yi(t.firstChild):[];if(!s.length)return null;let n=window.getComputedStyle(t.parentNode),i=fo(s[0],n.direction!="rtl"),a=parseInt(n.lineHeight);return i.bottom-i.top>a*1.5?{left:i.left,right:i.right,top:i.top,bottom:i.top+a}:i}ignoreEvent(){return!1}}function ZA(r){let t=ss.fromClass(class{constructor(s){this.view=s,this.placeholder=r?qe.set([qe.widget({widget:new XA(r),side:1}).range(0)]):qe.none}get decorations(){return this.view.state.doc.length?qe.none:this.placeholder}},{decorations:s=>s.decorations});return typeof r=="string"?[t,Ie.contentAttributes.of({"aria-placeholder":r})]:t}const Gh=2e3;function JA(r,t,s){let n=Math.min(t.line,s.line),i=Math.max(t.line,s.line),a=[];if(t.off>Gh||s.off>Gh||t.col<0||s.col<0){let o=Math.min(t.off,s.off),l=Math.max(t.off,s.off);for(let c=n;c<=i;c++){let h=r.doc.line(c);h.length<=l&&a.push(ye.range(h.from+o,h.to+l))}}else{let o=Math.min(t.col,s.col),l=Math.max(t.col,s.col);for(let c=n;c<=i;c++){let h=r.doc.line(c),u=Ch(h.text,o,r.tabSize,!0);if(u<0)a.push(ye.cursor(h.to));else{let m=Ch(h.text,l,r.tabSize);a.push(ye.range(h.from+u,h.from+m))}}}return a}function eT(r,t){let s=r.coordsAtPos(r.viewport.from);return s?Math.round(Math.abs((s.left-t)/r.defaultCharacterWidth)):-1}function Ep(r,t){let s=r.posAtCoords({x:t.clientX,y:t.clientY},!1),n=r.state.doc.lineAt(s),i=s-n.from,a=i>Gh?-1:i==n.length?eT(r,t.clientX):ia(n.text,r.state.tabSize,s-n.from);return{line:n.number,col:a,off:i}}function tT(r,t){let s=Ep(r,t),n=r.state.selection;return s?{update(i){if(i.docChanged){let a=i.changes.mapPos(i.startState.doc.line(s.line).from),o=i.state.doc.lineAt(a);s={line:o.number,col:s.col,off:Math.min(s.off,o.length)},n=n.map(i.changes)}},get(i,a,o){let l=Ep(r,i);if(!l)return n;let c=JA(r.state,s,l);return c.length?o?ye.create(c.concat(n.ranges)):ye.create(c):n}}:null}function sT(r){let t=(s=>s.altKey&&s.button==0);return Ie.mouseSelectionStyle.of((s,n)=>t(n)?tT(s,n):null)}const rT={Alt:[18,r=>!!r.altKey],Control:[17,r=>!!r.ctrlKey],Shift:[16,r=>!!r.shiftKey],Meta:[91,r=>!!r.metaKey]},nT={style:"cursor: crosshair"};function iT(r={}){let[t,s]=rT[r.key||"Alt"],n=ss.fromClass(class{constructor(i){this.view=i,this.isDown=!1}set(i){this.isDown!=i&&(this.isDown=i,this.view.update([]))}},{eventObservers:{keydown(i){this.set(i.keyCode==t||s(i))},keyup(i){(i.keyCode==t||!s(i))&&this.set(!1)},mousemove(i){this.set(s(i))}}});return[n,Ie.contentAttributes.of(i=>{var a;return!((a=i.plugin(n))===null||a===void 0)&&a.isDown?nT:null})]}const pa="-10000px";class b0{constructor(t,s,n,i){this.facet=s,this.createTooltipView=n,this.removeTooltipView=i,this.input=t.state.facet(s),this.tooltips=this.input.filter(o=>o);let a=null;this.tooltipViews=this.tooltips.map(o=>a=n(o,a))}update(t,s){var n;let i=t.state.facet(this.facet),a=i.filter(c=>c);if(i===this.input){for(let c of this.tooltipViews)c.update&&c.update(t);return!1}let o=[],l=s?[]:null;for(let c=0;c<a.length;c++){let h=a[c],u=-1;if(h){for(let m=0;m<this.tooltips.length;m++){let p=this.tooltips[m];p&&p.create==h.create&&(u=m)}if(u<0)o[c]=this.createTooltipView(h,c?o[c-1]:null),l&&(l[c]=!!h.above);else{let m=o[c]=this.tooltipViews[u];l&&(l[c]=s[u]),m.update&&m.update(t)}}}for(let c of this.tooltipViews)o.indexOf(c)<0&&(this.removeTooltipView(c),(n=c.destroy)===null||n===void 0||n.call(c));return s&&(l.forEach((c,h)=>s[h]=c),s.length=l.length),this.input=i,this.tooltips=a,this.tooltipViews=o,!0}}function aT(r){let t=r.dom.ownerDocument.documentElement;return{top:0,left:0,bottom:t.clientHeight,right:t.clientWidth}}const wd=We.define({combine:r=>{var t,s,n;return{position:Ne.ios?"absolute":((t=r.find(i=>i.position))===null||t===void 0?void 0:t.position)||"fixed",parent:((s=r.find(i=>i.parent))===null||s===void 0?void 0:s.parent)||null,tooltipSpace:((n=r.find(i=>i.tooltipSpace))===null||n===void 0?void 0:n.tooltipSpace)||aT}}}),Ip=new WeakMap,uf=ss.fromClass(class{constructor(r){this.view=r,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let t=r.state.facet(wd);this.position=t.position,this.parent=t.parent,this.classes=r.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new b0(r,ff,(s,n)=>this.createTooltip(s,n),s=>{this.resizeObserver&&this.resizeObserver.unobserve(s.dom),s.dom.remove()}),this.above=this.manager.tooltips.map(s=>!!s.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(s=>{Date.now()>this.lastTransaction-50&&s.length>0&&s[s.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),r.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let r of this.manager.tooltipViews)this.intersectionObserver.observe(r.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(r){r.transactions.length&&(this.lastTransaction=Date.now());let t=this.manager.update(r,this.above);t&&this.observeIntersection();let s=t||r.geometryChanged,n=r.state.facet(wd);if(n.position!=this.position&&!this.madeAbsolute){this.position=n.position;for(let i of this.manager.tooltipViews)i.dom.style.position=this.position;s=!0}if(n.parent!=this.parent){this.parent&&this.container.remove(),this.parent=n.parent,this.createContainer();for(let i of this.manager.tooltipViews)this.container.appendChild(i.dom);s=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);s&&this.maybeMeasure()}createTooltip(r,t){let s=r.create(this.view),n=t?t.dom:null;if(s.dom.classList.add("cm-tooltip"),r.arrow&&!s.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let i=document.createElement("div");i.className="cm-tooltip-arrow",s.dom.appendChild(i)}return s.dom.style.position=this.position,s.dom.style.top=pa,s.dom.style.left="0px",this.container.insertBefore(s.dom,n),s.mount&&s.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(s.dom),s}destroy(){var r,t,s;this.view.win.removeEventListener("resize",this.measureSoon);for(let n of this.manager.tooltipViews)n.dom.remove(),(r=n.destroy)===null||r===void 0||r.call(n);this.parent&&this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(s=this.intersectionObserver)===null||s===void 0||s.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let r=1,t=1,s=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:a}=this.manager.tooltipViews[0];if(Ne.gecko)s=a.offsetParent!=this.container.ownerDocument.body;else if(a.style.top==pa&&a.style.left=="0px"){let o=a.getBoundingClientRect();s=Math.abs(o.top+1e4)>1||Math.abs(o.left)>1}}if(s||this.position=="absolute")if(this.parent){let a=this.parent.getBoundingClientRect();a.width&&a.height&&(r=a.width/this.parent.offsetWidth,t=a.height/this.parent.offsetHeight)}else({scaleX:r,scaleY:t}=this.view.viewState);let n=this.view.scrollDOM.getBoundingClientRect(),i=lf(this.view);return{visible:{left:n.left+i.left,top:n.top+i.top,right:n.right-i.right,bottom:n.bottom-i.bottom},parent:this.parent?this.container.getBoundingClientRect():this.view.dom.getBoundingClientRect(),pos:this.manager.tooltips.map((a,o)=>{let l=this.manager.tooltipViews[o];return l.getCoords?l.getCoords(a.pos):this.view.coordsAtPos(a.pos)}),size:this.manager.tooltipViews.map(({dom:a})=>a.getBoundingClientRect()),space:this.view.state.facet(wd).tooltipSpace(this.view),scaleX:r,scaleY:t,makeAbsolute:s}}writeMeasure(r){var t;if(r.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{visible:s,space:n,scaleX:i,scaleY:a}=r,o=[];for(let l=0;l<this.manager.tooltips.length;l++){let c=this.manager.tooltips[l],h=this.manager.tooltipViews[l],{dom:u}=h,m=r.pos[l],p=r.size[l];if(!m||c.clip!==!1&&(m.bottom<=Math.max(s.top,n.top)||m.top>=Math.min(s.bottom,n.bottom)||m.right<Math.max(s.left,n.left)-.1||m.left>Math.min(s.right,n.right)+.1)){u.style.top=pa;continue}let x=c.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,b=x?7:0,w=p.right-p.left,C=(t=Ip.get(h))!==null&&t!==void 0?t:p.bottom-p.top,A=h.offset||lT,_=this.view.textDirection==zt.LTR,R=p.width>n.right-n.left?_?n.left:n.right-p.width:_?Math.max(n.left,Math.min(m.left-(x?14:0)+A.x,n.right-w)):Math.min(Math.max(n.left,m.left-w+(x?14:0)-A.x),n.right-w),E=this.above[l];!c.strictSide&&(E?m.top-C-b-A.y<n.top:m.bottom+C+b+A.y>n.bottom)&&E==n.bottom-m.bottom>m.top-n.top&&(E=this.above[l]=!E);let T=(E?m.top-n.top:n.bottom-m.bottom)-b;if(T<C&&h.resize!==!1){if(T<this.view.defaultLineHeight){u.style.top=pa;continue}Ip.set(h,C),u.style.height=(C=T)/a+"px"}else u.style.height&&(u.style.height="");let M=E?m.top-C-b-A.y:m.bottom+b+A.y,I=R+w;if(h.overlap!==!0)for(let N of o)N.left<I&&N.right>R&&N.top<M+C&&N.bottom>M&&(M=E?N.top-C-2-b:N.bottom+b+2);if(this.position=="absolute"?(u.style.top=(M-r.parent.top)/a+"px",Dp(u,(R-r.parent.left)/i)):(u.style.top=M/a+"px",Dp(u,R/i)),x){let N=m.left+(_?A.x:-A.x)-(R+14-7);x.style.left=N/i+"px"}h.overlap!==!0&&o.push({left:R,top:M,right:I,bottom:M+C}),u.classList.toggle("cm-tooltip-above",E),u.classList.toggle("cm-tooltip-below",!E),h.positioned&&h.positioned(r.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let r of this.manager.tooltipViews)r.dom.style.top=pa}},{eventObservers:{scroll(){this.maybeMeasure()}}});function Dp(r,t){let s=parseInt(r.style.left,10);(isNaN(s)||Math.abs(t-s)>1)&&(r.style.left=t+"px")}const oT=Ie.baseTheme({".cm-tooltip":{zIndex:500,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:"14px",position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),lT={x:0,y:0},ff=We.define({enables:[uf,oT]}),Ql=We.define({combine:r=>r.reduce((t,s)=>t.concat(s),[])});class _c{static create(t){return new _c(t)}constructor(t){this.view=t,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new b0(t,Ql,(s,n)=>this.createHostedView(s,n),s=>s.dom.remove())}createHostedView(t,s){let n=t.create(this.view);return n.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(n.dom,s?s.dom.nextSibling:this.dom.firstChild),this.mounted&&n.mount&&n.mount(this.view),n}mount(t){for(let s of this.manager.tooltipViews)s.mount&&s.mount(t);this.mounted=!0}positioned(t){for(let s of this.manager.tooltipViews)s.positioned&&s.positioned(t)}update(t){this.manager.update(t)}destroy(){var t;for(let s of this.manager.tooltipViews)(t=s.destroy)===null||t===void 0||t.call(s)}passProp(t){let s;for(let n of this.manager.tooltipViews){let i=n[t];if(i!==void 0){if(s===void 0)s=i;else if(s!==i)return}}return s}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const cT=ff.compute([Ql],r=>{let t=r.facet(Ql);return t.length===0?null:{pos:Math.min(...t.map(s=>s.pos)),end:Math.max(...t.map(s=>{var n;return(n=s.end)!==null&&n!==void 0?n:s.pos})),create:_c.create,above:t[0].above,arrow:t.some(s=>s.arrow)}});class dT{constructor(t,s,n,i,a){this.view=t,this.source=s,this.field=n,this.setHover=i,this.hoverTime=a,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:t.dom,time:0},this.checkHover=this.checkHover.bind(this),t.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),t.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let t=Date.now()-this.lastMove.time;t<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-t):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:t,lastMove:s}=this,n=t.docView.nearest(s.target);if(!n)return;let i,a=1;if(n instanceof In)i=n.posAtStart;else{if(i=t.posAtCoords(s),i==null)return;let l=t.coordsAtPos(i);if(!l||s.y<l.top||s.y>l.bottom||s.x<l.left-t.defaultCharacterWidth||s.x>l.right+t.defaultCharacterWidth)return;let c=t.bidiSpans(t.state.doc.lineAt(i)).find(u=>u.from<=i&&u.to>=i),h=c&&c.dir==zt.RTL?-1:1;a=s.x<l.left?-h:h}let o=this.source(t,i,a);if(o?.then){let l=this.pending={pos:i};o.then(c=>{this.pending==l&&(this.pending=null,c&&!(Array.isArray(c)&&!c.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(c)?c:[c])}))},c=>Hs(t.state,c,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&t.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let t=this.view.plugin(uf),s=t?t.manager.tooltips.findIndex(n=>n.create==_c.create):-1;return s>-1?t.manager.tooltipViews[s]:null}mousemove(t){var s,n;this.lastMove={x:t.clientX,y:t.clientY,target:t.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:i,tooltip:a}=this;if(i.length&&a&&!hT(a.dom,t)||this.pending){let{pos:o}=i[0]||this.pending,l=(n=(s=i[0])===null||s===void 0?void 0:s.end)!==null&&n!==void 0?n:o;(o==l?this.view.posAtCoords(this.lastMove)!=o:!uT(this.view,o,l,t.clientX,t.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(t){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:s}=this;if(s.length){let{tooltip:n}=this;n&&n.dom.contains(t.relatedTarget)?this.watchTooltipLeave(n.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(t){let s=n=>{t.removeEventListener("mouseleave",s),this.active.length&&!this.view.dom.contains(n.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};t.addEventListener("mouseleave",s)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const Yo=4;function hT(r,t){let{left:s,right:n,top:i,bottom:a}=r.getBoundingClientRect(),o;if(o=r.querySelector(".cm-tooltip-arrow")){let l=o.getBoundingClientRect();i=Math.min(l.top,i),a=Math.max(l.bottom,a)}return t.clientX>=s-Yo&&t.clientX<=n+Yo&&t.clientY>=i-Yo&&t.clientY<=a+Yo}function uT(r,t,s,n,i,a){let o=r.scrollDOM.getBoundingClientRect(),l=r.documentTop+r.documentPadding.top+r.contentHeight;if(o.left>n||o.right<n||o.top>i||Math.min(o.bottom,l)<i)return!1;let c=r.posAtCoords({x:n,y:i},!1);return c>=t&&c<=s}function fT(r,t={}){let s=nt.define(),n=ys.define({create(){return[]},update(i,a){if(i.length&&(t.hideOnChange&&(a.docChanged||a.selection)?i=[]:t.hideOn&&(i=i.filter(o=>!t.hideOn(a,o))),a.docChanged)){let o=[];for(let l of i){let c=a.changes.mapPos(l.pos,-1,ws.TrackDel);if(c!=null){let h=Object.assign(Object.create(null),l);h.pos=c,h.end!=null&&(h.end=a.changes.mapPos(h.end)),o.push(h)}}i=o}for(let o of a.effects)o.is(s)&&(i=o.value),o.is(mT)&&(i=[]);return i},provide:i=>Ql.from(i)});return{active:n,extension:[n,ss.define(i=>new dT(i,r,n,s,t.hoverTime||300)),cT]}}function v0(r,t){let s=r.plugin(uf);if(!s)return null;let n=s.manager.tooltips.indexOf(t);return n<0?null:s.manager.tooltipViews[n]}const mT=nt.define(),Rp=We.define({combine(r){let t,s;for(let n of r)t=t||n.topContainer,s=s||n.bottomContainer;return{topContainer:t,bottomContainer:s}}});function Ga(r,t){let s=r.plugin(w0),n=s?s.specs.indexOf(t):-1;return n>-1?s.panels[n]:null}const w0=ss.fromClass(class{constructor(r){this.input=r.state.facet(Ka),this.specs=this.input.filter(s=>s),this.panels=this.specs.map(s=>s(r));let t=r.state.facet(Rp);this.top=new Xo(r,!0,t.topContainer),this.bottom=new Xo(r,!1,t.bottomContainer),this.top.sync(this.panels.filter(s=>s.top)),this.bottom.sync(this.panels.filter(s=>!s.top));for(let s of this.panels)s.dom.classList.add("cm-panel"),s.mount&&s.mount()}update(r){let t=r.state.facet(Rp);this.top.container!=t.topContainer&&(this.top.sync([]),this.top=new Xo(r.view,!0,t.topContainer)),this.bottom.container!=t.bottomContainer&&(this.bottom.sync([]),this.bottom=new Xo(r.view,!1,t.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let s=r.state.facet(Ka);if(s!=this.input){let n=s.filter(c=>c),i=[],a=[],o=[],l=[];for(let c of n){let h=this.specs.indexOf(c),u;h<0?(u=c(r.view),l.push(u)):(u=this.panels[h],u.update&&u.update(r)),i.push(u),(u.top?a:o).push(u)}this.specs=n,this.panels=i,this.top.sync(a),this.bottom.sync(o);for(let c of l)c.dom.classList.add("cm-panel"),c.mount&&c.mount()}else for(let n of this.panels)n.update&&n.update(r)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:r=>Ie.scrollMargins.of(t=>{let s=t.plugin(r);return s&&{top:s.top.scrollMargin(),bottom:s.bottom.scrollMargin()}})});class Xo{constructor(t,s,n){this.view=t,this.top=s,this.container=n,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(t){for(let s of this.panels)s.destroy&&t.indexOf(s)<0&&s.destroy();this.panels=t,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let s=this.container||this.view.dom;s.insertBefore(this.dom,this.top?s.firstChild:null)}let t=this.dom.firstChild;for(let s of this.panels)if(s.dom.parentNode==this.dom){for(;t!=s.dom;)t=Mp(t);t=t.nextSibling}else this.dom.insertBefore(s.dom,t);for(;t;)t=Mp(t)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let t of this.classes.split(" "))t&&this.container.classList.remove(t);for(let t of(this.classes=this.view.themeClasses).split(" "))t&&this.container.classList.add(t)}}}function Mp(r){let t=r.nextSibling;return r.remove(),t}const Ka=We.define({enables:w0});class wn extends ui{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}wn.prototype.elementClass="";wn.prototype.toDOM=void 0;wn.prototype.mapMode=ws.TrackBefore;wn.prototype.startSide=wn.prototype.endSide=-1;wn.prototype.point=!0;const kl=We.define(),pT=We.define(),gT={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>Ot.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},Ia=We.define();function xT(r){return[S0(),Ia.of({...gT,...r})]}const Lp=We.define({combine:r=>r.some(t=>t)});function S0(r){return[yT]}const yT=ss.fromClass(class{constructor(r){this.view=r,this.domAfter=null,this.prevViewport=r.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=r.state.facet(Ia).map(t=>new Np(r,t)),this.fixed=!r.state.facet(Lp);for(let t of this.gutters)t.config.side=="after"?this.getDOMAfter().appendChild(t.dom):this.dom.appendChild(t.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),r.scrollDOM.insertBefore(this.dom,r.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(r){if(this.updateGutters(r)){let t=this.prevViewport,s=r.view.viewport,n=Math.min(t.to,s.to)-Math.max(t.from,s.from);this.syncGutters(n<(s.to-s.from)*.8)}if(r.geometryChanged){let t=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=t,this.domAfter&&(this.domAfter.style.minHeight=t)}this.view.state.facet(Lp)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=r.view.viewport}syncGutters(r){let t=this.dom.nextSibling;r&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let s=Ot.iter(this.view.state.facet(kl),this.view.viewport.from),n=[],i=this.gutters.map(a=>new jT(a,this.view.viewport,-this.view.documentPadding.top));for(let a of this.view.viewportLineBlocks)if(n.length&&(n=[]),Array.isArray(a.type)){let o=!0;for(let l of a.type)if(l.type==Ns.Text&&o){Kh(s,n,l.from);for(let c of i)c.line(this.view,l,n);o=!1}else if(l.widget)for(let c of i)c.widget(this.view,l)}else if(a.type==Ns.Text){Kh(s,n,a.from);for(let o of i)o.line(this.view,a,n)}else if(a.widget)for(let o of i)o.widget(this.view,a);for(let a of i)a.finish();r&&(this.view.scrollDOM.insertBefore(this.dom,t),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(r){let t=r.startState.facet(Ia),s=r.state.facet(Ia),n=r.docChanged||r.heightChanged||r.viewportChanged||!Ot.eq(r.startState.facet(kl),r.state.facet(kl),r.view.viewport.from,r.view.viewport.to);if(t==s)for(let i of this.gutters)i.update(r)&&(n=!0);else{n=!0;let i=[];for(let a of s){let o=t.indexOf(a);o<0?i.push(new Np(this.view,a)):(this.gutters[o].update(r),i.push(this.gutters[o]))}for(let a of this.gutters)a.dom.remove(),i.indexOf(a)<0&&a.destroy();for(let a of i)a.config.side=="after"?this.getDOMAfter().appendChild(a.dom):this.dom.appendChild(a.dom);this.gutters=i}return n}destroy(){for(let r of this.gutters)r.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:r=>Ie.scrollMargins.of(t=>{let s=t.plugin(r);if(!s||s.gutters.length==0||!s.fixed)return null;let n=s.dom.offsetWidth*t.scaleX,i=s.domAfter?s.domAfter.offsetWidth*t.scaleX:0;return t.textDirection==zt.LTR?{left:n,right:i}:{right:n,left:i}})});function Fp(r){return Array.isArray(r)?r:[r]}function Kh(r,t,s){for(;r.value&&r.from<=s;)r.from==s&&t.push(r.value),r.next()}class jT{constructor(t,s,n){this.gutter=t,this.height=n,this.i=0,this.cursor=Ot.iter(t.markers,s.from)}addElement(t,s,n){let{gutter:i}=this,a=(s.top-this.height)/t.scaleY,o=s.height/t.scaleY;if(this.i==i.elements.length){let l=new O0(t,o,a,n);i.elements.push(l),i.dom.appendChild(l.dom)}else i.elements[this.i].update(t,o,a,n);this.height=s.bottom,this.i++}line(t,s,n){let i=[];Kh(this.cursor,i,s.from),n.length&&(i=i.concat(n));let a=this.gutter.config.lineMarker(t,s,i);a&&i.unshift(a);let o=this.gutter;i.length==0&&!o.config.renderEmptyElements||this.addElement(t,s,i)}widget(t,s){let n=this.gutter.config.widgetMarker(t,s.widget,s),i=n?[n]:null;for(let a of t.state.facet(pT)){let o=a(t,s.widget,s);o&&(i||(i=[])).push(o)}i&&this.addElement(t,s,i)}finish(){let t=this.gutter;for(;t.elements.length>this.i;){let s=t.elements.pop();t.dom.removeChild(s.dom),s.destroy()}}}class Np{constructor(t,s){this.view=t,this.config=s,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let n in s.domEventHandlers)this.dom.addEventListener(n,i=>{let a=i.target,o;if(a!=this.dom&&this.dom.contains(a)){for(;a.parentNode!=this.dom;)a=a.parentNode;let c=a.getBoundingClientRect();o=(c.top+c.bottom)/2}else o=i.clientY;let l=t.lineBlockAtHeight(o-t.documentTop);s.domEventHandlers[n](t,l,i)&&i.preventDefault()});this.markers=Fp(s.markers(t)),s.initialSpacer&&(this.spacer=new O0(t,0,0,[s.initialSpacer(t)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(t){let s=this.markers;if(this.markers=Fp(this.config.markers(t.view)),this.spacer&&this.config.updateSpacer){let i=this.config.updateSpacer(this.spacer.markers[0],t);i!=this.spacer.markers[0]&&this.spacer.update(t.view,0,0,[i])}let n=t.view.viewport;return!Ot.eq(this.markers,s,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):!1)}destroy(){for(let t of this.elements)t.destroy()}}class O0{constructor(t,s,n,i){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(t,s,n,i)}update(t,s,n,i){this.height!=s&&(this.height=s,this.dom.style.height=s+"px"),this.above!=n&&(this.dom.style.marginTop=(this.above=n)?n+"px":""),bT(this.markers,i)||this.setMarkers(t,i)}setMarkers(t,s){let n="cm-gutterElement",i=this.dom.firstChild;for(let a=0,o=0;;){let l=o,c=a<s.length?s[a++]:null,h=!1;if(c){let u=c.elementClass;u&&(n+=" "+u);for(let m=o;m<this.markers.length;m++)if(this.markers[m].compare(c)){l=m,h=!0;break}}else l=this.markers.length;for(;o<l;){let u=this.markers[o++];if(u.toDOM){u.destroy(i);let m=i.nextSibling;i.remove(),i=m}}if(!c)break;c.toDOM&&(h?i=i.nextSibling:this.dom.insertBefore(c.toDOM(t),i)),h&&o++}this.dom.className=n,this.markers=s}destroy(){this.setMarkers(null,[])}}function bT(r,t){if(r.length!=t.length)return!1;for(let s=0;s<r.length;s++)if(!r[s].compare(t[s]))return!1;return!0}const vT=We.define(),wT=We.define(),Ri=We.define({combine(r){return sn(r,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(t,s){let n=Object.assign({},t);for(let i in s){let a=n[i],o=s[i];n[i]=a?(l,c,h)=>a(l,c,h)||o(l,c,h):o}return n}})}});class Sd extends wn{constructor(t){super(),this.number=t}eq(t){return this.number==t.number}toDOM(){return document.createTextNode(this.number)}}function Od(r,t){return r.state.facet(Ri).formatNumber(t,r.state)}const ST=Ia.compute([Ri],r=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(t){return t.state.facet(vT)},lineMarker(t,s,n){return n.some(i=>i.toDOM)?null:new Sd(Od(t,t.state.doc.lineAt(s.from).number))},widgetMarker:(t,s,n)=>{for(let i of t.state.facet(wT)){let a=i(t,s,n);if(a)return a}return null},lineMarkerChange:t=>t.startState.facet(Ri)!=t.state.facet(Ri),initialSpacer(t){return new Sd(Od(t,Wp(t.state.doc.lines)))},updateSpacer(t,s){let n=Od(s.view,Wp(s.view.state.doc.lines));return n==t.number?t:new Sd(n)},domEventHandlers:r.facet(Ri).domEventHandlers,side:"before"}));function OT(r={}){return[Ri.of(r),S0(),ST]}function Wp(r){let t=9;for(;t<r;)t=t*10+9;return t}const kT=new class extends wn{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},CT=kl.compute(["selection"],r=>{let t=[],s=-1;for(let n of r.selection.ranges){let i=r.doc.lineAt(n.head).from;i>s&&(s=i,t.push(kT.range(i)))}return Ot.of(t)});function AT(){return CT}const k0=1024;let TT=0;class kd{constructor(t,s){this.from=t,this.to=s}}class gt{constructor(t={}){this.id=TT++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=Xs.match(t)),s=>{let n=t(s);return n===void 0?null:[this,n]}}}gt.closedBy=new gt({deserialize:r=>r.split(" ")});gt.openedBy=new gt({deserialize:r=>r.split(" ")});gt.group=new gt({deserialize:r=>r.split(" ")});gt.isolate=new gt({deserialize:r=>{if(r&&r!="rtl"&&r!="ltr"&&r!="auto")throw new RangeError("Invalid value for isolate: "+r);return r||"auto"}});gt.contextHash=new gt({perNode:!0});gt.lookAhead=new gt({perNode:!0});gt.mounted=new gt({perNode:!0});class ql{constructor(t,s,n){this.tree=t,this.overlay=s,this.parser=n}static get(t){return t&&t.props&&t.props[gt.mounted.id]}}const PT=Object.create(null);class Xs{constructor(t,s,n,i=0){this.name=t,this.props=s,this.id=n,this.flags=i}static define(t){let s=t.props&&t.props.length?Object.create(null):PT,n=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),i=new Xs(t.name||"",s,t.id,n);if(t.props){for(let a of t.props)if(Array.isArray(a)||(a=a(i)),a){if(a[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");s[a[0].id]=a[1]}}return i}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let s=this.prop(gt.group);return s?s.indexOf(t)>-1:!1}return this.id==t}static match(t){let s=Object.create(null);for(let n in t)for(let i of n.split(" "))s[i]=t[n];return n=>{for(let i=n.prop(gt.group),a=-1;a<(i?i.length:0);a++){let o=s[a<0?n.name:i[a]];if(o)return o}}}}Xs.none=new Xs("",Object.create(null),0,8);class mf{constructor(t){this.types=t;for(let s=0;s<t.length;s++)if(t[s].id!=s)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let s=[];for(let n of this.types){let i=null;for(let a of t){let o=a(n);o&&(i||(i=Object.assign({},n.props)),i[o[0].id]=o[1])}s.push(i?new Xs(n.name,i,n.id,n.flags):n)}return new mf(s)}}const Zo=new WeakMap,$p=new WeakMap;var us;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(us||(us={}));class cs{constructor(t,s,n,i,a){if(this.type=t,this.children=s,this.positions=n,this.length=i,this.props=null,a&&a.length){this.props=Object.create(null);for(let[o,l]of a)this.props[typeof o=="number"?o:o.id]=l}}toString(){let t=ql.get(this);if(t&&!t.overlay)return t.tree.toString();let s="";for(let n of this.children){let i=n.toString();i&&(s&&(s+=","),s+=i)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(s.length?"("+s+")":""):s}cursor(t=0){return new Xh(this.topNode,t)}cursorAt(t,s=0,n=0){let i=Zo.get(this)||this.topNode,a=new Xh(i);return a.moveTo(t,s),Zo.set(this,a._tree),a}get topNode(){return new Ys(this,0,0,null)}resolve(t,s=0){let n=Ya(Zo.get(this)||this.topNode,t,s,!1);return Zo.set(this,n),n}resolveInner(t,s=0){let n=Ya($p.get(this)||this.topNode,t,s,!0);return $p.set(this,n),n}resolveStack(t,s=0){return IT(this,t,s)}iterate(t){let{enter:s,leave:n,from:i=0,to:a=this.length}=t,o=t.mode||0,l=(o&us.IncludeAnonymous)>0;for(let c=this.cursor(o|us.IncludeAnonymous);;){let h=!1;if(c.from<=a&&c.to>=i&&(!l&&c.type.isAnonymous||s(c)!==!1)){if(c.firstChild())continue;h=!0}for(;h&&n&&(l||!c.type.isAnonymous)&&n(c),!c.nextSibling();){if(!c.parent())return;h=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let s in this.props)t.push([+s,this.props[s]]);return t}balance(t={}){return this.children.length<=8?this:xf(Xs.none,this.children,this.positions,0,this.children.length,0,this.length,(s,n,i)=>new cs(this.type,s,n,i,this.propValues),t.makeTree||((s,n,i)=>new cs(Xs.none,s,n,i)))}static build(t){return DT(t)}}cs.empty=new cs(Xs.none,[],[],0);class pf{constructor(t,s){this.buffer=t,this.index=s}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new pf(this.buffer,this.index)}}class zn{constructor(t,s,n){this.buffer=t,this.length=s,this.set=n}get type(){return Xs.none}toString(){let t=[];for(let s=0;s<this.buffer.length;)t.push(this.childString(s)),s=this.buffer[s+3];return t.join(",")}childString(t){let s=this.buffer[t],n=this.buffer[t+3],i=this.set.types[s],a=i.name;if(/\W/.test(a)&&!i.isError&&(a=JSON.stringify(a)),t+=4,n==t)return a;let o=[];for(;t<n;)o.push(this.childString(t)),t=this.buffer[t+3];return a+"("+o.join(",")+")"}findChild(t,s,n,i,a){let{buffer:o}=this,l=-1;for(let c=t;c!=s&&!(C0(a,i,o[c+1],o[c+2])&&(l=c,n>0));c=o[c+3]);return l}slice(t,s,n){let i=this.buffer,a=new Uint16Array(s-t),o=0;for(let l=t,c=0;l<s;){a[c++]=i[l++],a[c++]=i[l++]-n;let h=a[c++]=i[l++]-n;a[c++]=i[l++]-t,o=Math.max(o,h)}return new zn(a,o,this.set)}}function C0(r,t,s,n){switch(r){case-2:return s<t;case-1:return n>=t&&s<t;case 0:return s<t&&n>t;case 1:return s<=t&&n>t;case 2:return n>t;case 4:return!0}}function Ya(r,t,s,n){for(var i;r.from==r.to||(s<1?r.from>=t:r.from>t)||(s>-1?r.to<=t:r.to<t);){let o=!n&&r instanceof Ys&&r.index<0?null:r.parent;if(!o)return r;r=o}let a=n?0:us.IgnoreOverlays;if(n)for(let o=r,l=o.parent;l;o=l,l=o.parent)o instanceof Ys&&o.index<0&&((i=l.enter(t,s,a))===null||i===void 0?void 0:i.from)!=o.from&&(r=l);for(;;){let o=r.enter(t,s,a);if(!o)return r;r=o}}class A0{cursor(t=0){return new Xh(this,t)}getChild(t,s=null,n=null){let i=Vp(this,t,s,n);return i.length?i[0]:null}getChildren(t,s=null,n=null){return Vp(this,t,s,n)}resolve(t,s=0){return Ya(this,t,s,!1)}resolveInner(t,s=0){return Ya(this,t,s,!0)}matchContext(t){return Yh(this.parent,t)}enterUnfinishedNodesBefore(t){let s=this.childBefore(t),n=this;for(;s;){let i=s.lastChild;if(!i||i.to!=s.to)break;i.type.isError&&i.from==i.to?(n=s,s=i.prevSibling):s=i}return n}get node(){return this}get next(){return this.parent}}class Ys extends A0{constructor(t,s,n,i){super(),this._tree=t,this.from=s,this.index=n,this._parent=i}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,s,n,i,a=0){for(let o=this;;){for(let{children:l,positions:c}=o._tree,h=s>0?l.length:-1;t!=h;t+=s){let u=l[t],m=c[t]+o.from;if(C0(i,n,m,m+u.length)){if(u instanceof zn){if(a&us.ExcludeBuffers)continue;let p=u.findChild(0,u.buffer.length,s,n-m,i);if(p>-1)return new Qr(new _T(o,u,t,m),null,p)}else if(a&us.IncludeAnonymous||!u.type.isAnonymous||gf(u)){let p;if(!(a&us.IgnoreMounts)&&(p=ql.get(u))&&!p.overlay)return new Ys(p.tree,m,t,o);let x=new Ys(u,m,t,o);return a&us.IncludeAnonymous||!x.type.isAnonymous?x:x.nextChild(s<0?u.children.length-1:0,s,n,i)}}}if(a&us.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+s:t=s<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,s,n=0){let i;if(!(n&us.IgnoreOverlays)&&(i=ql.get(this._tree))&&i.overlay){let a=t-this.from;for(let{from:o,to:l}of i.overlay)if((s>0?o<=a:o<a)&&(s<0?l>=a:l>a))return new Ys(i.tree,i.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,s,n)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Vp(r,t,s,n){let i=r.cursor(),a=[];if(!i.firstChild())return a;if(s!=null){for(let o=!1;!o;)if(o=i.type.is(s),!i.nextSibling())return a}for(;;){if(n!=null&&i.type.is(n))return a;if(i.type.is(t)&&a.push(i.node),!i.nextSibling())return n==null?a:[]}}function Yh(r,t,s=t.length-1){for(let n=r;s>=0;n=n.parent){if(!n)return!1;if(!n.type.isAnonymous){if(t[s]&&t[s]!=n.name)return!1;s--}}return!0}class _T{constructor(t,s,n,i){this.parent=t,this.buffer=s,this.index=n,this.start=i}}class Qr extends A0{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,s,n){super(),this.context=t,this._parent=s,this.index=n,this.type=t.buffer.set.types[t.buffer.buffer[n]]}child(t,s,n){let{buffer:i}=this.context,a=i.findChild(this.index+4,i.buffer[this.index+3],t,s-this.context.start,n);return a<0?null:new Qr(this.context,this,a)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,s,n=0){if(n&us.ExcludeBuffers)return null;let{buffer:i}=this.context,a=i.findChild(this.index+4,i.buffer[this.index+3],s>0?1:-1,t-this.context.start,s);return a<0?null:new Qr(this.context,this,a)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,s=t.buffer[this.index+3];return s<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Qr(this.context,this._parent,s):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,s=this._parent?this._parent.index+4:0;return this.index==s?this.externalSibling(-1):new Qr(this.context,this._parent,t.findChild(s,this.index,-1,0,4))}get tree(){return null}toTree(){let t=[],s=[],{buffer:n}=this.context,i=this.index+4,a=n.buffer[this.index+3];if(a>i){let o=n.buffer[this.index+1];t.push(n.slice(i,a,o)),s.push(0)}return new cs(this.type,t,s,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function T0(r){if(!r.length)return null;let t=0,s=r[0];for(let a=1;a<r.length;a++){let o=r[a];(o.from>s.from||o.to<s.to)&&(s=o,t=a)}let n=s instanceof Ys&&s.index<0?null:s.parent,i=r.slice();return n?i[t]=n:i.splice(t,1),new ET(i,s)}class ET{constructor(t,s){this.heads=t,this.node=s}get next(){return T0(this.heads)}}function IT(r,t,s){let n=r.resolveInner(t,s),i=null;for(let a=n instanceof Ys?n:n.context.parent;a;a=a.parent)if(a.index<0){let o=a.parent;(i||(i=[n])).push(o.resolve(t,s)),a=o}else{let o=ql.get(a.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let l=new Ys(o.tree,o.overlay[0].from+a.from,-1,a);(i||(i=[n])).push(Ya(l,t,s,!1))}}return i?T0(i):n}class Xh{get name(){return this.type.name}constructor(t,s=0){if(this.mode=s,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof Ys)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let n=t._parent;n;n=n._parent)this.stack.unshift(n.index);this.bufferNode=t,this.yieldBuf(t.index)}}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,s){this.index=t;let{start:n,buffer:i}=this.buffer;return this.type=s||i.set.types[i.buffer[t]],this.from=n+i.buffer[t+1],this.to=n+i.buffer[t+2],!0}yield(t){return t?t instanceof Ys?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,s,n){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,s,n,this.mode));let{buffer:i}=this.buffer,a=i.findChild(this.index+4,i.buffer[this.index+3],t,s-this.buffer.start,n);return a<0?!1:(this.stack.push(this.index),this.yieldBuf(a))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,s,n=this.mode){return this.buffer?n&us.ExcludeBuffers?!1:this.enterChild(1,t,s):this.yield(this._tree.enter(t,s,n))}parent(){if(!this.buffer)return this.yieldNode(this.mode&us.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&us.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:s}=this.buffer,n=this.stack.length-1;if(t<0){let i=n<0?0:this.stack[n]+4;if(this.index!=i)return this.yieldBuf(s.findChild(i,this.index,-1,0,4))}else{let i=s.buffer[this.index+3];if(i<(n<0?s.buffer.length:s.buffer[this.stack[n]+3]))return this.yieldBuf(i)}return n<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let s,n,{buffer:i}=this;if(i){if(t>0){if(this.index<i.buffer.buffer.length)return!1}else for(let a=0;a<this.index;a++)if(i.buffer.buffer[a+3]<this.index)return!1;({index:s,parent:n}=i)}else({index:s,_parent:n}=this._tree);for(;n;{index:s,_parent:n}=n)if(s>-1)for(let a=s+t,o=t<0?-1:n._tree.children.length;a!=o;a+=t){let l=n._tree.children[a];if(this.mode&us.IncludeAnonymous||l instanceof zn||!l.type.isAnonymous||gf(l))return!1}return!0}move(t,s){if(s&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,s=0){for(;(this.from==this.to||(s<1?this.from>=t:this.from>t)||(s>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,s););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,s=null,n=0;if(t&&t.context==this.buffer)e:for(let i=this.index,a=this.stack.length;a>=0;){for(let o=t;o;o=o._parent)if(o.index==i){if(i==this.index)return o;s=o,n=a+1;break e}i=this.stack[--a]}for(let i=n;i<this.stack.length;i++)s=new Qr(this.buffer,s,this.stack[i]);return this.bufferNode=new Qr(this.buffer,s,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,s){for(let n=0;;){let i=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){n++;continue}this.type.isAnonymous||(i=!0)}for(;;){if(i&&s&&s(this),i=this.type.isAnonymous,!n)return;if(this.nextSibling())break;this.parent(),n--,i=!0}}}matchContext(t){if(!this.buffer)return Yh(this.node.parent,t);let{buffer:s}=this.buffer,{types:n}=s.set;for(let i=t.length-1,a=this.stack.length-1;i>=0;a--){if(a<0)return Yh(this._tree,t,i);let o=n[s.buffer[this.stack[a]]];if(!o.isAnonymous){if(t[i]&&t[i]!=o.name)return!1;i--}}return!0}}function gf(r){return r.children.some(t=>t instanceof zn||!t.type.isAnonymous||gf(t))}function DT(r){var t;let{buffer:s,nodeSet:n,maxBufferLength:i=k0,reused:a=[],minRepeatType:o=n.types.length}=r,l=Array.isArray(s)?new pf(s,s.length):s,c=n.types,h=0,u=0;function m(T,M,I,N,k,S){let{id:L,start:W,end:F,size:$}=l,q=u,ne=h;for(;$<0;)if(l.next(),$==-1){let P=a[L];I.push(P),N.push(W-T);return}else if($==-3){h=L;return}else if($==-4){u=L;return}else throw new RangeError(`Unrecognized record size: ${$}`);let he=c[L],re,G,H=W-T;if(F-W<=i&&(G=C(l.pos-M,k))){let P=new Uint16Array(G.size-G.skip),D=l.pos-G.size,Y=P.length;for(;l.pos>D;)Y=A(G.start,P,Y);re=new zn(P,F-G.start,n),H=G.start-T}else{let P=l.pos-$;l.next();let D=[],Y=[],ce=L>=o?L:-1,ae=0,ee=F;for(;l.pos>P;)ce>=0&&l.id==ce&&l.size>=0?(l.end<=ee-i&&(b(D,Y,W,ae,l.end,ee,ce,q,ne),ae=D.length,ee=l.end),l.next()):S>2500?p(W,P,D,Y):m(W,P,D,Y,ce,S+1);if(ce>=0&&ae>0&&ae<D.length&&b(D,Y,W,ae,W,ee,ce,q,ne),D.reverse(),Y.reverse(),ce>-1&&ae>0){let te=x(he,ne);re=xf(he,D,Y,0,D.length,0,F-W,te,te)}else re=w(he,D,Y,F-W,q-F,ne)}I.push(re),N.push(H)}function p(T,M,I,N){let k=[],S=0,L=-1;for(;l.pos>M;){let{id:W,start:F,end:$,size:q}=l;if(q>4)l.next();else{if(L>-1&&F<L)break;L<0&&(L=$-i),k.push(W,F,$),S++,l.next()}}if(S){let W=new Uint16Array(S*4),F=k[k.length-2];for(let $=k.length-3,q=0;$>=0;$-=3)W[q++]=k[$],W[q++]=k[$+1]-F,W[q++]=k[$+2]-F,W[q++]=q;I.push(new zn(W,k[2]-F,n)),N.push(F-T)}}function x(T,M){return(I,N,k)=>{let S=0,L=I.length-1,W,F;if(L>=0&&(W=I[L])instanceof cs){if(!L&&W.type==T&&W.length==k)return W;(F=W.prop(gt.lookAhead))&&(S=N[L]+W.length+F)}return w(T,I,N,k,S,M)}}function b(T,M,I,N,k,S,L,W,F){let $=[],q=[];for(;T.length>N;)$.push(T.pop()),q.push(M.pop()+I-k);T.push(w(n.types[L],$,q,S-k,W-S,F)),M.push(k-I)}function w(T,M,I,N,k,S,L){if(S){let W=[gt.contextHash,S];L=L?[W].concat(L):[W]}if(k>25){let W=[gt.lookAhead,k];L=L?[W].concat(L):[W]}return new cs(T,M,I,N,L)}function C(T,M){let I=l.fork(),N=0,k=0,S=0,L=I.end-i,W={size:0,start:0,skip:0};e:for(let F=I.pos-T;I.pos>F;){let $=I.size;if(I.id==M&&$>=0){W.size=N,W.start=k,W.skip=S,S+=4,N+=4,I.next();continue}let q=I.pos-$;if($<0||q<F||I.start<L)break;let ne=I.id>=o?4:0,he=I.start;for(I.next();I.pos>q;){if(I.size<0)if(I.size==-3)ne+=4;else break e;else I.id>=o&&(ne+=4);I.next()}k=he,N+=$,S+=ne}return(M<0||N==T)&&(W.size=N,W.start=k,W.skip=S),W.size>4?W:void 0}function A(T,M,I){let{id:N,start:k,end:S,size:L}=l;if(l.next(),L>=0&&N<o){let W=I;if(L>4){let F=l.pos-(L-4);for(;l.pos>F;)I=A(T,M,I)}M[--I]=W,M[--I]=S-T,M[--I]=k-T,M[--I]=N}else L==-3?h=N:L==-4&&(u=N);return I}let _=[],R=[];for(;l.pos>0;)m(r.start||0,r.bufferStart||0,_,R,-1,0);let E=(t=r.length)!==null&&t!==void 0?t:_.length?R[0]+_[0].length:0;return new cs(c[r.topID],_.reverse(),R.reverse(),E)}const zp=new WeakMap;function Cl(r,t){if(!r.isAnonymous||t instanceof zn||t.type!=r)return 1;let s=zp.get(t);if(s==null){s=1;for(let n of t.children){if(n.type!=r||!(n instanceof cs)){s=1;break}s+=Cl(r,n)}zp.set(t,s)}return s}function xf(r,t,s,n,i,a,o,l,c){let h=0;for(let b=n;b<i;b++)h+=Cl(r,t[b]);let u=Math.ceil(h*1.5/8),m=[],p=[];function x(b,w,C,A,_){for(let R=C;R<A;){let E=R,T=w[R],M=Cl(r,b[R]);for(R++;R<A;R++){let I=Cl(r,b[R]);if(M+I>=u)break;M+=I}if(R==E+1){if(M>u){let I=b[E];x(I.children,I.positions,0,I.children.length,w[E]+_);continue}m.push(b[E])}else{let I=w[R-1]+b[R-1].length-T;m.push(xf(r,b,w,E,R,T,I,null,c))}p.push(T+_-a)}}return x(t,s,n,i,0),(l||c)(m,p,o)}class RT{constructor(){this.map=new WeakMap}setBuffer(t,s,n){let i=this.map.get(t);i||this.map.set(t,i=new Map),i.set(s,n)}getBuffer(t,s){let n=this.map.get(t);return n&&n.get(s)}set(t,s){t instanceof Qr?this.setBuffer(t.context.buffer,t.index,s):t instanceof Ys&&this.map.set(t.tree,s)}get(t){return t instanceof Qr?this.getBuffer(t.context.buffer,t.index):t instanceof Ys?this.map.get(t.tree):void 0}cursorSet(t,s){t.buffer?this.setBuffer(t.buffer.buffer,t.index,s):this.map.set(t.tree,s)}cursorGet(t){return t.buffer?this.getBuffer(t.buffer.buffer,t.index):this.map.get(t.tree)}}class oi{constructor(t,s,n,i,a=!1,o=!1){this.from=t,this.to=s,this.tree=n,this.offset=i,this.open=(a?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,s=[],n=!1){let i=[new oi(0,t.length,t,0,!1,n)];for(let a of s)a.to>t.length&&i.push(a);return i}static applyChanges(t,s,n=128){if(!s.length)return t;let i=[],a=1,o=t.length?t[0]:null;for(let l=0,c=0,h=0;;l++){let u=l<s.length?s[l]:null,m=u?u.fromA:1e9;if(m-c>=n)for(;o&&o.from<m;){let p=o;if(c>=p.from||m<=p.to||h){let x=Math.max(p.from,c)-h,b=Math.min(p.to,m)-h;p=x>=b?null:new oi(x,b,p.tree,p.offset+h,l>0,!!u)}if(p&&i.push(p),o.to>m)break;o=a<t.length?t[a++]:null}if(!u)break;c=u.toA,h=u.toA-u.toB}return i}}class P0{startParse(t,s,n){return typeof t=="string"&&(t=new MT(t)),n=n?n.length?n.map(i=>new kd(i.from,i.to)):[new kd(0,0)]:[new kd(0,t.length)],this.createParse(t,s||[],n)}parse(t,s,n){let i=this.startParse(t,s,n);for(;;){let a=i.advance();if(a)return a}}}class MT{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,s){return this.string.slice(t,s)}}new gt({perNode:!0});let LT=0;class fr{constructor(t,s,n,i){this.name=t,this.set=s,this.base=n,this.modified=i,this.id=LT++}toString(){let{name:t}=this;for(let s of this.modified)s.name&&(t=`${s.name}(${t})`);return t}static define(t,s){let n=typeof t=="string"?t:"?";if(t instanceof fr&&(s=t),s?.base)throw new Error("Can not derive from a modified tag");let i=new fr(n,[],null,[]);if(i.set.push(i),s)for(let a of s.set)i.set.push(a);return i}static defineModifier(t){let s=new Hl(t);return n=>n.modified.indexOf(s)>-1?n:Hl.get(n.base||n,n.modified.concat(s).sort((i,a)=>i.id-a.id))}}let FT=0;class Hl{constructor(t){this.name=t,this.instances=[],this.id=FT++}static get(t,s){if(!s.length)return t;let n=s[0].instances.find(l=>l.base==t&&NT(s,l.modified));if(n)return n;let i=[],a=new fr(t.name,i,t,s);for(let l of s)l.instances.push(a);let o=WT(s);for(let l of t.set)if(!l.modified.length)for(let c of o)i.push(Hl.get(l,c));return a}}function NT(r,t){return r.length==t.length&&r.every((s,n)=>s==t[n])}function WT(r){let t=[[]];for(let s=0;s<r.length;s++)for(let n=0,i=t.length;n<i;n++)t.push(t[n].concat(r[s]));return t.sort((s,n)=>n.length-s.length)}function _0(r){let t=Object.create(null);for(let s in r){let n=r[s];Array.isArray(n)||(n=[n]);for(let i of s.split(" "))if(i){let a=[],o=2,l=i;for(let m=0;;){if(l=="..."&&m>0&&m+3==i.length){o=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!p)throw new RangeError("Invalid path: "+i);if(a.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),m+=p[0].length,m==i.length)break;let x=i[m++];if(m==i.length&&x=="!"){o=0;break}if(x!="/")throw new RangeError("Invalid path: "+i);l=i.slice(m)}let c=a.length-1,h=a[c];if(!h)throw new RangeError("Invalid path: "+i);let u=new Gl(n,o,c>0?a.slice(0,c):null);t[h]=u.sort(t[h])}}return E0.add(t)}const E0=new gt;class Gl{constructor(t,s,n,i){this.tags=t,this.mode=s,this.context=n,this.next=i}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}Gl.empty=new Gl([],2,null);function I0(r,t){let s=Object.create(null);for(let a of r)if(!Array.isArray(a.tag))s[a.tag.id]=a.class;else for(let o of a.tag)s[o.id]=a.class;let{scope:n,all:i=null}=t||{};return{style:a=>{let o=i;for(let l of a)for(let c of l.set){let h=s[c.id];if(h){o=o?o+" "+h:h;break}}return o},scope:n}}function $T(r,t){let s=null;for(let n of r){let i=n.style(t);i&&(s=s?s+" "+i:i)}return s}function VT(r,t,s,n=0,i=r.length){let a=new zT(n,Array.isArray(t)?t:[t],s);a.highlightRange(r.cursor(),n,i,"",a.highlighters),a.flush(i)}class zT{constructor(t,s,n){this.at=t,this.highlighters=s,this.span=n,this.class=""}startSpan(t,s){s!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=s)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,s,n,i,a){let{type:o,from:l,to:c}=t;if(l>=n||c<=s)return;o.isTop&&(a=this.highlighters.filter(x=>!x.scope||x.scope(o)));let h=i,u=BT(t)||Gl.empty,m=$T(a,u.tags);if(m&&(h&&(h+=" "),h+=m,u.mode==1&&(i+=(i?" ":"")+m)),this.startSpan(Math.max(s,l),h),u.opaque)return;let p=t.tree&&t.tree.prop(gt.mounted);if(p&&p.overlay){let x=t.node.enter(p.overlay[0].from+l,1),b=this.highlighters.filter(C=>!C.scope||C.scope(p.tree.type)),w=t.firstChild();for(let C=0,A=l;;C++){let _=C<p.overlay.length?p.overlay[C]:null,R=_?_.from+l:c,E=Math.max(s,A),T=Math.min(n,R);if(E<T&&w)for(;t.from<T&&(this.highlightRange(t,E,T,i,a),this.startSpan(Math.min(T,t.to),h),!(t.to>=R||!t.nextSibling())););if(!_||R>n)break;A=_.to+l,A>s&&(this.highlightRange(x.cursor(),Math.max(s,_.from+l),Math.min(n,A),"",b),this.startSpan(Math.min(n,A),h))}w&&t.parent()}else if(t.firstChild()){p&&(i="");do if(!(t.to<=s)){if(t.from>=n)break;this.highlightRange(t,s,n,i,a),this.startSpan(Math.min(n,t.to),h)}while(t.nextSibling());t.parent()}}}function BT(r){let t=r.type.prop(E0);for(;t&&t.context&&!r.matchContext(t.context);)t=t.next;return t||null}const Ee=fr.define,Jo=Ee(),Cn=Ee(),Bp=Ee(Cn),Up=Ee(Cn),An=Ee(),el=Ee(An),Cd=Ee(An),Nr=Ee(),Zn=Ee(Nr),Lr=Ee(),Fr=Ee(),Zh=Ee(),ga=Ee(Zh),tl=Ee(),de={comment:Jo,lineComment:Ee(Jo),blockComment:Ee(Jo),docComment:Ee(Jo),name:Cn,variableName:Ee(Cn),typeName:Bp,tagName:Ee(Bp),propertyName:Up,attributeName:Ee(Up),className:Ee(Cn),labelName:Ee(Cn),namespace:Ee(Cn),macroName:Ee(Cn),literal:An,string:el,docString:Ee(el),character:Ee(el),attributeValue:Ee(el),number:Cd,integer:Ee(Cd),float:Ee(Cd),bool:Ee(An),regexp:Ee(An),escape:Ee(An),color:Ee(An),url:Ee(An),keyword:Lr,self:Ee(Lr),null:Ee(Lr),atom:Ee(Lr),unit:Ee(Lr),modifier:Ee(Lr),operatorKeyword:Ee(Lr),controlKeyword:Ee(Lr),definitionKeyword:Ee(Lr),moduleKeyword:Ee(Lr),operator:Fr,derefOperator:Ee(Fr),arithmeticOperator:Ee(Fr),logicOperator:Ee(Fr),bitwiseOperator:Ee(Fr),compareOperator:Ee(Fr),updateOperator:Ee(Fr),definitionOperator:Ee(Fr),typeOperator:Ee(Fr),controlOperator:Ee(Fr),punctuation:Zh,separator:Ee(Zh),bracket:ga,angleBracket:Ee(ga),squareBracket:Ee(ga),paren:Ee(ga),brace:Ee(ga),content:Nr,heading:Zn,heading1:Ee(Zn),heading2:Ee(Zn),heading3:Ee(Zn),heading4:Ee(Zn),heading5:Ee(Zn),heading6:Ee(Zn),contentSeparator:Ee(Nr),list:Ee(Nr),quote:Ee(Nr),emphasis:Ee(Nr),strong:Ee(Nr),link:Ee(Nr),monospace:Ee(Nr),strikethrough:Ee(Nr),inserted:Ee(),deleted:Ee(),changed:Ee(),invalid:Ee(),meta:tl,documentMeta:Ee(tl),annotation:Ee(tl),processingInstruction:Ee(tl),definition:fr.defineModifier("definition"),constant:fr.defineModifier("constant"),function:fr.defineModifier("function"),standard:fr.defineModifier("standard"),local:fr.defineModifier("local"),special:fr.defineModifier("special")};for(let r in de){let t=de[r];t instanceof fr&&(t.name=r)}I0([{tag:de.link,class:"tok-link"},{tag:de.heading,class:"tok-heading"},{tag:de.emphasis,class:"tok-emphasis"},{tag:de.strong,class:"tok-strong"},{tag:de.keyword,class:"tok-keyword"},{tag:de.atom,class:"tok-atom"},{tag:de.bool,class:"tok-bool"},{tag:de.url,class:"tok-url"},{tag:de.labelName,class:"tok-labelName"},{tag:de.inserted,class:"tok-inserted"},{tag:de.deleted,class:"tok-deleted"},{tag:de.literal,class:"tok-literal"},{tag:de.string,class:"tok-string"},{tag:de.number,class:"tok-number"},{tag:[de.regexp,de.escape,de.special(de.string)],class:"tok-string2"},{tag:de.variableName,class:"tok-variableName"},{tag:de.local(de.variableName),class:"tok-variableName tok-local"},{tag:de.definition(de.variableName),class:"tok-variableName tok-definition"},{tag:de.special(de.variableName),class:"tok-variableName2"},{tag:de.definition(de.propertyName),class:"tok-propertyName tok-definition"},{tag:de.typeName,class:"tok-typeName"},{tag:de.namespace,class:"tok-namespace"},{tag:de.className,class:"tok-className"},{tag:de.macroName,class:"tok-macroName"},{tag:de.propertyName,class:"tok-propertyName"},{tag:de.operator,class:"tok-operator"},{tag:de.comment,class:"tok-comment"},{tag:de.meta,class:"tok-meta"},{tag:de.invalid,class:"tok-invalid"},{tag:de.punctuation,class:"tok-punctuation"}]);var Ad;const Mi=new gt;function UT(r){return We.define({combine:r?t=>t.concat(r):void 0})}const QT=new gt;class Cr{constructor(t,s,n=[],i=""){this.data=t,this.name=i,bt.prototype.hasOwnProperty("tree")||Object.defineProperty(bt.prototype,"tree",{get(){return xs(this)}}),this.parser=s,this.extension=[Bn.of(this),bt.languageData.of((a,o,l)=>{let c=Qp(a,o,l),h=c.type.prop(Mi);if(!h)return[];let u=a.facet(h),m=c.type.prop(QT);if(m){let p=c.resolve(o-c.from,l);for(let x of m)if(x.test(p,a)){let b=a.facet(x.facet);return x.type=="replace"?b:b.concat(u)}}return u})].concat(n)}isActiveAt(t,s,n=-1){return Qp(t,s,n).type.prop(Mi)==this.data}findRegions(t){let s=t.facet(Bn);if(s?.data==this.data)return[{from:0,to:t.doc.length}];if(!s||!s.allowsNesting)return[];let n=[],i=(a,o)=>{if(a.prop(Mi)==this.data){n.push({from:o,to:o+a.length});return}let l=a.prop(gt.mounted);if(l){if(l.tree.prop(Mi)==this.data){if(l.overlay)for(let c of l.overlay)n.push({from:c.from+o,to:c.to+o});else n.push({from:o,to:o+a.length});return}else if(l.overlay){let c=n.length;if(i(l.tree,l.overlay[0].from+o),n.length>c)return}}for(let c=0;c<a.children.length;c++){let h=a.children[c];h instanceof cs&&i(h,a.positions[c]+o)}};return i(xs(t),0),n}get allowsNesting(){return!0}}Cr.setState=nt.define();function Qp(r,t,s){let n=r.facet(Bn),i=xs(r).topNode;if(!n||n.allowsNesting)for(let a=i;a;a=a.enter(t,s,us.ExcludeBuffers))a.type.isTop&&(i=a);return i}class Kl extends Cr{constructor(t,s,n){super(t,s,[],n),this.parser=s}static define(t){let s=UT(t.languageData);return new Kl(s,t.parser.configure({props:[Mi.add(n=>n.isTop?s:void 0)]}),t.name)}configure(t,s){return new Kl(this.data,this.parser.configure(t),s||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function xs(r){let t=r.field(Cr.state,!1);return t?t.tree:cs.empty}class qT{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,s){let n=this.cursorPos-this.string.length;return t<n||s>=this.cursorPos?this.doc.sliceString(t,s):this.string.slice(t-n,s-n)}}let xa=null;class Yl{constructor(t,s,n=[],i,a,o,l,c){this.parser=t,this.state=s,this.fragments=n,this.tree=i,this.treeLen=a,this.viewport=o,this.skipped=l,this.scheduleOn=c,this.parse=null,this.tempSkipped=[]}static create(t,s,n){return new Yl(t,s,[],cs.empty,0,n,[],null)}startParse(){return this.parser.startParse(new qT(this.state.doc),this.fragments)}work(t,s){return s!=null&&s>=this.state.doc.length&&(s=void 0),this.tree!=cs.empty&&this.isDone(s??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var n;if(typeof t=="number"){let i=Date.now()+t;t=()=>Date.now()>i}for(this.parse||(this.parse=this.startParse()),s!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>s)&&s<this.state.doc.length&&this.parse.stopAt(s);;){let i=this.parse.advance();if(i)if(this.fragments=this.withoutTempSkipped(oi.addTree(i,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(n=this.parse.stoppedAt)!==null&&n!==void 0?n:this.state.doc.length,this.tree=i,this.parse=null,this.treeLen<(s??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,s;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(s=this.parse.advance()););}),this.treeLen=t,this.tree=s,this.fragments=this.withoutTempSkipped(oi.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let s=xa;xa=this;try{return t()}finally{xa=s}}withoutTempSkipped(t){for(let s;s=this.tempSkipped.pop();)t=qp(t,s.from,s.to);return t}changes(t,s){let{fragments:n,tree:i,treeLen:a,viewport:o,skipped:l}=this;if(this.takeTree(),!t.empty){let c=[];if(t.iterChangedRanges((h,u,m,p)=>c.push({fromA:h,toA:u,fromB:m,toB:p})),n=oi.applyChanges(n,c),i=cs.empty,a=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let u=t.mapPos(h.from,1),m=t.mapPos(h.to,-1);u<m&&l.push({from:u,to:m})}}}return new Yl(this.parser,s,n,i,a,o,l,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let s=this.skipped.length;for(let n=0;n<this.skipped.length;n++){let{from:i,to:a}=this.skipped[n];i<t.to&&a>t.from&&(this.fragments=qp(this.fragments,i,a),this.skipped.splice(n--,1))}return this.skipped.length>=s?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,s){this.skipped.push({from:t,to:s})}static getSkippingParser(t){return new class extends P0{createParse(s,n,i){let a=i[0].from,o=i[i.length-1].to;return{parsedPos:a,advance(){let c=xa;if(c){for(let h of i)c.tempSkipped.push(h);t&&(c.scheduleOn=c.scheduleOn?Promise.all([c.scheduleOn,t]):t)}return this.parsedPos=o,new cs(Xs.none,[],[],o-a)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let s=this.fragments;return this.treeLen>=t&&s.length&&s[0].from==0&&s[0].to>=t}static get(){return xa}}function qp(r,t,s){return oi.applyChanges(r,[{fromA:t,toA:s,fromB:t,toB:s}])}class ea{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let s=this.context.changes(t.changes,t.state),n=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),s.viewport.to);return s.work(20,n)||s.takeTree(),new ea(s)}static init(t){let s=Math.min(3e3,t.doc.length),n=Yl.create(t.facet(Bn).parser,t,{from:0,to:s});return n.work(20,s)||n.takeTree(),new ea(n)}}Cr.state=ys.define({create:ea.init,update(r,t){for(let s of t.effects)if(s.is(Cr.setState))return s.value;return t.startState.facet(Bn)!=t.state.facet(Bn)?ea.init(t.state):r.apply(t)}});let D0=r=>{let t=setTimeout(()=>r(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(D0=r=>{let t=-1,s=setTimeout(()=>{t=requestIdleCallback(r,{timeout:400})},100);return()=>t<0?clearTimeout(s):cancelIdleCallback(t)});const Td=typeof navigator<"u"&&(!((Ad=navigator.scheduling)===null||Ad===void 0)&&Ad.isInputPending)?()=>navigator.scheduling.isInputPending():null,HT=ss.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let s=this.view.state.field(Cr.state).context;(s.updateViewport(t.view.viewport)||this.view.viewport.to>s.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(s)}scheduleWork(){if(this.working)return;let{state:t}=this.view,s=t.field(Cr.state);(s.tree!=s.context.tree||!s.context.isDone(t.doc.length))&&(this.working=D0(this.work))}work(t){this.working=null;let s=Date.now();if(this.chunkEnd<s&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=s+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:n,viewport:{to:i}}=this.view,a=n.field(Cr.state);if(a.tree==a.context.tree&&a.context.isDone(i+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!Td?Math.max(25,t.timeRemaining()-5):1e9),l=a.context.treeLen<i&&n.doc.length>i+1e3,c=a.context.work(()=>Td&&Td()||Date.now()>o,i+(l?0:1e5));this.chunkBudget-=Date.now()-s,(c||this.chunkBudget<=0)&&(a.context.takeTree(),this.view.dispatch({effects:Cr.setState.of(new ea(a.context))})),this.chunkBudget>0&&!(c&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(a.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(s=>Hs(this.view.state,s)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Bn=We.define({combine(r){return r.length?r[0]:null},enables:r=>[Cr.state,HT,Ie.contentAttributes.compute([r],t=>{let s=t.facet(r);return s&&s.name?{"data-language":s.name}:{}})]});class GT{constructor(t,s=[]){this.language=t,this.support=s,this.extension=[t,s]}}const KT=We.define(),yo=We.define({combine:r=>{if(!r.length)return"  ";let t=r[0];if(!t||/\S/.test(t)||Array.from(t).some(s=>s!=t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(r[0]));return t}});function Xl(r){let t=r.facet(yo);return t.charCodeAt(0)==9?r.tabSize*t.length:t.length}function Xa(r,t){let s="",n=r.tabSize,i=r.facet(yo)[0];if(i=="	"){for(;t>=n;)s+="	",t-=n;i=" "}for(let a=0;a<t;a++)s+=i;return s}function yf(r,t){r instanceof bt&&(r=new Ec(r));for(let n of r.state.facet(KT)){let i=n(r,t);if(i!==void 0)return i}let s=xs(r.state);return s.length>=t?YT(r,s,t):null}class Ec{constructor(t,s={}){this.state=t,this.options=s,this.unit=Xl(t)}lineAt(t,s=1){let n=this.state.doc.lineAt(t),{simulateBreak:i,simulateDoubleBreak:a}=this.options;return i!=null&&i>=n.from&&i<=n.to?a&&i==t?{text:"",from:t}:(s<0?i<t:i<=t)?{text:n.text.slice(i-n.from),from:i}:{text:n.text.slice(0,i-n.from),from:n.from}:n}textAfterPos(t,s=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:n,from:i}=this.lineAt(t,s);return n.slice(t-i,Math.min(n.length,t+100-i))}column(t,s=1){let{text:n,from:i}=this.lineAt(t,s),a=this.countColumn(n,t-i),o=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;return o>-1&&(a+=o-this.countColumn(n,n.search(/\S|$/))),a}countColumn(t,s=t.length){return ia(t,this.state.tabSize,s)}lineIndent(t,s=1){let{text:n,from:i}=this.lineAt(t,s),a=this.options.overrideIndentation;if(a){let o=a(i);if(o>-1)return o}return this.countColumn(n,n.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const R0=new gt;function YT(r,t,s){let n=t.resolveStack(s),i=t.resolveInner(s,-1).resolve(s,0).enterUnfinishedNodesBefore(s);if(i!=n.node){let a=[];for(let o=i;o&&!(o.from<n.node.from||o.to>n.node.to||o.from==n.node.from&&o.type==n.node.type);o=o.parent)a.push(o);for(let o=a.length-1;o>=0;o--)n={node:a[o],next:n}}return M0(n,r,s)}function M0(r,t,s){for(let n=r;n;n=n.next){let i=ZT(n.node);if(i)return i(jf.create(t,s,n))}return 0}function XT(r){return r.pos==r.options.simulateBreak&&r.options.simulateDoubleBreak}function ZT(r){let t=r.type.prop(R0);if(t)return t;let s=r.firstChild,n;if(s&&(n=s.type.prop(gt.closedBy))){let i=r.lastChild,a=i&&n.indexOf(i.name)>-1;return o=>L0(o,!0,1,void 0,a&&!XT(o)?i.from:void 0)}return r.parent==null?JT:null}function JT(){return 0}class jf extends Ec{constructor(t,s,n){super(t.state,t.options),this.base=t,this.pos=s,this.context=n}get node(){return this.context.node}static create(t,s,n){return new jf(t,s,n)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let s=this.state.doc.lineAt(t.from);for(;;){let n=t.resolve(s.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(eP(n,t))break;s=this.state.doc.lineAt(n.from)}return this.lineIndent(s.from)}continue(){return M0(this.context.next,this.base,this.pos)}}function eP(r,t){for(let s=t;s;s=s.parent)if(r==s)return!0;return!1}function tP(r){let t=r.node,s=t.childAfter(t.from),n=t.lastChild;if(!s)return null;let i=r.options.simulateBreak,a=r.state.doc.lineAt(s.from),o=i==null||i<=a.from?a.to:Math.min(a.to,i);for(let l=s.to;;){let c=t.childAfter(l);if(!c||c==n)return null;if(!c.type.isSkipped){if(c.from>=o)return null;let h=/^ */.exec(a.text.slice(s.to-a.from))[0].length;return{from:s.from,to:s.to+h}}l=c.to}}function Pd({closing:r,align:t=!0,units:s=1}){return n=>L0(n,t,s,r)}function L0(r,t,s,n,i){let a=r.textAfter,o=a.match(/^\s*/)[0].length,l=n&&a.slice(o,o+n.length)==n||i==r.pos+o,c=t?tP(r):null;return c?l?r.column(c.from):r.column(c.to):r.baseIndent+(l?0:r.unit*s)}const sP=200;function rP(){return bt.transactionFilter.of(r=>{if(!r.docChanged||!r.isUserEvent("input.type")&&!r.isUserEvent("input.complete"))return r;let t=r.startState.languageDataAt("indentOnInput",r.startState.selection.main.head);if(!t.length)return r;let s=r.newDoc,{head:n}=r.newSelection.main,i=s.lineAt(n);if(n>i.from+sP)return r;let a=s.sliceString(i.from,n);if(!t.some(h=>h.test(a)))return r;let{state:o}=r,l=-1,c=[];for(let{head:h}of o.selection.ranges){let u=o.doc.lineAt(h);if(u.from==l)continue;l=u.from;let m=yf(o,u.from);if(m==null)continue;let p=/^\s*/.exec(u.text)[0],x=Xa(o,m);p!=x&&c.push({from:u.from,to:u.from+p.length,insert:x})}return c.length?[r,{changes:c,sequential:!0}]:r})}const nP=We.define(),F0=new gt;function iP(r){let t=r.firstChild,s=r.lastChild;return t&&t.to<s.from?{from:t.to,to:s.type.isError?r.to:s.from}:null}function aP(r,t,s){let n=xs(r);if(n.length<s)return null;let i=n.resolveStack(s,1),a=null;for(let o=i;o;o=o.next){let l=o.node;if(l.to<=s||l.from>s)continue;if(a&&l.from<t)break;let c=l.type.prop(F0);if(c&&(l.to<n.length-50||n.length==r.doc.length||!oP(l))){let h=c(l,r);h&&h.from<=s&&h.from>=t&&h.to>s&&(a=h)}}return a}function oP(r){let t=r.lastChild;return t&&t.to==r.to&&t.type.isError}function Zl(r,t,s){for(let n of r.facet(nP)){let i=n(r,t,s);if(i)return i}return aP(r,t,s)}function N0(r,t){let s=t.mapPos(r.from,1),n=t.mapPos(r.to,-1);return s>=n?void 0:{from:s,to:n}}const Ic=nt.define({map:N0}),jo=nt.define({map:N0});function W0(r){let t=[];for(let{head:s}of r.state.selection.ranges)t.some(n=>n.from<=s&&n.to>=s)||t.push(r.lineBlockAt(s));return t}const gi=ys.define({create(){return qe.none},update(r,t){t.isUserEvent("delete")&&t.changes.iterChangedRanges((s,n)=>r=Hp(r,s,n)),r=r.map(t.changes);for(let s of t.effects)if(s.is(Ic)&&!lP(r,s.value.from,s.value.to)){let{preparePlaceholder:n}=t.state.facet(z0),i=n?qe.replace({widget:new pP(n(t.state,s.value))}):Gp;r=r.update({add:[i.range(s.value.from,s.value.to)]})}else s.is(jo)&&(r=r.update({filter:(n,i)=>s.value.from!=n||s.value.to!=i,filterFrom:s.value.from,filterTo:s.value.to}));return t.selection&&(r=Hp(r,t.selection.main.head)),r},provide:r=>Ie.decorations.from(r),toJSON(r,t){let s=[];return r.between(0,t.doc.length,(n,i)=>{s.push(n,i)}),s},fromJSON(r){if(!Array.isArray(r)||r.length%2)throw new RangeError("Invalid JSON for fold state");let t=[];for(let s=0;s<r.length;){let n=r[s++],i=r[s++];if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid JSON for fold state");t.push(Gp.range(n,i))}return qe.set(t,!0)}});function Hp(r,t,s=t){let n=!1;return r.between(t,s,(i,a)=>{i<s&&a>t&&(n=!0)}),n?r.update({filterFrom:t,filterTo:s,filter:(i,a)=>i>=s||a<=t}):r}function Jl(r,t,s){var n;let i=null;return(n=r.field(gi,!1))===null||n===void 0||n.between(t,s,(a,o)=>{(!i||i.from>a)&&(i={from:a,to:o})}),i}function lP(r,t,s){let n=!1;return r.between(t,t,(i,a)=>{i==t&&a==s&&(n=!0)}),n}function $0(r,t){return r.field(gi,!1)?t:t.concat(nt.appendConfig.of(B0()))}const cP=r=>{for(let t of W0(r)){let s=Zl(r.state,t.from,t.to);if(s)return r.dispatch({effects:$0(r.state,[Ic.of(s),V0(r,s)])}),!0}return!1},dP=r=>{if(!r.state.field(gi,!1))return!1;let t=[];for(let s of W0(r)){let n=Jl(r.state,s.from,s.to);n&&t.push(jo.of(n),V0(r,n,!1))}return t.length&&r.dispatch({effects:t}),t.length>0};function V0(r,t,s=!0){let n=r.state.doc.lineAt(t.from).number,i=r.state.doc.lineAt(t.to).number;return Ie.announce.of(`${r.state.phrase(s?"Folded lines":"Unfolded lines")} ${n} ${r.state.phrase("to")} ${i}.`)}const hP=r=>{let{state:t}=r,s=[];for(let n=0;n<t.doc.length;){let i=r.lineBlockAt(n),a=Zl(t,i.from,i.to);a&&s.push(Ic.of(a)),n=(a?r.lineBlockAt(a.to):i).to+1}return s.length&&r.dispatch({effects:$0(r.state,s)}),!!s.length},uP=r=>{let t=r.state.field(gi,!1);if(!t||!t.size)return!1;let s=[];return t.between(0,r.state.doc.length,(n,i)=>{s.push(jo.of({from:n,to:i}))}),r.dispatch({effects:s}),!0},fP=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:cP},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:dP},{key:"Ctrl-Alt-[",run:hP},{key:"Ctrl-Alt-]",run:uP}],mP={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},z0=We.define({combine(r){return sn(r,mP)}});function B0(r){return[gi,yP]}function U0(r,t){let{state:s}=r,n=s.facet(z0),i=o=>{let l=r.lineBlockAt(r.posAtDOM(o.target)),c=Jl(r.state,l.from,l.to);c&&r.dispatch({effects:jo.of(c)}),o.preventDefault()};if(n.placeholderDOM)return n.placeholderDOM(r,i,t);let a=document.createElement("span");return a.textContent=n.placeholderText,a.setAttribute("aria-label",s.phrase("folded code")),a.title=s.phrase("unfold"),a.className="cm-foldPlaceholder",a.onclick=i,a}const Gp=qe.replace({widget:new class extends rn{toDOM(r){return U0(r,null)}}});class pP extends rn{constructor(t){super(),this.value=t}eq(t){return this.value==t.value}toDOM(t){return U0(t,this.value)}}const gP={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class _d extends wn{constructor(t,s){super(),this.config=t,this.open=s}eq(t){return this.config==t.config&&this.open==t.open}toDOM(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);let s=document.createElement("span");return s.textContent=this.open?this.config.openText:this.config.closedText,s.title=t.state.phrase(this.open?"Fold line":"Unfold line"),s}}function xP(r={}){let t={...gP,...r},s=new _d(t,!0),n=new _d(t,!1),i=ss.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Bn)!=o.state.facet(Bn)||o.startState.field(gi,!1)!=o.state.field(gi,!1)||xs(o.startState)!=xs(o.state)||t.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new bn;for(let c of o.viewportLineBlocks){let h=Jl(o.state,c.from,c.to)?n:Zl(o.state,c.from,c.to)?s:null;h&&l.add(c.from,c.from,h)}return l.finish()}}),{domEventHandlers:a}=t;return[i,xT({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(i))===null||l===void 0?void 0:l.markers)||Ot.empty},initialSpacer(){return new _d(t,!1)},domEventHandlers:{...a,click:(o,l,c)=>{if(a.click&&a.click(o,l,c))return!0;let h=Jl(o.state,l.from,l.to);if(h)return o.dispatch({effects:jo.of(h)}),!0;let u=Zl(o.state,l.from,l.to);return u?(o.dispatch({effects:Ic.of(u)}),!0):!1}}}),B0()]}const yP=Ie.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class bo{constructor(t,s){this.specs=t;let n;function i(l){let c=Wn.newName();return(n||(n=Object.create(null)))["."+c]=l,c}const a=typeof s.all=="string"?s.all:s.all?i(s.all):void 0,o=s.scope;this.scope=o instanceof Cr?l=>l.prop(Mi)==o.data:o?l=>l==o:void 0,this.style=I0(t.map(l=>({tag:l.tag,class:l.class||i(Object.assign({},l,{tag:null}))})),{all:a}).style,this.module=n?new Wn(n):null,this.themeType=s.themeType}static define(t,s){return new bo(t,s||{})}}const Jh=We.define(),Q0=We.define({combine(r){return r.length?[r[0]]:null}});function Ed(r){let t=r.facet(Jh);return t.length?t:r.facet(Q0)}function q0(r,t){let s=[bP],n;return r instanceof bo&&(r.module&&s.push(Ie.styleModule.of(r.module)),n=r.themeType),t?.fallback?s.push(Q0.of(r)):n?s.push(Jh.computeN([Ie.darkTheme],i=>i.facet(Ie.darkTheme)==(n=="dark")?[r]:[])):s.push(Jh.of(r)),s}class jP{constructor(t){this.markCache=Object.create(null),this.tree=xs(t.state),this.decorations=this.buildDeco(t,Ed(t.state)),this.decoratedTo=t.viewport.to}update(t){let s=xs(t.state),n=Ed(t.state),i=n!=Ed(t.startState),{viewport:a}=t.view,o=t.changes.mapPos(this.decoratedTo,1);s.length<a.to&&!i&&s.type==this.tree.type&&o>=a.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=o):(s!=this.tree||t.viewportChanged||i)&&(this.tree=s,this.decorations=this.buildDeco(t.view,n),this.decoratedTo=a.to)}buildDeco(t,s){if(!s||!this.tree.length)return qe.none;let n=new bn;for(let{from:i,to:a}of t.visibleRanges)VT(this.tree,s,(o,l,c)=>{n.add(o,l,this.markCache[c]||(this.markCache[c]=qe.mark({class:c})))},i,a);return n.finish()}}const bP=qn.high(ss.fromClass(jP,{decorations:r=>r.decorations})),vP=bo.define([{tag:de.meta,color:"#404740"},{tag:de.link,textDecoration:"underline"},{tag:de.heading,textDecoration:"underline",fontWeight:"bold"},{tag:de.emphasis,fontStyle:"italic"},{tag:de.strong,fontWeight:"bold"},{tag:de.strikethrough,textDecoration:"line-through"},{tag:de.keyword,color:"#708"},{tag:[de.atom,de.bool,de.url,de.contentSeparator,de.labelName],color:"#219"},{tag:[de.literal,de.inserted],color:"#164"},{tag:[de.string,de.deleted],color:"#a11"},{tag:[de.regexp,de.escape,de.special(de.string)],color:"#e40"},{tag:de.definition(de.variableName),color:"#00f"},{tag:de.local(de.variableName),color:"#30a"},{tag:[de.typeName,de.namespace],color:"#085"},{tag:de.className,color:"#167"},{tag:[de.special(de.variableName),de.macroName],color:"#256"},{tag:de.definition(de.propertyName),color:"#00c"},{tag:de.comment,color:"#940"},{tag:de.invalid,color:"#f00"}]),wP=Ie.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),H0=1e4,G0="()[]{}",K0=We.define({combine(r){return sn(r,{afterCursor:!0,brackets:G0,maxScanDistance:H0,renderMatch:kP})}}),SP=qe.mark({class:"cm-matchingBracket"}),OP=qe.mark({class:"cm-nonmatchingBracket"});function kP(r){let t=[],s=r.matched?SP:OP;return t.push(s.range(r.start.from,r.start.to)),r.end&&t.push(s.range(r.end.from,r.end.to)),t}const CP=ys.define({create(){return qe.none},update(r,t){if(!t.docChanged&&!t.selection)return r;let s=[],n=t.state.facet(K0);for(let i of t.state.selection.ranges){if(!i.empty)continue;let a=qr(t.state,i.head,-1,n)||i.head>0&&qr(t.state,i.head-1,1,n)||n.afterCursor&&(qr(t.state,i.head,1,n)||i.head<t.state.doc.length&&qr(t.state,i.head+1,-1,n));a&&(s=s.concat(n.renderMatch(a,t.state)))}return qe.set(s,!0)},provide:r=>Ie.decorations.from(r)}),AP=[CP,wP];function TP(r={}){return[K0.of(r),AP]}const PP=new gt;function eu(r,t,s){let n=r.prop(t<0?gt.openedBy:gt.closedBy);if(n)return n;if(r.name.length==1){let i=s.indexOf(r.name);if(i>-1&&i%2==(t<0?1:0))return[s[i+t]]}return null}function tu(r){let t=r.type.prop(PP);return t?t(r.node):r}function qr(r,t,s,n={}){let i=n.maxScanDistance||H0,a=n.brackets||G0,o=xs(r),l=o.resolveInner(t,s);for(let c=l;c;c=c.parent){let h=eu(c.type,s,a);if(h&&c.from<c.to){let u=tu(c);if(u&&(s>0?t>=u.from&&t<u.to:t>u.from&&t<=u.to))return _P(r,t,s,c,u,h,a)}}return EP(r,t,s,o,l.type,i,a)}function _P(r,t,s,n,i,a,o){let l=n.parent,c={from:i.from,to:i.to},h=0,u=l?.cursor();if(u&&(s<0?u.childBefore(n.from):u.childAfter(n.to)))do if(s<0?u.to<=n.from:u.from>=n.to){if(h==0&&a.indexOf(u.type.name)>-1&&u.from<u.to){let m=tu(u);return{start:c,end:m?{from:m.from,to:m.to}:void 0,matched:!0}}else if(eu(u.type,s,o))h++;else if(eu(u.type,-s,o)){if(h==0){let m=tu(u);return{start:c,end:m&&m.from<m.to?{from:m.from,to:m.to}:void 0,matched:!1}}h--}}while(s<0?u.prevSibling():u.nextSibling());return{start:c,matched:!1}}function EP(r,t,s,n,i,a,o){let l=s<0?r.sliceDoc(t-1,t):r.sliceDoc(t,t+1),c=o.indexOf(l);if(c<0||c%2==0!=s>0)return null;let h={from:s<0?t-1:t,to:s>0?t+1:t},u=r.doc.iterRange(t,s>0?r.doc.length:0),m=0;for(let p=0;!u.next().done&&p<=a;){let x=u.value;s<0&&(p+=x.length);let b=t+p*s;for(let w=s>0?0:x.length-1,C=s>0?x.length:-1;w!=C;w+=s){let A=o.indexOf(x[w]);if(!(A<0||n.resolveInner(b+w,1).type!=i))if(A%2==0==s>0)m++;else{if(m==1)return{start:h,end:{from:b+w,to:b+w+1},matched:A>>1==c>>1};m--}}s>0&&(p+=x.length)}return u.done?{start:h,matched:!1}:null}const IP=Object.create(null),Kp=[Xs.none],Yp=[],Xp=Object.create(null),DP=Object.create(null);for(let[r,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])DP[r]=RP(IP,t);function Id(r,t){Yp.indexOf(r)>-1||(Yp.push(r),console.warn(t))}function RP(r,t){let s=[];for(let l of t.split(" ")){let c=[];for(let h of l.split(".")){let u=r[h]||de[h];u?typeof u=="function"?c.length?c=c.map(u):Id(h,`Modifier ${h} used at start of tag`):c.length?Id(h,`Tag ${h} used as modifier`):c=Array.isArray(u)?u:[u]:Id(h,`Unknown highlighting tag ${h}`)}for(let h of c)s.push(h)}if(!s.length)return 0;let n=t.replace(/ /g,"_"),i=n+" "+s.map(l=>l.id),a=Xp[i];if(a)return a.id;let o=Xp[i]=Xs.define({id:Kp.length,name:n,props:[_0({[n]:s})]});return Kp.push(o),o.id}zt.RTL,zt.LTR;const MP=r=>{let{state:t}=r,s=t.doc.lineAt(t.selection.main.from),n=vf(r.state,s.from);return n.line?LP(r):n.block?NP(r):!1};function bf(r,t){return({state:s,dispatch:n})=>{if(s.readOnly)return!1;let i=r(t,s);return i?(n(s.update(i)),!0):!1}}const LP=bf(VP,0),FP=bf(Y0,0),NP=bf((r,t)=>Y0(r,t,$P(t)),0);function vf(r,t){let s=r.languageDataAt("commentTokens",t,1);return s.length?s[0]:{}}const ya=50;function WP(r,{open:t,close:s},n,i){let a=r.sliceDoc(n-ya,n),o=r.sliceDoc(i,i+ya),l=/\s*$/.exec(a)[0].length,c=/^\s*/.exec(o)[0].length,h=a.length-l;if(a.slice(h-t.length,h)==t&&o.slice(c,c+s.length)==s)return{open:{pos:n-l,margin:l&&1},close:{pos:i+c,margin:c&&1}};let u,m;i-n<=2*ya?u=m=r.sliceDoc(n,i):(u=r.sliceDoc(n,n+ya),m=r.sliceDoc(i-ya,i));let p=/^\s*/.exec(u)[0].length,x=/\s*$/.exec(m)[0].length,b=m.length-x-s.length;return u.slice(p,p+t.length)==t&&m.slice(b,b+s.length)==s?{open:{pos:n+p+t.length,margin:/\s/.test(u.charAt(p+t.length))?1:0},close:{pos:i-x-s.length,margin:/\s/.test(m.charAt(b-1))?1:0}}:null}function $P(r){let t=[];for(let s of r.selection.ranges){let n=r.doc.lineAt(s.from),i=s.to<=n.to?n:r.doc.lineAt(s.to);i.from>n.from&&i.from==s.to&&(i=s.to==n.to+1?n:r.doc.lineAt(s.to-1));let a=t.length-1;a>=0&&t[a].to>n.from?t[a].to=i.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:i.to})}return t}function Y0(r,t,s=t.selection.ranges){let n=s.map(a=>vf(t,a.from).block);if(!n.every(a=>a))return null;let i=s.map((a,o)=>WP(t,n[o],a.from,a.to));if(r!=2&&!i.every(a=>a))return{changes:t.changes(s.map((a,o)=>i[o]?[]:[{from:a.from,insert:n[o].open+" "},{from:a.to,insert:" "+n[o].close}]))};if(r!=1&&i.some(a=>a)){let a=[];for(let o=0,l;o<i.length;o++)if(l=i[o]){let c=n[o],{open:h,close:u}=l;a.push({from:h.pos-c.open.length,to:h.pos+h.margin},{from:u.pos-u.margin,to:u.pos+c.close.length})}return{changes:a}}return null}function VP(r,t,s=t.selection.ranges){let n=[],i=-1;for(let{from:a,to:o}of s){let l=n.length,c=1e9,h=vf(t,a).line;if(h){for(let u=a;u<=o;){let m=t.doc.lineAt(u);if(m.from>i&&(a==o||o>m.from)){i=m.from;let p=/^\s*/.exec(m.text)[0].length,x=p==m.length,b=m.text.slice(p,p+h.length)==h?p:-1;p<m.text.length&&p<c&&(c=p),n.push({line:m,comment:b,token:h,indent:p,empty:x,single:!1})}u=m.to+1}if(c<1e9)for(let u=l;u<n.length;u++)n[u].indent<n[u].line.text.length&&(n[u].indent=c);n.length==l+1&&(n[l].single=!0)}}if(r!=2&&n.some(a=>a.comment<0&&(!a.empty||a.single))){let a=[];for(let{line:l,token:c,indent:h,empty:u,single:m}of n)(m||!u)&&a.push({from:l.from+h,insert:c+" "});let o=t.changes(a);return{changes:o,selection:t.selection.map(o,1)}}else if(r!=1&&n.some(a=>a.comment>=0)){let a=[];for(let{line:o,comment:l,token:c}of n)if(l>=0){let h=o.from+l,u=h+c.length;o.text[u-o.from]==" "&&u++,a.push({from:h,to:u})}return{changes:a}}return null}const su=tn.define(),zP=tn.define(),BP=We.define(),X0=We.define({combine(r){return sn(r,{minDepth:100,newGroupDelay:500,joinToEvent:(t,s)=>s},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,s)=>(n,i)=>t(n,i)||s(n,i)})}}),Z0=ys.define({create(){return Hr.empty},update(r,t){let s=t.state.facet(X0),n=t.annotation(su);if(n){let c=Gs.fromTransaction(t,n.selection),h=n.side,u=h==0?r.undone:r.done;return c?u=ec(u,u.length,s.minDepth,c):u=tv(u,t.startState.selection),new Hr(h==0?n.rest:u,h==0?u:n.rest)}let i=t.annotation(zP);if((i=="full"||i=="before")&&(r=r.isolate()),t.annotation(ls.addToHistory)===!1)return t.changes.empty?r:r.addMapping(t.changes.desc);let a=Gs.fromTransaction(t),o=t.annotation(ls.time),l=t.annotation(ls.userEvent);return a?r=r.addChanges(a,o,l,s,t):t.selection&&(r=r.addSelection(t.startState.selection,o,l,s.newGroupDelay)),(i=="full"||i=="after")&&(r=r.isolate()),r},toJSON(r){return{done:r.done.map(t=>t.toJSON()),undone:r.undone.map(t=>t.toJSON())}},fromJSON(r){return new Hr(r.done.map(Gs.fromJSON),r.undone.map(Gs.fromJSON))}});function UP(r={}){return[Z0,X0.of(r),Ie.domEventHandlers({beforeinput(t,s){let n=t.inputType=="historyUndo"?J0:t.inputType=="historyRedo"?ru:null;return n?(t.preventDefault(),n(s)):!1}})]}function Dc(r,t){return function({state:s,dispatch:n}){if(!t&&s.readOnly)return!1;let i=s.field(Z0,!1);if(!i)return!1;let a=i.pop(r,s,t);return a?(n(a),!0):!1}}const J0=Dc(0,!1),ru=Dc(1,!1),QP=Dc(0,!0),qP=Dc(1,!0);class Gs{constructor(t,s,n,i,a){this.changes=t,this.effects=s,this.mapped=n,this.startSelection=i,this.selectionsAfter=a}setSelAfter(t){return new Gs(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,s,n;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(s=this.mapped)===null||s===void 0?void 0:s.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(i=>i.toJSON())}}static fromJSON(t){return new Gs(t.changes&&hs.fromJSON(t.changes),[],t.mapped&&Xr.fromJSON(t.mapped),t.startSelection&&ye.fromJSON(t.startSelection),t.selectionsAfter.map(ye.fromJSON))}static fromTransaction(t,s){let n=pr;for(let i of t.startState.facet(BP)){let a=i(t);a.length&&(n=n.concat(a))}return!n.length&&t.changes.empty?null:new Gs(t.changes.invert(t.startState.doc),n,void 0,s||t.startState.selection,pr)}static selection(t){return new Gs(void 0,pr,void 0,void 0,t)}}function ec(r,t,s,n){let i=t+1>s+20?t-s-1:0,a=r.slice(i,t);return a.push(n),a}function HP(r,t){let s=[],n=!1;return r.iterChangedRanges((i,a)=>s.push(i,a)),t.iterChangedRanges((i,a,o,l)=>{for(let c=0;c<s.length;){let h=s[c++],u=s[c++];l>=h&&o<=u&&(n=!0)}}),n}function GP(r,t){return r.ranges.length==t.ranges.length&&r.ranges.filter((s,n)=>s.empty!=t.ranges[n].empty).length===0}function ev(r,t){return r.length?t.length?r.concat(t):r:t}const pr=[],KP=200;function tv(r,t){if(r.length){let s=r[r.length-1],n=s.selectionsAfter.slice(Math.max(0,s.selectionsAfter.length-KP));return n.length&&n[n.length-1].eq(t)?r:(n.push(t),ec(r,r.length-1,1e9,s.setSelAfter(n)))}else return[Gs.selection([t])]}function YP(r){let t=r[r.length-1],s=r.slice();return s[r.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),s}function Dd(r,t){if(!r.length)return r;let s=r.length,n=pr;for(;s;){let i=XP(r[s-1],t,n);if(i.changes&&!i.changes.empty||i.effects.length){let a=r.slice(0,s);return a[s-1]=i,a}else t=i.mapped,s--,n=i.selectionsAfter}return n.length?[Gs.selection(n)]:pr}function XP(r,t,s){let n=ev(r.selectionsAfter.length?r.selectionsAfter.map(l=>l.map(t)):pr,s);if(!r.changes)return Gs.selection(n);let i=r.changes.map(t),a=t.mapDesc(r.changes,!0),o=r.mapped?r.mapped.composeDesc(a):a;return new Gs(i,nt.mapEffects(r.effects,t),o,r.startSelection.map(a),n)}const ZP=/^(input\.type|delete)($|\.)/;class Hr{constructor(t,s,n=0,i=void 0){this.done=t,this.undone=s,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new Hr(this.done,this.undone):this}addChanges(t,s,n,i,a){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&t.changes&&(!n||ZP.test(n))&&(!l.selectionsAfter.length&&s-this.prevTime<i.newGroupDelay&&i.joinToEvent(a,HP(l.changes,t.changes))||n=="input.type.compose")?o=ec(o,o.length-1,i.minDepth,new Gs(t.changes.compose(l.changes),ev(nt.mapEffects(t.effects,l.changes),l.effects),l.mapped,l.startSelection,pr)):o=ec(o,o.length,i.minDepth,t),new Hr(o,pr,s,n)}addSelection(t,s,n,i){let a=this.done.length?this.done[this.done.length-1].selectionsAfter:pr;return a.length>0&&s-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&GP(a[a.length-1],t)?this:new Hr(tv(this.done,t),this.undone,s,n)}addMapping(t){return new Hr(Dd(this.done,t),Dd(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,s,n){let i=t==0?this.done:this.undone;if(i.length==0)return null;let a=i[i.length-1],o=a.selectionsAfter[0]||s.selection;if(n&&a.selectionsAfter.length)return s.update({selection:a.selectionsAfter[a.selectionsAfter.length-1],annotations:su.of({side:t,rest:YP(i),selection:o}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(a.changes){let l=i.length==1?pr:i.slice(0,i.length-1);return a.mapped&&(l=Dd(l,a.mapped)),s.update({changes:a.changes,selection:a.startSelection,effects:a.effects,annotations:su.of({side:t,rest:l,selection:o}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}Hr.empty=new Hr(pr,pr);const JP=[{key:"Mod-z",run:J0,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:ru,preventDefault:!0},{linux:"Ctrl-Shift-z",run:ru,preventDefault:!0},{key:"Mod-u",run:QP,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:qP,preventDefault:!0}];function aa(r,t){return ye.create(r.ranges.map(t),r.mainIndex)}function nn(r,t){return r.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function Dr({state:r,dispatch:t},s){let n=aa(r.selection,s);return n.eq(r.selection,!0)?!1:(t(nn(r,n)),!0)}function Rc(r,t){return ye.cursor(t?r.to:r.from)}function sv(r,t){return Dr(r,s=>s.empty?r.moveByChar(s,t):Rc(s,t))}function Ms(r){return r.textDirectionAt(r.state.selection.main.head)==zt.LTR}const rv=r=>sv(r,!Ms(r)),nv=r=>sv(r,Ms(r));function iv(r,t){return Dr(r,s=>s.empty?r.moveByGroup(s,t):Rc(s,t))}const e_=r=>iv(r,!Ms(r)),t_=r=>iv(r,Ms(r));function s_(r,t,s){if(t.type.prop(s))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(r.sliceDoc(t.from,t.to)))||t.firstChild}function Mc(r,t,s){let n=xs(r).resolveInner(t.head),i=s?gt.closedBy:gt.openedBy;for(let c=t.head;;){let h=s?n.childAfter(c):n.childBefore(c);if(!h)break;s_(r,h,i)?n=h:c=s?h.to:h.from}let a=n.type.prop(i),o,l;return a&&(o=s?qr(r,n.from,1):qr(r,n.to,-1))&&o.matched?l=s?o.end.to:o.end.from:l=s?n.to:n.from,ye.cursor(l,s?-1:1)}const r_=r=>Dr(r,t=>Mc(r.state,t,!Ms(r))),n_=r=>Dr(r,t=>Mc(r.state,t,Ms(r)));function av(r,t){return Dr(r,s=>{if(!s.empty)return Rc(s,t);let n=r.moveVertically(s,t);return n.head!=s.head?n:r.moveToLineBoundary(s,t)})}const ov=r=>av(r,!1),lv=r=>av(r,!0);function cv(r){let t=r.scrollDOM.clientHeight<r.scrollDOM.scrollHeight-2,s=0,n=0,i;if(t){for(let a of r.state.facet(Ie.scrollMargins)){let o=a(r);o?.top&&(s=Math.max(o?.top,s)),o?.bottom&&(n=Math.max(o?.bottom,n))}i=r.scrollDOM.clientHeight-s-n}else i=(r.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:s,marginBottom:n,selfScroll:t,height:Math.max(r.defaultLineHeight,i-5)}}function dv(r,t){let s=cv(r),{state:n}=r,i=aa(n.selection,o=>o.empty?r.moveVertically(o,t,s.height):Rc(o,t));if(i.eq(n.selection))return!1;let a;if(s.selfScroll){let o=r.coordsAtPos(n.selection.main.head),l=r.scrollDOM.getBoundingClientRect(),c=l.top+s.marginTop,h=l.bottom-s.marginBottom;o&&o.top>c&&o.bottom<h&&(a=Ie.scrollIntoView(i.main.head,{y:"start",yMargin:o.top-c}))}return r.dispatch(nn(n,i),{effects:a}),!0}const Zp=r=>dv(r,!1),nu=r=>dv(r,!0);function Hn(r,t,s){let n=r.lineBlockAt(t.head),i=r.moveToLineBoundary(t,s);if(i.head==t.head&&i.head!=(s?n.to:n.from)&&(i=r.moveToLineBoundary(t,s,!1)),!s&&i.head==n.from&&n.length){let a=/^\s*/.exec(r.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;a&&t.head!=n.from+a&&(i=ye.cursor(n.from+a))}return i}const i_=r=>Dr(r,t=>Hn(r,t,!0)),a_=r=>Dr(r,t=>Hn(r,t,!1)),o_=r=>Dr(r,t=>Hn(r,t,!Ms(r))),l_=r=>Dr(r,t=>Hn(r,t,Ms(r))),c_=r=>Dr(r,t=>ye.cursor(r.lineBlockAt(t.head).from,1)),d_=r=>Dr(r,t=>ye.cursor(r.lineBlockAt(t.head).to,-1));function h_(r,t,s){let n=!1,i=aa(r.selection,a=>{let o=qr(r,a.head,-1)||qr(r,a.head,1)||a.head>0&&qr(r,a.head-1,1)||a.head<r.doc.length&&qr(r,a.head+1,-1);if(!o||!o.end)return a;n=!0;let l=o.start.from==a.head?o.end.to:o.end.from;return ye.cursor(l)});return n?(t(nn(r,i)),!0):!1}const u_=({state:r,dispatch:t})=>h_(r,t);function wr(r,t){let s=aa(r.state.selection,n=>{let i=t(n);return ye.range(n.anchor,i.head,i.goalColumn,i.bidiLevel||void 0)});return s.eq(r.state.selection)?!1:(r.dispatch(nn(r.state,s)),!0)}function hv(r,t){return wr(r,s=>r.moveByChar(s,t))}const uv=r=>hv(r,!Ms(r)),fv=r=>hv(r,Ms(r));function mv(r,t){return wr(r,s=>r.moveByGroup(s,t))}const f_=r=>mv(r,!Ms(r)),m_=r=>mv(r,Ms(r)),p_=r=>wr(r,t=>Mc(r.state,t,!Ms(r))),g_=r=>wr(r,t=>Mc(r.state,t,Ms(r)));function pv(r,t){return wr(r,s=>r.moveVertically(s,t))}const gv=r=>pv(r,!1),xv=r=>pv(r,!0);function yv(r,t){return wr(r,s=>r.moveVertically(s,t,cv(r).height))}const Jp=r=>yv(r,!1),eg=r=>yv(r,!0),x_=r=>wr(r,t=>Hn(r,t,!0)),y_=r=>wr(r,t=>Hn(r,t,!1)),j_=r=>wr(r,t=>Hn(r,t,!Ms(r))),b_=r=>wr(r,t=>Hn(r,t,Ms(r))),v_=r=>wr(r,t=>ye.cursor(r.lineBlockAt(t.head).from)),w_=r=>wr(r,t=>ye.cursor(r.lineBlockAt(t.head).to)),tg=({state:r,dispatch:t})=>(t(nn(r,{anchor:0})),!0),sg=({state:r,dispatch:t})=>(t(nn(r,{anchor:r.doc.length})),!0),rg=({state:r,dispatch:t})=>(t(nn(r,{anchor:r.selection.main.anchor,head:0})),!0),ng=({state:r,dispatch:t})=>(t(nn(r,{anchor:r.selection.main.anchor,head:r.doc.length})),!0),S_=({state:r,dispatch:t})=>(t(r.update({selection:{anchor:0,head:r.doc.length},userEvent:"select"})),!0),O_=({state:r,dispatch:t})=>{let s=Lc(r).map(({from:n,to:i})=>ye.range(n,Math.min(i+1,r.doc.length)));return t(r.update({selection:ye.create(s),userEvent:"select"})),!0},k_=({state:r,dispatch:t})=>{let s=aa(r.selection,n=>{let i=xs(r),a=i.resolveStack(n.from,1);if(n.empty){let o=i.resolveStack(n.from,-1);o.node.from>=a.node.from&&o.node.to<=a.node.to&&(a=o)}for(let o=a;o;o=o.next){let{node:l}=o;if((l.from<n.from&&l.to>=n.to||l.to>n.to&&l.from<=n.from)&&o.next)return ye.range(l.to,l.from)}return n});return s.eq(r.selection)?!1:(t(nn(r,s)),!0)},C_=({state:r,dispatch:t})=>{let s=r.selection,n=null;return s.ranges.length>1?n=ye.create([s.main]):s.main.empty||(n=ye.create([ye.cursor(s.main.head)])),n?(t(nn(r,n)),!0):!1};function vo(r,t){if(r.state.readOnly)return!1;let s="delete.selection",{state:n}=r,i=n.changeByRange(a=>{let{from:o,to:l}=a;if(o==l){let c=t(a);c<o?(s="delete.backward",c=sl(r,c,!1)):c>o&&(s="delete.forward",c=sl(r,c,!0)),o=Math.min(o,c),l=Math.max(l,c)}else o=sl(r,o,!1),l=sl(r,l,!0);return o==l?{range:a}:{changes:{from:o,to:l},range:ye.cursor(o,o<a.head?-1:1)}});return i.changes.empty?!1:(r.dispatch(n.update(i,{scrollIntoView:!0,userEvent:s,effects:s=="delete.selection"?Ie.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function sl(r,t,s){if(r instanceof Ie)for(let n of r.state.facet(Ie.atomicRanges).map(i=>i(r)))n.between(t,t,(i,a)=>{i<t&&a>t&&(t=s?a:i)});return t}const jv=(r,t,s)=>vo(r,n=>{let i=n.from,{state:a}=r,o=a.doc.lineAt(i),l,c;if(s&&!t&&i>o.from&&i<o.from+200&&!/[^ \t]/.test(l=o.text.slice(0,i-o.from))){if(l[l.length-1]=="	")return i-1;let h=ia(l,a.tabSize),u=h%Xl(a)||Xl(a);for(let m=0;m<u&&l[l.length-1-m]==" ";m++)i--;c=i}else c=Ss(o.text,i-o.from,t,t)+o.from,c==i&&o.number!=(t?a.doc.lines:1)?c+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(o.text.slice(c-o.from,i-o.from))&&(c=Ss(o.text,c-o.from,!1,!1)+o.from);return c}),iu=r=>jv(r,!1,!0),bv=r=>jv(r,!0,!1),vv=(r,t)=>vo(r,s=>{let n=s.head,{state:i}=r,a=i.doc.lineAt(n),o=i.charCategorizer(n);for(let l=null;;){if(n==(t?a.to:a.from)){n==s.head&&a.number!=(t?i.doc.lines:1)&&(n+=t?1:-1);break}let c=Ss(a.text,n-a.from,t)+a.from,h=a.text.slice(Math.min(n,c)-a.from,Math.max(n,c)-a.from),u=o(h);if(l!=null&&u!=l)break;(h!=" "||n!=s.head)&&(l=u),n=c}return n}),wv=r=>vv(r,!1),A_=r=>vv(r,!0),T_=r=>vo(r,t=>{let s=r.lineBlockAt(t.head).to;return t.head<s?s:Math.min(r.state.doc.length,t.head+1)}),P_=r=>vo(r,t=>{let s=r.moveToLineBoundary(t,!1).head;return t.head>s?s:Math.max(0,t.head-1)}),__=r=>vo(r,t=>{let s=r.moveToLineBoundary(t,!0).head;return t.head<s?s:Math.min(r.state.doc.length,t.head+1)}),E_=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let s=r.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:wt.of(["",""])},range:ye.cursor(n.from)}));return t(r.update(s,{scrollIntoView:!0,userEvent:"input"})),!0},I_=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let s=r.changeByRange(n=>{if(!n.empty||n.from==0||n.from==r.doc.length)return{range:n};let i=n.from,a=r.doc.lineAt(i),o=i==a.from?i-1:Ss(a.text,i-a.from,!1)+a.from,l=i==a.to?i+1:Ss(a.text,i-a.from,!0)+a.from;return{changes:{from:o,to:l,insert:r.doc.slice(i,l).append(r.doc.slice(o,i))},range:ye.cursor(l)}});return s.changes.empty?!1:(t(r.update(s,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Lc(r){let t=[],s=-1;for(let n of r.selection.ranges){let i=r.doc.lineAt(n.from),a=r.doc.lineAt(n.to);if(!n.empty&&n.to==a.from&&(a=r.doc.lineAt(n.to-1)),s>=i.number){let o=t[t.length-1];o.to=a.to,o.ranges.push(n)}else t.push({from:i.from,to:a.to,ranges:[n]});s=a.number+1}return t}function Sv(r,t,s){if(r.readOnly)return!1;let n=[],i=[];for(let a of Lc(r)){if(s?a.to==r.doc.length:a.from==0)continue;let o=r.doc.lineAt(s?a.to+1:a.from-1),l=o.length+1;if(s){n.push({from:a.to,to:o.to},{from:a.from,insert:o.text+r.lineBreak});for(let c of a.ranges)i.push(ye.range(Math.min(r.doc.length,c.anchor+l),Math.min(r.doc.length,c.head+l)))}else{n.push({from:o.from,to:a.from},{from:a.to,insert:r.lineBreak+o.text});for(let c of a.ranges)i.push(ye.range(c.anchor-l,c.head-l))}}return n.length?(t(r.update({changes:n,scrollIntoView:!0,selection:ye.create(i,r.selection.mainIndex),userEvent:"move.line"})),!0):!1}const D_=({state:r,dispatch:t})=>Sv(r,t,!1),R_=({state:r,dispatch:t})=>Sv(r,t,!0);function Ov(r,t,s){if(r.readOnly)return!1;let n=[];for(let i of Lc(r))s?n.push({from:i.from,insert:r.doc.slice(i.from,i.to)+r.lineBreak}):n.push({from:i.to,insert:r.lineBreak+r.doc.slice(i.from,i.to)});return t(r.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const M_=({state:r,dispatch:t})=>Ov(r,t,!1),L_=({state:r,dispatch:t})=>Ov(r,t,!0),F_=r=>{if(r.state.readOnly)return!1;let{state:t}=r,s=t.changes(Lc(t).map(({from:i,to:a})=>(i>0?i--:a<t.doc.length&&a++,{from:i,to:a}))),n=aa(t.selection,i=>{let a;if(r.lineWrapping){let o=r.lineBlockAt(i.head),l=r.coordsAtPos(i.head,i.assoc||1);l&&(a=o.bottom+r.documentTop-l.bottom+r.defaultLineHeight/2)}return r.moveVertically(i,!0,a)}).map(s);return r.dispatch({changes:s,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function N_(r,t){if(/\(\)|\[\]|\{\}/.test(r.sliceDoc(t-1,t+1)))return{from:t,to:t};let s=xs(r).resolveInner(t),n=s.childBefore(t),i=s.childAfter(t),a;return n&&i&&n.to<=t&&i.from>=t&&(a=n.type.prop(gt.closedBy))&&a.indexOf(i.name)>-1&&r.doc.lineAt(n.to).from==r.doc.lineAt(i.from).from&&!/\S/.test(r.sliceDoc(n.to,i.from))?{from:n.to,to:i.from}:null}const ig=kv(!1),W_=kv(!0);function kv(r){return({state:t,dispatch:s})=>{if(t.readOnly)return!1;let n=t.changeByRange(i=>{let{from:a,to:o}=i,l=t.doc.lineAt(a),c=!r&&a==o&&N_(t,a);r&&(a=o=(o<=l.to?l:t.doc.lineAt(o)).to);let h=new Ec(t,{simulateBreak:a,simulateDoubleBreak:!!c}),u=yf(h,a);for(u==null&&(u=ia(/^\s*/.exec(t.doc.lineAt(a).text)[0],t.tabSize));o<l.to&&/\s/.test(l.text[o-l.from]);)o++;c?{from:a,to:o}=c:a>l.from&&a<l.from+100&&!/\S/.test(l.text.slice(0,a))&&(a=l.from);let m=["",Xa(t,u)];return c&&m.push(Xa(t,h.lineIndent(l.from,-1))),{changes:{from:a,to:o,insert:wt.of(m)},range:ye.cursor(a+1+m[1].length)}});return s(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function wf(r,t){let s=-1;return r.changeByRange(n=>{let i=[];for(let o=n.from;o<=n.to;){let l=r.doc.lineAt(o);l.number>s&&(n.empty||n.to>l.from)&&(t(l,i,n),s=l.number),o=l.to+1}let a=r.changes(i);return{changes:i,range:ye.range(a.mapPos(n.anchor,1),a.mapPos(n.head,1))}})}const $_=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let s=Object.create(null),n=new Ec(r,{overrideIndentation:a=>{let o=s[a];return o??-1}}),i=wf(r,(a,o,l)=>{let c=yf(n,a.from);if(c==null)return;/\S/.test(a.text)||(c=0);let h=/^\s*/.exec(a.text)[0],u=Xa(r,c);(h!=u||l.from<a.from+h.length)&&(s[a.from]=c,o.push({from:a.from,to:a.from+h.length,insert:u}))});return i.changes.empty||t(r.update(i,{userEvent:"indent"})),!0},Cv=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(wf(r,(s,n)=>{n.push({from:s.from,insert:r.facet(yo)})}),{userEvent:"input.indent"})),!0),Av=({state:r,dispatch:t})=>r.readOnly?!1:(t(r.update(wf(r,(s,n)=>{let i=/^\s*/.exec(s.text)[0];if(!i)return;let a=ia(i,r.tabSize),o=0,l=Xa(r,Math.max(0,a-Xl(r)));for(;o<i.length&&o<l.length&&i.charCodeAt(o)==l.charCodeAt(o);)o++;n.push({from:s.from+o,to:s.from+i.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),V_=r=>(r.setTabFocusMode(),!0),z_=[{key:"Ctrl-b",run:rv,shift:uv,preventDefault:!0},{key:"Ctrl-f",run:nv,shift:fv},{key:"Ctrl-p",run:ov,shift:gv},{key:"Ctrl-n",run:lv,shift:xv},{key:"Ctrl-a",run:c_,shift:v_},{key:"Ctrl-e",run:d_,shift:w_},{key:"Ctrl-d",run:bv},{key:"Ctrl-h",run:iu},{key:"Ctrl-k",run:T_},{key:"Ctrl-Alt-h",run:wv},{key:"Ctrl-o",run:E_},{key:"Ctrl-t",run:I_},{key:"Ctrl-v",run:nu}],B_=[{key:"ArrowLeft",run:rv,shift:uv,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e_,shift:f_,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:o_,shift:j_,preventDefault:!0},{key:"ArrowRight",run:nv,shift:fv,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:t_,shift:m_,preventDefault:!0},{mac:"Cmd-ArrowRight",run:l_,shift:b_,preventDefault:!0},{key:"ArrowUp",run:ov,shift:gv,preventDefault:!0},{mac:"Cmd-ArrowUp",run:tg,shift:rg},{mac:"Ctrl-ArrowUp",run:Zp,shift:Jp},{key:"ArrowDown",run:lv,shift:xv,preventDefault:!0},{mac:"Cmd-ArrowDown",run:sg,shift:ng},{mac:"Ctrl-ArrowDown",run:nu,shift:eg},{key:"PageUp",run:Zp,shift:Jp},{key:"PageDown",run:nu,shift:eg},{key:"Home",run:a_,shift:y_,preventDefault:!0},{key:"Mod-Home",run:tg,shift:rg},{key:"End",run:i_,shift:x_,preventDefault:!0},{key:"Mod-End",run:sg,shift:ng},{key:"Enter",run:ig,shift:ig},{key:"Mod-a",run:S_},{key:"Backspace",run:iu,shift:iu},{key:"Delete",run:bv},{key:"Mod-Backspace",mac:"Alt-Backspace",run:wv},{key:"Mod-Delete",mac:"Alt-Delete",run:A_},{mac:"Mod-Backspace",run:P_},{mac:"Mod-Delete",run:__}].concat(z_.map(r=>({mac:r.key,run:r.run,shift:r.shift}))),U_=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:r_,shift:p_},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:n_,shift:g_},{key:"Alt-ArrowUp",run:D_},{key:"Shift-Alt-ArrowUp",run:M_},{key:"Alt-ArrowDown",run:R_},{key:"Shift-Alt-ArrowDown",run:L_},{key:"Escape",run:C_},{key:"Mod-Enter",run:W_},{key:"Alt-l",mac:"Ctrl-l",run:O_},{key:"Mod-i",run:k_,preventDefault:!0},{key:"Mod-[",run:Av},{key:"Mod-]",run:Cv},{key:"Mod-Alt-\\",run:$_},{key:"Shift-Mod-k",run:F_},{key:"Shift-Mod-\\",run:u_},{key:"Mod-/",run:MP},{key:"Alt-A",run:FP},{key:"Ctrl-m",mac:"Shift-Alt-m",run:V_}].concat(B_),Q_={key:"Tab",run:Cv,shift:Av},ag=typeof String.prototype.normalize=="function"?r=>r.normalize("NFKD"):r=>r;class ta{constructor(t,s,n=0,i=t.length,a,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(n,i),this.bufferStart=n,this.normalize=a?l=>a(ag(l)):ag,this.query=this.normalize(s)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Us(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let s=Zu(t),n=this.bufferStart+this.bufferPos;this.bufferPos+=Br(t);let i=this.normalize(s);if(i.length)for(let a=0,o=n;;a++){let l=i.charCodeAt(a),c=this.match(l,o,this.bufferPos+this.bufferStart);if(a==i.length-1){if(c)return this.value=c,this;break}o==n&&a<s.length&&s.charCodeAt(a)==l&&o++}}}match(t,s,n){let i=null;for(let a=0;a<this.matches.length;a+=2){let o=this.matches[a],l=!1;this.query.charCodeAt(o)==t&&(o==this.query.length-1?i={from:this.matches[a+1],to:n}:(this.matches[a]++,l=!0)),l||(this.matches.splice(a,2),a-=2)}return this.query.charCodeAt(0)==t&&(this.query.length==1?i={from:s,to:n}:this.matches.push(1,s)),i&&this.test&&!this.test(i.from,i.to,this.buffer,this.bufferStart)&&(i=null),i}}typeof Symbol<"u"&&(ta.prototype[Symbol.iterator]=function(){return this});const Tv={from:-1,to:-1,match:/.*/.exec("")},Sf="gm"+(/x/.unicode==null?"":"u");class Pv{constructor(t,s,n,i=0,a=t.length){if(this.text=t,this.to=a,this.curLine="",this.done=!1,this.value=Tv,/\\[sWDnr]|\n|\r|\[\^/.test(s))return new _v(t,s,n,i,a);this.re=new RegExp(s,Sf+(n?.ignoreCase?"i":"")),this.test=n?.test,this.iter=t.iter();let o=t.lineAt(i);this.curLineStart=o.from,this.matchPos=tc(t,i),this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let s=this.matchPos<=this.to&&this.re.exec(this.curLine);if(s){let n=this.curLineStart+s.index,i=n+s[0].length;if(this.matchPos=tc(this.text,i+(n==i?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<i||n>this.value.to)&&(!this.test||this.test(n,i,s)))return this.value={from:n,to:i,match:s},this;t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),t=0;else return this.done=!0,this}}}const Rd=new WeakMap;class zi{constructor(t,s){this.from=t,this.text=s}get to(){return this.from+this.text.length}static get(t,s,n){let i=Rd.get(t);if(!i||i.from>=n||i.to<=s){let l=new zi(s,t.sliceString(s,n));return Rd.set(t,l),l}if(i.from==s&&i.to==n)return i;let{text:a,from:o}=i;return o>s&&(a=t.sliceString(s,o)+a,o=s),i.to<n&&(a+=t.sliceString(i.to,n)),Rd.set(t,new zi(o,a)),new zi(s,a.slice(s-o,n-o))}}class _v{constructor(t,s,n,i,a){this.text=t,this.to=a,this.done=!1,this.value=Tv,this.matchPos=tc(t,i),this.re=new RegExp(s,Sf+(n?.ignoreCase?"i":"")),this.test=n?.test,this.flat=zi.get(t,i,this.chunkEnd(i+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,s=this.re.exec(this.flat.text);if(s&&!s[0]&&s.index==t&&(this.re.lastIndex=t+1,s=this.re.exec(this.flat.text)),s){let n=this.flat.from+s.index,i=n+s[0].length;if((this.flat.to>=this.to||s.index+s[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,i,s)))return this.value={from:n,to:i,match:s},this.matchPos=tc(this.text,i+(n==i?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=zi.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(Pv.prototype[Symbol.iterator]=_v.prototype[Symbol.iterator]=function(){return this});function q_(r){try{return new RegExp(r,Sf),!0}catch{return!1}}function tc(r,t){if(t>=r.length)return t;let s=r.lineAt(t),n;for(;t<s.to&&(n=s.text.charCodeAt(t-s.from))>=56320&&n<57344;)t++;return t}function au(r){let t=String(r.state.doc.lineAt(r.state.selection.main.head).number),s=_t("input",{class:"cm-textfield",name:"line",value:t}),n=_t("form",{class:"cm-gotoLine",onkeydown:a=>{a.keyCode==27?(a.preventDefault(),r.dispatch({effects:Da.of(!1)}),r.focus()):a.keyCode==13&&(a.preventDefault(),i())},onsubmit:a=>{a.preventDefault(),i()}},_t("label",r.state.phrase("Go to line"),": ",s)," ",_t("button",{class:"cm-button",type:"submit"},r.state.phrase("go")),_t("button",{name:"close",onclick:()=>{r.dispatch({effects:Da.of(!1)}),r.focus()},"aria-label":r.state.phrase("close"),type:"button"},["×"]));function i(){let a=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(s.value);if(!a)return;let{state:o}=r,l=o.doc.lineAt(o.selection.main.head),[,c,h,u,m]=a,p=u?+u.slice(1):0,x=h?+h:l.number;if(h&&m){let C=x/100;c&&(C=C*(c=="-"?-1:1)+l.number/o.doc.lines),x=Math.round(o.doc.lines*C)}else h&&c&&(x=x*(c=="-"?-1:1)+l.number);let b=o.doc.line(Math.max(1,Math.min(o.doc.lines,x))),w=ye.cursor(b.from+Math.max(0,Math.min(p,b.length)));r.dispatch({effects:[Da.of(!1),Ie.scrollIntoView(w.from,{y:"center"})],selection:w}),r.focus()}return{dom:n}}const Da=nt.define(),og=ys.define({create(){return!0},update(r,t){for(let s of t.effects)s.is(Da)&&(r=s.value);return r},provide:r=>Ka.from(r,t=>t?au:null)}),H_=r=>{let t=Ga(r,au);if(!t){let s=[Da.of(!0)];r.state.field(og,!1)==null&&s.push(nt.appendConfig.of([og,G_])),r.dispatch({effects:s}),t=Ga(r,au)}return t&&t.dom.querySelector("input").select(),!0},G_=Ie.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),K_={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Y_=We.define({combine(r){return sn(r,K_,{highlightWordAroundCursor:(t,s)=>t||s,minSelectionLength:Math.min,maxMatches:Math.min})}});function X_(r){return[sE,tE]}const Z_=qe.mark({class:"cm-selectionMatch"}),J_=qe.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function lg(r,t,s,n){return(s==0||r(t.sliceDoc(s-1,s))!=Qt.Word)&&(n==t.doc.length||r(t.sliceDoc(n,n+1))!=Qt.Word)}function eE(r,t,s,n){return r(t.sliceDoc(s,s+1))==Qt.Word&&r(t.sliceDoc(n-1,n))==Qt.Word}const tE=ss.fromClass(class{constructor(r){this.decorations=this.getDeco(r)}update(r){(r.selectionSet||r.docChanged||r.viewportChanged)&&(this.decorations=this.getDeco(r.view))}getDeco(r){let t=r.state.facet(Y_),{state:s}=r,n=s.selection;if(n.ranges.length>1)return qe.none;let i=n.main,a,o=null;if(i.empty){if(!t.highlightWordAroundCursor)return qe.none;let c=s.wordAt(i.head);if(!c)return qe.none;o=s.charCategorizer(i.head),a=s.sliceDoc(c.from,c.to)}else{let c=i.to-i.from;if(c<t.minSelectionLength||c>200)return qe.none;if(t.wholeWords){if(a=s.sliceDoc(i.from,i.to),o=s.charCategorizer(i.head),!(lg(o,s,i.from,i.to)&&eE(o,s,i.from,i.to)))return qe.none}else if(a=s.sliceDoc(i.from,i.to),!a)return qe.none}let l=[];for(let c of r.visibleRanges){let h=new ta(s.doc,a,c.from,c.to);for(;!h.next().done;){let{from:u,to:m}=h.value;if((!o||lg(o,s,u,m))&&(i.empty&&u<=i.from&&m>=i.to?l.push(J_.range(u,m)):(u>=i.to||m<=i.from)&&l.push(Z_.range(u,m)),l.length>t.maxMatches))return qe.none}}return qe.set(l)}},{decorations:r=>r.decorations}),sE=Ie.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),rE=({state:r,dispatch:t})=>{let{selection:s}=r,n=ye.create(s.ranges.map(i=>r.wordAt(i.head)||ye.cursor(i.head)),s.mainIndex);return n.eq(s)?!1:(t(r.update({selection:n})),!0)};function nE(r,t){let{main:s,ranges:n}=r.selection,i=r.wordAt(s.head),a=i&&i.from==s.from&&i.to==s.to;for(let o=!1,l=new ta(r.doc,t,n[n.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new ta(r.doc,t,0,Math.max(0,n[n.length-1].from-1)),o=!0}else{if(o&&n.some(c=>c.from==l.value.from))continue;if(a){let c=r.wordAt(l.value.from);if(!c||c.from!=l.value.from||c.to!=l.value.to)continue}return l.value}}const iE=({state:r,dispatch:t})=>{let{ranges:s}=r.selection;if(s.some(a=>a.from===a.to))return rE({state:r,dispatch:t});let n=r.sliceDoc(s[0].from,s[0].to);if(r.selection.ranges.some(a=>r.sliceDoc(a.from,a.to)!=n))return!1;let i=nE(r,n);return i?(t(r.update({selection:r.selection.addRange(ye.range(i.from,i.to),!1),effects:Ie.scrollIntoView(i.to)})),!0):!1},oa=We.define({combine(r){return sn(r,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:t=>new xE(t),scrollToMatch:t=>Ie.scrollIntoView(t)})}});class Ev{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.literal=!!t.literal,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||q_(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!t.wholeWord}unquote(t){return this.literal?t:t.replace(/\\([nrt\\])/g,(s,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp&&this.wholeWord==t.wholeWord}create(){return this.regexp?new cE(this):new oE(this)}getCursor(t,s=0,n){let i=t.doc?t:bt.create({doc:t});return n==null&&(n=i.doc.length),this.regexp?Ei(this,i,s,n):_i(this,i,s,n)}}class Iv{constructor(t){this.spec=t}}function _i(r,t,s,n){return new ta(t.doc,r.unquoted,s,n,r.caseSensitive?void 0:i=>i.toLowerCase(),r.wholeWord?aE(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}function aE(r,t){return(s,n,i,a)=>((a>s||a+i.length<n)&&(a=Math.max(0,s-2),i=r.sliceString(a,Math.min(r.length,n+2))),(t(sc(i,s-a))!=Qt.Word||t(rc(i,s-a))!=Qt.Word)&&(t(rc(i,n-a))!=Qt.Word||t(sc(i,n-a))!=Qt.Word))}class oE extends Iv{constructor(t){super(t)}nextMatch(t,s,n){let i=_i(this.spec,t,n,t.doc.length).nextOverlapping();if(i.done){let a=Math.min(t.doc.length,s+this.spec.unquoted.length);i=_i(this.spec,t,0,a).nextOverlapping()}return i.done||i.value.from==s&&i.value.to==n?null:i.value}prevMatchInRange(t,s,n){for(let i=n;;){let a=Math.max(s,i-1e4-this.spec.unquoted.length),o=_i(this.spec,t,a,i),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(a==s)return null;i-=1e4}}prevMatch(t,s,n){let i=this.prevMatchInRange(t,0,s);return i||(i=this.prevMatchInRange(t,Math.max(0,n-this.spec.unquoted.length),t.doc.length)),i&&(i.from!=s||i.to!=n)?i:null}getReplacement(t){return this.spec.unquote(this.spec.replace)}matchAll(t,s){let n=_i(this.spec,t,0,t.doc.length),i=[];for(;!n.next().done;){if(i.length>=s)return null;i.push(n.value)}return i}highlight(t,s,n,i){let a=_i(this.spec,t,Math.max(0,s-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,t.doc.length));for(;!a.next().done;)i(a.value.from,a.value.to)}}function Ei(r,t,s,n){return new Pv(t.doc,r.search,{ignoreCase:!r.caseSensitive,test:r.wholeWord?lE(t.charCategorizer(t.selection.main.head)):void 0},s,n)}function sc(r,t){return r.slice(Ss(r,t,!1),t)}function rc(r,t){return r.slice(t,Ss(r,t))}function lE(r){return(t,s,n)=>!n[0].length||(r(sc(n.input,n.index))!=Qt.Word||r(rc(n.input,n.index))!=Qt.Word)&&(r(rc(n.input,n.index+n[0].length))!=Qt.Word||r(sc(n.input,n.index+n[0].length))!=Qt.Word)}class cE extends Iv{nextMatch(t,s,n){let i=Ei(this.spec,t,n,t.doc.length).next();return i.done&&(i=Ei(this.spec,t,0,s).next()),i.done?null:i.value}prevMatchInRange(t,s,n){for(let i=1;;i++){let a=Math.max(s,n-i*1e4),o=Ei(this.spec,t,a,n),l=null;for(;!o.next().done;)l=o.value;if(l&&(a==s||l.from>a+10))return l;if(a==s)return null}}prevMatch(t,s,n){return this.prevMatchInRange(t,0,s)||this.prevMatchInRange(t,n,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(s,n)=>{if(n=="&")return t.match[0];if(n=="$")return"$";for(let i=n.length;i>0;i--){let a=+n.slice(0,i);if(a>0&&a<t.match.length)return t.match[a]+n.slice(i)}return s})}matchAll(t,s){let n=Ei(this.spec,t,0,t.doc.length),i=[];for(;!n.next().done;){if(i.length>=s)return null;i.push(n.value)}return i}highlight(t,s,n,i){let a=Ei(this.spec,t,Math.max(0,s-250),Math.min(n+250,t.doc.length));for(;!a.next().done;)i(a.value.from,a.value.to)}}const Za=nt.define(),Of=nt.define(),Ln=ys.define({create(r){return new Md(ou(r).create(),null)},update(r,t){for(let s of t.effects)s.is(Za)?r=new Md(s.value.create(),r.panel):s.is(Of)&&(r=new Md(r.query,s.value?kf:null));return r},provide:r=>Ka.from(r,t=>t.panel)});class Md{constructor(t,s){this.query=t,this.panel=s}}const dE=qe.mark({class:"cm-searchMatch"}),hE=qe.mark({class:"cm-searchMatch cm-searchMatch-selected"}),uE=ss.fromClass(class{constructor(r){this.view=r,this.decorations=this.highlight(r.state.field(Ln))}update(r){let t=r.state.field(Ln);(t!=r.startState.field(Ln)||r.docChanged||r.selectionSet||r.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:r,panel:t}){if(!t||!r.spec.valid)return qe.none;let{view:s}=this,n=new bn;for(let i=0,a=s.visibleRanges,o=a.length;i<o;i++){let{from:l,to:c}=a[i];for(;i<o-1&&c>a[i+1].from-500;)c=a[++i].to;r.highlight(s.state,l,c,(h,u)=>{let m=s.state.selection.ranges.some(p=>p.from==h&&p.to==u);n.add(h,u,m?hE:dE)})}return n.finish()}},{decorations:r=>r.decorations});function wo(r){return t=>{let s=t.state.field(Ln,!1);return s&&s.query.spec.valid?r(t,s):Mv(t)}}const nc=wo((r,{query:t})=>{let{to:s}=r.state.selection.main,n=t.nextMatch(r.state,s,s);if(!n)return!1;let i=ye.single(n.from,n.to),a=r.state.facet(oa);return r.dispatch({selection:i,effects:[Cf(r,n),a.scrollToMatch(i.main,r)],userEvent:"select.search"}),Rv(r),!0}),ic=wo((r,{query:t})=>{let{state:s}=r,{from:n}=s.selection.main,i=t.prevMatch(s,n,n);if(!i)return!1;let a=ye.single(i.from,i.to),o=r.state.facet(oa);return r.dispatch({selection:a,effects:[Cf(r,i),o.scrollToMatch(a.main,r)],userEvent:"select.search"}),Rv(r),!0}),fE=wo((r,{query:t})=>{let s=t.matchAll(r.state,1e3);return!s||!s.length?!1:(r.dispatch({selection:ye.create(s.map(n=>ye.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),mE=({state:r,dispatch:t})=>{let s=r.selection;if(s.ranges.length>1||s.main.empty)return!1;let{from:n,to:i}=s.main,a=[],o=0;for(let l=new ta(r.doc,r.sliceDoc(n,i));!l.next().done;){if(a.length>1e3)return!1;l.value.from==n&&(o=a.length),a.push(ye.range(l.value.from,l.value.to))}return t(r.update({selection:ye.create(a,o),userEvent:"select.search.matches"})),!0},cg=wo((r,{query:t})=>{let{state:s}=r,{from:n,to:i}=s.selection.main;if(s.readOnly)return!1;let a=t.nextMatch(s,n,n);if(!a)return!1;let o=a,l=[],c,h,u=[];o.from==n&&o.to==i&&(h=s.toText(t.getReplacement(o)),l.push({from:o.from,to:o.to,insert:h}),o=t.nextMatch(s,o.from,o.to),u.push(Ie.announce.of(s.phrase("replaced match on line $",s.doc.lineAt(n).number)+".")));let m=r.state.changes(l);return o&&(c=ye.single(o.from,o.to).map(m),u.push(Cf(r,o)),u.push(s.facet(oa).scrollToMatch(c.main,r))),r.dispatch({changes:m,selection:c,effects:u,userEvent:"input.replace"}),!0}),pE=wo((r,{query:t})=>{if(r.state.readOnly)return!1;let s=t.matchAll(r.state,1e9).map(i=>{let{from:a,to:o}=i;return{from:a,to:o,insert:t.getReplacement(i)}});if(!s.length)return!1;let n=r.state.phrase("replaced $ matches",s.length)+".";return r.dispatch({changes:s,effects:Ie.announce.of(n),userEvent:"input.replace.all"}),!0});function kf(r){return r.state.facet(oa).createPanel(r)}function ou(r,t){var s,n,i,a,o;let l=r.selection.main,c=l.empty||l.to>l.from+100?"":r.sliceDoc(l.from,l.to);if(t&&!c)return t;let h=r.facet(oa);return new Ev({search:((s=t?.literal)!==null&&s!==void 0?s:h.literal)?c:c.replace(/\n/g,"\\n"),caseSensitive:(n=t?.caseSensitive)!==null&&n!==void 0?n:h.caseSensitive,literal:(i=t?.literal)!==null&&i!==void 0?i:h.literal,regexp:(a=t?.regexp)!==null&&a!==void 0?a:h.regexp,wholeWord:(o=t?.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}function Dv(r){let t=Ga(r,kf);return t&&t.dom.querySelector("[main-field]")}function Rv(r){let t=Dv(r);t&&t==r.root.activeElement&&t.select()}const Mv=r=>{let t=r.state.field(Ln,!1);if(t&&t.panel){let s=Dv(r);if(s&&s!=r.root.activeElement){let n=ou(r.state,t.query.spec);n.valid&&r.dispatch({effects:Za.of(n)}),s.focus(),s.select()}}else r.dispatch({effects:[Of.of(!0),t?Za.of(ou(r.state,t.query.spec)):nt.appendConfig.of(jE)]});return!0},Lv=r=>{let t=r.state.field(Ln,!1);if(!t||!t.panel)return!1;let s=Ga(r,kf);return s&&s.dom.contains(r.root.activeElement)&&r.focus(),r.dispatch({effects:Of.of(!1)}),!0},gE=[{key:"Mod-f",run:Mv,scope:"editor search-panel"},{key:"F3",run:nc,shift:ic,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:nc,shift:ic,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Lv,scope:"editor search-panel"},{key:"Mod-Shift-l",run:mE},{key:"Mod-Alt-g",run:H_},{key:"Mod-d",run:iE,preventDefault:!0}];class xE{constructor(t){this.view=t;let s=this.query=t.state.field(Ln).query.spec;this.commit=this.commit.bind(this),this.searchField=_t("input",{value:s.search,placeholder:er(t,"Find"),"aria-label":er(t,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=_t("input",{value:s.replace,placeholder:er(t,"Replace"),"aria-label":er(t,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=_t("input",{type:"checkbox",name:"case",form:"",checked:s.caseSensitive,onchange:this.commit}),this.reField=_t("input",{type:"checkbox",name:"re",form:"",checked:s.regexp,onchange:this.commit}),this.wordField=_t("input",{type:"checkbox",name:"word",form:"",checked:s.wholeWord,onchange:this.commit});function n(i,a,o){return _t("button",{class:"cm-button",name:i,onclick:a,type:"button"},o)}this.dom=_t("div",{onkeydown:i=>this.keydown(i),class:"cm-search"},[this.searchField,n("next",()=>nc(t),[er(t,"next")]),n("prev",()=>ic(t),[er(t,"previous")]),n("select",()=>fE(t),[er(t,"all")]),_t("label",null,[this.caseField,er(t,"match case")]),_t("label",null,[this.reField,er(t,"regexp")]),_t("label",null,[this.wordField,er(t,"by word")]),...t.state.readOnly?[]:[_t("br"),this.replaceField,n("replace",()=>cg(t),[er(t,"replace")]),n("replaceAll",()=>pE(t),[er(t,"replace all")])],_t("button",{name:"close",onclick:()=>Lv(t),"aria-label":er(t,"close"),type:"button"},["×"])])}commit(){let t=new Ev({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:Za.of(t)}))}keydown(t){kA(this.view,t,"search-panel")?t.preventDefault():t.keyCode==13&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?ic:nc)(this.view)):t.keyCode==13&&t.target==this.replaceField&&(t.preventDefault(),cg(this.view))}update(t){for(let s of t.transactions)for(let n of s.effects)n.is(Za)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp,this.wordField.checked=t.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(oa).top}}function er(r,t){return r.state.phrase(t)}const rl=30,nl=/[\s\.,:;?!]/;function Cf(r,{from:t,to:s}){let n=r.state.doc.lineAt(t),i=r.state.doc.lineAt(s).to,a=Math.max(n.from,t-rl),o=Math.min(i,s+rl),l=r.state.sliceDoc(a,o);if(a!=n.from){for(let c=0;c<rl;c++)if(!nl.test(l[c+1])&&nl.test(l[c])){l=l.slice(c);break}}if(o!=i){for(let c=l.length-1;c>l.length-rl;c--)if(!nl.test(l[c-1])&&nl.test(l[c])){l=l.slice(0,c);break}}return Ie.announce.of(`${r.state.phrase("current match")}. ${l} ${r.state.phrase("on line")} ${n.number}.`)}const yE=Ie.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),jE=[Ln,qn.low(uE),yE];class Fv{constructor(t,s,n,i){this.state=t,this.pos=s,this.explicit=n,this.view=i,this.abortListeners=[],this.abortOnDocChange=!1}tokenBefore(t){let s=xs(this.state).resolveInner(this.pos,-1);for(;s&&t.indexOf(s.name)<0;)s=s.parent;return s?{from:s.from,to:this.pos,text:this.state.sliceDoc(s.from,this.pos),type:s.type}:null}matchBefore(t){let s=this.state.doc.lineAt(this.pos),n=Math.max(s.from,this.pos-250),i=s.text.slice(n-s.from,this.pos-s.from),a=i.search(Wv(t,!1));return a<0?null:{from:n+a,to:this.pos,text:i.slice(a)}}get aborted(){return this.abortListeners==null}addEventListener(t,s,n){t=="abort"&&this.abortListeners&&(this.abortListeners.push(s),n&&n.onDocChange&&(this.abortOnDocChange=!0))}}function dg(r){let t=Object.keys(r).join(""),s=/\w/.test(t);return s&&(t=t.replace(/\w/g,"")),`[${s?"\\w":""}${t.replace(/[^\w\s]/g,"\\$&")}]`}function bE(r){let t=Object.create(null),s=Object.create(null);for(let{label:i}of r){t[i[0]]=!0;for(let a=1;a<i.length;a++)s[i[a]]=!0}let n=dg(t)+dg(s)+"*$";return[new RegExp("^"+n),new RegExp(n)]}function Nv(r){let t=r.map(i=>typeof i=="string"?{label:i}:i),[s,n]=t.every(i=>/^\w+$/.test(i.label))?[/\w*$/,/\w+$/]:bE(t);return i=>{let a=i.matchBefore(n);return a||i.explicit?{from:a?a.from:i.pos,options:t,validFor:s}:null}}function vE(r,t){return s=>{for(let n=xs(s.state).resolveInner(s.pos,-1);n;n=n.parent){if(r.indexOf(n.name)>-1)return null;if(n.type.isTop)break}return t(s)}}class hg{constructor(t,s,n,i){this.completion=t,this.source=s,this.match=n,this.score=i}}function li(r){return r.selection.main.from}function Wv(r,t){var s;let{source:n}=r,i=t&&n[0]!="^",a=n[n.length-1]!="$";return!i&&!a?r:new RegExp(`${i?"^":""}(?:${n})${a?"$":""}`,(s=r.flags)!==null&&s!==void 0?s:r.ignoreCase?"i":"")}const Af=tn.define();function wE(r,t,s,n){let{main:i}=r.selection,a=s-i.from,o=n-i.from;return{...r.changeByRange(l=>{if(l!=i&&s!=n&&r.sliceDoc(l.from+a,l.from+o)!=r.sliceDoc(s,n))return{range:l};let c=r.toText(t);return{changes:{from:l.from+a,to:n==i.from?l.to:l.from+o,insert:c},range:ye.cursor(l.from+a+c.length)}}),scrollIntoView:!0,userEvent:"input.complete"}}const ug=new WeakMap;function SE(r){if(!Array.isArray(r))return r;let t=ug.get(r);return t||ug.set(r,t=Nv(r)),t}const ac=nt.define(),Ja=nt.define();class OE{constructor(t){this.pattern=t,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let s=0;s<t.length;){let n=Us(t,s),i=Br(n);this.chars.push(n);let a=t.slice(s,s+i),o=a.toUpperCase();this.folded.push(Us(o==a?a.toLowerCase():o,0)),s+=i}this.astral=t.length!=this.chars.length}ret(t,s){return this.score=t,this.matched=s,this}match(t){if(this.pattern.length==0)return this.ret(-100,[]);if(t.length<this.pattern.length)return null;let{chars:s,folded:n,any:i,precise:a,byWord:o}=this;if(s.length==1){let _=Us(t,0),R=Br(_),E=R==t.length?0:-100;if(_!=s[0])if(_==n[0])E+=-200;else return null;return this.ret(E,[0,R])}let l=t.indexOf(this.pattern);if(l==0)return this.ret(t.length==this.pattern.length?0:-100,[0,this.pattern.length]);let c=s.length,h=0;if(l<0){for(let _=0,R=Math.min(t.length,200);_<R&&h<c;){let E=Us(t,_);(E==s[h]||E==n[h])&&(i[h++]=_),_+=Br(E)}if(h<c)return null}let u=0,m=0,p=!1,x=0,b=-1,w=-1,C=/[a-z]/.test(t),A=!0;for(let _=0,R=Math.min(t.length,200),E=0;_<R&&m<c;){let T=Us(t,_);l<0&&(u<c&&T==s[u]&&(a[u++]=_),x<c&&(T==s[x]||T==n[x]?(x==0&&(b=_),w=_+1,x++):x=0));let M,I=T<255?T>=48&&T<=57||T>=97&&T<=122?2:T>=65&&T<=90?1:0:(M=Zu(T))!=M.toLowerCase()?1:M!=M.toUpperCase()?2:0;(!_||I==1&&C||E==0&&I!=0)&&(s[m]==T||n[m]==T&&(p=!0)?o[m++]=_:o.length&&(A=!1)),E=I,_+=Br(T)}return m==c&&o[0]==0&&A?this.result(-100+(p?-200:0),o,t):x==c&&b==0?this.ret(-200-t.length+(w==t.length?0:-100),[0,w]):l>-1?this.ret(-700-t.length,[l,l+this.pattern.length]):x==c?this.ret(-900-t.length,[b,w]):m==c?this.result(-100+(p?-200:0)+-700+(A?0:-1100),o,t):s.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,t)}result(t,s,n){let i=[],a=0;for(let o of s){let l=o+(this.astral?Br(Us(n,o)):1);a&&i[a-1]==o?i[a-1]=l:(i[a++]=o,i[a++]=l)}return this.ret(t-n.length,i)}}class kE{constructor(t){this.pattern=t,this.matched=[],this.score=0,this.folded=t.toLowerCase()}match(t){if(t.length<this.pattern.length)return null;let s=t.slice(0,this.pattern.length),n=s==this.pattern?0:s.toLowerCase()==this.folded?-200:null;return n==null?null:(this.matched=[0,s.length],this.score=n+(t.length==this.pattern.length?0:-100),this)}}const gs=We.define({combine(r){return sn(r,{activateOnTyping:!0,activateOnCompletion:()=>!1,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:CE,filterStrict:!1,compareCompletions:(t,s)=>t.label.localeCompare(s.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(t,s)=>t&&s,closeOnBlur:(t,s)=>t&&s,icons:(t,s)=>t&&s,tooltipClass:(t,s)=>n=>fg(t(n),s(n)),optionClass:(t,s)=>n=>fg(t(n),s(n)),addToOptions:(t,s)=>t.concat(s),filterStrict:(t,s)=>t||s})}});function fg(r,t){return r?t?r+" "+t:r:t}function CE(r,t,s,n,i,a){let o=r.textDirection==zt.RTL,l=o,c=!1,h="top",u,m,p=t.left-i.left,x=i.right-t.right,b=n.right-n.left,w=n.bottom-n.top;if(l&&p<Math.min(b,x)?l=!1:!l&&x<Math.min(b,p)&&(l=!0),b<=(l?p:x))u=Math.max(i.top,Math.min(s.top,i.bottom-w))-t.top,m=Math.min(400,l?p:x);else{c=!0,m=Math.min(400,(o?t.right:i.right-t.left)-30);let _=i.bottom-t.bottom;_>=w||_>t.top?u=s.bottom-t.top:(h="bottom",u=t.bottom-s.top)}let C=(t.bottom-t.top)/a.offsetHeight,A=(t.right-t.left)/a.offsetWidth;return{style:`${h}: ${u/C}px; max-width: ${m/A}px`,class:"cm-completionInfo-"+(c?o?"left-narrow":"right-narrow":l?"left":"right")}}function AE(r){let t=r.addToOptions.slice();return r.icons&&t.push({render(s){let n=document.createElement("div");return n.classList.add("cm-completionIcon"),s.type&&n.classList.add(...s.type.split(/\s+/g).map(i=>"cm-completionIcon-"+i)),n.setAttribute("aria-hidden","true"),n},position:20}),t.push({render(s,n,i,a){let o=document.createElement("span");o.className="cm-completionLabel";let l=s.displayLabel||s.label,c=0;for(let h=0;h<a.length;){let u=a[h++],m=a[h++];u>c&&o.appendChild(document.createTextNode(l.slice(c,u)));let p=o.appendChild(document.createElement("span"));p.appendChild(document.createTextNode(l.slice(u,m))),p.className="cm-completionMatchedText",c=m}return c<l.length&&o.appendChild(document.createTextNode(l.slice(c))),o},position:50},{render(s){if(!s.detail)return null;let n=document.createElement("span");return n.className="cm-completionDetail",n.textContent=s.detail,n},position:80}),t.sort((s,n)=>s.position-n.position).map(s=>s.render)}function Ld(r,t,s){if(r<=s)return{from:0,to:r};if(t<0&&(t=0),t<=r>>1){let i=Math.floor(t/s);return{from:i*s,to:(i+1)*s}}let n=Math.floor((r-t)/s);return{from:r-(n+1)*s,to:r-n*s}}class TE{constructor(t,s,n){this.view=t,this.stateField=s,this.applyCompletion=n,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:c=>this.placeInfo(c),key:this},this.space=null,this.currentClass="";let i=t.state.field(s),{options:a,selected:o}=i.open,l=t.state.facet(gs);this.optionContent=AE(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=Ld(a.length,o,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(t.state),this.dom.addEventListener("mousedown",c=>{let{options:h}=t.state.field(s).open;for(let u=c.target,m;u&&u!=this.dom;u=u.parentNode)if(u.nodeName=="LI"&&(m=/-(\d+)$/.exec(u.id))&&+m[1]<h.length){this.applyCompletion(t,h[+m[1]]),c.preventDefault();return}}),this.dom.addEventListener("focusout",c=>{let h=t.state.field(this.stateField,!1);h&&h.tooltip&&t.state.facet(gs).closeOnBlur&&c.relatedTarget!=t.contentDOM&&t.dispatch({effects:Ja.of(null)})}),this.showOptions(a,i.id)}mount(){this.updateSel()}showOptions(t,s){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(t,s,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(t){var s;let n=t.state.field(this.stateField),i=t.startState.field(this.stateField);if(this.updateTooltipClass(t.state),n!=i){let{options:a,selected:o,disabled:l}=n.open;(!i.open||i.open.options!=a)&&(this.range=Ld(a.length,o,t.state.facet(gs).maxRenderedOptions),this.showOptions(a,n.id)),this.updateSel(),l!=((s=i.open)===null||s===void 0?void 0:s.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(t){let s=this.tooltipClass(t);if(s!=this.currentClass){for(let n of this.currentClass.split(" "))n&&this.dom.classList.remove(n);for(let n of s.split(" "))n&&this.dom.classList.add(n);this.currentClass=s}}positioned(t){this.space=t,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let t=this.view.state.field(this.stateField),s=t.open;if((s.selected>-1&&s.selected<this.range.from||s.selected>=this.range.to)&&(this.range=Ld(s.options.length,s.selected,this.view.state.facet(gs).maxRenderedOptions),this.showOptions(s.options,t.id)),this.updateSelectedOption(s.selected)){this.destroyInfo();let{completion:n}=s.options[s.selected],{info:i}=n;if(!i)return;let a=typeof i=="string"?document.createTextNode(i):i(n);if(!a)return;"then"in a?a.then(o=>{o&&this.view.state.field(this.stateField,!1)==t&&this.addInfoPane(o,n)}).catch(o=>Hs(this.view.state,o,"completion info")):this.addInfoPane(a,n)}}addInfoPane(t,s){this.destroyInfo();let n=this.info=document.createElement("div");if(n.className="cm-tooltip cm-completionInfo",t.nodeType!=null)n.appendChild(t),this.infoDestroy=null;else{let{dom:i,destroy:a}=t;n.appendChild(i),this.infoDestroy=a||null}this.dom.appendChild(n),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(t){let s=null;for(let n=this.list.firstChild,i=this.range.from;n;n=n.nextSibling,i++)n.nodeName!="LI"||!n.id?i--:i==t?n.hasAttribute("aria-selected")||(n.setAttribute("aria-selected","true"),s=n):n.hasAttribute("aria-selected")&&n.removeAttribute("aria-selected");return s&&_E(this.list,s),s}measureInfo(){let t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;let s=this.dom.getBoundingClientRect(),n=this.info.getBoundingClientRect(),i=t.getBoundingClientRect(),a=this.space;if(!a){let o=this.dom.ownerDocument.documentElement;a={left:0,top:0,right:o.clientWidth,bottom:o.clientHeight}}return i.top>Math.min(a.bottom,s.bottom)-10||i.bottom<Math.max(a.top,s.top)+10?null:this.view.state.facet(gs).positionInfo(this.view,s,i,n,a,this.dom)}placeInfo(t){this.info&&(t?(t.style&&(this.info.style.cssText=t.style),this.info.className="cm-tooltip cm-completionInfo "+(t.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(t,s,n){const i=document.createElement("ul");i.id=s,i.setAttribute("role","listbox"),i.setAttribute("aria-expanded","true"),i.setAttribute("aria-label",this.view.state.phrase("Completions")),i.addEventListener("mousedown",o=>{o.target==i&&o.preventDefault()});let a=null;for(let o=n.from;o<n.to;o++){let{completion:l,match:c}=t[o],{section:h}=l;if(h){let p=typeof h=="string"?h:h.name;if(p!=a&&(o>n.from||n.from==0))if(a=p,typeof h!="string"&&h.header)i.appendChild(h.header(h));else{let x=i.appendChild(document.createElement("completion-section"));x.textContent=p}}const u=i.appendChild(document.createElement("li"));u.id=s+"-"+o,u.setAttribute("role","option");let m=this.optionClass(l);m&&(u.className=m);for(let p of this.optionContent){let x=p(l,this.view.state,this.view,c);x&&u.appendChild(x)}}return n.from&&i.classList.add("cm-completionListIncompleteTop"),n.to<t.length&&i.classList.add("cm-completionListIncompleteBottom"),i}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function PE(r,t){return s=>new TE(s,r,t)}function _E(r,t){let s=r.getBoundingClientRect(),n=t.getBoundingClientRect(),i=s.height/r.offsetHeight;n.top<s.top?r.scrollTop-=(s.top-n.top)/i:n.bottom>s.bottom&&(r.scrollTop+=(n.bottom-s.bottom)/i)}function mg(r){return(r.boost||0)*100+(r.apply?10:0)+(r.info?5:0)+(r.type?1:0)}function EE(r,t){let s=[],n=null,i=h=>{s.push(h);let{section:u}=h.completion;if(u){n||(n=[]);let m=typeof u=="string"?u:u.name;n.some(p=>p.name==m)||n.push(typeof u=="string"?{name:m}:u)}},a=t.facet(gs);for(let h of r)if(h.hasResult()){let u=h.result.getMatch;if(h.result.filter===!1)for(let m of h.result.options)i(new hg(m,h.source,u?u(m):[],1e9-s.length));else{let m=t.sliceDoc(h.from,h.to),p,x=a.filterStrict?new kE(m):new OE(m);for(let b of h.result.options)if(p=x.match(b.label)){let w=b.displayLabel?u?u(b,p.matched):[]:p.matched;i(new hg(b,h.source,w,p.score+(b.boost||0)))}}}if(n){let h=Object.create(null),u=0,m=(p,x)=>{var b,w;return((b=p.rank)!==null&&b!==void 0?b:1e9)-((w=x.rank)!==null&&w!==void 0?w:1e9)||(p.name<x.name?-1:1)};for(let p of n.sort(m))u-=1e5,h[p.name]=u;for(let p of s){let{section:x}=p.completion;x&&(p.score+=h[typeof x=="string"?x:x.name])}}let o=[],l=null,c=a.compareCompletions;for(let h of s.sort((u,m)=>m.score-u.score||c(u.completion,m.completion))){let u=h.completion;!l||l.label!=u.label||l.detail!=u.detail||l.type!=null&&u.type!=null&&l.type!=u.type||l.apply!=u.apply||l.boost!=u.boost?o.push(h):mg(h.completion)>mg(l)&&(o[o.length-1]=h),l=h.completion}return o}class Li{constructor(t,s,n,i,a,o){this.options=t,this.attrs=s,this.tooltip=n,this.timestamp=i,this.selected=a,this.disabled=o}setSelected(t,s){return t==this.selected||t>=this.options.length?this:new Li(this.options,pg(s,t),this.tooltip,this.timestamp,t,this.disabled)}static build(t,s,n,i,a,o){if(i&&!o&&t.some(h=>h.isPending))return i.setDisabled();let l=EE(t,s);if(!l.length)return i&&t.some(h=>h.isPending)?i.setDisabled():null;let c=s.facet(gs).selectOnOpen?0:-1;if(i&&i.selected!=c&&i.selected!=-1){let h=i.options[i.selected].completion;for(let u=0;u<l.length;u++)if(l[u].completion==h){c=u;break}}return new Li(l,pg(n,c),{pos:t.reduce((h,u)=>u.hasResult()?Math.min(h,u.from):h,1e8),create:FE,above:a.aboveCursor},i?i.timestamp:Date.now(),c,!1)}map(t){return new Li(this.options,this.attrs,{...this.tooltip,pos:t.mapPos(this.tooltip.pos)},this.timestamp,this.selected,this.disabled)}setDisabled(){return new Li(this.options,this.attrs,this.tooltip,this.timestamp,this.selected,!0)}}class oc{constructor(t,s,n){this.active=t,this.id=s,this.open=n}static start(){return new oc(ME,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(t){let{state:s}=t,n=s.facet(gs),a=(n.override||s.languageDataAt("autocomplete",li(s)).map(SE)).map(c=>(this.active.find(u=>u.source==c)||new gr(c,this.active.some(u=>u.state!=0)?1:0)).update(t,n));a.length==this.active.length&&a.every((c,h)=>c==this.active[h])&&(a=this.active);let o=this.open,l=t.effects.some(c=>c.is(Tf));o&&t.docChanged&&(o=o.map(t.changes)),t.selection||a.some(c=>c.hasResult()&&t.changes.touchesRange(c.from,c.to))||!IE(a,this.active)||l?o=Li.build(a,s,this.id,o,n,l):o&&o.disabled&&!a.some(c=>c.isPending)&&(o=null),!o&&a.every(c=>!c.isPending)&&a.some(c=>c.hasResult())&&(a=a.map(c=>c.hasResult()?new gr(c.source,0):c));for(let c of t.effects)c.is(Vv)&&(o=o&&o.setSelected(c.value,this.id));return a==this.active&&o==this.open?this:new oc(a,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:this.active.length?DE:RE}}function IE(r,t){if(r==t)return!0;for(let s=0,n=0;;){for(;s<r.length&&!r[s].hasResult();)s++;for(;n<t.length&&!t[n].hasResult();)n++;let i=s==r.length,a=n==t.length;if(i||a)return i==a;if(r[s++].result!=t[n++].result)return!1}}const DE={"aria-autocomplete":"list"},RE={};function pg(r,t){let s={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":r};return t>-1&&(s["aria-activedescendant"]=r+"-"+t),s}const ME=[];function $v(r,t){if(r.isUserEvent("input.complete")){let n=r.annotation(Af);if(n&&t.activateOnCompletion(n))return 12}let s=r.isUserEvent("input.type");return s&&t.activateOnTyping?5:s?1:r.isUserEvent("delete.backward")?2:r.selection?8:r.docChanged?16:0}class gr{constructor(t,s,n=!1){this.source=t,this.state=s,this.explicit=n}hasResult(){return!1}get isPending(){return this.state==1}update(t,s){let n=$v(t,s),i=this;(n&8||n&16&&this.touches(t))&&(i=new gr(i.source,0)),n&4&&i.state==0&&(i=new gr(this.source,1)),i=i.updateFor(t,n);for(let a of t.effects)if(a.is(ac))i=new gr(i.source,1,a.value);else if(a.is(Ja))i=new gr(i.source,0);else if(a.is(Tf))for(let o of a.value)o.source==i.source&&(i=o);return i}updateFor(t,s){return this.map(t.changes)}map(t){return this}touches(t){return t.changes.touchesRange(li(t.state))}}class Bi extends gr{constructor(t,s,n,i,a,o){super(t,3,s),this.limit=n,this.result=i,this.from=a,this.to=o}hasResult(){return!0}updateFor(t,s){var n;if(!(s&3))return this.map(t.changes);let i=this.result;i.map&&!t.changes.empty&&(i=i.map(i,t.changes));let a=t.changes.mapPos(this.from),o=t.changes.mapPos(this.to,1),l=li(t.state);if(l>o||!i||s&2&&(li(t.startState)==this.from||l<this.limit))return new gr(this.source,s&4?1:0);let c=t.changes.mapPos(this.limit);return LE(i.validFor,t.state,a,o)?new Bi(this.source,this.explicit,c,i,a,o):i.update&&(i=i.update(i,a,o,new Fv(t.state,l,!1)))?new Bi(this.source,this.explicit,c,i,i.from,(n=i.to)!==null&&n!==void 0?n:li(t.state)):new gr(this.source,1,this.explicit)}map(t){return t.empty?this:(this.result.map?this.result.map(this.result,t):this.result)?new Bi(this.source,this.explicit,t.mapPos(this.limit),this.result,t.mapPos(this.from),t.mapPos(this.to,1)):new gr(this.source,0)}touches(t){return t.changes.touchesRange(this.from,this.to)}}function LE(r,t,s,n){if(!r)return!1;let i=t.sliceDoc(s,n);return typeof r=="function"?r(i,s,n,t):Wv(r,!0).test(i)}const Tf=nt.define({map(r,t){return r.map(s=>s.map(t))}}),Vv=nt.define(),qs=ys.define({create(){return oc.start()},update(r,t){return r.update(t)},provide:r=>[ff.from(r,t=>t.tooltip),Ie.contentAttributes.from(r,t=>t.attrs)]});function Pf(r,t){const s=t.completion.apply||t.completion.label;let n=r.state.field(qs).active.find(i=>i.source==t.source);return n instanceof Bi?(typeof s=="string"?r.dispatch({...wE(r.state,s,n.from,n.to),annotations:Af.of(t.completion)}):s(r,t.completion,n.from,n.to),!0):!1}const FE=PE(qs,Pf);function il(r,t="option"){return s=>{let n=s.state.field(qs,!1);if(!n||!n.open||n.open.disabled||Date.now()-n.open.timestamp<s.state.facet(gs).interactionDelay)return!1;let i=1,a;t=="page"&&(a=v0(s,n.open.tooltip))&&(i=Math.max(2,Math.floor(a.dom.offsetHeight/a.dom.querySelector("li").offsetHeight)-1));let{length:o}=n.open.options,l=n.open.selected>-1?n.open.selected+i*(r?1:-1):r?0:o-1;return l<0?l=t=="page"?0:o-1:l>=o&&(l=t=="page"?o-1:0),s.dispatch({effects:Vv.of(l)}),!0}}const NE=r=>{let t=r.state.field(qs,!1);return r.state.readOnly||!t||!t.open||t.open.selected<0||t.open.disabled||Date.now()-t.open.timestamp<r.state.facet(gs).interactionDelay?!1:Pf(r,t.open.options[t.open.selected])},Fd=r=>r.state.field(qs,!1)?(r.dispatch({effects:ac.of(!0)}),!0):!1,WE=r=>{let t=r.state.field(qs,!1);return!t||!t.active.some(s=>s.state!=0)?!1:(r.dispatch({effects:Ja.of(null)}),!0)};class $E{constructor(t,s){this.active=t,this.context=s,this.time=Date.now(),this.updates=[],this.done=void 0}}const VE=50,zE=1e3,BE=ss.fromClass(class{constructor(r){this.view=r,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let t of r.state.field(qs).active)t.isPending&&this.startQuery(t)}update(r){let t=r.state.field(qs),s=r.state.facet(gs);if(!r.selectionSet&&!r.docChanged&&r.startState.field(qs)==t)return;let n=r.transactions.some(a=>{let o=$v(a,s);return o&8||(a.selection||a.docChanged)&&!(o&3)});for(let a=0;a<this.running.length;a++){let o=this.running[a];if(n||o.context.abortOnDocChange&&r.docChanged||o.updates.length+r.transactions.length>VE&&Date.now()-o.time>zE){for(let l of o.context.abortListeners)try{l()}catch(c){Hs(this.view.state,c)}o.context.abortListeners=null,this.running.splice(a--,1)}else o.updates.push(...r.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),r.transactions.some(a=>a.effects.some(o=>o.is(ac)))&&(this.pendingStart=!0);let i=this.pendingStart?50:s.activateOnTypingDelay;if(this.debounceUpdate=t.active.some(a=>a.isPending&&!this.running.some(o=>o.active.source==a.source))?setTimeout(()=>this.startUpdate(),i):-1,this.composing!=0)for(let a of r.transactions)a.isUserEvent("input.type")?this.composing=2:this.composing==2&&a.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:r}=this.view,t=r.field(qs);for(let s of t.active)s.isPending&&!this.running.some(n=>n.active.source==s.source)&&this.startQuery(s);this.running.length&&t.open&&t.open.disabled&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(gs).updateSyncTime))}startQuery(r){let{state:t}=this.view,s=li(t),n=new Fv(t,s,r.explicit,this.view),i=new $E(r,n);this.running.push(i),Promise.resolve(r.source(n)).then(a=>{i.context.aborted||(i.done=a||null,this.scheduleAccept())},a=>{this.view.dispatch({effects:Ja.of(null)}),Hs(this.view.state,a)})}scheduleAccept(){this.running.every(r=>r.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(gs).updateSyncTime))}accept(){var r;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let t=[],s=this.view.state.facet(gs),n=this.view.state.field(qs);for(let i=0;i<this.running.length;i++){let a=this.running[i];if(a.done===void 0)continue;if(this.running.splice(i--,1),a.done){let l=li(a.updates.length?a.updates[0].startState:this.view.state),c=Math.min(l,a.done.from+(a.active.explicit?0:1)),h=new Bi(a.active.source,a.active.explicit,c,a.done,a.done.from,(r=a.done.to)!==null&&r!==void 0?r:l);for(let u of a.updates)h=h.update(u,s);if(h.hasResult()){t.push(h);continue}}let o=n.active.find(l=>l.source==a.active.source);if(o&&o.isPending)if(a.done==null){let l=new gr(a.active.source,0);for(let c of a.updates)l=l.update(c,s);l.isPending||t.push(l)}else this.startQuery(o)}(t.length||n.open&&n.open.disabled)&&this.view.dispatch({effects:Tf.of(t)})}},{eventHandlers:{blur(r){let t=this.view.state.field(qs,!1);if(t&&t.tooltip&&this.view.state.facet(gs).closeOnBlur){let s=t.open&&v0(this.view,t.open.tooltip);(!s||!s.dom.contains(r.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:Ja.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:ac.of(!1)}),20),this.composing=0}}}),UE=typeof navigator=="object"&&/Win/.test(navigator.platform),QE=qn.highest(Ie.domEventHandlers({keydown(r,t){let s=t.state.field(qs,!1);if(!s||!s.open||s.open.disabled||s.open.selected<0||r.key.length>1||r.ctrlKey&&!(UE&&r.altKey)||r.metaKey)return!1;let n=s.open.options[s.open.selected],i=s.active.find(o=>o.source==n.source),a=n.completion.commitCharacters||i.result.commitCharacters;return a&&a.indexOf(r.key)>-1&&Pf(t,n),!1}})),zv=Ie.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class qE{constructor(t,s,n,i){this.field=t,this.line=s,this.from=n,this.to=i}}class _f{constructor(t,s,n){this.field=t,this.from=s,this.to=n}map(t){let s=t.mapPos(this.from,-1,ws.TrackDel),n=t.mapPos(this.to,1,ws.TrackDel);return s==null||n==null?null:new _f(this.field,s,n)}}class Ef{constructor(t,s){this.lines=t,this.fieldPositions=s}instantiate(t,s){let n=[],i=[s],a=t.doc.lineAt(s),o=/^\s*/.exec(a.text)[0];for(let c of this.lines){if(n.length){let h=o,u=/^\t*/.exec(c)[0].length;for(let m=0;m<u;m++)h+=t.facet(yo);i.push(s+h.length-u),c=h+c.slice(u)}n.push(c),s+=c.length+1}let l=this.fieldPositions.map(c=>new _f(c.field,i[c.line]+c.from,i[c.line]+c.to));return{text:n,ranges:l}}static parse(t){let s=[],n=[],i=[],a;for(let o of t.split(/\r\n?|\n/)){for(;a=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(o);){let l=a[1]?+a[1]:null,c=a[2]||a[3]||"",h=-1,u=c.replace(/\\[{}]/g,m=>m[1]);for(let m=0;m<s.length;m++)(l!=null?s[m].seq==l:u&&s[m].name==u)&&(h=m);if(h<0){let m=0;for(;m<s.length&&(l==null||s[m].seq!=null&&s[m].seq<l);)m++;s.splice(m,0,{seq:l,name:u}),h=m;for(let p of i)p.field>=h&&p.field++}for(let m of i)if(m.line==n.length&&m.from>a.index){let p=a[2]?3+(a[1]||"").length:2;m.from-=p,m.to-=p}i.push(new qE(h,n.length,a.index,a.index+u.length)),o=o.slice(0,a.index)+c+o.slice(a.index+a[0].length)}o=o.replace(/\\([{}])/g,(l,c,h)=>{for(let u of i)u.line==n.length&&u.from>h&&(u.from--,u.to--);return c}),n.push(o)}return new Ef(n,i)}}let HE=qe.widget({widget:new class extends rn{toDOM(){let r=document.createElement("span");return r.className="cm-snippetFieldPosition",r}ignoreEvent(){return!1}}}),GE=qe.mark({class:"cm-snippetField"});class la{constructor(t,s){this.ranges=t,this.active=s,this.deco=qe.set(t.map(n=>(n.from==n.to?HE:GE).range(n.from,n.to)),!0)}map(t){let s=[];for(let n of this.ranges){let i=n.map(t);if(!i)return null;s.push(i)}return new la(s,this.active)}selectionInsideField(t){return t.ranges.every(s=>this.ranges.some(n=>n.field==this.active&&n.from<=s.from&&n.to>=s.to))}}const So=nt.define({map(r,t){return r&&r.map(t)}}),KE=nt.define(),eo=ys.define({create(){return null},update(r,t){for(let s of t.effects){if(s.is(So))return s.value;if(s.is(KE)&&r)return new la(r.ranges,s.value)}return r&&t.docChanged&&(r=r.map(t.changes)),r&&t.selection&&!r.selectionInsideField(t.selection)&&(r=null),r},provide:r=>Ie.decorations.from(r,t=>t?t.deco:qe.none)});function If(r,t){return ye.create(r.filter(s=>s.field==t).map(s=>ye.range(s.from,s.to)))}function YE(r){let t=Ef.parse(r);return(s,n,i,a)=>{let{text:o,ranges:l}=t.instantiate(s.state,i),{main:c}=s.state.selection,h={changes:{from:i,to:a==c.from?c.to:a,insert:wt.of(o)},scrollIntoView:!0,annotations:n?[Af.of(n),ls.userEvent.of("input.complete")]:void 0};if(l.length&&(h.selection=If(l,0)),l.some(u=>u.field>0)){let u=new la(l,0),m=h.effects=[So.of(u)];s.state.field(eo,!1)===void 0&&m.push(nt.appendConfig.of([eo,tI,sI,zv]))}s.dispatch(s.state.update(h))}}function Bv(r){return({state:t,dispatch:s})=>{let n=t.field(eo,!1);if(!n||r<0&&n.active==0)return!1;let i=n.active+r,a=r>0&&!n.ranges.some(o=>o.field==i+r);return s(t.update({selection:If(n.ranges,i),effects:So.of(a?null:new la(n.ranges,i)),scrollIntoView:!0})),!0}}const XE=({state:r,dispatch:t})=>r.field(eo,!1)?(t(r.update({effects:So.of(null)})),!0):!1,ZE=Bv(1),JE=Bv(-1),eI=[{key:"Tab",run:ZE,shift:JE},{key:"Escape",run:XE}],gg=We.define({combine(r){return r.length?r[0]:eI}}),tI=qn.highest(go.compute([gg],r=>r.facet(gg)));function on(r,t){return{...t,apply:YE(r)}}const sI=Ie.domEventHandlers({mousedown(r,t){let s=t.state.field(eo,!1),n;if(!s||(n=t.posAtCoords({x:r.clientX,y:r.clientY}))==null)return!1;let i=s.ranges.find(a=>a.from<=n&&a.to>=n);return!i||i.field==s.active?!1:(t.dispatch({selection:If(s.ranges,i.field),effects:So.of(s.ranges.some(a=>a.field>i.field)?new la(s.ranges,i.field):null),scrollIntoView:!0}),!0)}}),to={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},ni=nt.define({map(r,t){let s=t.mapPos(r,-1,ws.TrackAfter);return s??void 0}}),Df=new class extends ui{};Df.startSide=1;Df.endSide=-1;const Uv=ys.define({create(){return Ot.empty},update(r,t){if(r=r.map(t.changes),t.selection){let s=t.state.doc.lineAt(t.selection.main.head);r=r.update({filter:n=>n>=s.from&&n<=s.to})}for(let s of t.effects)s.is(ni)&&(r=r.update({add:[Df.range(s.value,s.value+1)]}));return r}});function rI(){return[iI,Uv]}const Nd="()[]{}<>«»»«［］｛｝";function Qv(r){for(let t=0;t<Nd.length;t+=2)if(Nd.charCodeAt(t)==r)return Nd.charAt(t+1);return Zu(r<128?r:r+1)}function qv(r,t){return r.languageDataAt("closeBrackets",t)[0]||to}const nI=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),iI=Ie.inputHandler.of((r,t,s,n)=>{if((nI?r.composing:r.compositionStarted)||r.state.readOnly)return!1;let i=r.state.selection.main;if(n.length>2||n.length==2&&Br(Us(n,0))==1||t!=i.from||s!=i.to)return!1;let a=lI(r.state,n);return a?(r.dispatch(a),!0):!1}),aI=({state:r,dispatch:t})=>{if(r.readOnly)return!1;let n=qv(r,r.selection.main.head).brackets||to.brackets,i=null,a=r.changeByRange(o=>{if(o.empty){let l=cI(r.doc,o.head);for(let c of n)if(c==l&&Fc(r.doc,o.head)==Qv(Us(c,0)))return{changes:{from:o.head-c.length,to:o.head+c.length},range:ye.cursor(o.head-c.length)}}return{range:i=o}});return i||t(r.update(a,{scrollIntoView:!0,userEvent:"delete.backward"})),!i},oI=[{key:"Backspace",run:aI}];function lI(r,t){let s=qv(r,r.selection.main.head),n=s.brackets||to.brackets;for(let i of n){let a=Qv(Us(i,0));if(t==i)return a==i?uI(r,i,n.indexOf(i+i+i)>-1,s):dI(r,i,a,s.before||to.before);if(t==a&&Hv(r,r.selection.main.from))return hI(r,i,a)}return null}function Hv(r,t){let s=!1;return r.field(Uv).between(0,r.doc.length,n=>{n==t&&(s=!0)}),s}function Fc(r,t){let s=r.sliceString(t,t+2);return s.slice(0,Br(Us(s,0)))}function cI(r,t){let s=r.sliceString(t-2,t);return Br(Us(s,0))==s.length?s:s.slice(1)}function dI(r,t,s,n){let i=null,a=r.changeByRange(o=>{if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:s,from:o.to}],effects:ni.of(o.to+t.length),range:ye.range(o.anchor+t.length,o.head+t.length)};let l=Fc(r.doc,o.head);return!l||/\s/.test(l)||n.indexOf(l)>-1?{changes:{insert:t+s,from:o.head},effects:ni.of(o.head+t.length),range:ye.cursor(o.head+t.length)}:{range:i=o}});return i?null:r.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function hI(r,t,s){let n=null,i=r.changeByRange(a=>a.empty&&Fc(r.doc,a.head)==s?{changes:{from:a.head,to:a.head+s.length,insert:s},range:ye.cursor(a.head+s.length)}:n={range:a});return n?null:r.update(i,{scrollIntoView:!0,userEvent:"input.type"})}function uI(r,t,s,n){let i=n.stringPrefixes||to.stringPrefixes,a=null,o=r.changeByRange(l=>{if(!l.empty)return{changes:[{insert:t,from:l.from},{insert:t,from:l.to}],effects:ni.of(l.to+t.length),range:ye.range(l.anchor+t.length,l.head+t.length)};let c=l.head,h=Fc(r.doc,c),u;if(h==t){if(xg(r,c))return{changes:{insert:t+t,from:c},effects:ni.of(c+t.length),range:ye.cursor(c+t.length)};if(Hv(r,c)){let p=s&&r.sliceDoc(c,c+t.length*3)==t+t+t?t+t+t:t;return{changes:{from:c,to:c+p.length,insert:p},range:ye.cursor(c+p.length)}}}else{if(s&&r.sliceDoc(c-2*t.length,c)==t+t&&(u=yg(r,c-2*t.length,i))>-1&&xg(r,u))return{changes:{insert:t+t+t+t,from:c},effects:ni.of(c+t.length),range:ye.cursor(c+t.length)};if(r.charCategorizer(c)(h)!=Qt.Word&&yg(r,c,i)>-1&&!fI(r,c,t,i))return{changes:{insert:t+t,from:c},effects:ni.of(c+t.length),range:ye.cursor(c+t.length)}}return{range:a=l}});return a?null:r.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function xg(r,t){let s=xs(r).resolveInner(t+1);return s.parent&&s.from==t}function fI(r,t,s,n){let i=xs(r).resolveInner(t,-1),a=n.reduce((o,l)=>Math.max(o,l.length),0);for(let o=0;o<5;o++){let l=r.sliceDoc(i.from,Math.min(i.to,i.from+s.length+a)),c=l.indexOf(s);if(!c||c>-1&&n.indexOf(l.slice(0,c))>-1){let u=i.firstChild;for(;u&&u.from==i.from&&u.to-u.from>s.length+c;){if(r.sliceDoc(u.to-s.length,u.to)==s)return!1;u=u.firstChild}return!0}let h=i.to==t&&i.parent;if(!h)break;i=h}return!1}function yg(r,t,s){let n=r.charCategorizer(t);if(n(r.sliceDoc(t-1,t))!=Qt.Word)return t;for(let i of s){let a=t-i.length;if(r.sliceDoc(a,t)==i&&n(r.sliceDoc(a-1,a))!=Qt.Word)return a}return-1}function mI(r={}){return[QE,qs,gs.of(r),BE,pI,zv]}const Gv=[{key:"Ctrl-Space",run:Fd},{mac:"Alt-`",run:Fd},{mac:"Alt-i",run:Fd},{key:"Escape",run:WE},{key:"ArrowDown",run:il(!0)},{key:"ArrowUp",run:il(!1)},{key:"PageDown",run:il(!0,"page")},{key:"PageUp",run:il(!1,"page")},{key:"Enter",run:NE}],pI=qn.highest(go.computeN([gs],r=>r.facet(gs).defaultKeymap?[Gv]:[]));class jg{constructor(t,s,n){this.from=t,this.to=s,this.diagnostic=n}}class ti{constructor(t,s,n){this.diagnostics=t,this.panel=s,this.selected=n}static init(t,s,n){let i=n.facet(so).markerFilter;i&&(t=i(t,n));let a=t.slice().sort((u,m)=>u.from-m.from||u.to-m.to),o=new bn,l=[],c=0;for(let u=0;;){let m=u==a.length?null:a[u];if(!m&&!l.length)break;let p,x;for(l.length?(p=c,x=l.reduce((w,C)=>Math.min(w,C.to),m&&m.from>p?m.from:1e8)):(p=m.from,x=m.to,l.push(m),u++);u<a.length;){let w=a[u];if(w.from==p&&(w.to>w.from||w.to==p))l.push(w),u++,x=Math.min(w.to,x);else{x=Math.min(w.from,x);break}}let b=TI(l);if(l.some(w=>w.from==w.to||w.from==w.to-1&&n.doc.lineAt(w.from).to==w.from))o.add(p,p,qe.widget({widget:new OI(b),diagnostics:l.slice()}));else{let w=l.reduce((C,A)=>A.markClass?C+" "+A.markClass:C,"");o.add(p,x,qe.mark({class:"cm-lintRange cm-lintRange-"+b+w,diagnostics:l.slice(),inclusiveEnd:l.some(C=>C.to>x)}))}c=x;for(let w=0;w<l.length;w++)l[w].to<=c&&l.splice(w--,1)}let h=o.finish();return new ti(h,s,sa(h))}}function sa(r,t=null,s=0){let n=null;return r.between(s,1e9,(i,a,{spec:o})=>{if(!(t&&o.diagnostics.indexOf(t)<0))if(!n)n=new jg(i,a,t||o.diagnostics[0]);else{if(o.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new jg(n.from,a,n.diagnostic)}}),n}function gI(r,t){let s=t.pos,n=t.end||s,i=r.state.facet(so).hideOn(r,s,n);if(i!=null)return i;let a=r.startState.doc.lineAt(t.pos);return!!(r.effects.some(o=>o.is(Kv))||r.changes.touchesRange(a.from,Math.max(a.to,n)))}function xI(r,t){return r.field(ir,!1)?t:t.concat(nt.appendConfig.of(PI))}const Kv=nt.define(),Rf=nt.define(),Yv=nt.define(),ir=ys.define({create(){return new ti(qe.none,null,null)},update(r,t){if(t.docChanged&&r.diagnostics.size){let s=r.diagnostics.map(t.changes),n=null,i=r.panel;if(r.selected){let a=t.changes.mapPos(r.selected.from,1);n=sa(s,r.selected.diagnostic,a)||sa(s,null,a)}!s.size&&i&&t.state.facet(so).autoPanel&&(i=null),r=new ti(s,i,n)}for(let s of t.effects)if(s.is(Kv)){let n=t.state.facet(so).autoPanel?s.value.length?ro.open:null:r.panel;r=ti.init(s.value,n,t.state)}else s.is(Rf)?r=new ti(r.diagnostics,s.value?ro.open:null,r.selected):s.is(Yv)&&(r=new ti(r.diagnostics,r.panel,s.value));return r},provide:r=>[Ka.from(r,t=>t.panel),Ie.decorations.from(r,t=>t.diagnostics)]}),yI=qe.mark({class:"cm-lintRange cm-lintRange-active"});function jI(r,t,s){let{diagnostics:n}=r.state.field(ir),i,a=-1,o=-1;n.between(t-(s<0?1:0),t+(s>0?1:0),(c,h,{spec:u})=>{if(t>=c&&t<=h&&(c==h||(t>c||s>0)&&(t<h||s<0)))return i=u.diagnostics,a=c,o=h,!1});let l=r.state.facet(so).tooltipFilter;return i&&l&&(i=l(i,r.state)),i?{pos:a,end:o,above:r.state.doc.lineAt(a).to<o,create(){return{dom:bI(r,i)}}}:null}function bI(r,t){return _t("ul",{class:"cm-tooltip-lint"},t.map(s=>Zv(r,s,!1)))}const vI=r=>{let t=r.state.field(ir,!1);(!t||!t.panel)&&r.dispatch({effects:xI(r.state,[Rf.of(!0)])});let s=Ga(r,ro.open);return s&&s.dom.querySelector(".cm-panel-lint ul").focus(),!0},bg=r=>{let t=r.state.field(ir,!1);return!t||!t.panel?!1:(r.dispatch({effects:Rf.of(!1)}),!0)},wI=r=>{let t=r.state.field(ir,!1);if(!t)return!1;let s=r.state.selection.main,n=t.diagnostics.iter(s.to+1);return!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==s.from&&n.to==s.to)?!1:(r.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},SI=[{key:"Mod-Shift-m",run:vI,preventDefault:!0},{key:"F8",run:wI}],so=We.define({combine(r){return Object.assign({sources:r.map(t=>t.source).filter(t=>t!=null)},sn(r.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{needsRefresh:(t,s)=>t?s?n=>t(n)||s(n):t:s}))}});function Xv(r){let t=[];if(r)e:for(let{name:s}of r){for(let n=0;n<s.length;n++){let i=s[n];if(/[a-zA-Z]/.test(i)&&!t.some(a=>a.toLowerCase()==i.toLowerCase())){t.push(i);continue e}}t.push("")}return t}function Zv(r,t,s){var n;let i=s?Xv(t.actions):[];return _t("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},_t("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(r):t.message),(n=t.actions)===null||n===void 0?void 0:n.map((a,o)=>{let l=!1,c=p=>{if(p.preventDefault(),l)return;l=!0;let x=sa(r.state.field(ir).diagnostics,t);x&&a.apply(r,x.from,x.to)},{name:h}=a,u=i[o]?h.indexOf(i[o]):-1,m=u<0?h:[h.slice(0,u),_t("u",h.slice(u,u+1)),h.slice(u+1)];return _t("button",{type:"button",class:"cm-diagnosticAction",onclick:c,onmousedown:c,"aria-label":` Action: ${h}${u<0?"":` (access key "${i[o]})"`}.`},m)}),t.source&&_t("div",{class:"cm-diagnosticSource"},t.source))}class OI extends rn{constructor(t){super(),this.sev=t}eq(t){return t.sev==this.sev}toDOM(){return _t("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class vg{constructor(t,s){this.diagnostic=s,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Zv(t,s,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class ro{constructor(t){this.view=t,this.items=[];let s=i=>{if(i.keyCode==27)bg(this.view),this.view.focus();else if(i.keyCode==38||i.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(i.keyCode==40||i.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(i.keyCode==36)this.moveSelection(0);else if(i.keyCode==35)this.moveSelection(this.items.length-1);else if(i.keyCode==13)this.view.focus();else if(i.keyCode>=65&&i.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:a}=this.items[this.selectedIndex],o=Xv(a.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==i.keyCode){let c=sa(this.view.state.field(ir).diagnostics,a);c&&a.actions[l].apply(t,c.from,c.to)}}else return;i.preventDefault()},n=i=>{for(let a=0;a<this.items.length;a++)this.items[a].dom.contains(i.target)&&this.moveSelection(a)};this.list=_t("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:s,onclick:n}),this.dom=_t("div",{class:"cm-panel-lint"},this.list,_t("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>bg(this.view)},"×")),this.update()}get selectedIndex(){let t=this.view.state.field(ir).selected;if(!t)return-1;for(let s=0;s<this.items.length;s++)if(this.items[s].diagnostic==t.diagnostic)return s;return-1}update(){let{diagnostics:t,selected:s}=this.view.state.field(ir),n=0,i=!1,a=null,o=new Set;for(t.between(0,this.view.state.doc.length,(l,c,{spec:h})=>{for(let u of h.diagnostics){if(o.has(u))continue;o.add(u);let m=-1,p;for(let x=n;x<this.items.length;x++)if(this.items[x].diagnostic==u){m=x;break}m<0?(p=new vg(this.view,u),this.items.splice(n,0,p),i=!0):(p=this.items[m],m>n&&(this.items.splice(n,m-n),i=!0)),s&&p.diagnostic==s.diagnostic?p.dom.hasAttribute("aria-selected")||(p.dom.setAttribute("aria-selected","true"),a=p):p.dom.hasAttribute("aria-selected")&&p.dom.removeAttribute("aria-selected"),n++}});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)i=!0,this.items.pop();this.items.length==0&&(this.items.push(new vg(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),i=!0),a?(this.list.setAttribute("aria-activedescendant",a.id),this.view.requestMeasure({key:this,read:()=>({sel:a.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:l,panel:c})=>{let h=c.height/this.list.offsetHeight;l.top<c.top?this.list.scrollTop-=(c.top-l.top)/h:l.bottom>c.bottom&&(this.list.scrollTop+=(l.bottom-c.bottom)/h)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),i&&this.sync()}sync(){let t=this.list.firstChild;function s(){let n=t;t=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;t!=n.dom;)s();t=n.dom.nextSibling}else this.list.insertBefore(n.dom,t);for(;t;)s()}moveSelection(t){if(this.selectedIndex<0)return;let s=this.view.state.field(ir),n=sa(s.diagnostics,this.items[t].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Yv.of(n)})}static open(t){return new ro(t)}}function kI(r,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(r)}</svg>')`}function al(r){return kI(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${r}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const CI=Ie.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:al("#d11")},".cm-lintRange-warning":{backgroundImage:al("orange")},".cm-lintRange-info":{backgroundImage:al("#999")},".cm-lintRange-hint":{backgroundImage:al("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function AI(r){return r=="error"?4:r=="warning"?3:r=="info"?2:1}function TI(r){let t="hint",s=1;for(let n of r){let i=AI(n.severity);i>s&&(s=i,t=n.severity)}return t}const PI=[ir,Ie.decorations.compute([ir],r=>{let{selected:t,panel:s}=r.field(ir);return!t||!s||t.from==t.to?qe.none:qe.set([yI.range(t.from,t.to)])}),fT(jI,{hideOn:gI}),CI];var wg=function(t){t===void 0&&(t={});var{crosshairCursor:s=!1}=t,n=[];t.closeBracketsKeymap!==!1&&(n=n.concat(oI)),t.defaultKeymap!==!1&&(n=n.concat(U_)),t.searchKeymap!==!1&&(n=n.concat(gE)),t.historyKeymap!==!1&&(n=n.concat(JP)),t.foldKeymap!==!1&&(n=n.concat(fP)),t.completionKeymap!==!1&&(n=n.concat(Gv)),t.lintKeymap!==!1&&(n=n.concat(SI));var i=[];return t.lineNumbers!==!1&&i.push(OT()),t.highlightActiveLineGutter!==!1&&i.push(AT()),t.highlightSpecialChars!==!1&&i.push(zA()),t.history!==!1&&i.push(UP()),t.foldGutter!==!1&&i.push(xP()),t.drawSelection!==!1&&i.push(EA()),t.dropCursor!==!1&&i.push(LA()),t.allowMultipleSelections!==!1&&i.push(bt.allowMultipleSelections.of(!0)),t.indentOnInput!==!1&&i.push(rP()),t.syntaxHighlighting!==!1&&i.push(q0(vP,{fallback:!0})),t.bracketMatching!==!1&&i.push(TP()),t.closeBrackets!==!1&&i.push(rI()),t.autocompletion!==!1&&i.push(mI()),t.rectangularSelection!==!1&&i.push(sT()),s!==!1&&i.push(iT()),t.highlightActiveLine!==!1&&i.push(GA()),t.highlightSelectionMatches!==!1&&i.push(X_()),t.tabSize&&typeof t.tabSize=="number"&&i.push(yo.of(" ".repeat(t.tabSize))),i.concat([go.of(n.flat())]).filter(Boolean)};const _I="#e5c07b",Sg="#e06c75",EI="#56b6c2",II="#ffffff",Al="#abb2bf",lu="#7d8799",DI="#61afef",RI="#98c379",Og="#d19a66",MI="#c678dd",LI="#21252b",kg="#2c313a",Cg="#282c34",Wd="#353a42",FI="#3E4451",Ag="#528bff",NI=Ie.theme({"&":{color:Al,backgroundColor:Cg},".cm-content":{caretColor:Ag},".cm-cursor, .cm-dropCursor":{borderLeftColor:Ag},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:FI},".cm-panels":{backgroundColor:LI,color:Al},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Cg,color:lu,border:"none"},".cm-activeLineGutter":{backgroundColor:kg},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Wd},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Wd,borderBottomColor:Wd},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:kg,color:Al}}},{dark:!0}),WI=bo.define([{tag:de.keyword,color:MI},{tag:[de.name,de.deleted,de.character,de.propertyName,de.macroName],color:Sg},{tag:[de.function(de.variableName),de.labelName],color:DI},{tag:[de.color,de.constant(de.name),de.standard(de.name)],color:Og},{tag:[de.definition(de.name),de.separator],color:Al},{tag:[de.typeName,de.className,de.number,de.changed,de.annotation,de.modifier,de.self,de.namespace],color:_I},{tag:[de.operator,de.operatorKeyword,de.url,de.escape,de.regexp,de.link,de.special(de.string)],color:EI},{tag:[de.meta,de.comment],color:lu},{tag:de.strong,fontWeight:"bold"},{tag:de.emphasis,fontStyle:"italic"},{tag:de.strikethrough,textDecoration:"line-through"},{tag:de.link,color:lu,textDecoration:"underline"},{tag:de.heading,fontWeight:"bold",color:Sg},{tag:[de.atom,de.bool,de.special(de.variableName)],color:Og},{tag:[de.processingInstruction,de.string,de.inserted],color:RI},{tag:de.invalid,color:II}]),$I=[NI,q0(WI)];var VI=Ie.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),zI=function(t){t===void 0&&(t={});var{indentWithTab:s=!0,editable:n=!0,readOnly:i=!1,theme:a="light",placeholder:o="",basicSetup:l=!0}=t,c=[];switch(s&&c.unshift(go.of([Q_])),l&&(typeof l=="boolean"?c.unshift(wg()):c.unshift(wg(l))),o&&c.unshift(ZA(o)),a){case"light":c.push(VI);break;case"dark":c.push($I);break;case"none":break;default:c.push(a);break}return n===!1&&c.push(Ie.editable.of(!1)),i&&c.push(bt.readOnly.of(!0)),[...c]},BI=r=>({line:r.state.doc.lineAt(r.state.selection.main.from),lineCount:r.state.doc.lines,lineBreak:r.state.lineBreak,length:r.state.doc.length,readOnly:r.state.readOnly,tabSize:r.state.tabSize,selection:r.state.selection,selectionAsSingle:r.state.selection.asSingle().main,ranges:r.state.selection.ranges,selectionCode:r.state.sliceDoc(r.state.selection.main.from,r.state.selection.main.to),selections:r.state.selection.ranges.map(t=>r.state.sliceDoc(t.from,t.to)),selectedText:r.state.selection.ranges.some(t=>!t.empty)});class UI{constructor(t,s){this.timeLeftMS=void 0,this.timeoutMS=void 0,this.isCancelled=!1,this.isTimeExhausted=!1,this.callbacks=[],this.timeLeftMS=s,this.timeoutMS=s,this.callbacks.push(t)}tick(){if(!this.isCancelled&&!this.isTimeExhausted&&(this.timeLeftMS--,this.timeLeftMS<=0)){this.isTimeExhausted=!0;var t=this.callbacks.slice();this.callbacks.length=0,t.forEach(s=>{try{s()}catch(n){console.error("TimeoutLatch callback error:",n)}})}}cancel(){this.isCancelled=!0,this.callbacks.length=0}reset(){this.timeLeftMS=this.timeoutMS,this.isCancelled=!1,this.isTimeExhausted=!1}get isDone(){return this.isCancelled||this.isTimeExhausted}}class Tg{constructor(){this.interval=null,this.latches=new Set}add(t){this.latches.add(t),this.start()}remove(t){this.latches.delete(t),this.latches.size===0&&this.stop()}start(){this.interval===null&&(this.interval=setInterval(()=>{this.latches.forEach(t=>{t.tick(),t.isDone&&this.remove(t)})},1))}stop(){this.interval!==null&&(clearInterval(this.interval),this.interval=null)}}var $d=null,QI=()=>typeof window>"u"?new Tg:($d||($d=new Tg),$d),Pg=tn.define(),qI=200,HI=[];function GI(r){var{value:t,selection:s,onChange:n,onStatistics:i,onCreateEditor:a,onUpdate:o,extensions:l=HI,autoFocus:c,theme:h="light",height:u=null,minHeight:m=null,maxHeight:p=null,width:x=null,minWidth:b=null,maxWidth:w=null,placeholder:C="",editable:A=!0,readOnly:_=!1,indentWithTab:R=!0,basicSetup:E=!0,root:T,initialState:M}=r,[I,N]=j.useState(),[k,S]=j.useState(),[L,W]=j.useState(),F=j.useState(()=>({current:null}))[0],$=j.useState(()=>({current:null}))[0],q=Ie.theme({"&":{height:u,minHeight:m,maxHeight:p,width:x,minWidth:b,maxWidth:w},"& .cm-scroller":{height:"100% !important"}}),ne=Ie.updateListener.of(G=>{if(G.docChanged&&typeof n=="function"&&!G.transactions.some(D=>D.annotation(Pg))){F.current?F.current.reset():(F.current=new UI(()=>{if($.current){var D=$.current;$.current=null,D()}F.current=null},qI),QI().add(F.current));var H=G.state.doc,P=H.toString();n(P,G)}i&&i(BI(G))}),he=zI({theme:h,editable:A,readOnly:_,placeholder:C,indentWithTab:R,basicSetup:E}),re=[ne,q,...he];return o&&typeof o=="function"&&re.push(Ie.updateListener.of(o)),re=re.concat(l),j.useLayoutEffect(()=>{if(I&&!L){var G={doc:t,selection:s,extensions:re},H=M?bt.fromJSON(M.json,G,M.fields):bt.create(G);if(W(H),!k){var P=new Ie({state:H,parent:I,root:T});S(P),a&&a(P,H)}}return()=>{k&&(W(void 0),S(void 0))}},[I,L]),j.useEffect(()=>{r.container&&N(r.container)},[r.container]),j.useEffect(()=>()=>{k&&(k.destroy(),S(void 0)),F.current&&(F.current.cancel(),F.current=null)},[k]),j.useEffect(()=>{c&&k&&k.focus()},[c,k]),j.useEffect(()=>{k&&k.dispatch({effects:nt.reconfigure.of(re)})},[h,l,u,m,p,x,b,w,C,A,_,R,E,n,o]),j.useEffect(()=>{if(t!==void 0){var G=k?k.state.doc.toString():"";if(k&&t!==G){var H=F.current&&!F.current.isDone,P=()=>{k&&t!==k.state.doc.toString()&&k.dispatch({changes:{from:0,to:k.state.doc.toString().length,insert:t||""},annotations:[Pg.of(!0)]})};H?$.current=P:P()}}},[t,k]),{state:L,setState:W,view:k,setView:S,container:I,setContainer:N}}var KI=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],Jv=j.forwardRef((r,t)=>{var{className:s,value:n="",selection:i,extensions:a=[],onChange:o,onStatistics:l,onCreateEditor:c,onUpdate:h,autoFocus:u,theme:m="light",height:p,minHeight:x,maxHeight:b,width:w,minWidth:C,maxWidth:A,basicSetup:_,placeholder:R,indentWithTab:E,editable:T,readOnly:M,root:I,initialState:N}=r,k=kt(r,KI),S=j.useRef(null),{state:L,view:W,container:F,setContainer:$}=GI({root:I,value:n,autoFocus:u,theme:m,height:p,minHeight:x,maxHeight:b,width:w,minWidth:C,maxWidth:A,basicSetup:_,placeholder:R,indentWithTab:E,editable:T,readOnly:M,selection:i,onChange:o,onStatistics:l,onCreateEditor:c,onUpdate:h,extensions:a,initialState:N});j.useImperativeHandle(t,()=>({editor:S.current,state:L,view:W}),[S,F,L,W]);var q=j.useCallback(he=>{S.current=he,$(he)},[$]);if(typeof n!="string")throw new Error("value must be typeof string but got "+typeof n);var ne=typeof m=="string"?"cm-theme-"+m:"cm-theme";return e.jsx("div",me({ref:q,className:""+ne+(s?" "+s:"")},k))});Jv.displayName="CodeMirror";var _g={};class lc{constructor(t,s,n,i,a,o,l,c,h,u=0,m){this.p=t,this.stack=s,this.state=n,this.reducePos=i,this.pos=a,this.score=o,this.buffer=l,this.bufferBase=c,this.curContext=h,this.lookAhead=u,this.parent=m}toString(){return`[${this.stack.filter((t,s)=>s%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,s,n=0){let i=t.parser.context;return new lc(t,[],s,n,n,0,[],0,i?new Eg(i,i.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,s){this.stack.push(this.state,s,this.bufferBase+this.buffer.length),this.state=t}reduce(t){var s;let n=t>>19,i=t&65535,{parser:a}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let l=a.dynamicPrecedence(i);if(l&&(this.score+=l),n==0){this.pushState(a.getGoto(this.state,i,!0),this.reducePos),i<a.minRepeatTerm&&this.storeNode(i,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(i,this.reducePos);return}let c=this.stack.length-(n-1)*3-(t&262144?6:0),h=c?this.stack[c-2]:this.p.ranges[0].from,u=this.reducePos-h;u>=2e3&&!(!((s=this.p.parser.nodeSet.types[i])===null||s===void 0)&&s.isAnonymous)&&(h==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=u):this.p.lastBigReductionSize<u&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=h,this.p.lastBigReductionSize=u));let m=c?this.stack[c-1]:0,p=this.bufferBase+this.buffer.length-m;if(i<a.minRepeatTerm||t&131072){let x=a.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(i,h,x,p+4,!0)}if(t&262144)this.state=this.stack[c];else{let x=this.stack[c-3];this.state=a.getGoto(x,i,!0)}for(;this.stack.length>c;)this.stack.pop();this.reduceContext(i,h)}storeNode(t,s,n,i=4,a=!1){if(t==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,l=this.buffer.length;if(l==0&&o.parent&&(l=o.bufferBase-o.parent.bufferBase,o=o.parent),l>0&&o.buffer[l-4]==0&&o.buffer[l-1]>-1){if(s==n)return;if(o.buffer[l-2]>=s){o.buffer[l-2]=n;return}}}if(!a||this.pos==n)this.buffer.push(t,s,n,i);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0){let l=!1;for(let c=o;c>0&&this.buffer[c-2]>n;c-=4)if(this.buffer[c-1]>=0){l=!0;break}if(l)for(;o>0&&this.buffer[o-2]>n;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,i>4&&(i-=4)}this.buffer[o]=t,this.buffer[o+1]=s,this.buffer[o+2]=n,this.buffer[o+3]=i}}shift(t,s,n,i){if(t&131072)this.pushState(t&65535,this.pos);else if((t&262144)==0){let a=t,{parser:o}=this.p;(i>this.pos||s<=o.maxNode)&&(this.pos=i,o.stateFlag(a,1)||(this.reducePos=i)),this.pushState(a,n),this.shiftContext(s,n),s<=o.maxNode&&this.buffer.push(s,n,i,4)}else this.pos=i,this.shiftContext(s,n),s<=this.p.parser.maxNode&&this.buffer.push(s,n,i,4)}apply(t,s,n,i){t&65536?this.reduce(t):this.shift(t,s,n,i)}useNode(t,s){let n=this.p.reused.length-1;(n<0||this.p.reused[n]!=t)&&(this.p.reused.push(t),n++);let i=this.pos;this.reducePos=this.pos=i+t.length,this.pushState(s,i),this.buffer.push(n,i,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,s=t.buffer.length;for(;s>0&&t.buffer[s-2]>t.reducePos;)s-=4;let n=t.buffer.slice(s),i=t.bufferBase+s;for(;t&&i==t.bufferBase;)t=t.parent;return new lc(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,n,i,this.curContext,this.lookAhead,t)}recoverByDelete(t,s){let n=t<=this.p.parser.maxNode;n&&this.storeNode(t,this.pos,s,4),this.storeNode(0,this.pos,s,n?8:4),this.pos=this.reducePos=s,this.score-=190}canShift(t){for(let s=new YI(this);;){let n=this.p.parser.stateSlot(s.state,4)||this.p.parser.hasAction(s.state,t);if(n==0)return!1;if((n&65536)==0)return!0;s.reduce(n)}}recoverByInsert(t){if(this.stack.length>=300)return[];let s=this.p.parser.nextStates(this.state);if(s.length>8||this.stack.length>=120){let i=[];for(let a=0,o;a<s.length;a+=2)(o=s[a+1])!=this.state&&this.p.parser.hasAction(o,t)&&i.push(s[a],o);if(this.stack.length<120)for(let a=0;i.length<8&&a<s.length;a+=2){let o=s[a+1];i.some((l,c)=>c&1&&l==o)||i.push(s[a],o)}s=i}let n=[];for(let i=0;i<s.length&&n.length<4;i+=2){let a=s[i+1];if(a==this.state)continue;let o=this.split();o.pushState(a,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(s[i],this.pos),o.reducePos=this.pos,o.score-=200,n.push(o)}return n}forceReduce(){let{parser:t}=this.p,s=t.stateSlot(this.state,5);if((s&65536)==0)return!1;if(!t.validAction(this.state,s)){let n=s>>19,i=s&65535,a=this.stack.length-n*3;if(a<0||t.getGoto(this.stack[a],i,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;s=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(s),!0}findForcedReduction(){let{parser:t}=this.p,s=[],n=(i,a)=>{if(!s.includes(i))return s.push(i),t.allActions(i,o=>{if(!(o&393216))if(o&65536){let l=(o>>19)-a;if(l>1){let c=o&65535,h=this.stack.length-l*3;if(h>=0&&t.getGoto(this.stack[h],c,!1)>=0)return l<<19|65536|c}}else{let l=n(o,a+1);if(l!=null)return l}})};return n(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:t}=this.p;return t.data[t.stateSlot(this.state,1)]==65535&&!t.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let s=0;s<this.stack.length;s+=3)if(this.stack[s]!=t.stack[s])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,s){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(s)))}reduceContext(t,s){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(s)))}emitContext(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(t){if(t!=this.curContext.context){let s=new Eg(this.curContext.tracker,t);s.hash!=this.curContext.hash&&this.emitContext(),this.curContext=s}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Eg{constructor(t,s){this.tracker=t,this.context=s,this.hash=t.strict?t.hash(s):0}}class YI{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let s=t&65535,n=t>>19;n==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(n-1)*3;let i=this.start.p.parser.getGoto(this.stack[this.base-3],s,!0);this.state=i}}class cc{constructor(t,s,n){this.stack=t,this.pos=s,this.index=n,this.buffer=t.buffer,this.index==0&&this.maybeNext()}static create(t,s=t.bufferBase+t.buffer.length){return new cc(t,s,s-t.bufferBase)}maybeNext(){let t=this.stack.parent;t!=null&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new cc(this.stack,this.pos,this.index)}}function ol(r,t=Uint16Array){if(typeof r!="string")return r;let s=null;for(let n=0,i=0;n<r.length;){let a=0;for(;;){let o=r.charCodeAt(n++),l=!1;if(o==126){a=65535;break}o>=92&&o--,o>=34&&o--;let c=o-32;if(c>=46&&(c-=46,l=!0),a+=c,l)break;a*=46}s?s[i++]=a:s=new t(a)}return s}class Tl{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Ig=new Tl;class XI{constructor(t,s){this.input=t,this.ranges=s,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Ig,this.rangeIndex=0,this.pos=this.chunkPos=s[0].from,this.range=s[0],this.end=s[s.length-1].to,this.readNext()}resolveOffset(t,s){let n=this.range,i=this.rangeIndex,a=this.pos+t;for(;a<n.from;){if(!i)return null;let o=this.ranges[--i];a-=n.from-o.to,n=o}for(;s<0?a>n.to:a>=n.to;){if(i==this.ranges.length-1)return null;let o=this.ranges[++i];a+=o.from-n.to,n=o}return a}clipPos(t){if(t>=this.range.from&&t<this.range.to)return t;for(let s of this.ranges)if(s.to>t)return Math.max(t,s.from);return this.end}peek(t){let s=this.chunkOff+t,n,i;if(s>=0&&s<this.chunk.length)n=this.pos+t,i=this.chunk.charCodeAt(s);else{let a=this.resolveOffset(t,1);if(a==null)return-1;if(n=a,n>=this.chunk2Pos&&n<this.chunk2Pos+this.chunk2.length)i=this.chunk2.charCodeAt(n-this.chunk2Pos);else{let o=this.rangeIndex,l=this.range;for(;l.to<=n;)l=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=n),n+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-n)),i=this.chunk2.charCodeAt(0)}}return n>=this.token.lookAhead&&(this.token.lookAhead=n+1),i}acceptToken(t,s=0){let n=s?this.resolveOffset(s,-1):this.pos;if(n==null||n<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=n}acceptTokenTo(t,s){this.token.value=t,this.token.end=s}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:s}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=s,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),s=this.pos+t.length;this.chunk=s>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,s){if(s?(this.token=s,s.start=t,s.lookAhead=t+1,s.value=s.extended=-1):this.token=Ig,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,s){if(t>=this.chunkPos&&s<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,s-this.chunkPos);if(t>=this.chunk2Pos&&s<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,s-this.chunk2Pos);if(t>=this.range.from&&s<=this.range.to)return this.input.read(t,s);let n="";for(let i of this.ranges){if(i.from>=s)break;i.to>t&&(n+=this.input.read(Math.max(i.from,t),Math.min(i.to,s)))}return n}}class Ui{constructor(t,s){this.data=t,this.id=s}token(t,s){let{parser:n}=s.p;ZI(this.data,t,s,this.id,n.data,n.tokenPrecTable)}}Ui.prototype.contextual=Ui.prototype.fallback=Ui.prototype.extend=!1;Ui.prototype.fallback=Ui.prototype.extend=!1;class Nc{constructor(t,s={}){this.token=t,this.contextual=!!s.contextual,this.fallback=!!s.fallback,this.extend=!!s.extend}}function ZI(r,t,s,n,i,a){let o=0,l=1<<n,{dialect:c}=s.p.parser;e:for(;(l&r[o])!=0;){let h=r[o+1];for(let x=o+3;x<h;x+=2)if((r[x+1]&l)>0){let b=r[x];if(c.allows(b)&&(t.token.value==-1||t.token.value==b||JI(b,t.token.value,i,a))){t.acceptToken(b);break}}let u=t.next,m=0,p=r[o+2];if(t.next<0&&p>m&&r[h+p*3-3]==65535){o=r[h+p*3-1];continue e}for(;m<p;){let x=m+p>>1,b=h+x+(x<<1),w=r[b],C=r[b+1]||65536;if(u<w)p=x;else if(u>=C)m=x+1;else{o=r[b+2],t.advance();continue e}}break}}function Dg(r,t,s){for(let n=t,i;(i=r[n])!=65535;n++)if(i==s)return n-t;return-1}function JI(r,t,s,n){let i=Dg(s,n,t);return i<0||Dg(s,n,r)<i}const tr=typeof process<"u"&&_g&&/\bparse\b/.test(_g.LOG);let Vd=null;function Rg(r,t,s){let n=r.cursor(us.IncludeAnonymous);for(n.moveTo(t);;)if(!(s<0?n.childBefore(t):n.childAfter(t)))for(;;){if((s<0?n.to<t:n.from>t)&&!n.type.isError)return s<0?Math.max(0,Math.min(n.to-1,t-25)):Math.min(r.length,Math.max(n.from+1,t+25));if(s<0?n.prevSibling():n.nextSibling())break;if(!n.parent())return s<0?0:r.length}}class eD{constructor(t,s){this.fragments=t,this.nodeSet=s,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?Rg(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?Rg(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let s=this.trees.length-1;if(s<0)return this.nextFragment(),null;let n=this.trees[s],i=this.index[s];if(i==n.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let a=n.children[i],o=this.start[s]+n.positions[i];if(o>t)return this.nextStart=o,null;if(a instanceof cs){if(o==t){if(o<this.safeFrom)return null;let l=o+a.length;if(l<=this.safeTo){let c=a.prop(gt.lookAhead);if(!c||l+c<this.fragment.to)return a}}this.index[s]++,o+a.length>=Math.max(this.safeFrom,t)&&(this.trees.push(a),this.start.push(o),this.index.push(0))}else this.index[s]++,this.nextStart=o+a.length}}}class tD{constructor(t,s){this.stream=s,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map(n=>new Tl)}getActions(t){let s=0,n=null,{parser:i}=t.p,{tokenizers:a}=i,o=i.stateSlot(t.state,3),l=t.curContext?t.curContext.hash:0,c=0;for(let h=0;h<a.length;h++){if((1<<h&o)==0)continue;let u=a[h],m=this.tokens[h];if(!(n&&!u.fallback)&&((u.contextual||m.start!=t.pos||m.mask!=o||m.context!=l)&&(this.updateCachedToken(m,u,t),m.mask=o,m.context=l),m.lookAhead>m.end+25&&(c=Math.max(m.lookAhead,c)),m.value!=0)){let p=s;if(m.extended>-1&&(s=this.addActions(t,m.extended,m.end,s)),s=this.addActions(t,m.value,m.end,s),!u.extend&&(n=m,s>p))break}}for(;this.actions.length>s;)this.actions.pop();return c&&t.setLookAhead(c),!n&&t.pos==this.stream.end&&(n=new Tl,n.value=t.p.parser.eofTerm,n.start=n.end=t.pos,s=this.addActions(t,n.value,n.end,s)),this.mainToken=n,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let s=new Tl,{pos:n,p:i}=t;return s.start=n,s.end=Math.min(n+1,i.stream.end),s.value=n==i.stream.end?i.parser.eofTerm:0,s}updateCachedToken(t,s,n){let i=this.stream.clipPos(n.pos);if(s.token(this.stream.reset(i,t),n),t.value>-1){let{parser:a}=n.p;for(let o=0;o<a.specialized.length;o++)if(a.specialized[o]==t.value){let l=a.specializers[o](this.stream.read(t.start,t.end),n);if(l>=0&&n.p.parser.dialect.allows(l>>1)){(l&1)==0?t.value=l>>1:t.extended=l>>1;break}}}else t.value=0,t.end=this.stream.clipPos(i+1)}putAction(t,s,n,i){for(let a=0;a<i;a+=3)if(this.actions[a]==t)return i;return this.actions[i++]=t,this.actions[i++]=s,this.actions[i++]=n,i}addActions(t,s,n,i){let{state:a}=t,{parser:o}=t.p,{data:l}=o;for(let c=0;c<2;c++)for(let h=o.stateSlot(a,c?2:1);;h+=3){if(l[h]==65535)if(l[h+1]==1)h=un(l,h+2);else{i==0&&l[h+1]==2&&(i=this.putAction(un(l,h+2),s,n,i));break}l[h]==s&&(i=this.putAction(un(l,h+1),s,n,i))}return i}}class sD{constructor(t,s,n,i){this.parser=t,this.input=s,this.ranges=i,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new XI(s,i),this.tokens=new tD(t,this.stream),this.topTerm=t.top[1];let{from:a}=i[0];this.stacks=[lc.start(this,t.top[0],a)],this.fragments=n.length&&this.stream.end-a>t.bufferLength*4?new eD(n,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t=this.stacks,s=this.minStackPos,n=this.stacks=[],i,a;if(this.bigReductionCount>300&&t.length==1){let[o]=t;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<t.length;o++){let l=t[o];for(;;){if(this.tokens.mainToken=null,l.pos>s)n.push(l);else{if(this.advanceStack(l,n,t))continue;{i||(i=[],a=[]),i.push(l);let c=this.tokens.getMainToken(l);a.push(c.value,c.end)}}break}}if(!n.length){let o=i&&iD(i);if(o)return tr&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw tr&&i&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+s);this.recovering||(this.recovering=5)}if(this.recovering&&i){let o=this.stoppedAt!=null&&i[0].pos>this.stoppedAt?i[0]:this.runRecovery(i,a,n);if(o)return tr&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(n.length>o)for(n.sort((l,c)=>c.score-l.score);n.length>o;)n.pop();n.some(l=>l.reducePos>s)&&this.recovering--}else if(n.length>1){e:for(let o=0;o<n.length-1;o++){let l=n[o];for(let c=o+1;c<n.length;c++){let h=n[c];if(l.sameState(h)||l.buffer.length>500&&h.buffer.length>500)if((l.score-h.score||l.buffer.length-h.buffer.length)>0)n.splice(c--,1);else{n.splice(o--,1);continue e}}}n.length>12&&n.splice(12,n.length-12)}this.minStackPos=n[0].pos;for(let o=1;o<n.length;o++)n[o].pos<this.minStackPos&&(this.minStackPos=n[o].pos);return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,s,n){let i=t.pos,{parser:a}=this,o=tr?this.stackID(t)+" -> ":"";if(this.stoppedAt!=null&&i>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let h=t.curContext&&t.curContext.tracker.strict,u=h?t.curContext.hash:0;for(let m=this.fragments.nodeAt(i);m;){let p=this.parser.nodeSet.types[m.type.id]==m.type?a.getGoto(t.state,m.type.id):-1;if(p>-1&&m.length&&(!h||(m.prop(gt.contextHash)||0)==u))return t.useNode(m,p),tr&&console.log(o+this.stackID(t)+` (via reuse of ${a.getName(m.type.id)})`),!0;if(!(m instanceof cs)||m.children.length==0||m.positions[0]>0)break;let x=m.children[0];if(x instanceof cs&&m.positions[0]==0)m=x;else break}}let l=a.stateSlot(t.state,4);if(l>0)return t.reduce(l),tr&&console.log(o+this.stackID(t)+` (via always-reduce ${a.getName(l&65535)})`),!0;if(t.stack.length>=8400)for(;t.stack.length>6e3&&t.forceReduce(););let c=this.tokens.getActions(t);for(let h=0;h<c.length;){let u=c[h++],m=c[h++],p=c[h++],x=h==c.length||!n,b=x?t:t.split(),w=this.tokens.mainToken;if(b.apply(u,m,w?w.start:b.pos,p),tr&&console.log(o+this.stackID(b)+` (via ${(u&65536)==0?"shift":`reduce of ${a.getName(u&65535)}`} for ${a.getName(m)} @ ${i}${b==t?"":", split"})`),x)return!0;b.pos>i?s.push(b):n.push(b)}return!1}advanceFully(t,s){let n=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>n)return Mg(t,s),!0}}runRecovery(t,s,n){let i=null,a=!1;for(let o=0;o<t.length;o++){let l=t[o],c=s[o<<1],h=s[(o<<1)+1],u=tr?this.stackID(l)+" -> ":"";if(l.deadEnd&&(a||(a=!0,l.restart(),tr&&console.log(u+this.stackID(l)+" (restarted)"),this.advanceFully(l,n))))continue;let m=l.split(),p=u;for(let x=0;m.forceReduce()&&x<10&&(tr&&console.log(p+this.stackID(m)+" (via force-reduce)"),!this.advanceFully(m,n));x++)tr&&(p=this.stackID(m)+" -> ");for(let x of l.recoverByInsert(c))tr&&console.log(u+this.stackID(x)+" (via recover-insert)"),this.advanceFully(x,n);this.stream.end>l.pos?(h==l.pos&&(h++,c=0),l.recoverByDelete(c,h),tr&&console.log(u+this.stackID(l)+` (via recover-delete ${this.parser.getName(c)})`),Mg(l,n)):(!i||i.score<l.score)&&(i=l)}return i}stackToTree(t){return t.close(),cs.build({buffer:cc.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let s=(Vd||(Vd=new WeakMap)).get(t);return s||Vd.set(t,s=String.fromCodePoint(this.nextStackID++)),s+t}}function Mg(r,t){for(let s=0;s<t.length;s++){let n=t[s];if(n.pos==r.pos&&n.sameState(r)){t[s].score<r.score&&(t[s]=r);return}}t.push(r)}class rD{constructor(t,s,n){this.source=t,this.flags=s,this.disabled=n}allows(t){return!this.disabled||this.disabled[t]==0}}const zd=r=>r;class nD{constructor(t){this.start=t.start,this.shift=t.shift||zd,this.reduce=t.reduce||zd,this.reuse=t.reuse||zd,this.hash=t.hash||(()=>0),this.strict=t.strict!==!1}}class dc extends P0{constructor(t){if(super(),this.wrappers=[],t.version!=14)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (14)`);let s=t.nodeNames.split(" ");this.minRepeatTerm=s.length;for(let l=0;l<t.repeatNodeCount;l++)s.push("");let n=Object.keys(t.topRules).map(l=>t.topRules[l][1]),i=[];for(let l=0;l<s.length;l++)i.push([]);function a(l,c,h){i[l].push([c,c.deserialize(String(h))])}if(t.nodeProps)for(let l of t.nodeProps){let c=l[0];typeof c=="string"&&(c=gt[c]);for(let h=1;h<l.length;){let u=l[h++];if(u>=0)a(u,c,l[h++]);else{let m=l[h+-u];for(let p=-u;p>0;p--)a(l[h++],c,m);h++}}}this.nodeSet=new mf(s.map((l,c)=>Xs.define({name:c>=this.minRepeatTerm?void 0:l,id:c,props:i[c],top:n.indexOf(c)>-1,error:c==0,skipped:t.skippedNodes&&t.skippedNodes.indexOf(c)>-1}))),t.propSources&&(this.nodeSet=this.nodeSet.extend(...t.propSources)),this.strict=!1,this.bufferLength=k0;let o=ol(t.tokenData);this.context=t.context,this.specializerSpecs=t.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(Lg),this.states=ol(t.states,Uint32Array),this.data=ol(t.stateData),this.goto=ol(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map(l=>typeof l=="number"?new Ui(o,l):l),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,s,n){let i=new sD(this,t,s,n);for(let a of this.wrappers)i=a(i,t,s,n);return i}getGoto(t,s,n=!1){let i=this.goto;if(s>=i[0])return-1;for(let a=i[s+1];;){let o=i[a++],l=o&1,c=i[a++];if(l&&n)return c;for(let h=a+(o>>1);a<h;a++)if(i[a]==t)return c;if(l)return-1}}hasAction(t,s){let n=this.data;for(let i=0;i<2;i++)for(let a=this.stateSlot(t,i?2:1),o;;a+=3){if((o=n[a])==65535)if(n[a+1]==1)o=n[a=un(n,a+2)];else{if(n[a+1]==2)return un(n,a+2);break}if(o==s||o==0)return un(n,a+1)}return 0}stateSlot(t,s){return this.states[t*6+s]}stateFlag(t,s){return(this.stateSlot(t,0)&s)>0}validAction(t,s){return!!this.allActions(t,n=>n==s?!0:null)}allActions(t,s){let n=this.stateSlot(t,4),i=n?s(n):void 0;for(let a=this.stateSlot(t,1);i==null;a+=3){if(this.data[a]==65535)if(this.data[a+1]==1)a=un(this.data,a+2);else break;i=s(un(this.data,a+1))}return i}nextStates(t){let s=[];for(let n=this.stateSlot(t,1);;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=un(this.data,n+2);else break;if((this.data[n+2]&1)==0){let i=this.data[n+1];s.some((a,o)=>o&1&&a==i)||s.push(this.data[n],i)}}return s}configure(t){let s=Object.assign(Object.create(dc.prototype),this);if(t.props&&(s.nodeSet=this.nodeSet.extend(...t.props)),t.top){let n=this.topRules[t.top];if(!n)throw new RangeError(`Invalid top rule name ${t.top}`);s.top=n}return t.tokenizers&&(s.tokenizers=this.tokenizers.map(n=>{let i=t.tokenizers.find(a=>a.from==n);return i?i.to:n})),t.specializers&&(s.specializers=this.specializers.slice(),s.specializerSpecs=this.specializerSpecs.map((n,i)=>{let a=t.specializers.find(l=>l.from==n.external);if(!a)return n;let o=Object.assign(Object.assign({},n),{external:a.to});return s.specializers[i]=Lg(o),o})),t.contextTracker&&(s.context=t.contextTracker),t.dialect&&(s.dialect=this.parseDialect(t.dialect)),t.strict!=null&&(s.strict=t.strict),t.wrap&&(s.wrappers=s.wrappers.concat(t.wrap)),t.bufferLength!=null&&(s.bufferLength=t.bufferLength),s}hasWrappers(){return this.wrappers.length>0}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let s=this.dynamicPrecedences;return s==null?0:s[t]||0}parseDialect(t){let s=Object.keys(this.dialects),n=s.map(()=>!1);if(t)for(let a of t.split(" ")){let o=s.indexOf(a);o>=0&&(n[o]=!0)}let i=null;for(let a=0;a<s.length;a++)if(!n[a])for(let o=this.dialects[s[a]],l;(l=this.data[o++])!=65535;)(i||(i=new Uint8Array(this.maxTerm+1)))[l]=1;return new rD(t,n,i)}static deserialize(t){return new dc(t)}}function un(r,t){return r[t]|r[t+1]<<16}function iD(r){let t=null;for(let s of r){let n=s.p.stoppedAt;(s.pos==s.p.stream.end||n!=null&&s.pos>n)&&s.p.parser.stateFlag(s.state,2)&&(!t||t.score<s.score)&&(t=s)}return t}function Lg(r){if(r.external){let t=r.extend?1:0;return(s,n)=>r.external(s,n)<<1|t}return r.get}const aD=1,ew=194,tw=195,oD=196,Fg=197,lD=198,cD=199,dD=200,hD=2,sw=3,Ng=201,uD=24,fD=25,mD=49,pD=50,gD=55,xD=56,yD=57,jD=59,bD=60,vD=61,wD=62,SD=63,OD=65,kD=238,CD=71,AD=241,TD=242,PD=243,_D=244,ED=245,ID=246,DD=247,RD=248,rw=72,MD=249,LD=250,FD=251,ND=252,WD=253,$D=254,VD=255,zD=256,BD=73,UD=77,QD=263,qD=112,HD=130,GD=151,KD=152,YD=155,xi=10,no=13,Mf=32,Wc=9,Lf=35,XD=40,ZD=46,cu=123,Wg=125,nw=39,iw=34,$g=92,JD=111,eR=120,tR=78,sR=117,rR=85,nR=new Set([fD,mD,pD,QD,OD,HD,xD,yD,kD,wD,SD,rw,BD,UD,bD,vD,GD,KD,YD,qD]);function Bd(r){return r==xi||r==no}function Ud(r){return r>=48&&r<=57||r>=65&&r<=70||r>=97&&r<=102}const iR=new Nc((r,t)=>{let s;if(r.next<0)r.acceptToken(cD);else if(t.context.flags&Pl)Bd(r.next)&&r.acceptToken(lD,1);else if(((s=r.peek(-1))<0||Bd(s))&&t.canShift(Fg)){let n=0;for(;r.next==Mf||r.next==Wc;)r.advance(),n++;(r.next==xi||r.next==no||r.next==Lf)&&r.acceptToken(Fg,-n)}else Bd(r.next)&&r.acceptToken(oD,1)},{contextual:!0}),aR=new Nc((r,t)=>{let s=t.context;if(s.flags)return;let n=r.peek(-1);if(n==xi||n==no){let i=0,a=0;for(;;){if(r.next==Mf)i++;else if(r.next==Wc)i+=8-i%8;else break;r.advance(),a++}i!=s.indent&&r.next!=xi&&r.next!=no&&r.next!=Lf&&(i<s.indent?r.acceptToken(tw,-a):r.acceptToken(ew))}}),Pl=1,aw=2,ln=4,cn=8,dn=16,hn=32;function _l(r,t,s){this.parent=r,this.indent=t,this.flags=s,this.hash=(r?r.hash+r.hash<<8:0)+t+(t<<4)+s+(s<<6)}const oR=new _l(null,0,0);function lR(r){let t=0;for(let s=0;s<r.length;s++)t+=r.charCodeAt(s)==Wc?8-t%8:1;return t}const Vg=new Map([[AD,0],[TD,ln],[PD,cn],[_D,cn|ln],[ED,dn],[ID,dn|ln],[DD,dn|cn],[RD,dn|cn|ln],[MD,hn],[LD,hn|ln],[FD,hn|cn],[ND,hn|cn|ln],[WD,hn|dn],[$D,hn|dn|ln],[VD,hn|dn|cn],[zD,hn|dn|cn|ln]].map(([r,t])=>[r,t|aw])),cR=new nD({start:oR,reduce(r,t,s,n){return r.flags&Pl&&nR.has(t)||(t==CD||t==rw)&&r.flags&aw?r.parent:r},shift(r,t,s,n){return t==ew?new _l(r,lR(n.read(n.pos,s.pos)),0):t==tw?r.parent:t==uD||t==gD||t==jD||t==sw?new _l(r,0,Pl):Vg.has(t)?new _l(r,0,Vg.get(t)|r.flags&Pl):r},hash(r){return r.hash}}),dR=new Nc(r=>{for(let t=0;t<5;t++){if(r.next!="print".charCodeAt(t))return;r.advance()}if(!/\w/.test(String.fromCharCode(r.next)))for(let t=0;;t++){let s=r.peek(t);if(!(s==Mf||s==Wc)){s!=XD&&s!=ZD&&s!=xi&&s!=no&&s!=Lf&&r.acceptToken(aD);return}}}),hR=new Nc((r,t)=>{let{flags:s}=t.context,n=s&ln?iw:nw,i=(s&cn)>0,a=!(s&dn),o=(s&hn)>0,l=r.pos;for(;!(r.next<0);)if(o&&r.next==cu)if(r.peek(1)==cu)r.advance(2);else{if(r.pos==l){r.acceptToken(sw,1);return}break}else if(a&&r.next==$g){if(r.pos==l){r.advance();let c=r.next;c>=0&&(r.advance(),uR(r,c)),r.acceptToken(hD);return}break}else if(r.next==$g&&!a&&r.peek(1)>-1)r.advance(2);else if(r.next==n&&(!i||r.peek(1)==n&&r.peek(2)==n)){if(r.pos==l){r.acceptToken(Ng,i?3:1);return}break}else if(r.next==xi){if(i)r.advance();else if(r.pos==l){r.acceptToken(Ng);return}break}else r.advance();r.pos>l&&r.acceptToken(dD)});function uR(r,t){if(t==JD)for(let s=0;s<2&&r.next>=48&&r.next<=55;s++)r.advance();else if(t==eR)for(let s=0;s<2&&Ud(r.next);s++)r.advance();else if(t==sR)for(let s=0;s<4&&Ud(r.next);s++)r.advance();else if(t==rR)for(let s=0;s<8&&Ud(r.next);s++)r.advance();else if(t==tR&&r.next==cu){for(r.advance();r.next>=0&&r.next!=Wg&&r.next!=nw&&r.next!=iw&&r.next!=xi;)r.advance();r.next==Wg&&r.advance()}}const fR=_0({'async "*" "**" FormatConversion FormatSpec':de.modifier,"for while if elif else try except finally return raise break continue with pass assert await yield match case":de.controlKeyword,"in not and or is del":de.operatorKeyword,"from def class global nonlocal lambda":de.definitionKeyword,import:de.moduleKeyword,"with as print":de.keyword,Boolean:de.bool,None:de.null,VariableName:de.variableName,"CallExpression/VariableName":de.function(de.variableName),"FunctionDefinition/VariableName":de.function(de.definition(de.variableName)),"ClassDefinition/VariableName":de.definition(de.className),PropertyName:de.propertyName,"CallExpression/MemberExpression/PropertyName":de.function(de.propertyName),Comment:de.lineComment,Number:de.number,String:de.string,FormatString:de.special(de.string),Escape:de.escape,UpdateOp:de.updateOperator,"ArithOp!":de.arithmeticOperator,BitOp:de.bitwiseOperator,CompareOp:de.compareOperator,AssignOp:de.definitionOperator,Ellipsis:de.punctuation,At:de.meta,"( )":de.paren,"[ ]":de.squareBracket,"{ }":de.brace,".":de.derefOperator,", ;":de.separator}),mR={__proto__:null,await:44,or:54,and:56,in:60,not:62,is:64,if:70,else:72,lambda:76,yield:94,from:96,async:102,for:104,None:162,True:164,False:164,del:178,pass:182,break:186,continue:190,return:194,raise:202,import:206,as:208,global:212,nonlocal:214,assert:218,type:223,elif:236,while:240,try:246,except:248,finally:250,with:254,def:258,class:268,match:279,case:285},pR=dc.deserialize({version:14,states:"##jO`QeOOP$}OSOOO&WQtO'#HUOOQS'#Co'#CoOOQS'#Cp'#CpO'vQdO'#CnO*UQtO'#HTOOQS'#HU'#HUOOQS'#DU'#DUOOQS'#HT'#HTO*rQdO'#D_O+VQdO'#DfO+gQdO'#DjO+zOWO'#DuO,VOWO'#DvO.[QtO'#GuOOQS'#Gu'#GuO'vQdO'#GtO0ZQtO'#GtOOQS'#Eb'#EbO0rQdO'#EcOOQS'#Gs'#GsO0|QdO'#GrOOQV'#Gr'#GrO1XQdO'#FYOOQS'#G^'#G^O1^QdO'#FXOOQV'#IS'#ISOOQV'#Gq'#GqOOQV'#Fq'#FqQ`QeOOO'vQdO'#CqO1lQdO'#C}O1sQdO'#DRO2RQdO'#HYO2cQtO'#EVO'vQdO'#EWOOQS'#EY'#EYOOQS'#E['#E[OOQS'#E^'#E^O2wQdO'#E`O3_QdO'#EdO3rQdO'#EfO3zQtO'#EfO1XQdO'#EiO0rQdO'#ElO1XQdO'#EnO0rQdO'#EtO0rQdO'#EwO4VQdO'#EyO4^QdO'#FOO4iQdO'#EzO0rQdO'#FOO1XQdO'#FQO1XQdO'#FVO4nQdO'#F[P4uOdO'#GpPOOO)CBd)CBdOOQS'#Ce'#CeOOQS'#Cf'#CfOOQS'#Cg'#CgOOQS'#Ch'#ChOOQS'#Ci'#CiOOQS'#Cj'#CjOOQS'#Cl'#ClO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO'vQdO,59OO5TQdO'#DoOOQS,5:Y,5:YO5hQdO'#HdOOQS,5:],5:]O5uQ!fO,5:]O5zQtO,59YO1lQdO,59bO1lQdO,59bO1lQdO,59bO8jQdO,59bO8oQdO,59bO8vQdO,59jO8}QdO'#HTO:TQdO'#HSOOQS'#HS'#HSOOQS'#D['#D[O:lQdO,59aO'vQdO,59aO:zQdO,59aOOQS,59y,59yO;PQdO,5:RO'vQdO,5:ROOQS,5:Q,5:QO;_QdO,5:QO;dQdO,5:XO'vQdO,5:XO'vQdO,5:VOOQS,5:U,5:UO;uQdO,5:UO;zQdO,5:WOOOW'#Fy'#FyO<POWO,5:aOOQS,5:a,5:aO<[QdO'#HwOOOW'#Dw'#DwOOOW'#Fz'#FzO<lOWO,5:bOOQS,5:b,5:bOOQS'#F}'#F}O<zQtO,5:iO?lQtO,5=`O@VQ#xO,5=`O@vQtO,5=`OOQS,5:},5:}OA_QeO'#GWOBqQdO,5;^OOQV,5=^,5=^OB|QtO'#IPOCkQdO,5;tOOQS-E:[-E:[OOQV,5;s,5;sO4dQdO'#FQOOQV-E9o-E9oOCsQtO,59]OEzQtO,59iOFeQdO'#HVOFpQdO'#HVO1XQdO'#HVOF{QdO'#DTOGTQdO,59mOGYQdO'#HZO'vQdO'#HZO0rQdO,5=tOOQS,5=t,5=tO0rQdO'#EROOQS'#ES'#ESOGwQdO'#GPOHXQdO,58|OHXQdO,58|O*xQdO,5:oOHgQtO'#H]OOQS,5:r,5:rOOQS,5:z,5:zOHzQdO,5;OOI]QdO'#IOO1XQdO'#H}OOQS,5;Q,5;QOOQS'#GT'#GTOIqQtO,5;QOJPQdO,5;QOJUQdO'#IQOOQS,5;T,5;TOJdQdO'#H|OOQS,5;W,5;WOJuQdO,5;YO4iQdO,5;`O4iQdO,5;cOJ}QtO'#ITO'vQdO'#ITOKXQdO,5;eO4VQdO,5;eO0rQdO,5;jO1XQdO,5;lOK^QeO'#EuOLjQgO,5;fO!!kQdO'#IUO4iQdO,5;jO!!vQdO,5;lO!#OQdO,5;qO!#ZQtO,5;vO'vQdO,5;vPOOO,5=[,5=[P!#bOSO,5=[P!#jOdO,5=[O!&bQtO1G.jO!&iQtO1G.jO!)YQtO1G.jO!)dQtO1G.jO!+}QtO1G.jO!,bQtO1G.jO!,uQdO'#HcO!-TQtO'#GuO0rQdO'#HcO!-_QdO'#HbOOQS,5:Z,5:ZO!-gQdO,5:ZO!-lQdO'#HeO!-wQdO'#HeO!.[QdO,5>OOOQS'#Ds'#DsOOQS1G/w1G/wOOQS1G.|1G.|O!/[QtO1G.|O!/cQtO1G.|O1lQdO1G.|O!0OQdO1G/UOOQS'#DZ'#DZO0rQdO,59tOOQS1G.{1G.{O!0VQdO1G/eO!0gQdO1G/eO!0oQdO1G/fO'vQdO'#H[O!0tQdO'#H[O!0yQtO1G.{O!1ZQdO,59iO!2aQdO,5=zO!2qQdO,5=zO!2yQdO1G/mO!3OQtO1G/mOOQS1G/l1G/lO!3`QdO,5=uO!4VQdO,5=uO0rQdO1G/qO!4tQdO1G/sO!4yQtO1G/sO!5ZQtO1G/qOOQS1G/p1G/pOOQS1G/r1G/rOOOW-E9w-E9wOOQS1G/{1G/{O!5kQdO'#HxO0rQdO'#HxO!5|QdO,5>cOOOW-E9x-E9xOOQS1G/|1G/|OOQS-E9{-E9{O!6[Q#xO1G2zO!6{QtO1G2zO'vQdO,5<jOOQS,5<j,5<jOOQS-E9|-E9|OOQS,5<r,5<rOOQS-E:U-E:UOOQV1G0x1G0xO1XQdO'#GRO!7dQtO,5>kOOQS1G1`1G1`O!8RQdO1G1`OOQS'#DV'#DVO0rQdO,5=qOOQS,5=q,5=qO!8WQdO'#FrO!8cQdO,59oO!8kQdO1G/XO!8uQtO,5=uOOQS1G3`1G3`OOQS,5:m,5:mO!9fQdO'#GtOOQS,5<k,5<kOOQS-E9}-E9}O!9wQdO1G.hOOQS1G0Z1G0ZO!:VQdO,5=wO!:gQdO,5=wO0rQdO1G0jO0rQdO1G0jO!:xQdO,5>jO!;ZQdO,5>jO1XQdO,5>jO!;lQdO,5>iOOQS-E:R-E:RO!;qQdO1G0lO!;|QdO1G0lO!<RQdO,5>lO!<aQdO,5>lO!<oQdO,5>hO!=VQdO,5>hO!=hQdO'#EpO0rQdO1G0tO!=sQdO1G0tO!=xQgO1G0zO!AvQgO1G0}O!EqQdO,5>oO!E{QdO,5>oO!FTQtO,5>oO0rQdO1G1PO!F_QdO1G1PO4iQdO1G1UO!!vQdO1G1WOOQV,5;a,5;aO!FdQfO,5;aO!FiQgO1G1QO!JjQdO'#GZO4iQdO1G1QO4iQdO1G1QO!JzQdO,5>pO!KXQdO,5>pO1XQdO,5>pOOQV1G1U1G1UO!KaQdO'#FSO!KrQ!fO1G1WO!KzQdO1G1WOOQV1G1]1G1]O4iQdO1G1]O!LPQdO1G1]O!LXQdO'#F^OOQV1G1b1G1bO!#ZQtO1G1bPOOO1G2v1G2vP!L^OSO1G2vOOQS,5=},5=}OOQS'#Dp'#DpO0rQdO,5=}O!LfQdO,5=|O!LyQdO,5=|OOQS1G/u1G/uO!MRQdO,5>PO!McQdO,5>PO!MkQdO,5>PO!NOQdO,5>PO!N`QdO,5>POOQS1G3j1G3jOOQS7+$h7+$hO!8kQdO7+$pO#!RQdO1G.|O#!YQdO1G.|OOQS1G/`1G/`OOQS,5<`,5<`O'vQdO,5<`OOQS7+%P7+%PO#!aQdO7+%POOQS-E9r-E9rOOQS7+%Q7+%QO#!qQdO,5=vO'vQdO,5=vOOQS7+$g7+$gO#!vQdO7+%PO##OQdO7+%QO##TQdO1G3fOOQS7+%X7+%XO##eQdO1G3fO##mQdO7+%XOOQS,5<_,5<_O'vQdO,5<_O##rQdO1G3aOOQS-E9q-E9qO#$iQdO7+%]OOQS7+%_7+%_O#$wQdO1G3aO#%fQdO7+%_O#%kQdO1G3gO#%{QdO1G3gO#&TQdO7+%]O#&YQdO,5>dO#&sQdO,5>dO#&sQdO,5>dOOQS'#Dx'#DxO#'UO&jO'#DzO#'aO`O'#HyOOOW1G3}1G3}O#'fQdO1G3}O#'nQdO1G3}O#'yQ#xO7+(fO#(jQtO1G2UP#)TQdO'#GOOOQS,5<m,5<mOOQS-E:P-E:POOQS7+&z7+&zOOQS1G3]1G3]OOQS,5<^,5<^OOQS-E9p-E9pOOQS7+$s7+$sO#)bQdO,5=`O#){QdO,5=`O#*^QtO,5<aO#*qQdO1G3cOOQS-E9s-E9sOOQS7+&U7+&UO#+RQdO7+&UO#+aQdO,5<nO#+uQdO1G4UOOQS-E:Q-E:QO#,WQdO1G4UOOQS1G4T1G4TOOQS7+&W7+&WO#,iQdO7+&WOOQS,5<p,5<pO#,tQdO1G4WOOQS-E:S-E:SOOQS,5<l,5<lO#-SQdO1G4SOOQS-E:O-E:OO1XQdO'#EqO#-jQdO'#EqO#-uQdO'#IRO#-}QdO,5;[OOQS7+&`7+&`O0rQdO7+&`O#.SQgO7+&fO!JmQdO'#GXO4iQdO7+&fO4iQdO7+&iO#2QQtO,5<tO'vQdO,5<tO#2[QdO1G4ZOOQS-E:W-E:WO#2fQdO1G4ZO4iQdO7+&kO0rQdO7+&kOOQV7+&p7+&pO!KrQ!fO7+&rO!KzQdO7+&rO`QeO1G0{OOQV-E:X-E:XO4iQdO7+&lO4iQdO7+&lOOQV,5<u,5<uO#2nQdO,5<uO!JmQdO,5<uOOQV7+&l7+&lO#2yQgO7+&lO#6tQdO,5<vO#7PQdO1G4[OOQS-E:Y-E:YO#7^QdO1G4[O#7fQdO'#IWO#7tQdO'#IWO1XQdO'#IWOOQS'#IW'#IWO#8PQdO'#IVOOQS,5;n,5;nO#8XQdO,5;nO0rQdO'#FUOOQV7+&r7+&rO4iQdO7+&rOOQV7+&w7+&wO4iQdO7+&wO#8^QfO,5;xOOQV7+&|7+&|POOO7+(b7+(bO#8cQdO1G3iOOQS,5<c,5<cO#8qQdO1G3hOOQS-E9u-E9uO#9UQdO,5<dO#9aQdO,5<dO#9tQdO1G3kOOQS-E9v-E9vO#:UQdO1G3kO#:^QdO1G3kO#:nQdO1G3kO#:UQdO1G3kOOQS<<H[<<H[O#:yQtO1G1zOOQS<<Hk<<HkP#;WQdO'#FtO8vQdO1G3bO#;eQdO1G3bO#;jQdO<<HkOOQS<<Hl<<HlO#;zQdO7+)QOOQS<<Hs<<HsO#<[QtO1G1yP#<{QdO'#FsO#=YQdO7+)RO#=jQdO7+)RO#=rQdO<<HwO#=wQdO7+({OOQS<<Hy<<HyO#>nQdO,5<bO'vQdO,5<bOOQS-E9t-E9tOOQS<<Hw<<HwOOQS,5<g,5<gO0rQdO,5<gO#>sQdO1G4OOOQS-E9y-E9yO#?^QdO1G4OO<[QdO'#H{OOOO'#D{'#D{OOOO'#F|'#F|O#?oO&jO,5:fOOOW,5>e,5>eOOOW7+)i7+)iO#?zQdO7+)iO#@SQdO1G2zO#@mQdO1G2zP'vQdO'#FuO0rQdO<<IpO1XQdO1G2YP1XQdO'#GSO#AOQdO7+)pO#AaQdO7+)pOOQS<<Ir<<IrP1XQdO'#GUP0rQdO'#GQOOQS,5;],5;]O#ArQdO,5>mO#BQQdO,5>mOOQS1G0v1G0vOOQS<<Iz<<IzOOQV-E:V-E:VO4iQdO<<JQOOQV,5<s,5<sO4iQdO,5<sOOQV<<JQ<<JQOOQV<<JT<<JTO#BYQtO1G2`P#BdQdO'#GYO#BkQdO7+)uO#BuQgO<<JVO4iQdO<<JVOOQV<<J^<<J^O4iQdO<<J^O!KrQ!fO<<J^O#FpQgO7+&gOOQV<<JW<<JWO#FzQgO<<JWOOQV1G2a1G2aO1XQdO1G2aO#JuQdO1G2aO4iQdO<<JWO1XQdO1G2bP0rQdO'#G[O#KQQdO7+)vO#K_QdO7+)vOOQS'#FT'#FTO0rQdO,5>rO#KgQdO,5>rO#KrQdO,5>rO#K}QdO,5>qO#L`QdO,5>qOOQS1G1Y1G1YOOQS,5;p,5;pOOQV<<Jc<<JcO#LhQdO1G1dOOQS7+)T7+)TP#LmQdO'#FwO#L}QdO1G2OO#MbQdO1G2OO#MrQdO1G2OP#M}QdO'#FxO#N[QdO7+)VO#NlQdO7+)VO#NlQdO7+)VO#NtQdO7+)VO$ UQdO7+(|O8vQdO7+(|OOQSAN>VAN>VO$ oQdO<<LmOOQSAN>cAN>cO0rQdO1G1|O$!PQtO1G1|P$!ZQdO'#FvOOQS1G2R1G2RP$!hQdO'#F{O$!uQdO7+)jO$#`QdO,5>gOOOO-E9z-E9zOOOW<<MT<<MTO$#nQdO7+(fOOQSAN?[AN?[OOQS7+'t7+'tO$$XQdO<<M[OOQS,5<q,5<qO$$jQdO1G4XOOQS-E:T-E:TOOQVAN?lAN?lOOQV1G2_1G2_O4iQdOAN?qO$$xQgOAN?qOOQVAN?xAN?xO4iQdOAN?xOOQV<<JR<<JRO4iQdOAN?rO4iQdO7+'{OOQV7+'{7+'{O1XQdO7+'{OOQVAN?rAN?rOOQS7+'|7+'|O$(sQdO<<MbOOQS1G4^1G4^O0rQdO1G4^OOQS,5<w,5<wO$)QQdO1G4]OOQS-E:Z-E:ZOOQU'#G_'#G_O$)cQfO7+'OO$)nQdO'#F_O$*uQdO7+'jO$+VQdO7+'jOOQS7+'j7+'jO$+bQdO<<LqO$+rQdO<<LqO$+rQdO<<LqO$+zQdO'#H^OOQS<<Lh<<LhO$,UQdO<<LhOOQS7+'h7+'hOOQS'#D|'#D|OOOO1G4R1G4RO$,oQdO1G4RO$,wQdO1G4RP!=hQdO'#GVOOQVG25]G25]O4iQdOG25]OOQVG25dG25dOOQVG25^G25^OOQV<<Kg<<KgO4iQdO<<KgOOQS7+)x7+)xP$-SQdO'#G]OOQU-E:]-E:]OOQV<<Jj<<JjO$-vQtO'#FaOOQS'#Fc'#FcO$.WQdO'#FbO$.xQdO'#FbOOQS'#Fb'#FbO$.}QdO'#IYO$)nQdO'#FiO$)nQdO'#FiO$/fQdO'#FjO$)nQdO'#FkO$/mQdO'#IZOOQS'#IZ'#IZO$0[QdO,5;yOOQS<<KU<<KUO$0dQdO<<KUO$0tQdOANB]O$1UQdOANB]O$1^QdO'#H_OOQS'#H_'#H_O1sQdO'#DcO$1wQdO,5=xOOQSANBSANBSOOOO7+)m7+)mO$2`QdO7+)mOOQVLD*wLD*wOOQVANARANARO5uQ!fO'#GaO$2hQtO,5<SO$)nQdO'#FmOOQS,5<W,5<WOOQS'#Fd'#FdO$3YQdO,5;|O$3_QdO,5;|OOQS'#Fg'#FgO$)nQdO'#G`O$4PQdO,5<QO$4kQdO,5>tO$4{QdO,5>tO1XQdO,5<PO$5^QdO,5<TO$5cQdO,5<TO$)nQdO'#I[O$5hQdO'#I[O$5mQdO,5<UOOQS,5<V,5<VO0rQdO'#FpOOQU1G1e1G1eO4iQdO1G1eOOQSAN@pAN@pO$5rQdOG27wO$6SQdO,59}OOQS1G3d1G3dOOOO<<MX<<MXOOQS,5<{,5<{OOQS-E:_-E:_O$6XQtO'#FaO$6`QdO'#I]O$6nQdO'#I]O$6vQdO,5<XOOQS1G1h1G1hO$6{QdO1G1hO$7QQdO,5<zOOQS-E:^-E:^O$7lQdO,5=OO$8TQdO1G4`OOQS-E:b-E:bOOQS1G1k1G1kOOQS1G1o1G1oO$8eQdO,5>vO$)nQdO,5>vOOQS1G1p1G1pOOQS,5<[,5<[OOQU7+'P7+'PO$+zQdO1G/iO$)nQdO,5<YO$8sQdO,5>wO$8zQdO,5>wOOQS1G1s1G1sOOQS7+'S7+'SP$)nQdO'#GdO$9SQdO1G4bO$9^QdO1G4bO$9fQdO1G4bOOQS7+%T7+%TO$9tQdO1G1tO$:SQtO'#FaO$:ZQdO,5<}OOQS,5<},5<}O$:iQdO1G4cOOQS-E:a-E:aO$)nQdO,5<|O$:pQdO,5<|O$:uQdO7+)|OOQS-E:`-E:`O$;PQdO7+)|O$)nQdO,5<ZP$)nQdO'#GcO$;XQdO1G2hO$)nQdO1G2hP$;gQdO'#GbO$;nQdO<<MhO$;xQdO1G1uO$<WQdO7+(SO8vQdO'#C}O8vQdO,59bO8vQdO,59bO8vQdO,59bO$<fQtO,5=`O8vQdO1G.|O0rQdO1G/XO0rQdO7+$pP$<yQdO'#GOO'vQdO'#GtO$=WQdO,59bO$=]QdO,59bO$=dQdO,59mO$=iQdO1G/UO1sQdO'#DRO8vQdO,59j",stateData:"$>S~O%cOS%^OSSOS%]PQ~OPdOVaOfoOhYOopOs!POvqO!PrO!Q{O!T!SO!U!RO!XZO!][O!h`O!r`O!s`O!t`O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO#l!QO#o!TO#s!UO#u!VO#z!WO#}hO$P!XO%oRO%pRO%tSO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O~O%]!YO~OV!aO_!aOa!bOh!iO!X!kO!f!mO%j![O%k!]O%l!^O%m!_O%n!_O%o!`O%p!`O%q!aO%r!aO%s!aO~Ok%xXl%xXm%xXn%xXo%xXp%xXs%xXz%xX{%xX!x%xX#g%xX%[%xX%_%xX%z%xXg%xX!T%xX!U%xX%{%xX!W%xX![%xX!Q%xX#[%xXt%xX!m%xX~P%SOfoOhYO!XZO!][O!h`O!r`O!s`O!t`O%oRO%pRO%tSO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O~Oz%wX{%wX#g%wX%[%wX%_%wX%z%wX~Ok!pOl!qOm!oOn!oOo!rOp!sOs!tO!x%wX~P)pOV!zOg!|Oo0cOv0qO!PrO~P'vOV#OOo0cOv0qO!W#PO~P'vOV#SOa#TOo0cOv0qO![#UO~P'vOQ#XO%`#XO%a#ZO~OQ#^OR#[O%`#^O%a#`O~OV%iX_%iXa%iXh%iXk%iXl%iXm%iXn%iXo%iXp%iXs%iXz%iX!X%iX!f%iX%j%iX%k%iX%l%iX%m%iX%n%iX%o%iX%p%iX%q%iX%r%iX%s%iXg%iX!T%iX!U%iX~O&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O&c^O&d^O&e^O&f^O&g^O&h^O&i^O&j^O{%iX!x%iX#g%iX%[%iX%_%iX%z%iX%{%iX!W%iX![%iX!Q%iX#[%iXt%iX!m%iX~P,eOz#dO{%hX!x%hX#g%hX%[%hX%_%hX%z%hX~Oo0cOv0qO~P'vO#g#gO%[#iO%_#iO~O%uWO~O!T#nO#u!VO#z!WO#}hO~OopO~P'vOV#sOa#tO%uWO{wP~OV#xOo0cOv0qO!Q#yO~P'vO{#{O!x$QO%z#|O#g!yX%[!yX%_!yX~OV#xOo0cOv0qO#g#SX%[#SX%_#SX~P'vOo0cOv0qO#g#WX%[#WX%_#WX~P'vOh$WO%uWO~O!f$YO!r$YO%uWO~OV$eO~P'vO!U$gO#s$hO#u$iO~O{$jO~OV$qO~P'vOS$sO%[$rO%_$rO%c$tO~OV$}Oa$}Og%POo0cOv0qO~P'vOo0cOv0qO{%SO~P'vO&Y%UO~Oa!bOh!iO!X!kO!f!mOVba_bakbalbambanbaobapbasbazba{ba!xba#gba%[ba%_ba%jba%kba%lba%mba%nba%oba%pba%qba%rba%sba%zbagba!Tba!Uba%{ba!Wba![ba!Qba#[batba!mba~On%ZO~Oo%ZO~P'vOo0cO~P'vOk0eOl0fOm0dOn0dOo0mOp0nOs0rOg%wX!T%wX!U%wX%{%wX!W%wX![%wX!Q%wX#[%wX!m%wX~P)pO%{%]Og%vXz%vX!T%vX!U%vX!W%vX{%vX~Og%_Oz%`O!T%dO!U%cO~Og%_O~Oz%gO!T%dO!U%cO!W&SX~O!W%kO~Oz%lO{%nO!T%dO!U%cO![%}X~O![%rO~O![%sO~OQ#XO%`#XO%a%uO~OV%wOo0cOv0qO!PrO~P'vOQ#^OR#[O%`#^O%a%zO~OV!qa_!qaa!qah!qak!qal!qam!qan!qao!qap!qas!qaz!qa{!qa!X!qa!f!qa!x!qa#g!qa%[!qa%_!qa%j!qa%k!qa%l!qa%m!qa%n!qa%o!qa%p!qa%q!qa%r!qa%s!qa%z!qag!qa!T!qa!U!qa%{!qa!W!qa![!qa!Q!qa#[!qat!qa!m!qa~P#yOz%|O{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~P%SOV&OOopOvqO{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~P'vOz%|O{%ha!x%ha#g%ha%[%ha%_%ha%z%ha~OPdOVaOopOvqO!PrO!Q{O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO#g$zX%[$zX%_$zX~P'vO#g#gO%[&TO%_&TO~O!f&UOh&sX%[&sXz&sX#[&sX#g&sX%_&sX#Z&sXg&sX~Oh!iO%[&WO~Okealeameaneaoeapeaseazea{ea!xea#gea%[ea%_ea%zeagea!Tea!Uea%{ea!Wea![ea!Qea#[eatea!mea~P%SOsqazqa{qa#gqa%[qa%_qa%zqa~Ok!pOl!qOm!oOn!oOo!rOp!sO!xqa~PEcO%z&YOz%yX{%yX~O%uWOz%yX{%yX~Oz&]O{wX~O{&_O~Oz%lO#g%}X%[%}X%_%}Xg%}X{%}X![%}X!m%}X%z%}X~OV0lOo0cOv0qO!PrO~P'vO%z#|O#gUa%[Ua%_Ua~Oz&hO#g&PX%[&PX%_&PXn&PX~P%SOz&kO!Q&jO#g#Wa%[#Wa%_#Wa~Oz&lO#[&nO#g&rX%[&rX%_&rXg&rX~O!f$YO!r$YO#Z&qO%uWO~O#Z&qO~Oz&sO#g&tX%[&tX%_&tX~Oz&uO#g&pX%[&pX%_&pX{&pX~O!X&wO%z&xO~Oz&|On&wX~P%SOn'PO~OPdOVaOopOvqO!PrO!Q{O!{tO!}uO#PvO#RwO#TxO#XyO#ZzO#^|O#_|O#a}O#c!OO%['UO~P'vOt'YO#p'WO#q'XOP#naV#naf#nah#nao#nas#nav#na!P#na!Q#na!T#na!U#na!X#na!]#na!h#na!r#na!s#na!t#na!{#na!}#na#P#na#R#na#T#na#X#na#Z#na#^#na#_#na#a#na#c#na#l#na#o#na#s#na#u#na#z#na#}#na$P#na%X#na%o#na%p#na%t#na%u#na&Z#na&[#na&]#na&^#na&_#na&`#na&a#na&b#na&c#na&d#na&e#na&f#na&g#na&h#na&i#na&j#na%Z#na%_#na~Oz'ZO#[']O{&xX~Oh'_O!X&wO~Oh!iO{$jO!X&wO~O{'eO~P%SO%['hO%_'hO~OS'iO%['hO%_'hO~OV!aO_!aOa!bOh!iO!X!kO!f!mO%l!^O%m!_O%n!_O%o!`O%p!`O%q!aO%r!aO%s!aOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~O%k!]O~P!#uO%kWi~P!#uOV!aO_!aOa!bOh!iO!X!kO!f!mO%o!`O%p!`O%q!aO%r!aO%s!aOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%kWi%lWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~O%m!_O%n!_O~P!&pO%mWi%nWi~P!&pOa!bOh!iO!X!kO!f!mOkWilWimWinWioWipWisWizWi{Wi!xWi#gWi%[Wi%_Wi%jWi%kWi%lWi%mWi%nWi%oWi%pWi%zWigWi!TWi!UWi%{Wi!WWi![Wi!QWi#[WitWi!mWi~OV!aO_!aO%q!aO%r!aO%s!aO~P!)nOVWi_Wi%qWi%rWi%sWi~P!)nO!T%dO!U%cOg&VXz&VX~O%z'kO%{'kO~P,eOz'mOg&UX~Og'oO~Oz'pO{'rO!W&XX~Oo0cOv0qOz'pO{'sO!W&XX~P'vO!W'uO~Om!oOn!oOo!rOp!sOkjisjizji{ji!xji#gji%[ji%_ji%zji~Ol!qO~P!.aOlji~P!.aOk0eOl0fOm0dOn0dOo0mOp0nO~Ot'wO~P!/jOV'|Og'}Oo0cOv0qO~P'vOg'}Oz(OO~Og(QO~O!U(SO~Og(TOz(OO!T%dO!U%cO~P%SOk0eOl0fOm0dOn0dOo0mOp0nOgqa!Tqa!Uqa%{qa!Wqa![qa!Qqa#[qatqa!mqa~PEcOV'|Oo0cOv0qO!W&Sa~P'vOz(WO!W&Sa~O!W(XO~Oz(WO!T%dO!U%cO!W&Sa~P%SOV(]Oo0cOv0qO![%}a#g%}a%[%}a%_%}ag%}a{%}a!m%}a%z%}a~P'vOz(^O![%}a#g%}a%[%}a%_%}ag%}a{%}a!m%}a%z%}a~O![(aO~Oz(^O!T%dO!U%cO![%}a~P%SOz(dO!T%dO!U%cO![&Ta~P%SOz(gO{&lX![&lX!m&lX%z&lX~O{(kO![(mO!m(nO%z(jO~OV&OOopOvqO{%hi!x%hi#g%hi%[%hi%_%hi%z%hi~P'vOz(pO{%hi!x%hi#g%hi%[%hi%_%hi%z%hi~O!f&UOh&sa%[&saz&sa#[&sa#g&sa%_&sa#Z&sag&sa~O%[(uO~OV#sOa#tO%uWO~Oz&]O{wa~OopOvqO~P'vOz(^O#g%}a%[%}a%_%}ag%}a{%}a![%}a!m%}a%z%}a~P%SOz(zO#g%hX%[%hX%_%hX%z%hX~O%z#|O#gUi%[Ui%_Ui~O#g&Pa%[&Pa%_&Pan&Pa~P'vOz(}O#g&Pa%[&Pa%_&Pan&Pa~O%uWO#g&ra%[&ra%_&rag&ra~Oz)SO#g&ra%[&ra%_&rag&ra~Og)VO~OV)WOh$WO%uWO~O#Z)XO~O%uWO#g&ta%[&ta%_&ta~Oz)ZO#g&ta%[&ta%_&ta~Oo0cOv0qO#g&pa%[&pa%_&pa{&pa~P'vOz)^O#g&pa%[&pa%_&pa{&pa~OV)`Oa)`O%uWO~O%z)eO~Ot)hO#j)gOP#hiV#hif#hih#hio#his#hiv#hi!P#hi!Q#hi!T#hi!U#hi!X#hi!]#hi!h#hi!r#hi!s#hi!t#hi!{#hi!}#hi#P#hi#R#hi#T#hi#X#hi#Z#hi#^#hi#_#hi#a#hi#c#hi#l#hi#o#hi#s#hi#u#hi#z#hi#}#hi$P#hi%X#hi%o#hi%p#hi%t#hi%u#hi&Z#hi&[#hi&]#hi&^#hi&_#hi&`#hi&a#hi&b#hi&c#hi&d#hi&e#hi&f#hi&g#hi&h#hi&i#hi&j#hi%Z#hi%_#hi~Ot)iOP#kiV#kif#kih#kio#kis#kiv#ki!P#ki!Q#ki!T#ki!U#ki!X#ki!]#ki!h#ki!r#ki!s#ki!t#ki!{#ki!}#ki#P#ki#R#ki#T#ki#X#ki#Z#ki#^#ki#_#ki#a#ki#c#ki#l#ki#o#ki#s#ki#u#ki#z#ki#}#ki$P#ki%X#ki%o#ki%p#ki%t#ki%u#ki&Z#ki&[#ki&]#ki&^#ki&_#ki&`#ki&a#ki&b#ki&c#ki&d#ki&e#ki&f#ki&g#ki&h#ki&i#ki&j#ki%Z#ki%_#ki~OV)kOn&wa~P'vOz)lOn&wa~Oz)lOn&wa~P%SOn)pO~O%Y)tO~Ot)wO#p'WO#q)vOP#niV#nif#nih#nio#nis#niv#ni!P#ni!Q#ni!T#ni!U#ni!X#ni!]#ni!h#ni!r#ni!s#ni!t#ni!{#ni!}#ni#P#ni#R#ni#T#ni#X#ni#Z#ni#^#ni#_#ni#a#ni#c#ni#l#ni#o#ni#s#ni#u#ni#z#ni#}#ni$P#ni%X#ni%o#ni%p#ni%t#ni%u#ni&Z#ni&[#ni&]#ni&^#ni&_#ni&`#ni&a#ni&b#ni&c#ni&d#ni&e#ni&f#ni&g#ni&h#ni&i#ni&j#ni%Z#ni%_#ni~OV)zOo0cOv0qO{$jO~P'vOo0cOv0qO{&xa~P'vOz*OO{&xa~OV*SOa*TOg*WO%q*UO%uWO~O{$jO&{*YO~Oh'_O~Oh!iO{$jO~O%[*_O~O%[*aO%_*aO~OV$}Oa$}Oo0cOv0qOg&Ua~P'vOz*dOg&Ua~Oo0cOv0qO{*gO!W&Xa~P'vOz*hO!W&Xa~Oo0cOv0qOz*hO{*kO!W&Xa~P'vOo0cOv0qOz*hO!W&Xa~P'vOz*hO{*kO!W&Xa~Om0dOn0dOo0mOp0nOgjikjisjizji!Tji!Uji%{ji!Wji{ji![ji#gji%[ji%_ji!Qji#[jitji!mji%zji~Ol0fO~P!NkOlji~P!NkOV'|Og*pOo0cOv0qO~P'vOn*rO~Og*pOz*tO~Og*uO~OV'|Oo0cOv0qO!W&Si~P'vOz*vO!W&Si~O!W*wO~OV(]Oo0cOv0qO![%}i#g%}i%[%}i%_%}ig%}i{%}i!m%}i%z%}i~P'vOz*zO!T%dO!U%cO![&Ti~Oz*}O![%}i#g%}i%[%}i%_%}ig%}i{%}i!m%}i%z%}i~O![+OO~Oa+QOo0cOv0qO![&Ti~P'vOz*zO![&Ti~O![+SO~OV+UOo0cOv0qO{&la![&la!m&la%z&la~P'vOz+VO{&la![&la!m&la%z&la~O!]+YO&n+[O![!nX~O![+^O~O{(kO![+_O~O{(kO![+_O!m+`O~OV&OOopOvqO{%hq!x%hq#g%hq%[%hq%_%hq%z%hq~P'vOz$ri{$ri!x$ri#g$ri%[$ri%_$ri%z$ri~P%SOV&OOopOvqO~P'vOV&OOo0cOv0qO#g%ha%[%ha%_%ha%z%ha~P'vOz+aO#g%ha%[%ha%_%ha%z%ha~Oz$ia#g$ia%[$ia%_$ian$ia~P%SO#g&Pi%[&Pi%_&Pin&Pi~P'vOz+dO#g#Wq%[#Wq%_#Wq~O#[+eOz$va#g$va%[$va%_$vag$va~O%uWO#g&ri%[&ri%_&rig&ri~Oz+gO#g&ri%[&ri%_&rig&ri~OV+iOh$WO%uWO~O%uWO#g&ti%[&ti%_&ti~Oo0cOv0qO#g&pi%[&pi%_&pi{&pi~P'vO{#{Oz#eX!W#eX~Oz+mO!W&uX~O!W+oO~Ot+rO#j)gOP#hqV#hqf#hqh#hqo#hqs#hqv#hq!P#hq!Q#hq!T#hq!U#hq!X#hq!]#hq!h#hq!r#hq!s#hq!t#hq!{#hq!}#hq#P#hq#R#hq#T#hq#X#hq#Z#hq#^#hq#_#hq#a#hq#c#hq#l#hq#o#hq#s#hq#u#hq#z#hq#}#hq$P#hq%X#hq%o#hq%p#hq%t#hq%u#hq&Z#hq&[#hq&]#hq&^#hq&_#hq&`#hq&a#hq&b#hq&c#hq&d#hq&e#hq&f#hq&g#hq&h#hq&i#hq&j#hq%Z#hq%_#hq~On$|az$|a~P%SOV)kOn&wi~P'vOz+yOn&wi~Oz,TO{$jO#[,TO~O#q,VOP#nqV#nqf#nqh#nqo#nqs#nqv#nq!P#nq!Q#nq!T#nq!U#nq!X#nq!]#nq!h#nq!r#nq!s#nq!t#nq!{#nq!}#nq#P#nq#R#nq#T#nq#X#nq#Z#nq#^#nq#_#nq#a#nq#c#nq#l#nq#o#nq#s#nq#u#nq#z#nq#}#nq$P#nq%X#nq%o#nq%p#nq%t#nq%u#nq&Z#nq&[#nq&]#nq&^#nq&_#nq&`#nq&a#nq&b#nq&c#nq&d#nq&e#nq&f#nq&g#nq&h#nq&i#nq&j#nq%Z#nq%_#nq~O#[,WOz%Oa{%Oa~Oo0cOv0qO{&xi~P'vOz,YO{&xi~O{#{O%z,[Og&zXz&zX~O%uWOg&zXz&zX~Oz,`Og&yX~Og,bO~O%Y,eO~O!T%dO!U%cOg&Viz&Vi~OV$}Oa$}Oo0cOv0qOg&Ui~P'vO{,hOz$la!W$la~Oo0cOv0qO{,iOz$la!W$la~P'vOo0cOv0qO{*gO!W&Xi~P'vOz,lO!W&Xi~Oo0cOv0qOz,lO!W&Xi~P'vOz,lO{,oO!W&Xi~Og$hiz$hi!W$hi~P%SOV'|Oo0cOv0qO~P'vOn,qO~OV'|Og,rOo0cOv0qO~P'vOV'|Oo0cOv0qO!W&Sq~P'vOz$gi![$gi#g$gi%[$gi%_$gig$gi{$gi!m$gi%z$gi~P%SOV(]Oo0cOv0qO~P'vOa+QOo0cOv0qO![&Tq~P'vOz,sO![&Tq~O![,tO~OV(]Oo0cOv0qO![%}q#g%}q%[%}q%_%}qg%}q{%}q!m%}q%z%}q~P'vO{,uO~OV+UOo0cOv0qO{&li![&li!m&li%z&li~P'vOz,zO{&li![&li!m&li%z&li~O!]+YO&n+[O![!na~O{(kO![,}O~OV&OOo0cOv0qO#g%hi%[%hi%_%hi%z%hi~P'vOz-OO#g%hi%[%hi%_%hi%z%hi~O%uWO#g&rq%[&rq%_&rqg&rq~Oz-RO#g&rq%[&rq%_&rqg&rq~OV)`Oa)`O%uWO!W&ua~Oz-TO!W&ua~On$|iz$|i~P%SOV)kO~P'vOV)kOn&wq~P'vOt-XOP#myV#myf#myh#myo#mys#myv#my!P#my!Q#my!T#my!U#my!X#my!]#my!h#my!r#my!s#my!t#my!{#my!}#my#P#my#R#my#T#my#X#my#Z#my#^#my#_#my#a#my#c#my#l#my#o#my#s#my#u#my#z#my#}#my$P#my%X#my%o#my%p#my%t#my%u#my&Z#my&[#my&]#my&^#my&_#my&`#my&a#my&b#my&c#my&d#my&e#my&f#my&g#my&h#my&i#my&j#my%Z#my%_#my~O%Z-]O%_-]O~P`O#q-^OP#nyV#nyf#nyh#nyo#nys#nyv#ny!P#ny!Q#ny!T#ny!U#ny!X#ny!]#ny!h#ny!r#ny!s#ny!t#ny!{#ny!}#ny#P#ny#R#ny#T#ny#X#ny#Z#ny#^#ny#_#ny#a#ny#c#ny#l#ny#o#ny#s#ny#u#ny#z#ny#}#ny$P#ny%X#ny%o#ny%p#ny%t#ny%u#ny&Z#ny&[#ny&]#ny&^#ny&_#ny&`#ny&a#ny&b#ny&c#ny&d#ny&e#ny&f#ny&g#ny&h#ny&i#ny&j#ny%Z#ny%_#ny~Oz-aO{$jO#[-aO~Oo0cOv0qO{&xq~P'vOz-dO{&xq~O%z,[Og&zaz&za~O{#{Og&zaz&za~OV*SOa*TO%q*UO%uWOg&ya~Oz-hOg&ya~O$S-lO~OV$}Oa$}Oo0cOv0qO~P'vOo0cOv0qO{-mOz$li!W$li~P'vOo0cOv0qOz$li!W$li~P'vO{-mOz$li!W$li~Oo0cOv0qO{*gO~P'vOo0cOv0qO{*gO!W&Xq~P'vOz-pO!W&Xq~Oo0cOv0qOz-pO!W&Xq~P'vOs-sO!T%dO!U%cOg&Oq!W&Oq![&Oqz&Oq~P!/jOa+QOo0cOv0qO![&Ty~P'vOz$ji![$ji~P%SOa+QOo0cOv0qO~P'vOV+UOo0cOv0qO~P'vOV+UOo0cOv0qO{&lq![&lq!m&lq%z&lq~P'vO{(kO![-xO!m-yO%z-wO~OV&OOo0cOv0qO#g%hq%[%hq%_%hq%z%hq~P'vO%uWO#g&ry%[&ry%_&ryg&ry~OV)`Oa)`O%uWO!W&ui~Ot-}OP#m!RV#m!Rf#m!Rh#m!Ro#m!Rs#m!Rv#m!R!P#m!R!Q#m!R!T#m!R!U#m!R!X#m!R!]#m!R!h#m!R!r#m!R!s#m!R!t#m!R!{#m!R!}#m!R#P#m!R#R#m!R#T#m!R#X#m!R#Z#m!R#^#m!R#_#m!R#a#m!R#c#m!R#l#m!R#o#m!R#s#m!R#u#m!R#z#m!R#}#m!R$P#m!R%X#m!R%o#m!R%p#m!R%t#m!R%u#m!R&Z#m!R&[#m!R&]#m!R&^#m!R&_#m!R&`#m!R&a#m!R&b#m!R&c#m!R&d#m!R&e#m!R&f#m!R&g#m!R&h#m!R&i#m!R&j#m!R%Z#m!R%_#m!R~Oo0cOv0qO{&xy~P'vOV*SOa*TO%q*UO%uWOg&yi~O$S-lO%Z.VO%_.VO~OV.aOh._O!X.^O!].`O!h.YO!s.[O!t.[O%p.XO%uWO&Z]O&[]O&]]O&^]O&_]O&`]O&a]O&b]O~Oo0cOv0qOz$lq!W$lq~P'vO{.fOz$lq!W$lq~Oo0cOv0qO{*gO!W&Xy~P'vOz.gO!W&Xy~Oo0cOv.kO~P'vOs-sO!T%dO!U%cOg&Oy!W&Oy![&Oyz&Oy~P!/jO{(kO![.nO~O{(kO![.nO!m.oO~OV*SOa*TO%q*UO%uWO~Oh.tO!f.rOz$TX#[$TX%j$TXg$TX~Os$TX{$TX!W$TX![$TX~P$-bO%o.vO%p.vOs$UXz$UX{$UX#[$UX%j$UX!W$UXg$UX![$UX~O!h.xO~Oz.|O#[/OO%j.yOs&|X{&|X!W&|Xg&|X~Oa/RO~P$)zOh.tOs&}Xz&}X{&}X#[&}X%j&}X!W&}Xg&}X![&}X~Os/VO{$jO~Oo0cOv0qOz$ly!W$ly~P'vOo0cOv0qO{*gO!W&X!R~P'vOz/ZO!W&X!R~Og&RXs&RX!T&RX!U&RX!W&RX![&RXz&RX~P!/jOs-sO!T%dO!U%cOg&Qa!W&Qa![&Qaz&Qa~O{(kO![/^O~O!f.rOh$[as$[az$[a{$[a#[$[a%j$[a!W$[ag$[a![$[a~O!h/eO~O%o.vO%p.vOs$Uaz$Ua{$Ua#[$Ua%j$Ua!W$Uag$Ua![$Ua~O%j.yOs$Yaz$Ya{$Ya#[$Ya!W$Yag$Ya![$Ya~Os&|a{&|a!W&|ag&|a~P$)nOz/jOs&|a{&|a!W&|ag&|a~O!W/mO~Og/mO~O{/oO~O![/pO~Oo0cOv0qO{*gO!W&X!Z~P'vO{/sO~O%z/tO~P$-bOz/uO#[/OO%j.yOg'PX~Oz/uOg'PX~Og/wO~O!h/xO~O#[/OOs%Saz%Sa{%Sa%j%Sa!W%Sag%Sa![%Sa~O#[/OO%j.yOs%Waz%Wa{%Wa!W%Wag%Wa~Os&|i{&|i!W&|ig&|i~P$)nOz/zO#[/OO%j.yO!['Oa~Og'Pa~P$)nOz0SOg'Pa~Oa0UO!['Oi~P$)zOz0WO!['Oi~Oz0WO#[/OO%j.yO!['Oi~O#[/OO%j.yOg$biz$bi~O%z0ZO~P$-bO#[/OO%j.yOg%Vaz%Va~Og'Pi~P$)nO{0^O~Oa0UO!['Oq~P$)zOz0`O!['Oq~O#[/OO%j.yOz%Ui![%Ui~Oa0UO~P$)zOa0UO!['Oy~P$)zO#[/OO%j.yOg$ciz$ci~O#[/OO%j.yOz%Uq![%Uq~Oz+aO#g%ha%[%ha%_%ha%z%ha~P%SOV&OOo0cOv0qO~P'vOn0hO~Oo0hO~P'vO{0iO~Ot0jO~P!/jO&]&Z&j&h&i&g&f&d&e&c&b&`&a&_&^&[%u~",goto:"!=j'QPPPPPP'RP'Z*s+[+t,_,y-fP.SP'Z.r.r'ZPPP'Z2[PPPPPP2[5PPP5PP7b7k=sPP=v>h>kPP'Z'ZPP>zPP'Z'ZPP'Z'Z'Z'Z'Z?O?w'ZP?zP@QDXGuGyPG|HWH['ZPPPH_Hk'RP'R'RP'RP'RP'RP'RP'R'R'RP'RPP'RPP'RP'RPHqH}IVPI^IdPI^PI^I^PPPI^PKrPK{LVL]KrPI^LfPI^PLmLsPLwM]MzNeLwLwNkNxLwLwLwLw! ^! d! g! l! o! y!!P!!]!!o!!u!#P!#V!#s!#y!$P!$Z!$a!$g!$y!%T!%Z!%a!%k!%q!%w!%}!&T!&Z!&e!&k!&u!&{!'U!'[!'k!'s!'}!(UPPPPPPPPPPP!([!(_!(e!(n!(x!)TPPPPPPPPPPPP!-u!/Z!3^!6oPP!6w!7W!7a!8Y!8P!8c!8i!8l!8o!8r!8z!9jPPPPPPPPPPPPPPPPP!9m!9q!9wP!:]!:a!:m!:v!;S!;j!;m!;p!;v!;|!<S!<VP!<_!<h!=d!=g]eOn#g$j)t,P'}`OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0r{!cQ#c#p$R$d$p%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g}!dQ#c#p$R$d$p$u%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g!P!eQ#c#p$R$d$p$u$v%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g!R!fQ#c#p$R$d$p$u$v$w%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g!T!gQ#c#p$R$d$p$u$v$w$x%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g!V!hQ#c#p$R$d$p$u$v$w$x$y%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g!Z!hQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v0g'}TOTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0r&eVOYZ[dnprxy}!P!Q!U!i!k!o!p!q!s!t#[#d#g#y#{#}$Q$h$j$}%S%Z%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0n0r%oXOYZ[dnrxy}!P!Q!U!i!k#[#d#g#y#{#}$Q$h$j$}%S%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,s,u,w,y,z-O-d-f-m-p.f.g/V/Z0i0j0kQ#vqQ/[.kR0o0q't`OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rh#jhz{$W$Z&l&q)S)X+f+g-RW#rq&].k0qQ$]|Q$a!OQ$n!VQ$o!WW$|!i'm*d,gS&[#s#tQ'S$iQ(s&UQ)U&nU)Y&s)Z+jW)a&w+m-T-{Q*Q']W*R'_,`-h.TQ+l)`S,_*S*TQ-Q+eQ-_,TQ-c,WQ.R-al.W-l.^._.a.z.|/R/j/o/t/y0U0Z0^Q/S.`Q/a.tQ/l/OU0P/u0S0[X0V/z0W0_0`R&Z#r!_!wYZ!P!Q!k%S%`%g'p'r's(O(W)g*g*h*k*q*t*v,h,i,k,l,o-m-p.f.g/ZR%^!vQ!{YQ%x#[Q&d#}Q&g$QR,{+YT.j-s/s!Y!jQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v0gQ&X#kQ'c$oR*^'dR'l$|Q%V!mR/_.r'|_OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rS#a_#b!P.[-l.^._.`.a.t.z.|/R/j/o/t/u/y/z0S0U0W0Z0[0^0_0`'|_OTYZ[adnoprtxy}!P!Q!R!U!X!c!d!e!f!g!h!i!k!o!p!q!s!t!z#O#S#T#[#d#g#x#y#{#}$Q$e$g$h$j$q$}%S%Z%^%`%c%g%l%n%w%|&O&Z&_&h&j&k&u&x&|'P'W'Z'l'm'p'r's'w'|(O(S(W(](^(d(g(p(r(z(})^)e)g)k)l)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+Q+U+V+Y+a+c+d+k+x+y,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0l0n0rT#a_#bT#^^#_R(o%xa(l%x(n(o+`,{-y-z.oT+[(k+]R-z,{Q$PsQ+l)aQ,^*RR-e,_X#}s$O$P&fQ&y$aQ'a$nQ'd$oR)s'SQ)b&wV-S+m-T-{ZgOn$j)t,PXkOn)t,PQ$k!TQ&z$bQ&{$cQ'^$mQ'b$oQ)q'RQ)x'WQ){'XQ)|'YQ*Z'`S*]'c'dQ+s)gQ+u)hQ+v)iQ+z)oS+|)r*[Q,Q)vQ,R)wS,S)y)zQ,d*^Q-V+rQ-W+tQ-Y+{S-Z+},OQ-`,UQ-b,VQ-|-XQ.O-[Q.P-^Q.Q-_Q.p-}Q.q.RQ/W.dR/r/XWkOn)t,PR#mjQ'`$nS)r'S'aR,O)sQ,]*RR-f,^Q*['`Q+})rR-[,OZiOjn)t,PQ'f$pR*`'gT-j,e-ku.c-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^t.c-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^Q/S.`X0V/z0W0_0`!P.Z-l.^._.`.a.t.z.|/R/j/o/t/u/y/z0S0U0W0Z0[0^0_0`Q.w.YR/f.xg.z.].{/b/i/n/|0O0Q0]0a0bu.b-l.^._.a.t.z.|/R/j/o/t/u/y0S0U0Z0[0^X.u.W.b/a0PR/c.tV0R/u0S0[R/X.dQnOS#on,PR,P)tQ&^#uR(x&^S%m#R#wS(_%m(bT(b%p&`Q%a!yQ%h!}W(P%a%h(U(YQ(U%eR(Y%jQ&i$RR)O&iQ(e%qQ*{(`T+R(e*{Q'n%OR*e'nS'q%R%SY*i'q*j,m-q.hU*j'r's'tU,m*k*l*mS-q,n,oR.h-rQ#Y]R%t#YQ#_^R%y#_Q(h%vS+W(h+XR+X(iQ+](kR,|+]Q#b_R%{#bQ#ebQ%}#cW&Q#e%}({+bQ({&cR+b0gQ$OsS&e$O&fR&f$PQ&v$_R)_&vQ&V#jR(t&VQ&m$VS)T&m+hR+h)UQ$Z{R&p$ZQ&t$]R)[&tQ+n)bR-U+nQ#hfR&S#hQ)f&zR+q)fQ&}$dS)m&})nR)n'OQ'V$kR)u'VQ'[$lS*P'[,ZR,Z*QQ,a*VR-i,aWjOn)t,PR#ljQ-k,eR.U-kd.{.]/b/i/n/|0O0Q0]0a0bR/h.{U.s.W/a0PR/`.sQ/{/nS0X/{0YR0Y/|S/v/b/cR0T/vQ.}.]R/k.}R!ZPXmOn)t,PWlOn)t,PR'T$jYfOn$j)t,PR&R#g[sOn#g$j)t,PR&d#}&dQOYZ[dnprxy}!P!Q!U!i!k!o!p!q!s!t#[#d#g#y#{#}$Q$h$j$}%S%Z%^%`%g%l%n%w%|&Z&_&j&k&u&x'P'W'Z'l'm'p'r's'w(O(W(^(d(g(p(r(z)^)e)g)p)t)z*O*Y*d*g*h*k*q*r*t*v*y*z*}+U+V+Y+a+d+k,P,X,Y,],g,h,i,k,l,o,q,s,u,w,y,z-O-d-f-m-p-s.f.g/V/Z/s0c0d0e0f0h0i0j0k0n0rQ!nTQ#caQ#poU$Rt%c(SS$d!R$gQ$p!XQ$u!cQ$v!dQ$w!eQ$x!fQ$y!gQ$z!hQ%e!zQ%j#OQ%p#SQ%q#TQ&`#xQ'O$eQ'g$qQ(q&OU(|&h(}+cW)j&|)l+x+yQ*o'|Q*x(]Q+w)kQ,v+QR0g0lQ!yYQ!}ZQ$b!PQ$c!QQ%R!kQ't%S^'{%`%g(O(W*q*t*v^*f'p*h,k,l-p.g/ZQ*l'rQ*m'sQ+t)gQ,j*gQ,n*kQ-n,hQ-o,iQ-r,oQ.e-mR/Y.f[bOn#g$j)t,P!^!vYZ!P!Q!k%S%`%g'p'r's(O(W)g*g*h*k*q*t*v,h,i,k,l,o-m-p.f.g/ZQ#R[Q#fdS#wrxQ$UyW$_}$Q'P)pS$l!U$hW${!i'm*d,gS%v#[+Y`&P#d%|(p(r(z+a-O0kQ&a#yQ&b#{Q&c#}Q'j$}Q'z%^W([%l(^*y*}Q(`%nQ(i%wQ(v&ZS(y&_0iQ)P&jQ)Q&kU)]&u)^+kQ)d&xQ)y'WY)}'Z*O,X,Y-dQ*b'lS*n'w0jW+P(d*z,s,wW+T(g+V,y,zQ+p)eQ,U)zQ,c*YQ,x+UQ-P+dQ-e,]Q-v,uQ.S-fR/q/VhUOn#d#g$j%|&_'w(p(r)t,P%U!uYZ[drxy}!P!Q!U!i!k#[#y#{#}$Q$h$}%S%^%`%g%l%n%w&Z&j&k&u&x'P'W'Z'l'm'p'r's(O(W(^(d(g(z)^)e)g)p)z*O*Y*d*g*h*k*q*t*v*y*z*}+U+V+Y+a+d+k,X,Y,],g,h,i,k,l,o,s,u,w,y,z-O-d-f-m-p.f.g/V/Z0i0j0kQ#qpW%W!o!s0d0nQ%X!pQ%Y!qQ%[!tQ%f0cS'v%Z0hQ'x0eQ'y0fQ,p*rQ-u,qS.i-s/sR0p0rU#uq.k0qR(w&][cOn#g$j)t,PZ!xY#[#}$Q+YQ#W[Q#zrR$TxQ%b!yQ%i!}Q%o#RQ'j${Q(V%eQ(Z%jQ(c%pQ(f%qQ*|(`Q,f*bQ-t,pQ.m-uR/].lQ$StQ(R%cR*s(SQ.l-sR/}/sR#QZR#V[R%Q!iQ%O!iV*c'm*d,g!Z!lQ!n#c#p$R$d$p$u$v$w$x$y$z%e%j%p%q&`'O'g(q(|)j*o*x+w,v0gR%T!kT#]^#_Q%x#[R,{+YQ(m%xS+_(n(oQ,}+`Q-x,{S.n-y-zR/^.oT+Z(k+]Q$`}Q&g$QQ)o'PR+{)pQ$XzQ)W&qR+i)XQ$XzQ&o$WQ)W&qR+i)XQ#khW$Vz$W&q)XQ$[{Q&r$ZZ)R&l)S+f+g-RR$^|R)c&wXlOn)t,PQ$f!RR'Q$gQ$m!UR'R$hR*X'_Q*V'_V-g,`-h.TQ.d-lQ/P.^R/Q._U.]-l.^._Q/U.aQ/b.tQ/g.zU/i.|/j/yQ/n/RQ/|/oQ0O/tU0Q/u0S0[Q0]0UQ0a0ZR0b0^R/T.`R/d.t",nodeNames:"⚠ print Escape { Comment Script AssignStatement * BinaryExpression BitOp BitOp BitOp BitOp ArithOp ArithOp @ ArithOp ** UnaryExpression ArithOp BitOp AwaitExpression await ) ( ParenthesizedExpression BinaryExpression or and CompareOp in not is UnaryExpression ConditionalExpression if else LambdaExpression lambda ParamList VariableName AssignOp , : NamedExpression AssignOp YieldExpression yield from TupleExpression ComprehensionExpression async for LambdaExpression ] [ ArrayExpression ArrayComprehensionExpression } { DictionaryExpression DictionaryComprehensionExpression SetExpression SetComprehensionExpression CallExpression ArgList AssignOp MemberExpression . PropertyName Number String FormatString FormatReplacement FormatSelfDoc FormatConversion FormatSpec FormatReplacement FormatSelfDoc ContinuedString Ellipsis None Boolean TypeDef AssignOp UpdateStatement UpdateOp ExpressionStatement DeleteStatement del PassStatement pass BreakStatement break ContinueStatement continue ReturnStatement return YieldStatement PrintStatement RaiseStatement raise ImportStatement import as ScopeStatement global nonlocal AssertStatement assert TypeDefinition type TypeParamList TypeParam StatementGroup ; IfStatement Body elif WhileStatement while ForStatement TryStatement try except finally WithStatement with FunctionDefinition def ParamList AssignOp TypeDef ClassDefinition class DecoratedStatement Decorator At MatchStatement match MatchBody MatchClause case CapturePattern LiteralPattern ArithOp ArithOp AsPattern OrPattern LogicOp AttributePattern SequencePattern MappingPattern StarPattern ClassPattern PatternArgList KeywordPattern KeywordPattern Guard",maxTerm:277,context:cR,nodeProps:[["isolate",-5,4,71,72,73,77,""],["group",-15,6,85,87,88,90,92,94,96,98,99,100,102,105,108,110,"Statement Statement",-22,8,18,21,25,40,49,50,56,57,60,61,62,63,64,67,70,71,72,79,80,81,82,"Expression",-10,114,116,119,121,122,126,128,133,135,138,"Statement",-9,143,144,147,148,150,151,152,153,154,"Pattern"],["openedBy",23,"(",54,"[",58,"{"],["closedBy",24,")",55,"]",59,"}"]],propSources:[fR],skippedNodes:[0,4],repeatNodeCount:34,tokenData:"!2|~R!`OX%TXY%oY[%T[]%o]p%Tpq%oqr'ars)Yst*xtu%Tuv,dvw-hwx.Uxy/tyz0[z{0r{|2S|}2p}!O3W!O!P4_!P!Q:Z!Q!R;k!R![>_![!]Do!]!^Es!^!_FZ!_!`Gk!`!aHX!a!b%T!b!cIf!c!dJU!d!eK^!e!hJU!h!i!#f!i!tJU!t!u!,|!u!wJU!w!x!.t!x!}JU!}#O!0S#O#P&o#P#Q!0j#Q#R!1Q#R#SJU#S#T%T#T#UJU#U#VK^#V#YJU#Y#Z!#f#Z#fJU#f#g!,|#g#iJU#i#j!.t#j#oJU#o#p!1n#p#q!1s#q#r!2a#r#s!2f#s$g%T$g;'SJU;'S;=`KW<%lOJU`%YT&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T`%lP;=`<%l%To%v]&n`%c_OX%TXY%oY[%T[]%o]p%Tpq%oq#O%T#O#P&o#P#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To&tX&n`OY%TYZ%oZ]%T]^%o^#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc'f[&n`O!_%T!_!`([!`#T%T#T#U(r#U#f%T#f#g(r#g#h(r#h#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc(cTmR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc(yT!mR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk)aV&n`&[ZOr%Trs)vs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk){V&n`Or%Trs*bs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk*iT&n`&^ZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To+PZS_&n`OY*xYZ%TZ]*x]^%T^#o*x#o#p+r#p#q*x#q#r+r#r;'S*x;'S;=`,^<%lO*x_+wTS_OY+rZ]+r^;'S+r;'S;=`,W<%lO+r_,ZP;=`<%l+ro,aP;=`<%l*xj,kV%rQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj-XT!xY&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj-oV%lQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk.]V&n`&ZZOw%Twx.rx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk.wV&n`Ow%Twx/^x#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk/eT&n`&]ZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk/{ThZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc0cTgR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk0yXVZ&n`Oz%Tz{1f{!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk1mVaR&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk2ZV%oZ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc2wTzR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To3_W%pZ&n`O!_%T!_!`-Q!`!a3w!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Td4OT&{S&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk4fX!fQ&n`O!O%T!O!P5R!P!Q%T!Q![6T![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk5WV&n`O!O%T!O!P5m!P#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk5tT!rZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti6[a!hX&n`O!Q%T!Q![6T![!g%T!g!h7a!h!l%T!l!m9s!m#R%T#R#S6T#S#X%T#X#Y7a#Y#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti7fZ&n`O{%T{|8X|}%T}!O8X!O!Q%T!Q![8s![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti8^V&n`O!Q%T!Q![8s![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti8z]!hX&n`O!Q%T!Q![8s![!l%T!l!m9s!m#R%T#R#S8s#S#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti9zT!hX&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk:bX%qR&n`O!P%T!P!Q:}!Q!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj;UV%sQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti;ro!hX&n`O!O%T!O!P=s!P!Q%T!Q![>_![!d%T!d!e?q!e!g%T!g!h7a!h!l%T!l!m9s!m!q%T!q!rA]!r!z%T!z!{Bq!{#R%T#R#S>_#S#U%T#U#V?q#V#X%T#X#Y7a#Y#^%T#^#_9s#_#c%T#c#dA]#d#l%T#l#mBq#m#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti=xV&n`O!Q%T!Q![6T![#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti>fc!hX&n`O!O%T!O!P=s!P!Q%T!Q![>_![!g%T!g!h7a!h!l%T!l!m9s!m#R%T#R#S>_#S#X%T#X#Y7a#Y#^%T#^#_9s#_#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti?vY&n`O!Q%T!Q!R@f!R!S@f!S#R%T#R#S@f#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Ti@mY!hX&n`O!Q%T!Q!R@f!R!S@f!S#R%T#R#S@f#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiAbX&n`O!Q%T!Q!YA}!Y#R%T#R#SA}#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiBUX!hX&n`O!Q%T!Q!YA}!Y#R%T#R#SA}#S#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiBv]&n`O!Q%T!Q![Co![!c%T!c!iCo!i#R%T#R#SCo#S#T%T#T#ZCo#Z#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TiCv]!hX&n`O!Q%T!Q![Co![!c%T!c!iCo!i#R%T#R#SCo#S#T%T#T#ZCo#Z#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%ToDvV{_&n`O!_%T!_!`E]!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TcEdT%{R&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkEzT#gZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkFbXmR&n`O!^%T!^!_F}!_!`([!`!a([!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TjGUV%mQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkGrV%zZ&n`O!_%T!_!`([!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkH`WmR&n`O!_%T!_!`([!`!aHx!a#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TjIPV%nQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkIoV_Q#}P&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%ToJ_]&n`&YS%uZO!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUoKZP;=`<%lJUoKge&n`&YS%uZOr%Trs)Ysw%Twx.Ux!Q%T!Q![JU![!c%T!c!tJU!t!uLx!u!}JU!}#R%T#R#SJU#S#T%T#T#fJU#f#gLx#g#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUoMRa&n`&YS%uZOr%TrsNWsw%Twx! vx!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUkN_V&n`&`ZOr%TrsNts#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%TkNyV&n`Or%Trs! `s#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk! gT&n`&bZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk! }V&n`&_ZOw%Twx!!dx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!!iV&n`Ow%Twx!#Ox#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!#VT&n`&aZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!#oe&n`&YS%uZOr%Trs!%Qsw%Twx!&px!Q%T!Q![JU![!c%T!c!tJU!t!u!(`!u!}JU!}#R%T#R#SJU#S#T%T#T#fJU#f#g!(`#g#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!%XV&n`&dZOr%Trs!%ns#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!%sV&n`Or%Trs!&Ys#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!&aT&n`&fZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!&wV&n`&cZOw%Twx!'^x#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!'cV&n`Ow%Twx!'xx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!(PT&n`&eZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!(ia&n`&YS%uZOr%Trs!)nsw%Twx!+^x!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!)uV&n`&hZOr%Trs!*[s#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!*aV&n`Or%Trs!*vs#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!*}T&n`&jZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!+eV&n`&gZOw%Twx!+zx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!,PV&n`Ow%Twx!,fx#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tk!,mT&n`&iZO#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%To!-Vi&n`&YS%uZOr%TrsNWsw%Twx! vx!Q%T!Q![JU![!c%T!c!dJU!d!eLx!e!hJU!h!i!(`!i!}JU!}#R%T#R#SJU#S#T%T#T#UJU#U#VLx#V#YJU#Y#Z!(`#Z#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUo!.}a&n`&YS%uZOr%Trs)Ysw%Twx.Ux!Q%T!Q![JU![!c%T!c!}JU!}#R%T#R#SJU#S#T%T#T#oJU#p#q%T#r$g%T$g;'SJU;'S;=`KW<%lOJUk!0ZT!XZ&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tc!0qT!WR&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%Tj!1XV%kQ&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T~!1sO!]~k!1zV%jR&n`O!_%T!_!`-Q!`#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T~!2fO![~i!2mT%tX&n`O#o%T#p#q%T#r;'S%T;'S;=`%i<%lO%T",tokenizers:[dR,aR,iR,hR,0,1,2,3,4],topRules:{Script:[0,5]},specialized:[{term:221,get:r=>mR[r]||-1}],tokenPrec:7668}),zg=new RT,ow=new Set(["Script","Body","FunctionDefinition","ClassDefinition","LambdaExpression","ForStatement","MatchClause"]);function ll(r){return(t,s,n)=>{if(n)return!1;let i=t.node.getChild("VariableName");return i&&s(i,r),!0}}const gR={FunctionDefinition:ll("function"),ClassDefinition:ll("class"),ForStatement(r,t,s){if(s){for(let n=r.node.firstChild;n;n=n.nextSibling)if(n.name=="VariableName")t(n,"variable");else if(n.name=="in")break}},ImportStatement(r,t){var s,n;let{node:i}=r,a=((s=i.firstChild)===null||s===void 0?void 0:s.name)=="from";for(let o=i.getChild("import");o;o=o.nextSibling)o.name=="VariableName"&&((n=o.nextSibling)===null||n===void 0?void 0:n.name)!="as"&&t(o,a?"variable":"namespace")},AssignStatement(r,t){for(let s=r.node.firstChild;s;s=s.nextSibling)if(s.name=="VariableName")t(s,"variable");else if(s.name==":"||s.name=="AssignOp")break},ParamList(r,t){for(let s=null,n=r.node.firstChild;n;n=n.nextSibling)n.name=="VariableName"&&(!s||!/\*|AssignOp/.test(s.name))&&t(n,"variable"),s=n},CapturePattern:ll("variable"),AsPattern:ll("variable"),__proto__:null};function lw(r,t){let s=zg.get(t);if(s)return s;let n=[],i=!0;function a(o,l){let c=r.sliceString(o.from,o.to);n.push({label:c,type:l})}return t.cursor(us.IncludeAnonymous).iterate(o=>{if(o.name){let l=gR[o.name];if(l&&l(o,a,i)||!i&&ow.has(o.name))return!1;i=!1}else if(o.to-o.from>8192){for(let l of lw(r,o.node))n.push(l);return!1}}),zg.set(t,n),n}const Bg=/^[\w\xa1-\uffff][\w\d\xa1-\uffff]*$/,cw=["String","FormatString","Comment","PropertyName"];function xR(r){let t=xs(r.state).resolveInner(r.pos,-1);if(cw.indexOf(t.name)>-1)return null;let s=t.name=="VariableName"||t.to-t.from<20&&Bg.test(r.state.sliceDoc(t.from,t.to));if(!s&&!r.explicit)return null;let n=[];for(let i=t;i;i=i.parent)ow.has(i.name)&&(n=n.concat(lw(r.state.doc,i)));return{options:n,from:s?t.from:r.pos,validFor:Bg}}const yR=["__annotations__","__builtins__","__debug__","__doc__","__import__","__name__","__loader__","__package__","__spec__","False","None","True"].map(r=>({label:r,type:"constant"})).concat(["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EncodingWarning","EnvironmentError","Exception","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","ModuleNotFoundError","NameError","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError"].map(r=>({label:r,type:"type"}))).concat(["bool","bytearray","bytes","classmethod","complex","float","frozenset","int","list","map","memoryview","object","range","set","staticmethod","str","super","tuple","type"].map(r=>({label:r,type:"class"}))).concat(["abs","aiter","all","anext","any","ascii","bin","breakpoint","callable","chr","compile","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","format","getattr","globals","hasattr","hash","help","hex","id","input","isinstance","issubclass","iter","len","license","locals","max","min","next","oct","open","ord","pow","print","property","quit","repr","reversed","round","setattr","slice","sorted","sum","vars","zip"].map(r=>({label:r,type:"function"}))),jR=[on("def ${name}(${params}):\n	${}",{label:"def",detail:"function",type:"keyword"}),on("for ${name} in ${collection}:\n	${}",{label:"for",detail:"loop",type:"keyword"}),on("while ${}:\n	${}",{label:"while",detail:"loop",type:"keyword"}),on("try:\n	${}\nexcept ${error}:\n	${}",{label:"try",detail:"/ except block",type:"keyword"}),on(`if \${}:
	
`,{label:"if",detail:"block",type:"keyword"}),on("if ${}:\n	${}\nelse:\n	${}",{label:"if",detail:"/ else block",type:"keyword"}),on("class ${name}:\n	def __init__(self, ${params}):\n			${}",{label:"class",detail:"definition",type:"keyword"}),on("import ${module}",{label:"import",detail:"statement",type:"keyword"}),on("from ${module} import ${names}",{label:"from",detail:"import",type:"keyword"})],bR=vE(cw,Nv(yR.concat(jR)));function Qd(r){let{node:t,pos:s}=r,n=r.lineIndent(s,-1),i=null;for(;;){let a=t.childBefore(s);if(a)if(a.name=="Comment")s=a.from;else if(a.name=="Body"||a.name=="MatchBody")r.baseIndentFor(a)+r.unit<=n&&(i=a),t=a;else if(a.name=="MatchClause")t=a;else if(a.type.is("Statement"))t=a;else break;else break}return i}function qd(r,t){let s=r.baseIndentFor(t),n=r.lineAt(r.pos,-1),i=n.from+n.text.length;return/^\s*($|#)/.test(n.text)&&r.node.to<i+100&&!/\S/.test(r.state.sliceDoc(i,r.node.to))&&r.lineIndent(r.pos,-1)<=s||/^\s*(else:|elif |except |finally:|case\s+[^=:]+:)/.test(r.textAfter)&&r.lineIndent(r.pos,-1)>s?null:s+r.unit}const Hd=Kl.define({name:"python",parser:pR.configure({props:[R0.add({Body:r=>{var t;let s=/^\s*(#|$)/.test(r.textAfter)&&Qd(r)||r.node;return(t=qd(r,s))!==null&&t!==void 0?t:r.continue()},MatchBody:r=>{var t;let s=Qd(r);return(t=qd(r,s||r.node))!==null&&t!==void 0?t:r.continue()},IfStatement:r=>/^\s*(else:|elif )/.test(r.textAfter)?r.baseIndent:r.continue(),"ForStatement WhileStatement":r=>/^\s*else:/.test(r.textAfter)?r.baseIndent:r.continue(),TryStatement:r=>/^\s*(except[ :]|finally:|else:)/.test(r.textAfter)?r.baseIndent:r.continue(),MatchStatement:r=>/^\s*case /.test(r.textAfter)?r.baseIndent+r.unit:r.continue(),"TupleExpression ComprehensionExpression ParamList ArgList ParenthesizedExpression":Pd({closing:")"}),"DictionaryExpression DictionaryComprehensionExpression SetExpression SetComprehensionExpression":Pd({closing:"}"}),"ArrayExpression ArrayComprehensionExpression":Pd({closing:"]"}),MemberExpression:r=>r.baseIndent+r.unit,"String FormatString":()=>null,Script:r=>{var t;let s=Qd(r);return(t=s&&qd(r,s))!==null&&t!==void 0?t:r.continue()}}),F0.add({"ArrayExpression DictionaryExpression SetExpression TupleExpression":iP,Body:(r,t)=>({from:r.from+1,to:r.to-(r.to==t.doc.length?0:1)}),"String FormatString":(r,t)=>({from:t.doc.lineAt(r.from).to,to:r.to})})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"'''",'"""'],stringPrefixes:["f","fr","rf","r","u","b","br","rb","F","FR","RF","R","U","B","BR","RB"]},commentTokens:{line:"#"},indentOnInput:/^\s*([\}\]\)]|else:|elif |except |finally:|case\s+[^:]*:?)$/}});function vR(){return new GT(Hd,[Hd.data.of({autocomplete:xR}),Hd.data.of({autocomplete:bR})])}const wR={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"},sr=wR&&"http://localhost:5001"||"",zs=r=>{if(!r?.equity||!r?.trades)return{};const t=r.equity,s=r.trades,n=t.slice(1).map((I,N)=>(I.value-t[N].value)/t[N].value),i=n.filter(I=>I<0),a=Math.sqrt(i.reduce((I,N)=>I+N*N,0)/i.length),o=n.length>0?n.reduce((I,N)=>I+N,0)/n.length/(a||1):0,l=r.metrics?.maxDrawdown||0,c=l!==0?(r.metrics?.annualizedReturn||0)/Math.abs(l):0,h=.08,u=n.map(I=>I-h/252),m=Math.sqrt(u.reduce((I,N)=>I+N*N,0)/u.length),p=m!==0?u.reduce((I,N)=>I+N,0)/u.length/m:0,x=s.length>1?s.slice(1).reduce((I,N,k)=>{const S=new Date(s[k].date),L=new Date(N.date);return I+(L-S)/(1e3*60*60*24)},0)/(s.length-1):0,b=s.filter(I=>(I.pnl||0)>0),w=s.filter(I=>(I.pnl||0)<0),C=b.reduce((I,N)=>I+(N.pnl||0),0),A=Math.abs(w.reduce((I,N)=>I+(N.pnl||0),0)),_=A!==0?C/A:0,R=b.length>0?C/b.length:0,E=w.length>0?A/w.length:0,T=s.length>0?b.length/s.length*100:0,M=T/100*R-(100-T)/100*E;return{sortinoRatio:o,calmarRatio:c,informationRatio:p*Math.sqrt(252),avgTradeDuration:x,profitFactor:_,expectancy:M,avgWin:R,avgLoss:E,grossProfit:C,grossLoss:A}},Gd={symbol:"",strategy:"",startDate:"",endDate:""};function SR(){const{user:r,isAuthenticated:t,isLoading:s}=ps(),n=window.location.hostname==="localhost",[i,a]=j.useState(Gd),[o,l]=j.useState(null),[c,h]=j.useState(!1),[u,m]=j.useState(null),[p,x]=j.useState([]),[b,w]=j.useState([]),[C,A]=j.useState({}),[_,R]=j.useState(""),[E,T]=j.useState(""),[M,I]=j.useState(!1),[N,k]=j.useState(""),[S,L]=j.useState([]),[W,F]=j.useState(!1),[$,q]=j.useState(null),[ne,he]=j.useState(""),[re,G]=j.useState("equity"),[H,P]=j.useState(!1),[D,Y]=j.useState(null),[ce,ae]=j.useState(!1),[ee,te]=j.useState({name:"",description:"",code:"",isPublic:!1}),[Pe,Be]=j.useState(null),[et,De]=j.useState([]),[ze,ve]=j.useState("all"),[B,pe]=j.useState({}),[je,xe]=j.useState([]),[v,ie]=j.useState(!1),[Q,Z]=j.useState({current:0,total:0}),[K,ue]=j.useState([]),[$e,Le]=j.useState(!1),[O,Ce]=j.useState(0),[At,Bt]=j.useState(!1),[or,bi]=j.useState({}),qt=j.useMemo(()=>{const se=Array.isArray(b)?b.find(Se=>Se.id===i.strategy):null;return se?se.id==="moving_average_crossover"?[{name:"shortPeriod",label:"Short MA Period",type:"number",default:20},{name:"longPeriod",label:"Long MA Period",type:"number",default:50}]:se.id==="rsi_strategy"?[{name:"rsiOversold",label:"RSI Oversold",type:"number",default:30},{name:"rsiOverbought",label:"RSI Overbought",type:"number",default:70}]:[]:[]},[b,i.strategy]);j.useEffect(()=>{fetch(`${sr}/api/backtest/symbols`).then(se=>se.json()).then(se=>x(se.symbols||[])).catch(()=>{x([{symbol:"AAPL"},{symbol:"MSFT"},{symbol:"GOOGL"},{symbol:"TSLA"},{symbol:"NVDA"},{symbol:"AMZN"},{symbol:"META"},{symbol:"SPY"},{symbol:"QQQ"}])}),fetch(`${sr}/api/backtest/templates`).then(se=>se.json()).then(se=>w(se.templates||[])).catch(()=>{w([{id:"moving_average_crossover",name:"Moving Average Crossover",code:"MA_CROSSOVER_CODE"},{id:"rsi_strategy",name:"RSI Strategy",code:"RSI_STRATEGY_CODE"},{id:"mean_reversion",name:"Mean Reversion",code:"MEAN_REVERSION_CODE"}])})},[]);const As=j.useCallback(async()=>{const se=r?.token||(n?"dev-bypass-token":null);if(!se){const Se=JSON.parse(localStorage.getItem("backtester_strategies")||"[]");L(Se);return}try{const Se={"Content-Type":"application/json",Authorization:`Bearer ${se}`},Re=await fetch(`${sr}/api/backtest/strategies`,{headers:Se});if(Re.ok){const vt=await Re.json();L(vt.strategies||[])}}catch{const Re=JSON.parse(localStorage.getItem("backtester_strategies")||"[]");L(Re)}},[r,n]);j.useEffect(()=>{if(t&&r)As();else{const se=JSON.parse(localStorage.getItem("backtester_strategies")||"[]");L(se)}},[t,r,As]);const ko=async()=>{if(!ee.name.trim()){console.warn("⚠️ Backtest: Strategy name validation failed"),m("Please enter a strategy name");return}const se={...ee,code:M?E:_,params:C,createdAt:new Date().toISOString(),author:r?.username||r?.email||"Anonymous",userId:r?.id||null};try{const Se=r?.token||(n?"dev-bypass-token":null);if(t&&Se){const Re={"Content-Type":"application/json",Authorization:`Bearer ${Se}`};if((await fetch(`${sr}/api/backtest/strategies`,{method:"POST",headers:Re,body:JSON.stringify(se)})).ok)await As();else throw new Error("Failed to save strategy to server")}else{const Re=JSON.parse(localStorage.getItem("backtester_strategies")||"[]"),vt=Date.now().toString();Re.push({...se,id:vt}),localStorage.setItem("backtester_strategies",JSON.stringify(Re)),L(Re)}ae(!1),te({name:"",description:"",code:"",isPublic:!1})}catch{m("Failed to save strategy. Please try again.")}},Co=se=>{se.code&&(se.language==="python"||M?(T(se.code),I(!0)):R(se.code)),se.params&&A(se.params),Be(se)},Ao=async se=>{if(confirm("Are you sure you want to delete this strategy?"))try{const Se=r?.token||(n?"dev-bypass-token":null);if(t&&Se){const Re={"Content-Type":"application/json",Authorization:`Bearer ${Se}`};(await fetch(`${sr}/backtest/strategies/${se}`,{method:"DELETE",headers:Re})).ok&&await As()}else{const vt=JSON.parse(localStorage.getItem("backtester_strategies")||"[]").filter(yt=>yt.id!==se);localStorage.setItem("backtester_strategies",JSON.stringify(vt)),L(vt)}}catch{}};j.useEffect(()=>{const se=Array.isArray(b)?b.find(Se=>Se.id===i.strategy):null;if(R(se?.code||""),qt.length){const Se={};qt.forEach(Re=>{Se[Re.name]=Re.default}),A(Se)}},[i.strategy,b,qt]);const vi=(se,Se)=>{a(Re=>({...Re,[se]:Se}))},ca=(se,Se)=>{A(Re=>({...Re,[se]:Se}))},To=async()=>{h(!0),P(!0),m(null),l(null),k("");try{let se,Se;if(M)se=await fetch(`${sr}/api/backtest/run-python`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:E})}),Se=await se.json();else{const Re={...i,...C,strategy:i.strategy};se=await fetch(`${sr}/api/backtest/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Re)}),Se=await se.json()}if(!Se.success)throw new Error(Se.error||"Backtest failed");l(Se),k(Se.logs||Se.stdout||""),G("equity")}catch(se){m(se.message)}finally{h(!1),P(!1)}},da=()=>{P(!1),h(!1),m("Backtest stopped by user.")},wi=()=>{if(!o)return;const se=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),Se=URL.createObjectURL(se),Re=document.createElement("a");Re.href=Se,Re.download=`backtest_${i.symbol}_${i.strategy}.json`,Re.click(),URL.revokeObjectURL(Se)},ha=()=>{if(!N)return;const se=new Blob([N],{type:"text/plain"}),Se=URL.createObjectURL(se),Re=document.createElement("a");Re.href=Se,Re.download=`backtest_logs_${i.symbol}_${i.strategy||"custom"}.txt`,Re.click(),URL.revokeObjectURL(Se)},qc=se=>{Array.isArray(b)&&b.find(Se=>Se.id===se),vi("strategy",se)},Nt=()=>{if(!o?.trades?.length)return;const se=["Date,Action,Price,Shares,PnL",...o.trades.map(yt=>`${yt.date},${yt.action},${yt.price},${yt.shares},${yt.pnl}`)].join(`
`),Se=new Blob([se],{type:"text/csv"}),Re=URL.createObjectURL(Se),vt=document.createElement("a");vt.href=Re,vt.download=`backtest_trades_${i.symbol}_${i.strategy||"custom"}.csv`,vt.click(),URL.revokeObjectURL(Re)},Js=`import requests

url = '${sr}/backtest/run'
payload = {
    'symbol': '${i.symbol}',
    'strategy_code': '''
${E.replace(/'/g,"''")}
''',
    'language': 'python'
}
response = requests.post(url, json=payload)
print(response.json())`,kn=`curl -X POST '${sr}/backtest/run' \\
  -H 'Content-Type: application/json' \\
  -d '{
    "symbol": "${i.symbol}",
    "strategy_code": """
${E.replace(/"/g,'"')}
""",
    "language": "python"
  }'`,Rr=()=>{navigator.clipboard.writeText(Js)},Ww=async()=>{q("pending"),he("");try{const Se=await(await fetch(`${sr}/api/backtest/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:E})})).json();Se.valid?(q("success"),he("Code is valid!")):(q("error"),he(Se.error||"Invalid code"))}catch(se){q("error"),he(se.message)}},Uf=se=>{if(!se||se.length===0)return[];let Se=se[0].value;return se.map(Re=>(Re.value>Se&&(Se=Re.value),{date:Re.date,drawdown:(Re.value-Se)/Se*100}))},$w=async se=>{const Se=S.find(Zt=>Zt.id===se);if(!Se)return;const Re=prompt("Enter a new name for this strategy:",Se.name);if(!Re||Re===Se.name)return;await fetch(`${sr}/api/backtest/strategies/${se}`,{method:"DELETE"});const yt=await(await fetch(`${sr}/api/backtest/strategies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Re,code:Se.code,language:Se.language})})).json();L(Zt=>Zt.filter(lr=>lr.id!==se).concat(yt.strategy))},Vw=()=>{if(!qt.length)return[];const se=qt.map(Re=>Re.name);return se.map(Re=>{const vt=B[Re];if(!vt)return[C[Re]??qt.find(yt=>yt.name===Re)?.default];if(vt.includes(","))return vt.split(",").map(yt=>parseFloat(yt.trim()));if(vt.includes("-")&&vt.includes(":")){const[yt,Zt]=vt.split("-"),[lr,qw]=Zt.split(":"),Qf=[];for(let Hc=parseFloat(yt);Hc<=parseFloat(lr);Hc+=parseFloat(qw))Qf.push(Hc);return Qf}return[parseFloat(vt)]}).reduce((Re,vt)=>Re.flatMap(yt=>vt.map(Zt=>[].concat(yt,Zt))),[[]]).map(Re=>{const vt={};return Re.forEach((yt,Zt)=>{vt[se[Zt]]=yt}),vt})},zw=(se,Se)=>{pe(Re=>({...Re,[se]:Se}))},Bw=async()=>{const se=Vw();if(se.length){ie(!0),Z({current:0,total:se.length}),xe([]);for(let Se=0;Se<se.length&&v;++Se){const Re=se[Se],vt={...i,...Re,strategy:i.strategy};try{const Zt=await(await fetch(`${sr}/api/backtest/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(vt)})).json();xe(lr=>[...lr,{params:Re,metrics:Zt.metrics,success:Zt.success,error:Zt.error}])}catch(yt){xe(Zt=>[...Zt,{params:Re,metrics:null,success:!1,error:yt.message}])}Z({current:Se+1,total:se.length})}ie(!1)}},Uw=()=>{ie(!1)},Qw=()=>{Bt(!0),Le(!1)};return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Institutional Backtester"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Professional-grade strategy testing with advanced analytics and risk management"}),e.jsxs(g,{display:"flex",gap:1,mt:1,children:[e.jsx(X,{label:"Live Execution",color:"primary",size:"small",variant:"filled"}),e.jsx(X,{label:"Risk Analytics",color:"success",size:"small",variant:"outlined"}),e.jsx(X,{label:"Advanced Metrics",color:"primary",size:"small",variant:"filled"}),e.jsx(X,{label:"Multi-Asset",color:"secondary",size:"small",variant:"filled"})]})]}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[s?e.jsx(Je,{size:24}):t?e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(La,{color:"primary"}),e.jsx(d,{variant:"body2",color:"primary",children:r?.username||r?.email||"User"})]}):e.jsx(X,{label:"Guest Mode",color:"secondary",size:"small",variant:"filled"}),e.jsx(ii,{badgeContent:S.length,color:"primary",children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(dS,{}),onClick:()=>ae(!0),size:"small",children:"My Strategies"})}),e.jsx(tt,{title:"Save current strategy",arrow:!0,children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Ni,{}),onClick:()=>{te({name:"",description:"",code:M?E:_,isPublic:!1}),ae(!0)},size:"small",children:"Save Strategy"})}),e.jsx(tt,{title:"Start a new blank strategy",arrow:!0,children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Fn,{}),onClick:()=>{T(""),a(Gd),A({}),l(null),m(null),Be(null)},size:"small",children:"New Strategy"})})]})]}),e.jsxs(z,{sx:{mb:4},children:[e.jsx(Ue,{title:"Strategy Configuration",subheader:"Configure your backtesting parameters and strategy logic",action:e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(X,{label:i.symbol||"No Symbol",color:"primary",variant:"outlined"}),e.jsx(X,{label:i.strategy||"No Strategy",color:"secondary",variant:"outlined"})]})}),e.jsx(Fe,{}),e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(tt,{title:"Choose a symbol to backtest",arrow:!0,children:e.jsx(hu,{options:p.map(se=>typeof se=="string"?se:se.symbol||se),value:i.symbol||null,onChange:(se,Se)=>vi("symbol",Se||""),isOptionEqualToValue:(se,Se)=>se===Se,renderInput:se=>e.jsx(_e,{...se,label:"Symbol",fullWidth:!0,size:"small"})})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(tt,{title:"Select a strategy template or your own",arrow:!0,children:e.jsx(_e,{select:!0,label:"Strategy",value:i.strategy,onChange:se=>qc(se.target.value),fullWidth:!0,size:"small",children:b.map(se=>e.jsx(J,{value:se.id,children:se.name},se.id))})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(tt,{title:"Backtest start date",arrow:!0,children:e.jsx(_e,{label:"Start Date",type:"date",value:i.startDate,onChange:se=>vi("startDate",se.target.value),fullWidth:!0,size:"small",InputLabelProps:{shrink:!0}})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(tt,{title:"Backtest end date",arrow:!0,children:e.jsx(_e,{label:"End Date",type:"date",value:i.endDate,onChange:se=>vi("endDate",se.target.value),fullWidth:!0,size:"small",InputLabelProps:{shrink:!0}})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(g,{display:"flex",flexWrap:"wrap",gap:2,children:qt.map(se=>e.jsx(tt,{title:se.label,arrow:!0,children:e.jsx(_e,{label:se.label,type:se.type,value:C[se.name]??se.default,onChange:Se=>ca(se.name,Se.target.value),size:"small",sx:{width:180}})},se.name))})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",sx:{mb:1},children:"Strategy Code"}),e.jsx(tt,{title:"Paste or edit your strategy code here. Python only.",arrow:!0,children:e.jsx("span",{children:e.jsx(Gf,{fontSize:"small",color:"action"})})})]}),e.jsx(He,{sx:{p:0,mb:2,background:"#f7f7f7"},children:e.jsx(g,{ref:se=>{se&&setTimeout(()=>{const Se=se.querySelector(".cm-content");Se&&Se.setAttribute("aria-label","Python backtest strategy code editor")},100)},children:e.jsx(Jv,{value:E,height:"300px",extensions:[vR()],onChange:se=>T(se),theme:"light"})})}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Ni,{}),onClick:ko,sx:{mb:2,mr:2},children:"Save Strategy"}),e.jsx(tt,{title:_?"Clone the selected strategy code":"Select a strategy to clone",arrow:!0,children:e.jsx("span",{children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Pi,{}),sx:{mb:2,mr:2},onClick:()=>T(_),disabled:!_,children:"Clone from Selected"})})}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Pi,{}),sx:{mb:2},onClick:()=>T(""),children:"Clear"})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(oe,{variant:"contained",color:"primary",startIcon:c||H?e.jsx(Je,{size:16,color:"inherit"}):e.jsx(Gr,{}),onClick:To,disabled:c||H||!i.symbol,size:"large",sx:{minWidth:180,height:48},children:c||H?"Running...":"Run Backtest"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(ml,{}),onClick:da,disabled:!H,color:"error",size:"large",children:"Stop"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Es,{}),onClick:()=>{a(Gd),l(null),m(null),T(""),A({})},disabled:c||H,size:"large",children:"Reset"}),e.jsx(tt,{title:"Quick validation check",children:e.jsx("span",{children:e.jsx(Ge,{onClick:Ww,disabled:!E.trim()||$==="pending",color:$==="success"?"success":$==="error"?"error":"default",children:$==="pending"?e.jsx(Je,{size:20}):$==="success"?e.jsx(Yr,{}):$==="error"?e.jsx(Ar,{}):e.jsx(lo,{})})})})]}),ne&&e.jsx(we,{severity:$==="success"?"success":"error",sx:{mt:2},variant:"outlined",children:ne})]})]})})]}),u&&e.jsx(we,{severity:"error",sx:{mb:3},children:u}),o&&e.jsxs(z,{sx:{mb:4,bgcolor:"primary.dark",color:"primary.contrastText"},children:[e.jsx(Ue,{title:"Performance Dashboard",subheader:"Real-time strategy performance metrics",action:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(X,{label:o.metrics?.totalReturn>=0?"PROFITABLE":"LOSS",color:o.metrics?.totalReturn>=0?"success":"error",size:"small"}),e.jsxs(d,{variant:"caption",sx:{opacity:.8},children:["Last Updated: ",new Date().toLocaleTimeString()]})]})}),e.jsxs(U,{children:[e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsxs(d,{variant:"h4",fontWeight:"bold",children:[o.metrics?.totalReturn?.toFixed(2)??"--","%"]}),e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Total Return"}),e.jsx(g,{display:"flex",alignItems:"center",justifyContent:"center",mt:1,children:(o.metrics?.totalReturn??0)>=0?e.jsx(at,{color:"success"}):e.jsx(Tt,{color:"error"})})]})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h4",fontWeight:"bold",children:o.metrics?.sharpeRatio?.toFixed(2)??"--"}),e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Sharpe Ratio"}),e.jsx(rt,{variant:"determinate",value:Math.min((o.metrics?.sharpeRatio??0)*50,100),sx:{mt:1,bgcolor:"rgba(255,255,255,0.2)"}})]})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsxs(d,{variant:"h4",fontWeight:"bold",children:[o.metrics?.maxDrawdown?.toFixed(2)??"--","%"]}),e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Max Drawdown"}),e.jsx(rt,{variant:"determinate",value:Math.min(Math.abs(o.metrics?.maxDrawdown??0),100),color:"error",sx:{mt:1,bgcolor:"rgba(255,255,255,0.2)"}})]})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h4",fontWeight:"bold",children:o.metrics?.totalTrades??"--"}),e.jsx(d,{variant:"body2",sx:{opacity:.8},children:"Total Trades"}),e.jsxs(d,{variant:"body2",sx:{opacity:.6,mt:1},children:[o.metrics?.winRate?.toFixed(1)??"--","% Win Rate"]})]})})]}),e.jsx(Fe,{sx:{my:3,bgcolor:"rgba(255,255,255,0.2)"}}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,children:e.jsx(X,{label:`Annualized: ${o.metrics?.annualizedReturn?.toFixed(2)??"--"}%`,variant:"outlined",sx:{color:"inherit",borderColor:"rgba(255,255,255,0.5)"}})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Volatility: ${o.metrics?.volatility?.toFixed(2)??"--"}%`,variant:"outlined",sx:{color:"inherit",borderColor:"rgba(255,255,255,0.5)"}})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Profit Factor: ${o.metrics?.profitFactor?.toFixed(2)??"--"}`,variant:"outlined",sx:{color:"inherit",borderColor:"rgba(255,255,255,0.5)"}})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Sortino: ${zs(o).sortinoRatio?.toFixed(2)??"--"}`,variant:"outlined",sx:{color:"inherit",borderColor:"rgba(255,255,255,0.5)"}})}),e.jsx(y,{item:!0,children:e.jsx(X,{label:`Calmar: ${zs(o).calmarRatio?.toFixed(2)??"--"}`,variant:"outlined",sx:{color:"inherit",borderColor:"rgba(255,255,255,0.5)"}})})]})]})]}),e.jsxs(He,{sx:{p:3,position:"relative",minHeight:400},children:[(c||H)&&e.jsx(g,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(255,255,255,0.7)",zIndex:2,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Je,{size:48})}),o&&e.jsxs(Ir,{value:re,onChange:(se,Se)=>G(Se),sx:{mb:2},children:[e.jsx(it,{label:"Equity Curve",value:"equity"}),e.jsx(it,{label:"Drawdown",value:"drawdown"}),e.jsx(it,{label:"Trades",value:"trades"}),e.jsx(it,{label:"Logs",value:"logs"}),e.jsx(it,{label:"Summary",value:"summary"}),o?.metrics?.custom&&Object.keys(o.metrics.custom).length>0&&Object.keys(o.metrics.custom).map((se,Se)=>e.jsx(it,{label:`Metric: ${se}`,value:`custom_${se}`},se))]}),o&&re==="equity"&&o.equity&&e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"subtitle2",children:"Equity Curve"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Ks,{data:o.equity.map(se=>({date:se.date,value:se.value})),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",hide:!0}),e.jsx(ht,{}),e.jsx(ot,{}),e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:"#1976d2",strokeWidth:2,dot:{r:0},name:"Equity Curve"})]})})]}),o&&re==="drawdown"&&o.equity&&e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"subtitle2",children:"Drawdown Chart"}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:Uf(o.equity),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",hide:!0}),e.jsx(ht,{domain:[Math.min(...Uf(o.equity).map(se=>se.drawdown)),0]}),e.jsx(ot,{}),e.jsx(jt,{dataKey:"drawdown",fill:"#ff7043",name:"Drawdown (%)"})]})})]}),o&&re==="trades"&&o.trades&&o.trades.length>0&&e.jsxs(g,{mt:3,children:[e.jsx(d,{variant:"subtitle2",children:"Trade Statistics"}),e.jsx(Ae,{component:He,sx:{mb:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Action"}),e.jsx(f,{children:"Price"}),e.jsx(f,{children:"Shares"}),e.jsx(f,{children:"PnL"})]})}),e.jsx(ke,{children:o.trades.map((se,Se)=>e.jsxs(V,{children:[e.jsx(f,{children:se.date}),e.jsx(f,{children:se.symbol}),e.jsx(f,{children:se.action}),e.jsx(f,{children:se.price}),e.jsx(f,{children:se.quantity||se.shares}),e.jsx(f,{children:se.pnl!==void 0?se.pnl.toFixed(2):""})]},Se))})]})}),e.jsx(oe,{variant:"outlined",sx:{mb:2},onClick:Nt,children:"Export Trades (CSV)"})]}),o&&re==="logs"&&e.jsxs(g,{mt:2,children:[e.jsx(d,{variant:"subtitle2",color:"text.secondary",children:"Backtest Logs / Output"}),e.jsx(He,{sx:{p:2,fontFamily:"monospace",fontSize:13,whiteSpace:"pre",overflowX:"auto",background:"#f7f7f7"},children:N}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kr,{}),sx:{mb:2,mt:2},onClick:ha,children:"Download Logs"})]}),o&&re==="summary"&&o.metrics&&e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"subtitle1",fontWeight:"bold",children:"Performance Summary"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Total Return: ${o.metrics.totalReturn?.toFixed(2)}%`,color:"success"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Annualized: ${o.metrics.annualizedReturn?.toFixed(2)}%`,color:"info"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Sharpe: ${o.metrics.sharpeRatio?.toFixed(2)}`,color:"primary"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Max Drawdown: ${o.metrics.maxDrawdown?.toFixed(2)}%`,color:"warning"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Volatility: ${o.metrics.volatility?.toFixed(2)}%`,color:"default"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Win Rate: ${o.metrics.winRate?.toFixed(2)}%`,color:"success"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Profit Factor: ${o.metrics.profitFactor?.toFixed(2)}`,color:"info"})}),e.jsx(y,{item:!0,xs:6,md:3,children:e.jsx(X,{label:`Trades: ${o.metrics.totalTrades}`,color:"secondary"})})]})]}),o&&e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kf,{}),sx:{mb:2,mr:2},onClick:wi,children:"Export Results"}),o&&e.jsxs(oe,{variant:"text",startIcon:e.jsx(Pi,{}),sx:{mb:2,ml:2},onClick:()=>F(se=>!se),children:[W?"Hide":"Show"," API Example"]}),o&&W&&e.jsxs(He,{sx:{p:2,fontFamily:"monospace",fontSize:13,whiteSpace:"pre",overflowX:"auto",background:"#f7f7f7",mb:2},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx("span",{children:"Python API Example"}),e.jsx(oe,{size:"small",startIcon:e.jsx(Pi,{}),onClick:Rr,children:"Copy"})]}),Js,e.jsx(g,{mt:2}),e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx("span",{children:"cURL API Example"}),e.jsx(oe,{size:"small",startIcon:e.jsx(Pi,{}),onClick:()=>navigator.clipboard.writeText(kn),children:"Copy"})]}),kn]}),re.startsWith("custom_")&&o?.metrics?.custom&&(()=>{const se=re.replace("custom_",""),Se=o.metrics.custom[se];return Se?e.jsxs(g,{mb:2,children:[e.jsxs(d,{variant:"subtitle2",children:["Custom Metric: ",se]}),e.jsx(st,{width:"100%",height:300,children:e.jsxs(Ks,{data:Se.map(Re=>({date:Re.date||Re[0],value:Re.value??Re[1]})),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",hide:!0}),e.jsx(ht,{}),e.jsx(ot,{}),e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:"#8e24aa",strokeWidth:2,dot:{r:0},name:se})]})})]}):null})()]}),K.length>0&&e.jsx(z,{sx:{mt:4},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",children:"Batch Run Progress"}),e.jsxs(g,{sx:{width:"100%",mb:2},children:[e.jsx(rt,{variant:"determinate",value:O*100}),e.jsxs(d,{variant:"body2",children:[Math.round(O*100),"% complete"]})]}),e.jsx(oe,{variant:"outlined",color:"error",onClick:Qw,disabled:!$e,children:"Cancel Batch"}),e.jsx(Ae,{component:He,sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Params"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Result"}),e.jsx(f,{children:"Error"})]})}),e.jsx(ke,{children:K.map((se,Se)=>e.jsxs(V,{children:[e.jsx(f,{children:JSON.stringify(se.params)}),e.jsx(f,{children:se.status}),e.jsx(f,{children:se.result?"✅":""}),e.jsx(f,{children:se.error})]},Se))})]})}),e.jsx(oe,{variant:"outlined",sx:{mt:2},onClick:()=>{const se=K.filter(lr=>lr.result).map(lr=>({...lr.params,...lr.result.metrics})),Re=[Object.keys(se[0]||{}).join(","),...se.map(lr=>Object.values(lr).join(","))].join(`
`),vt=new Blob([Re],{type:"text/csv"}),yt=URL.createObjectURL(vt),Zt=document.createElement("a");Zt.href=yt,Zt.download="batch_results.csv",Zt.click(),URL.revokeObjectURL(yt)},children:"Export All Results (CSV)"})]})}),o&&e.jsxs(z,{sx:{mb:4},children:[e.jsx(Ue,{title:"Advanced Risk Analytics",subheader:"Institutional-grade performance and risk metrics",action:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kr,{}),onClick:wi,size:"small",children:"Export"})}),e.jsxs(U,{children:[e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"h6",children:"Risk-Adjusted Returns"})}),e.jsx(os,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(He,{sx:{p:2,textAlign:"center"},children:[e.jsx(d,{variant:"h5",color:"primary",children:zs(o).sortinoRatio?.toFixed(3)??"--"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Sortino Ratio"}),e.jsx(d,{variant:"caption",display:"block",children:"Downside risk-adjusted return"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(He,{sx:{p:2,textAlign:"center"},children:[e.jsx(d,{variant:"h5",color:"secondary",children:zs(o).calmarRatio?.toFixed(3)??"--"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Calmar Ratio"}),e.jsx(d,{variant:"caption",display:"block",children:"Return vs maximum drawdown"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(He,{sx:{p:2,textAlign:"center"},children:[e.jsx(d,{variant:"h5",color:"info.main",children:zs(o).informationRatio?.toFixed(3)??"--"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Information Ratio"}),e.jsx(d,{variant:"caption",display:"block",children:"Active return vs tracking error"})]})})]})})]}),e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsx(d,{variant:"h6",children:"Trade Analytics"})}),e.jsx(os,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:2},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Trade Distribution"}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Average Win"}),e.jsxs(d,{variant:"body2",color:"success.main",children:["$",zs(o).avgWin?.toFixed(2)??"--"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Average Loss"}),e.jsxs(d,{variant:"body2",color:"error.main",children:["$",zs(o).avgLoss?.toFixed(2)??"--"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Expectancy"}),e.jsxs(d,{variant:"body2",color:zs(o).expectancy>=0?"success.main":"error.main",children:["$",zs(o).expectancy?.toFixed(2)??"--"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",children:[e.jsx(d,{variant:"body2",children:"Avg Trade Duration"}),e.jsxs(d,{variant:"body2",children:[zs(o).avgTradeDuration?.toFixed(1)??"--"," ","days"]})]})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:2},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Profit Analysis"}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Gross Profit"}),e.jsxs(d,{variant:"body2",color:"success.main",children:["$",zs(o).grossProfit?.toFixed(2)??"--"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Gross Loss"}),e.jsxs(d,{variant:"body2",color:"error.main",children:["$",zs(o).grossLoss?.toFixed(2)??"--"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",children:[e.jsx(d,{variant:"body2",children:"Profit Factor"}),e.jsx(d,{variant:"body2",color:zs(o).profitFactor>=1?"success.main":"error.main",children:zs(o).profitFactor?.toFixed(2)??"--"})]})]})})]})})]})]})]}),e.jsxs(z,{sx:{mt:4},children:[e.jsx(Ue,{title:"Strategy Library",subheader:"Manage and version your trading strategies",action:e.jsx(ii,{badgeContent:S.length,color:"primary",children:e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Ni,{}),size:"small",children:"Strategies"})})}),e.jsx(U,{children:e.jsx(Ae,{component:He,sx:{mb:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Actions"}),e.jsx(f,{children:"History"})]})}),e.jsx(ke,{children:S.map(se=>e.jsxs(V,{children:[e.jsx(f,{children:se.name}),e.jsxs(f,{children:[e.jsx(oe,{size:"small",onClick:()=>Co(se.code),children:"Load"}),e.jsx(oe,{size:"small",onClick:()=>$w(se.id),children:"Rename"}),e.jsx(oe,{size:"small",onClick:()=>{T(se.code),I(!0)},children:"Clone"}),e.jsx(oe,{size:"small",color:"error",onClick:()=>Ao(se.id),children:"Delete"})]}),e.jsx(f,{children:e.jsx(oe,{size:"small",onClick:()=>{console.log("📊 Strategy History for",se.name,":",or[se.id]||[]),m(`Strategy history logged to console for ${se.name}`)},children:"Show Versions"})})]},se.id))})]})})})]}),e.jsxs(z,{sx:{mb:4},children:[e.jsx(Ue,{title:"Parameter Optimization",subheader:"Grid search and parameter sweep functionality",action:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(X,{label:`${je.length} results`,color:"primary",size:"small",variant:"outlined"}),e.jsx(tt,{title:"Run a grid search over parameter values. Use comma-separated lists (e.g. 10,20,30) or range (e.g. 10-30:5 for 10,15,20,25,30).",arrow:!0,children:e.jsx("span",{children:e.jsx(Ge,{size:"small",children:e.jsx(Gf,{})})})})]})}),e.jsxs(U,{children:[e.jsx(y,{container:!0,spacing:2,children:qt.map(se=>e.jsx(y,{item:!0,xs:12,sm:4,md:3,children:e.jsx(tt,{title:se.label,arrow:!0,children:e.jsx(_e,{label:se.label,value:B[se.name]??"",onChange:Se=>zw(se.name,Se.target.value),size:"small",fullWidth:!0,placeholder:String(se.default),helperText:"List: 10,20,30 or Range: 10-30:5"})})},se.name))}),e.jsxs(g,{mt:2,display:"flex",alignItems:"center",gap:2,children:[e.jsx(oe,{variant:"contained",color:"primary",onClick:Bw,disabled:v||!qt.length,children:"Run Sweep"}),e.jsx(oe,{variant:"outlined",color:"error",onClick:Uw,disabled:!v,children:"Stop"}),v&&e.jsxs(d,{variant:"body2",children:["Progress: ",Q.current," / ",Q.total]})]}),je.length>0&&e.jsxs(g,{mt:3,children:[e.jsx(d,{variant:"subtitle2",children:"Sweep Results"}),e.jsx(Ae,{component:He,sx:{mb:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[qt.map(se=>e.jsx(f,{children:se.label},se.name)),e.jsx(f,{children:"Total Return"}),e.jsx(f,{children:"Sharpe"}),e.jsx(f,{children:"Max Drawdown"}),e.jsx(f,{children:"Success"}),e.jsx(f,{children:"Error"})]})}),e.jsx(ke,{children:je.map((se,Se)=>e.jsxs(V,{sx:{bgcolor:se.success?void 0:"#ffebee"},children:[qt.map(Re=>e.jsx(f,{children:se.params[Re.name]},Re.name)),e.jsx(f,{children:se.metrics?.totalReturn?.toFixed(2)??"--"}),e.jsx(f,{children:se.metrics?.sharpeRatio?.toFixed(2)??"--"}),e.jsx(f,{children:se.metrics?.maxDrawdown?.toFixed(2)??"--"}),e.jsx(f,{children:se.success?"Yes":"No"}),e.jsx(f,{sx:{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:se.error||""})]},Se))})]})}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kf,{}),onClick:()=>{const se=[[...qt.map(yt=>yt.label),"Total Return","Sharpe","Max Drawdown","Success","Error"].join(","),...je.map(yt=>[...qt.map(Zt=>yt.params[Zt.name]),yt.metrics?.totalReturn??"",yt.metrics?.sharpeRatio??"",yt.metrics?.maxDrawdown??"",yt.success?"Yes":"No",yt.error?'"'+yt.error.replace(/"/g,'""')+'"':""].join(","))].join(`
`),Se=new Blob([se],{type:"text/csv"}),Re=URL.createObjectURL(Se),vt=document.createElement("a");vt.href=Re,vt.download=`sweep_results_${i.symbol}_${i.strategy}.csv`,vt.click(),URL.revokeObjectURL(Re)},children:"Export Sweep Results (CSV)"})]})]})]}),e.jsxs(Os,{open:ce,onClose:()=>ae(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ls,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(d,{variant:"h6",children:"Strategy Management"}),e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(X,{label:t?"Cloud Storage":"Local Storage",color:t?"success":"warning",size:"small"}),e.jsx(ii,{badgeContent:S.length,color:"primary",children:e.jsx(Pr,{})})]})]})}),e.jsxs(ks,{children:[e.jsx(g,{sx:{mb:2},children:e.jsxs(ft,{size:"small",sx:{minWidth:120,mr:2},children:[e.jsx(mt,{children:"Filter"}),e.jsxs(pt,{value:ze,onChange:se=>ve(se.target.value),label:"Filter",children:[e.jsx(J,{value:"all",children:"All Strategies"}),e.jsx(J,{value:"mine",children:"My Strategies"}),t&&e.jsx(J,{value:"public",children:"Public Strategies"})]})]})}),ee.name!==void 0&&e.jsx(z,{sx:{mb:2,bgcolor:"grey.50"},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Save New Strategy"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{fullWidth:!0,label:"Strategy Name",value:ee.name,onChange:se=>te({...ee,name:se.target.value}),placeholder:"e.g., My RSI Strategy"})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(Jt,{control:e.jsx(rs,{checked:ee.isPublic,onChange:se=>te({...ee,isPublic:se.target.checked}),disabled:!t}),label:"Make Public"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(_e,{fullWidth:!0,label:"Description (Optional)",value:ee.description,onChange:se=>te({...ee,description:se.target.value}),multiline:!0,rows:2,placeholder:"Describe your strategy..."})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(oe,{variant:"contained",onClick:ko,children:"Save Strategy"}),e.jsx(oe,{variant:"outlined",onClick:()=>te({name:"",description:"",code:"",isPublic:!1}),children:"Cancel"})]})})]})]})}),e.jsx(Ae,{component:He,children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Name"}),e.jsx(f,{children:"Author"}),e.jsx(f,{children:"Created"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ke,{children:S.filter(se=>ze==="mine"?se.userId===r?.id||!se.userId:ze==="public"?se.isPublic:!0).map(se=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:"bold",children:se.name}),se.description&&e.jsx(d,{variant:"caption",color:"text.secondary",children:se.description})]})}),e.jsx(f,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(La,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:se.author||"Anonymous"}),se.isPublic&&e.jsx(X,{label:"Public",size:"small",color:"info"})]})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:se.createdAt?new Date(se.createdAt).toLocaleDateString():"Unknown"})}),e.jsx(f,{children:e.jsxs(g,{display:"flex",gap:1,children:[e.jsx(tt,{title:"Load Strategy",children:e.jsx(Ge,{size:"small",onClick:()=>{Co(se),ae(!1)},children:e.jsx(Gr,{})})}),(se.userId===r?.id||!t)&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{title:"Edit Strategy",children:e.jsx(Ge,{size:"small",children:e.jsx(fc,{})})}),e.jsx(tt,{title:"Delete Strategy",children:e.jsx(Ge,{size:"small",color:"error",onClick:()=>Ao(se.id),children:e.jsx(mc,{})})})]}),e.jsx(tt,{title:"Share Strategy",children:e.jsx(Ge,{size:"small",children:e.jsx(bx,{})})})]})})]},se.id))})]})}),!t&&e.jsx(we,{severity:"info",sx:{mt:2},children:e.jsx(d,{variant:"body2",children:"Sign in to save strategies to the cloud and access advanced features like sharing and collaboration."})})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>ae(!1),children:"Close"}),e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>te({name:"",description:"",code:"",isPublic:!1}),children:"New Strategy"})]})]})]})}const OR=(r,t)=>{if(r==null||r===""||r==="None")return"—";if(t.includes("price")||t.includes("level")||t.includes("target")||t==="close"||t==="open"||t==="high"||t==="low")return ge(r);if(t.includes("pct")||t.includes("percent")||t.includes("ratio")||t==="risk_reward_ratio"){const s=Number(r);return t==="risk_reward_ratio"?`${s.toFixed(1)}:1`:`${s.toFixed(2)}%`}if(t.includes("date")&&typeof r=="string")try{return new Date(r).toLocaleDateString()}catch{return r}return typeof r=="number"?Number.isInteger(r)?r:r.toFixed(2):String(r)},Ug=r=>r.includes("price")||r.includes("level")||r.includes("target")||r.includes("pct")||r.includes("percent")||r.includes("ratio")||r==="close"||r==="open"||r==="high"||r==="low"||r==="volume"?"right":"left",kR=(r,t=null)=>{if(!r||r.length===0)return[];const n=t||["symbol","company_name","signal","date","current_price","close","open","high","low","buylevel","stoplevel","selllevel","target_price","profit_target_20pct","profit_target_25pct","risk_reward_ratio","risk_pct","market_stage","stage_confidence","sata_score","entry_quality_score","next_earnings_date","days_to_earnings","rsi","adx","atr","pct_from_ema_21","pct_from_sma_50","pct_from_sma_200","volume","volume_ratio","volume_analysis","signal_state","days_in_current_state","current_gain_loss_pct"],i=Object.keys(r[0]||{});return[...n.filter(o=>i.includes(o)),...i.filter(o=>!n.includes(o)).sort()]},Qg=({error:r,title:t="Something went wrong",onRetry:s,showDetails:n=!0,severity:i="error",fullPage:a=!1})=>{const[o,l]=gn.useState(!1),c=On(),h=r?.message||r?.toString()||"Unknown error occurred",u=r?.stack,m=r?.context||{},p={error:(b,w,C)=>{console.error(`[ErrorDisplay] ${b}`,{error:w?.message||w,stack:w?.stack,context:C})}};gn.useEffect(()=>{p.error("Error displayed to user",r,{title:t,severity:i,fullPage:a,errorContext:m})},[r,t,i,a]);const x=()=>e.jsxs(e.Fragment,{children:[e.jsxs(we,{severity:i,sx:{mb:o?2:0},action:e.jsxs(g,{display:"flex",gap:1,children:[n&&e.jsx(Ge,{size:"small",onClick:()=>l(!o),"aria-label":"Toggle error details",children:o?e.jsx(vx,{}):e.jsx(Vt,{})}),s&&e.jsx(oe,{size:"small",startIcon:e.jsx(Es,{}),onClick:s,variant:"outlined",color:i,children:"Retry"})]}),children:[e.jsx(hS,{children:t}),e.jsx(d,{variant:"body2",children:h}),a&&e.jsxs(g,{sx:{mt:2,display:"flex",gap:1},children:[e.jsx(oe,{size:"small",startIcon:e.jsx(hx,{}),onClick:()=>c("/"),variant:"outlined",children:"Go Home"}),s&&e.jsx(oe,{size:"small",startIcon:e.jsx(Es,{}),onClick:s,variant:"contained",color:i,children:"Try Again"})]})]}),n&&e.jsx(uS,{in:o,children:e.jsxs(He,{variant:"outlined",sx:{p:2,bgcolor:"grey.50"},children:[e.jsxs(d,{variant:"subtitle2",gutterBottom:!0,children:[e.jsx(fS,{fontSize:"small",sx:{mr:1,verticalAlign:"middle"}}),"Error Details"]}),e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Message:"}),e.jsx(d,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:h})]}),Object.keys(m).length>0&&e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Context:"}),e.jsx(d,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.75rem"},children:JSON.stringify(m,null,2)})]}),u&&e.jsxs(g,{children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:"Stack Trace:"}),e.jsx(d,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.65rem",maxHeight:200,overflow:"auto",whiteSpace:"pre-wrap"},children:u})]}),e.jsxs(d,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Timestamp: ",new Date().toISOString()]})]})})]});return a?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",p:3,children:e.jsx(g,{maxWidth:600,width:"100%",children:e.jsx(x,{})})}):e.jsx(x,{})},CR=({message:r="Loading...",fullPage:t=!1,size:s="medium"})=>{const n={small:40,medium:60,large:80},i=()=>e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,children:[e.jsx(g,{sx:{width:n[s],height:n[s],border:"4px solid",borderColor:"primary.light",borderTopColor:"primary.main",borderRadius:"50%",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),e.jsx(d,{variant:"h6",color:"text.secondary",children:r})]});return t?e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(i,{})}):e.jsx(g,{sx:{py:4,textAlign:"center"},children:e.jsx(i,{})})},AR=({symbols:r=[],timeframe:t="7d"})=>{const s=Zs(),[n,i]=j.useState([]),[a,o]=j.useState(!0),[l,c]=j.useState({totalSignals:0,profitableSignals:0,avgReturn:0,winRate:0,bestPerformer:null,worstPerformer:null});j.useEffect(()=>{r.length>0&&h()},[r,t]);const h=async()=>{try{if(o(!0),r.length===0){i([]),c({totalSignals:0,profitableSignals:0,avgReturn:0,winRate:0,bestPerformer:null,worstPerformer:null});return}const p=r.map(async w=>{try{const C=await fetch(`/api/signals/performance/${w}?timeframe=${t}`);if(C.ok)return await C.json()}catch(C){console.warn(`Failed to fetch performance for ${w}:`,C)}return null}),b=(await Promise.all(p)).filter(w=>w!==null);if(i(b),b.length>0){const w=b.length,C=b.filter(T=>T.currentReturn>0).length,A=b.reduce((T,M)=>T+M.currentReturn,0)/w,_=C/w*100,R=b.reduce((T,M)=>M.currentReturn>(T?.currentReturn||-1/0)?M:T,null),E=b.reduce((T,M)=>M.currentReturn<(T?.currentReturn||1/0)?M:T,null);c({totalSignals:w,profitableSignals:C,avgReturn:A,winRate:_,bestPerformer:R,worstPerformer:E})}else c({totalSignals:0,profitableSignals:0,avgReturn:0,winRate:0,bestPerformer:null,worstPerformer:null})}catch(p){console.error("Error loading performance data:",p),i([])}finally{o(!1)}},u=p=>{switch(p?.toUpperCase()){case"BUY":return e.jsx(at,{sx:{color:s.palette.success.main}});case"SELL":return e.jsx(Tt,{sx:{color:s.palette.error.main}});case"HOLD":return e.jsx(Gt,{sx:{color:s.palette.warning.main}});default:return e.jsx(Pr,{sx:{color:s.palette.grey[500]}})}},m=p=>p>0?s.palette.success.main:p<0?s.palette.error.main:s.palette.grey[500];return a?e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Signal Performance Tracker"}),e.jsx(rt,{})]})}):e.jsxs(g,{children:[e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"primary.main",mx:"auto",mb:1},children:e.jsx(Pr,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:l.totalSignals}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Total Signals"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"success.main",mx:"auto",mb:1},children:e.jsx(at,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",color:"success.main",children:l.profitableSignals}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Profitable"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"info.main",mx:"auto",mb:1},children:e.jsx(xn,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",color:m(l.avgReturn),children:l.avgReturn!=null?`${l.avgReturn>0?"+":""}${l.avgReturn.toFixed(1)}%`:"N/A"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Avg Return"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"warning.main",mx:"auto",mb:1},children:e.jsx(Lt,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:l.winRate!=null?`${l.winRate.toFixed(1)}%`:"N/A"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Win Rate"})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"success.main",mx:"auto",mb:1},children:e.jsx(at,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",color:"success.main",children:l.bestPerformer&&l.bestPerformer.currentReturn!=null?`+${l.bestPerformer.currentReturn.toFixed(1)}%`:"--"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Best Signal"}),l.bestPerformer&&e.jsx(d,{variant:"caption",display:"block",children:l.bestPerformer.symbol})]})})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center"},children:[e.jsx(Mt,{sx:{bgcolor:"error.main",mx:"auto",mb:1},children:e.jsx(Tt,{})}),e.jsx(d,{variant:"h6",fontWeight:"bold",color:"error.main",children:l.worstPerformer&&l.worstPerformer.currentReturn!=null?`${l.worstPerformer.currentReturn.toFixed(1)}%`:"--"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Worst Signal"}),l.worstPerformer&&e.jsx(d,{variant:"caption",display:"block",children:l.worstPerformer.symbol})]})})})]}),e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Signal Performance Details"}),e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Signal"}),e.jsx(f,{align:"right",children:"Confidence"}),e.jsx(f,{align:"right",children:"Signal Date"}),e.jsx(f,{align:"right",children:"Days Held"}),e.jsx(f,{align:"right",children:"Current Return"}),e.jsx(f,{align:"right",children:"Performance"})]})}),e.jsx(ke,{children:n.map((p,x)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:p.symbol})}),e.jsx(f,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[u(p.signal),e.jsx(X,{label:p.signal,size:"small",color:p.signal==="BUY"?"success":p.signal==="SELL"?"error":"warning"})]})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",children:p.confidence!=null?`${(p.confidence*100).toFixed(0)}%`:"N/A"})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",children:p.signalDate})}),e.jsx(f,{align:"right",children:e.jsxs(d,{variant:"body2",children:[p.daysHeld,"d"]})}),e.jsx(f,{align:"right",children:e.jsx(d,{variant:"body2",fontWeight:"bold",color:m(p.currentReturn),children:p.currentReturn!=null?`${p.currentReturn>0?"+":""}${p.currentReturn.toFixed(1)}%`:"N/A"})}),e.jsx(f,{align:"right",children:e.jsx(rt,{variant:"determinate",value:p.currentReturn!=null?Math.min(Math.abs(p.currentReturn)*5,100):0,sx:{width:60,height:6,borderRadius:3,backgroundColor:Xe(s.palette.grey[300],.3),"& .MuiLinearProgress-bar":{backgroundColor:m(p.currentReturn)}}})})]},`${p.symbol}-${x}`))})]})})]})})]})},dr={info:r=>console.log(`[TradingSignals] ${r}`),error:r=>console.error(`[TradingSignals] ${r}`),warn:r=>console.warn(`[TradingSignals] ${r}`)};function qg(){jc("Trading Signals");const{apiUrl:r}=Xt();gn.useEffect(()=>{const P=`
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
    `;if(typeof document<"u"&&!document.getElementById("pulse-animation")){const D=document.createElement("style");D.id="pulse-animation",D.textContent=P,document.head.appendChild(D)}},[]);const[t,s]=j.useState("all"),[n,i]=j.useState("daily"),[a,o]=j.useState(0),[l,c]=j.useState(25),[h,u]=j.useState(null),[m,p]=j.useState(!1),[x,b]=j.useState(""),[w,C]=j.useState(""),[A,_]=j.useState("all"),[R,E]=j.useState(!1),T=P=>{if(!P)return!1;const D=new Date;D.setHours(0,0,0,0);const Y=new Date(P);Y.setHours(0,0,0,0);const ce=D.getTime()-Y.getTime(),ae=Math.ceil(ce/(1e3*60*60*24));switch(A){case"today":return ae===0;case"week":return ae<=7;case"month":return ae<=30;case"all":return!0;default:return!0}},{data:M,isLoading:I,error:N}=Qe({queryKey:["tradingSignals",t,n,a,l,x],queryFn:async()=>{try{const P=new URLSearchParams;t!=="all"&&P.append("signal_type",t),P.append("timeframe",n),P.append("page",a+1),P.append("limit",l),x&&P.append("symbol",x);const D=`${r}/api/signals?${P}`;dr.info("fetchTradingSignals - Request started",{url:D,signalType:t,timeframe:n});const Y=await fetch(D);if(!Y.ok){const ae=await Y.text();throw new Error(`HTTP ${Y.status}: ${ae}`)}const ce=await Y.json();return dr.info("fetchTradingSignals","Data retrieved",{recordCount:ce?.data?.length||0,totalRecords:ce?.total||0}),ce}catch(P){throw dr.error("fetchTradingSignals",P),P}},refetchOnWindowFocus:!1,staleTime:6e4,cacheTime:3e5,onError:P=>dr.queryError("tradingSignals",P,{signalType:t,timeframe:n})}),k=j.useMemo(()=>{if(!M?.data||!Array.isArray(M?.data))return null;const P=M?.data,D=P?.length||0,Y=P.filter(pe=>T(pe.date)).length,ce=P.filter(pe=>pe.signal==="Buy"||pe.signal==="BUY").length,ae=P.filter(pe=>pe.signal==="Sell"||pe.signal==="SELL").length,ee=P.filter(pe=>pe.market_stage==="Stage 2 - Advancing").length,te=P.filter(pe=>pe.entry_quality_score>=60).length,Pe=P.filter(pe=>pe.volume_analysis==="Pocket Pivot").length,Be=P.filter(pe=>pe.passes_minervini_template).length,et=P.filter(pe=>pe.inposition).length,De=P.filter(pe=>pe.risk_reward_ratio&&pe.risk_reward_ratio>0),ze=De.length>0?(De.reduce((pe,je)=>pe+parseFloat(je.risk_reward_ratio||0),0)/De.length).toFixed(1):0,ve=P.filter(pe=>pe.entry_quality_score),B=ve.length>0?Math.round(ve.reduce((pe,je)=>pe+parseInt(je.entry_quality_score||0),0)/ve.length):0;return{totalSignals:D,currentRangeSignals:Y,buySignals:ce,sellSignals:ae,stage2Signals:ee,highQualitySignals:te,pocketPivots:Pe,minerviniCompliant:Be,inPosition:et,avgRiskReward:ze,avgQualityScore:B}},[M,A]),S=j.useMemo(()=>{if(!M?.data||!Array.isArray(M?.data))return console.log("No signals data available or not array:",M),[];let P=M?.data;if(R){const D=new Date;D.setDate(D.getDate()-7),P=P.filter(Y=>Y.inposition||Y.in_position?!0:Y.signal&&Y.signal!=="None"?new Date(Y.date)>=D:!1)}return A!=="all"&&(P=P.filter(D=>T(D.date))),x&&(P=P.filter(D=>D.symbol?.toLowerCase().includes(x.toLowerCase()))),dr.info("filteredSignals","Data filtered",{originalCount:M.data?.length||0,filteredCount:P?.length||0,filters:{showActiveOnly:R,dateRange:A,symbolFilter:x}}),P},[M,R,A,x]),{data:L,isLoading:W}=Qe({queryKey:["historicalSignals",h],queryFn:async()=>{if(!h)return null;try{const P=await fetch(`${r}/api/signals?timeframe=daily&symbol=${h}&limit=50`);if(!P.ok)throw new Error("Failed to fetch historical data");return await P.json()}catch(P){throw dr.error("fetchHistoricalSignals",P,{symbol:h}),P}},enabled:!!h&&m,onError:P=>dr.queryError("historicalSignals",P,{symbol:h})}),F=()=>{b(w.trim()),o(0)},$=()=>{C(""),b(""),o(0)},{data:q,isLoading:ne}=Qe({queryKey:["tradingPerformance"],queryFn:async()=>{try{const P=`${r}/api/signals/performance`;dr.info("fetchTradingPerformance - Request started",{url:P});const D=await fetch(P);if(!D.ok){const ce=new Error(`Failed to fetch performance (${D.status})`);throw dr.error("fetchTradingPerformance",ce,{url:P,status:D.status,statusText:D.statusText}),ce}const Y=await D.json();return dr.info("fetchTradingPerformance - Request completed",Y),Y}catch(P){throw dr.error("fetchTradingPerformance",P),P}},refetchInterval:6e5,onError:P=>dr.queryError("tradingPerformance",P)});if((I||ne)&&!M)return e.jsx(lt,{maxWidth:"lg",sx:{py:4},children:e.jsx(CR,{message:"Loading trading signals and performance data...",fullPage:!0,size:"large"})});const re=(P,D)=>{const Y=P==="Buy"||P==="BUY",ce=P==="Sell"||P==="SELL",ae=P==="Hold"||P==="HOLD",ee=T(D);return e.jsx(ii,{badgeContent:ee?e.jsx(mS,{sx:{fontSize:12}}):0,color:"secondary",overlap:"circular",children:e.jsx(X,{label:P||"None",size:"medium",icon:Y?e.jsx(at,{}):ce?e.jsx(Tt,{}):e.jsx(uu,{}),sx:{backgroundColor:Y?"#059669":ce?"#DC2626":ae?"#D97706":"#6B7280",color:"white",fontWeight:"bold",fontSize:"0.875rem",minWidth:"80px",borderRadius:"16px",...ee&&{boxShadow:Y?"0 0 15px rgba(5, 150, 105, 0.6)":ce?"0 0 15px rgba(220, 38, 38, 0.6)":"0 0 15px rgba(59, 130, 246, 0.5)",animation:"pulse 2s infinite"},...Y&&{background:"linear-gradient(45deg, #059669 30%, #10B981 90%)"},...ce&&{background:"linear-gradient(45deg, #DC2626 30%, #EF4444 90%)"}}})})},G=({title:P,value:D,subtitle:Y,icon:ce,color:ae,isHighlight:ee=!1,details:te=null})=>e.jsx(z,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 12px 24px rgba(0, 0, 0, 0.15)"},...ee&&{border:"2px solid #3B82F6",boxShadow:"0 4px 20px rgba(59, 130, 246, 0.15)",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(59, 130, 246, 0) 100%)"}},children:e.jsxs(U,{sx:{flexGrow:1},children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(g,{sx:{color:ae,fontSize:24},children:ce}),e.jsx(d,{variant:"subtitle2",sx:{ml:1,fontWeight:600,color:"text.primary"},children:P})]}),e.jsx(g,{sx:{mb:1.5},children:e.jsx(d,{variant:"h3",sx:{color:ae,fontWeight:"bold",fontSize:{xs:"1.8rem",sm:"2.2rem"}},children:D})}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:te?1.5:0},children:Y}),te&&e.jsx(g,{sx:{pt:1.5,borderTop:"1px solid #E5E7EB",mt:1.5},children:Array.isArray(te)?te.map((Pe,Be)=>e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",mb:.75},children:[e.jsxs(d,{variant:"caption",color:"text.secondary",children:[Pe.label,":"]}),e.jsx(d,{variant:"caption",sx:{fontWeight:600},children:Pe.value})]},Be)):e.jsx(d,{variant:"caption",color:"text.secondary",children:te})})]})}),H=()=>{const P=kR(S);return e.jsxs(Ae,{component:He,elevation:0,sx:{overflowX:"auto"},children:[e.jsxs(Oe,{stickyHeader:!0,children:[e.jsx(Ve,{children:e.jsx(V,{children:P.map(D=>e.jsx(f,{align:Ug(D),sx:{fontWeight:"bold",whiteSpace:"nowrap",minWidth:"100px"},children:e.jsx(tt,{title:D,placement:"top",children:e.jsx("span",{children:D.replace(/_/g," ").replace(/^./,Y=>Y.toUpperCase())})})},D))})}),e.jsx(ke,{children:S?.map((D,Y)=>e.jsx(V,{hover:!0,sx:{"&:hover":{backgroundColor:"action.hover"}},children:P.map(ce=>{const ae=D[ce],ee=ce==="symbol",te=ce==="signal";return e.jsx(f,{align:Ug(ce),sx:{whiteSpace:"nowrap"},children:ee?e.jsx(oe,{variant:"text",size:"small",sx:{fontWeight:"bold",minWidth:"auto",p:.5},onClick:()=>{u(D.symbol),p(!0)},children:ae}):te?e.jsx(tt,{title:T(D.date)?`Signal in ${A==="today"?"today's":A==="week"?"this week's":A==="month"?"this month's":"selected"} range`:"Signal outside selected range",children:e.jsx(g,{children:re(ae,D.date)})}):e.jsx(d,{variant:"body2",children:OR(ae,ce)})},`${D.symbol}-${ce}`)})},`${D.symbol}-${Y}`))})]}),S?.length===0&&e.jsxs(g,{sx:{p:4,textAlign:"center"},children:[e.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No trading signals found"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:A==="all"?"No signals found. Try adjusting your timeframe or other filters.":"No signals match your current filters. Try adjusting your date range or other filters."})]})]})};return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{sx:{mb:4},children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:700,color:"primary.main"},children:"🎯 Trading Signals"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",sx:{mb:3},children:"AI-powered trading signals with real-time market analysis and institutional-grade insights"})]}),e.jsx(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4}),e.jsxs(y,{container:!0,spacing:3,mb:4,children:[k&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(G,{title:"Active Signals",value:k.totalSignals,subtitle:`${k.currentRangeSignals} in ${A==="today"?"today":A==="week"?"this week":A==="month"?"this month":"all time"}`,icon:e.jsx(ii,{badgeContent:k.currentRangeSignals,color:"secondary",children:e.jsx(xr,{})}),color:"#3B82F6",isHighlight:k.currentRangeSignals>0})}),q?.performance?.map(P=>e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(G,{title:`${P.signal} Win Rate`,value:`${(Number(P.win_rate)||0).toFixed(1)}%`,subtitle:`${P.winning_trades||0}/${P.total_signals||0} trades | Avg: ${Et((Number(P.avg_performance)||0)/100)}`,icon:P.signal==="BUY"?e.jsx(at,{}):e.jsx(Tt,{}),color:P.signal==="BUY"?"#10B981":"#DC2626"})},P.signal)),k&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(G,{title:"Buy Signals",value:k.buySignals||0,subtitle:`${Math.round((k.buySignals||0)/(k.totalSignals||1)*100)}% of signals`,icon:e.jsx(at,{}),color:"#10B981"})}),k&&e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(G,{title:"Sell Signals",value:k.sellSignals||0,subtitle:`${Math.round((k.sellSignals||0)/(k.totalSignals||1)*100)}% of signals`,icon:e.jsx(Tt,{}),color:"#DC2626"})})]}),e.jsx(z,{sx:{mb:4},children:e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:[e.jsx(Tr,{sx:{mr:1}}),"Filters"]}),e.jsx(Fe,{sx:{mb:2}})]}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(_e,{fullWidth:!0,size:"small",placeholder:"Search symbols...",value:w,onChange:P=>C(P.target.value),onKeyPress:P=>P.key==="Enter"&&F(),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})}),endAdornment:w&&e.jsx(ts,{position:"end",children:e.jsx(Ge,{size:"small",onClick:$,children:e.jsx(mn,{})})})}})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Signal Type"}),e.jsxs(pt,{value:t,label:"Signal Type",onChange:P=>s(P.target.value),children:[e.jsx(J,{value:"all",children:"All Signals"}),e.jsx(J,{value:"buy",children:"Buy Only"}),e.jsx(J,{value:"sell",children:"Sell Only"})]})]})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Timeframe"}),e.jsxs(pt,{value:n,label:"Timeframe",onChange:P=>i(P.target.value),children:[e.jsx(J,{value:"daily",children:"Daily"}),e.jsx(J,{value:"weekly",children:"Weekly"}),e.jsx(J,{value:"monthly",children:"Monthly"})]})]})}),e.jsxs(y,{item:!0,xs:12,md:2,children:[e.jsx(Jt,{control:e.jsx(rs,{checked:R,onChange:P=>{E(P.target.checked),o(0)},color:"primary"}),label:"Active Only",sx:{mt:1}}),e.jsx(d,{variant:"caption",display:"block",color:"text.secondary",children:"Show current positions & recent signals"})]}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Date Range"}),e.jsxs(pt,{value:A,label:"Date Range",onChange:P=>{_(P.target.value),o(0)},children:[e.jsx(J,{value:"today",children:"Today Only"}),e.jsx(J,{value:"week",children:"This Week"}),e.jsx(J,{value:"month",children:"This Month"}),e.jsx(J,{value:"all",children:"All Time"})]})]})}),e.jsx(y,{item:!0,xs:12,md:2,children:e.jsx(oe,{fullWidth:!0,variant:"contained",onClick:F,size:"medium",children:"Search"})})]})})}),e.jsx(y,{container:!0,spacing:3,children:e.jsxs(y,{item:!0,xs:12,children:[N&&e.jsx(Qg,{error:{message:N?.message||String(N),context:{endpoint:`${r}/api/signals?timeframe=${n}`,debugEndpoint:`${r}/api/trading/debug`,filters:{signalType:t,dateRange:A,timeframe:n},component:"TradingSignals"}},title:"Failed to Load Trading Signals",onRetry:()=>window.location.reload(),severity:"error"}),!N&&!I&&(!M?.data||(M.data?.length||0)===0)&&e.jsx(Qg,{error:{message:"No trading signals data found",context:{endpoint:`${r}/api/signals?timeframe=${n}`,filters:{signalType:t,dateRange:A},response:M}},title:"No Data Available",severity:"info",showDetails:!0}),e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(H,{}),e.jsx(yn,{component:"div",count:M?.pagination?.total||0,page:a,onPageChange:(P,D)=>o(D),rowsPerPage:l,onRowsPerPageChange:P=>{c(parseInt(P.target.value,10)),o(0)},rowsPerPageOptions:[10,25,50,100,{label:"All",value:-1}]})]})})]})}),S?.length>0&&e.jsxs(g,{sx:{mt:4},children:[e.jsx(d,{variant:"h5",gutterBottom:!0,sx:{mb:2},children:"Signal Performance Tracking"}),e.jsx(AR,{symbols:S.map(P=>P.symbol),timeframe:"7d"})]}),e.jsxs(Os,{open:m,onClose:()=>p(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(Ls,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(g,{display:"flex",alignItems:"center",children:[e.jsx(Lt,{sx:{mr:1}}),e.jsxs(d,{variant:"h6",children:[h," - Historical Signals"]})]}),e.jsx(Ge,{onClick:()=>p(!1),size:"small",children:e.jsx(wx,{})})]})}),e.jsx(ks,{children:W?e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})}):e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Signal"}),e.jsx(f,{align:"right",children:"Price"}),e.jsx(f,{align:"right",children:"Buy Level"}),e.jsx(f,{align:"right",children:"Stop Loss"}),e.jsx(f,{align:"right",children:"Target"}),e.jsx(f,{align:"right",children:"R/R Ratio"}),e.jsx(f,{children:"Stage"}),e.jsx(f,{align:"right",children:"SATA"}),e.jsx(f,{align:"right",children:"Quality"})]})}),e.jsx(ke,{children:L?.data?.map((P,D)=>e.jsxs(V,{children:[e.jsx(f,{children:P.date?new Date(P.date).toLocaleDateString():""}),e.jsx(f,{children:re(P.signal,P.date)}),e.jsx(f,{align:"right",children:ge(P.current_price||P.close)}),e.jsx(f,{align:"right",children:P.buylevel?ge(P.buylevel):"—"}),e.jsx(f,{align:"right",children:P.stoplevel?ge(P.stoplevel):"—"}),e.jsx(f,{align:"right",children:P.target_price?ge(P.target_price):"—"}),e.jsx(f,{align:"right",children:P.risk_reward_ratio?`${Number(P.risk_reward_ratio).toFixed(1)}:1`:"—"}),e.jsx(f,{children:e.jsx(tt,{title:`${P.market_stage||"Unknown"}
${P.substage||""}`,children:e.jsx(g,{sx:{display:"flex",alignItems:"center",gap:.5},children:e.jsx(X,{label:P.market_stage?.replace("Stage ","S")||"—",size:"small",sx:{backgroundColor:P.market_stage==="Stage 2 - Advancing"?"rgba(5, 150, 105, 0.2)":P.market_stage==="Stage 1 - Basing"?"rgba(59, 130, 246, 0.2)":P.market_stage==="Stage 3 - Topping"?"rgba(245, 158, 11, 0.2)":P.market_stage==="Stage 4 - Declining"?"rgba(220, 38, 38, 0.2)":"rgba(156, 163, 175, 0.2)",color:P.market_stage==="Stage 2 - Advancing"?"#059669":P.market_stage==="Stage 1 - Basing"?"#3B82F6":P.market_stage==="Stage 3 - Topping"?"#F59E0B":P.market_stage==="Stage 4 - Declining"?"#DC2626":"#6B7280",fontWeight:"bold",fontSize:"0.7rem"}})})})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:P.sata_score!==null&&P.sata_score!==void 0?P.sata_score:"—",size:"small",sx:{backgroundColor:P.sata_score>=8?"rgba(5, 150, 105, 0.2)":P.sata_score>=4?"rgba(59, 130, 246, 0.2)":"rgba(220, 38, 38, 0.2)",color:P.sata_score>=8?"#059669":P.sata_score>=4?"#3B82F6":"#DC2626",fontWeight:"bold",fontSize:"0.7rem"}})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:P.entry_quality_score||"—",size:"small",sx:{backgroundColor:P.entry_quality_score>=80?"rgba(5, 150, 105, 0.2)":P.entry_quality_score>=60?"rgba(59, 130, 246, 0.2)":P.entry_quality_score>=40?"rgba(245, 158, 11, 0.2)":"rgba(220, 38, 38, 0.2)",color:P.entry_quality_score>=80?"#059669":P.entry_quality_score>=60?"#3B82F6":P.entry_quality_score>=40?"#F59E0B":"#DC2626",fontWeight:"bold",fontSize:"0.7rem"}})})]},D))})]})})}),e.jsx(Is,{children:e.jsx(oe,{onClick:()=>p(!1),children:"Close"})})]})]})}const TR=({timeframe:r})=>{const[t,s]=j.useState("SPY"),[n,i]=j.useState(0),a=r?.toLowerCase()||"1y",{data:o,isLoading:l}=Qe({queryKey:["performanceAnalytics",a,t],queryFn:()=>zj(a,t),staleTime:6e4}),{data:c,isLoading:h}=Qe({queryKey:["riskAnalytics",a],queryFn:()=>Bj(a),staleTime:6e4}),{data:u,isLoading:m}=Qe({queryKey:["allocationAnalytics"],queryFn:()=>Qj(),staleTime:12e4}),{data:p,isLoading:x}=Qe({queryKey:["correlationAnalytics",a],queryFn:()=>Uj(a),staleTime:3e5}),{data:b,isLoading:w}=Qe({queryKey:["volatilityAnalytics",a],queryFn:()=>qj(a),staleTime:6e4}),{data:C,isLoading:A}=Qe({queryKey:["trendsAnalytics",a],queryFn:()=>Hj(a),staleTime:6e4});if(l||h||m||x||w||A)return e.jsx(g,{display:"flex",justifyContent:"center",p:4,children:e.jsx(Je,{})});const R=()=>e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(at,{color:"primary"}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:o?.data?.returns?`${(o.data.returns*100).toFixed(2)}%`:"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Total Return"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Gt,{color:"secondary"}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:o?.data?.volatility?`${(o.data.volatility*100).toFixed(2)}%`:"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Volatility"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Lt,{}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:o?.data?.sharpe_ratio?o.data.sharpe_ratio.toFixed(2):"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Sharpe Ratio"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Fs,{}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:o?.data?.portfolio_metrics?.total_value?`$${parseFloat(o.data.portfolio_metrics.total_value).toLocaleString()}`:"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Portfolio Value"})]})]})})})})]})}),e.jsx(y,{item:!0,xs:12,lg:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Performance vs Benchmark"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:400,children:e.jsxs(Ks,{data:o?.data?.performance_timeline||[],children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date",tickFormatter:I=>new Date(I).toLocaleDateString()}),e.jsx(ht,{tickFormatter:I=>`${I}%`}),e.jsx(ot,{formatter:(I,N)=>[`${parseFloat(I).toFixed(2)}%`,N],labelFormatter:I=>new Date(I).toLocaleDateString()}),e.jsx(gu,{}),e.jsx(Ds,{type:"monotone",dataKey:"pnl_percent",stroke:"#8884d8",strokeWidth:2,name:"Portfolio"}),e.jsx(Ds,{type:"monotone",dataKey:"benchmark_return",stroke:"#82ca9d",strokeWidth:2,name:`${t} Benchmark`,data:o?.data?.benchmark_comparison?.data||[]})]})})})]})}),e.jsx(y,{item:!0,xs:12,lg:4,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Risk Metrics"}),e.jsxs(U,{children:[e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Portfolio Volatility"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.portfolio_volatility||"N/A","%"]})]}),e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Max Drawdown"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.max_drawdown||"N/A","%"]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Value at Risk (95%)"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.value_at_risk_95||"N/A","%"]})]})]})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Sector Allocation"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:u?.data?.sectors||[],dataKey:"percentage",cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",label:({name:I,percentage:N})=>`${I}: ${N}%`,children:(u?.data?.sectors||[]).map((I,N)=>e.jsx(xt,{fill:`hsl(${N*45}, 70%, 60%)`},`cell-${N}`))}),e.jsx(ot,{})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Top Holdings"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:(u?.data?.assets||[]).slice(0,10),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"symbol"}),e.jsx(ht,{tickFormatter:I=>`${I}%`}),e.jsx(ot,{formatter:I=>[`${I}%`,"Weight"]}),e.jsx(jt,{dataKey:"percentage",fill:"#8884d8"})]})})})]})})]}),E=()=>e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Risk Metrics"}),e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Portfolio Volatility"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.portfolio_volatility||"N/A","%"]})]}),e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Max Drawdown"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.max_drawdown||"N/A","%"]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Value at Risk (95%)"}),e.jsxs(d,{variant:"h6",children:[c?.data?.risk?.portfolio_metrics?.value_at_risk_95||"N/A","%"]})]})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Concentration Risk"}),e.jsx(d,{variant:"h6",children:c?.data?.risk?.portfolio_metrics?.concentration_risk||"N/A"})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Overall Risk Level"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mt:1,children:[c?.data?.risk?.risk_assessment?.overall_risk==="Low"?e.jsx(Yr,{color:"success"}):c?.data?.risk?.risk_assessment?.overall_risk==="Medium"?e.jsx(Ar,{color:"warning"}):c?.data?.risk?.risk_assessment?.overall_risk==="High"?e.jsx(Vr,{color:"error"}):null,e.jsx(d,{variant:"h6",children:c?.data?.risk?.risk_assessment?.overall_risk||"Unknown"})]})]})]})]})})]})})}),T=()=>e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Correlation Analysis"}),e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h4",color:"primary",children:p?.data?.correlations?.insights?.diversification_score||"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Diversification Score"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h6",children:p?.data?.correlations?.insights?.average_correlation||"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Average Correlation"})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h6",children:p?.data?.correlations?.assets_analyzed||"N/A"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Assets Analyzed"})]})})]})})]})})}),M=()=>e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Volatility Analysis"}),e.jsx(U,{children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsxs(d,{variant:"h5",children:[b?.data?.volatility?.annualized_volatility||"N/A","%"]}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Annualized Volatility"}),e.jsxs(g,{mt:2,children:[b?.data?.volatility?.risk_level==="Low"?e.jsx(Yr,{color:"success"}):b?.data?.volatility?.risk_level==="Medium"?e.jsx(Ar,{color:"warning"}):b?.data?.volatility?.risk_level==="High"?e.jsx(Vr,{color:"error"}):null,e.jsxs(d,{variant:"body2",color:"text.secondary",mt:1,children:[b?.data?.volatility?.risk_level||"Unknown"," Risk"]})]})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Trend Analysis"}),e.jsx(U,{children:e.jsxs(g,{textAlign:"center",p:2,children:[e.jsx(d,{variant:"h6",children:C?.data?.trends?.trend_direction||"Unknown"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Trend Direction"}),e.jsxs(g,{mt:2,children:[e.jsx(d,{variant:"h6",children:C?.data?.trends?.trend_strength||"Unknown"}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Trend Strength"})]})]})})]})})]});return e.jsxs(g,{children:[e.jsx(He,{sx:{mb:2},children:e.jsxs(Ir,{value:n,onChange:(I,N)=>i(N),variant:"scrollable",scrollButtons:"auto",children:[e.jsx(it,{label:"Performance"}),e.jsx(it,{label:"Risk Analysis"}),e.jsx(it,{label:"Asset Allocation"}),e.jsx(it,{label:"Correlation"}),e.jsx(it,{label:"Volatility & Trends"})]})}),e.jsxs(g,{mt:2,children:[n===0&&R(),n===1&&E(),n===2&&e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Sector Allocation"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:u?.data?.sectors||[],dataKey:"percentage",cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",label:({name:I,percentage:N})=>`${I}: ${N}%`,children:(u?.data?.sectors||[]).map((I,N)=>e.jsx(xt,{fill:`hsl(${N*45}, 70%, 60%)`},`cell-${N}`))}),e.jsx(ot,{})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Top Holdings"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Yt,{data:(u?.data?.assets||[]).slice(0,10),children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"symbol"}),e.jsx(ht,{tickFormatter:I=>`${I}%`}),e.jsx(ot,{formatter:I=>[`${I}%`,"Weight"]}),e.jsx(jt,{dataKey:"percentage",fill:"#8884d8"})]})})})]})})]}),n===3&&T(),n===4&&M()]})]})},PR=()=>{const{user:r,tokens:t}=ps();jc("Portfolio Holdings");const[s,n]=j.useState(!0),[i,a]=j.useState(null),[o,l]=j.useState([]),[c,h]=j.useState(null),[u,m]=j.useState("marketValue"),[p,x]=j.useState("desc"),[b,w]=j.useState(0),[C,A]=j.useState(25),[_,R]=j.useState("1Y"),[E,T]=j.useState(!1),[M,I]=j.useState(!1),[N,k]=j.useState(!1),[S,L]=j.useState(null),[W,F]=j.useState(""),[$,q]=j.useState({symbol:"",shares:"",avgCost:""}),ne=j.useCallback(async()=>{if(!r?.userId&&!r?.id||!t?.accessToken&&!t?.access){a("Authentication required"),n(!1);return}try{n(!0),a(null);const ae=r.userId||r.id,ee=await Jx(ae);if(ee?.data?.holdings){l(ee.data.holdings),h(ee.data.summary);const te=ee.data.holdings.map(Pe=>Pe.symbol);if(te.length>0)try{await uo(te)}catch(Pe){console.warn("Failed to fetch current stock prices:",Pe)}}else throw new Error("No portfolio holdings found")}catch(ae){a(ae.message||"Failed to load portfolio data")}finally{n(!1)}},[r?.userId,r?.id,t?.accessToken,t?.access]);j.useEffect(()=>{ne()},[ne]);const he=async()=>{try{const ae=await Su({userId:r.userId||r.id,symbol:$.symbol.toUpperCase(),shares:parseFloat($.shares),avgCost:parseFloat($.avgCost)});if(ae.success)T(!1),q({symbol:"",shares:"",avgCost:""}),ne();else throw new Error(ae.message||"Failed to add holding")}catch(ae){a(ae.message)}},re=async()=>{try{const ae=await Ou(S.symbol,{userId:r.userId||r.id,shares:parseFloat($.shares),avgCost:parseFloat($.avgCost)});if(ae.success)I(!1),L(null),q({symbol:"",shares:"",avgCost:""}),ne();else throw new Error(ae.message||"Failed to update holding")}catch(ae){a(ae.message)}},G=async ae=>{if(window.confirm(`Are you sure you want to delete ${ae}?`))try{const ee=r.userId||r.id,te=await ku(ae,ee);if(te.success)ne();else throw new Error(te.message||"Failed to delete holding")}catch(ee){a(ee.message)}},H=async()=>{if(!W){a("Please select a broker");return}try{n(!0),a(null);const ae=await Cu(W);if(ae.success)k(!1),F(""),ne();else throw new Error(ae.message||"Failed to import portfolio")}catch(ae){a(ae.message||"Failed to import portfolio. Please check your API credentials and try again.")}finally{n(!1)}},P=j.useMemo(()=>o?.length?[...o].sort((ae,ee)=>{let te=ae[u],Pe=ee[u];return typeof te=="string"&&(te=te.toLowerCase(),Pe=Pe.toLowerCase()),p==="desc"?Pe>te?1:-1:te>Pe?1:-1}):[],[o,u,p]),D=j.useMemo(()=>{const ae=b*C;return P.slice(ae,ae+C)},[P,b,C]),Y=j.useMemo(()=>o?.length?o.map(ae=>({symbol:ae.symbol,value:ae.marketValue||0,allocation:ae.allocation||0})):[],[o]),ce=j.useMemo(()=>{if(!o?.length)return[];const ae=o.reduce((ee,te)=>{const Pe=te.sector||"Unknown";return ee[Pe]=(ee[Pe]||0)+(te.marketValue||0),ee},{});return Object.entries(ae).map(([ee,te])=>({sector:ee,value:te,allocation:c?.totalValue?te/c.totalValue*100:0}))},[o,c]);return s&&!o.length?e.jsx(lt,{maxWidth:"xl",sx:{mt:4,mb:4},"data-testid":"portfolio-page",children:e.jsxs(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[e.jsx(Je,{size:60}),e.jsx(d,{variant:"h6",sx:{ml:2},children:"Loading portfolio data..."})]})}):e.jsxs(lt,{maxWidth:"xl",sx:{mt:4,mb:4},"data-testid":"portfolio-page",children:[e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(He,{sx:{p:3,mb:3},children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Portfolio Holdings & Analysis"}),e.jsxs(g,{display:"flex",gap:2,children:[e.jsxs(ft,{size:"small",children:[e.jsx(mt,{children:"Timeframe"}),e.jsxs(pt,{value:_,onChange:ae=>R(ae.target.value),label:"Timeframe",children:[e.jsx(J,{value:"1M",children:"1 Month"}),e.jsx(J,{value:"3M",children:"3 Months"}),e.jsx(J,{value:"6M",children:"6 Months"}),e.jsx(J,{value:"1Y",children:"1 Year"}),e.jsx(J,{value:"2Y",children:"2 Years"})]})]}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Es,{}),onClick:ne,disabled:s,"aria-label":"refresh",children:"Refresh"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(pS,{}),onClick:()=>k(!0),disabled:s,"data-testid":"import-portfolio-button",children:"Import Portfolio"}),e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>T(!0),children:"Add Holding"})]})]}),c&&e.jsxs(y,{container:!0,spacing:2,sx:{mt:2},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{color:"textSecondary",gutterBottom:!0,children:"Total Value"}),e.jsxs(d,{variant:"h5",children:["$",c.totalValue?.toLocaleString()||"0"]})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{color:"textSecondary",gutterBottom:!0,children:"Total Gain/Loss"}),e.jsxs(d,{variant:"h5",color:c.totalGainLoss>=0?"success.main":"error.main",children:["$",c.totalGainLoss?.toLocaleString()||"0"]})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{color:"textSecondary",gutterBottom:!0,children:"Total Return %"}),e.jsxs(d,{variant:"h5",color:c.totalGainLossPercent>=0?"success.main":"error.main",children:[c.totalGainLossPercent?.toFixed(2)||"0.00","%"]})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsx(d,{color:"textSecondary",gutterBottom:!0,children:"Holdings Count"}),e.jsx(d,{variant:"h5",children:o?.length||0})]})})})]})]})}),i&&e.jsx(y,{item:!0,xs:12,children:e.jsx(we,{severity:"error",onClose:()=>a(null),sx:{mb:2},children:i})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(d,{variant:"h6",children:"Portfolio Holdings"}),e.jsx(g,{display:"flex",gap:1,children:e.jsx(Ge,{size:"small",children:e.jsx(Tr,{})})})]}),e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(Ca,{active:u==="symbol",direction:p,onClick:()=>{x(u==="symbol"&&p==="asc"?"desc":"asc"),m("symbol")},children:"Symbol"})}),e.jsx(f,{children:"Company"}),e.jsx(f,{align:"right",children:e.jsx(Ca,{active:u==="shares",direction:p,onClick:()=>{x(u==="shares"&&p==="asc"?"desc":"asc"),m("shares")},children:"Shares"})}),e.jsx(f,{align:"right",children:"Avg Cost"}),e.jsx(f,{align:"right",children:"Current Price"}),e.jsx(f,{align:"right",children:e.jsx(Ca,{active:u==="marketValue",direction:p,onClick:()=>{x(u==="marketValue"&&p==="asc"?"desc":"asc"),m("marketValue")},children:"Market Value"})}),e.jsx(f,{align:"right",children:"Gain/Loss"}),e.jsx(f,{align:"right",children:"Gain/Loss %"}),e.jsx(f,{align:"right",children:"Allocation"}),e.jsx(f,{align:"center",children:"Actions"})]})}),e.jsx(ke,{children:D.map((ae,ee)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:ae.symbol})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:ae.company||"N/A"})}),e.jsx(f,{align:"right",children:ae.shares?.toLocaleString()||0}),e.jsxs(f,{align:"right",children:["$",ae.avgCost?.toFixed(2)||"0.00"]}),e.jsxs(f,{align:"right",children:["$",ae.currentPrice?.toFixed(2)||"0.00"]}),e.jsxs(f,{align:"right",children:["$",ae.marketValue?.toLocaleString()||"0"]}),e.jsxs(f,{align:"right",sx:{color:ae.gainLoss>=0?"success.main":"error.main"},children:["$",ae.gainLoss?.toLocaleString()||"0"]}),e.jsxs(f,{align:"right",sx:{color:ae.gainLossPercent>=0?"success.main":"error.main"},children:[ae.gainLossPercent?.toFixed(2)||"0.00","%"]}),e.jsxs(f,{align:"right",children:[ae.allocation?.toFixed(1)||"0.0","%"]}),e.jsxs(f,{align:"center",children:[e.jsx(Ge,{size:"small","aria-label":"edit",onClick:()=>{L(ae),q({symbol:ae.symbol,shares:ae.shares.toString(),avgCost:ae.avgCost.toString()}),I(!0)},children:e.jsx(fc,{})}),e.jsx(Ge,{size:"small","aria-label":"delete",onClick:()=>G(ae.symbol),color:"error",children:e.jsx(mc,{})})]})]},`${ae.symbol}-${ae.id||ee}`))})]})}),e.jsx(yn,{rowsPerPageOptions:[10,25,50],component:"div",count:P.length,rowsPerPage:C,page:b,onPageChange:(ae,ee)=>w(ee),onRowsPerPageChange:ae=>{A(parseInt(ae.target.value,10)),w(0)}}),e.jsxs(y,{container:!0,spacing:3,sx:{mt:3},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Holdings Allocation"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:Y,dataKey:"value",cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",children:Y.map((ae,ee)=>e.jsx(xt,{fill:`hsl(${ee*45}, 70%, 60%)`},`cell-${ee}`))}),e.jsx(ot,{formatter:ae=>[`$${ae.toLocaleString()}`,"Value"]})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Sector Allocation"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:300,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:ce,dataKey:"value",cx:"50%",cy:"50%",outerRadius:100,fill:"#82ca9d",children:ce.map((ae,ee)=>e.jsx(xt,{fill:`hsl(${ee*60}, 70%, 60%)`},`cell-${ee}`))}),e.jsx(ot,{formatter:ae=>[`$${ae.toLocaleString()}`,"Value"]})]})})})]})})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(TR,{timeframe:_})})]}),e.jsxs(Os,{open:E,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ls,{children:"Add New Holding"}),e.jsxs(ks,{children:[e.jsx(_e,{autoFocus:!0,margin:"dense",label:"Symbol",fullWidth:!0,variant:"outlined",value:$.symbol,onChange:ae=>q({...$,symbol:ae.target.value.toUpperCase()}),sx:{mb:2}}),e.jsx(_e,{margin:"dense",label:"Shares",type:"number",fullWidth:!0,variant:"outlined",value:$.shares,onChange:ae=>q({...$,shares:ae.target.value}),sx:{mb:2}}),e.jsx(_e,{margin:"dense",label:"Average Cost",type:"number",fullWidth:!0,variant:"outlined",value:$.avgCost,onChange:ae=>q({...$,avgCost:ae.target.value}),step:"0.01"})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(oe,{onClick:he,variant:"contained",children:"Add Holding"})]})]}),e.jsxs(Os,{open:M,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(Ls,{children:["Edit Holding: ",S?.symbol]}),e.jsxs(ks,{children:[e.jsx(_e,{margin:"dense",label:"Shares",type:"number",fullWidth:!0,variant:"outlined",value:$.shares,onChange:ae=>q({...$,shares:ae.target.value}),sx:{mb:2}}),e.jsx(_e,{margin:"dense",label:"Average Cost",type:"number",fullWidth:!0,variant:"outlined",value:$.avgCost,onChange:ae=>q({...$,avgCost:ae.target.value}),step:"0.01"})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(oe,{onClick:re,variant:"contained",children:"Update Holding"})]})]}),e.jsxs(Os,{open:N,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,"data-testid":"import-portfolio-dialog",children:[e.jsx(Ls,{children:"Import Portfolio from Broker"}),e.jsxs(ks,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Import your portfolio positions from your connected broker account. Make sure you have configured your API keys in the Settings page."}),e.jsxs(ft,{fullWidth:!0,sx:{mt:2},children:[e.jsx(mt,{children:"Select Broker"}),e.jsx(pt,{value:W,onChange:ae=>F(ae.target.value),label:"Select Broker","data-testid":"broker-select",children:e.jsx(J,{value:"alpaca",children:"Alpaca"})})]}),i&&e.jsx(we,{severity:"error",sx:{mt:2},children:i})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>k(!1),children:"Cancel"}),e.jsx(oe,{onClick:H,variant:"contained",disabled:!W||s,"data-testid":"import-confirm-button",children:s?"Importing...":"Import Portfolio"})]})]})]})},_R=()=>{const{user:r}=ps(),[t,s]=j.useState(!0),[n,i]=j.useState(null),[a,o]=j.useState(!1),[l,c]=j.useState(0),[h,u]=j.useState(null),[m,p]=j.useState(null),[x,b]=j.useState(null),[w,C]=j.useState(null),[A,_]=j.useState(null),[R,E]=j.useState(!1),[T,M]=j.useState({objective:"max_sharpe",riskTolerance:50,targetReturn:10,constraints:{maxSinglePosition:20,minSinglePosition:1,maxSectorAllocation:30,allowShortSelling:!1,rebalanceThreshold:5},timeHorizon:"1Y",includeAlternatives:!1,excludeList:[]});j.useEffect(()=>{I()},[]);const I=async()=>{try{s(!0);const[S,L,W]=await Promise.allSettled([Au(),Pu(),_u()]);if(S.status==="fulfilled"){const F=S.value?.data||S.value;b({totalValue:F?.totalValue||F?.currentAllocation?.reduce(($,q)=>$+q.amount,0)||1e5,expectedReturn:F?.expectedReturn||12.5,risk:F?.risk||F?.volatility||18.5,sharpeRatio:F?.sharpeRatio||1.24})}else b(null);if(L.status==="fulfilled"){const q=((L.value?.data||L.value)?.recommendations||[]||[]).map(ne=>({symbol:ne.symbol,currentWeight:ne.currentWeight||ne.current_weight||0,targetWeight:ne.targetWeight||ne.target_weight||ne.optimalWeight||0,difference:(ne.targetWeight||ne.target_weight||ne.optimalWeight||0)-(ne.currentWeight||ne.current_weight||0),action:ne.action||(ne.amount>0?"BUY":"SELL"),priority:ne.priority||"MEDIUM"}));p(q)}else p([]);if(W.status==="fulfilled"){const F=W.value?.data||W.value;_({riskScore:F?.riskScore||F?.overallRiskScore||6.2,riskFactors:F?.riskFactors||F?.recommendations||[{name:"Concentration Risk",severity:"MEDIUM",description:"Portfolio shows moderate concentration in technology sector"},{name:"Market Risk",severity:"LOW",description:"Portfolio beta is within acceptable range"}]})}else _(null)}catch{i("Failed to fetch optimization data"),b(null),p([]),_(null)}finally{s(!1)}},N=async()=>{try{o(!0);const S=await Tu(T),L=S?.data||S;if(L){const W={current:{expectedReturn:x?.expectedReturn||12.5,risk:x?.risk||18.5,sharpeRatio:x?.sharpeRatio||1.24},optimized:{expectedReturn:L.expectedImprovement?.expectedReturn?.optimized||L.expectedReturn||14.2,risk:L.expectedImprovement?.volatility?.optimized||L.risk||16.8,sharpeRatio:L.expectedImprovement?.sharpeRatio?.optimized||L.sharpeRatio||1.45}};u(W);const F=L.currentAllocation||L.allocation||[{symbol:"AAPL",weight:20},{symbol:"MSFT",weight:25},{symbol:"GOOGL",weight:15},{symbol:"AMZN",weight:18},{symbol:"TSLA",weight:12},{symbol:"JNJ",weight:10}];C({allocation:F}),E(!0)}else throw new Error("No optimization results received")}catch{i("Failed to run portfolio optimization"),u(null),C(null)}finally{o(!1)}},k=[{label:"Set Objectives",description:"Define your investment goals and risk tolerance",content:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Optimization Objective"}),e.jsxs(pt,{value:T.objective,label:"Optimization Objective",onChange:S=>M({...T,objective:S.target.value}),children:[e.jsx(J,{value:"max_sharpe",children:"Maximize Sharpe Ratio"}),e.jsx(J,{value:"min_risk",children:"Minimize Risk"}),e.jsx(J,{value:"max_return",children:"Maximize Return"}),e.jsx(J,{value:"target_return",children:"Target Return"})]})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Time Horizon"}),e.jsxs(pt,{value:T.timeHorizon,label:"Time Horizon",onChange:S=>M({...T,timeHorizon:S.target.value}),children:[e.jsx(J,{value:"3M",children:"3 Months"}),e.jsx(J,{value:"6M",children:"6 Months"}),e.jsx(J,{value:"1Y",children:"1 Year"}),e.jsx(J,{value:"2Y",children:"2 Years"}),e.jsx(J,{value:"5Y",children:"5 Years"})]})]})}),e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(d,{gutterBottom:!0,children:["Risk Tolerance: ",T.riskTolerance,"%"]}),e.jsx(Yf,{value:T.riskTolerance,onChange:(S,L)=>M({...T,riskTolerance:L}),"aria-labelledby":"risk-tolerance-slider",valueLabelDisplay:"auto",step:5,marks:!0,min:0,max:100})]}),T.objective==="target_return"&&e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(_e,{fullWidth:!0,label:"Target Annual Return (%)",type:"number",value:T.targetReturn,onChange:S=>M({...T,targetReturn:parseFloat(S.target.value)})})})]})},{label:"Set Constraints",description:"Configure portfolio constraints and limits",content:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(_e,{fullWidth:!0,label:"Max Single Position (%)",type:"number",value:T.constraints.maxSinglePosition,onChange:S=>M({...T,constraints:{...T.constraints,maxSinglePosition:parseFloat(S.target.value)}})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(_e,{fullWidth:!0,label:"Min Single Position (%)",type:"number",value:T.constraints.minSinglePosition,onChange:S=>M({...T,constraints:{...T.constraints,minSinglePosition:parseFloat(S.target.value)}})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(_e,{fullWidth:!0,label:"Max Sector Allocation (%)",type:"number",value:T.constraints.maxSectorAllocation,onChange:S=>M({...T,constraints:{...T.constraints,maxSectorAllocation:parseFloat(S.target.value)}})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(_e,{fullWidth:!0,label:"Rebalance Threshold (%)",type:"number",value:T.constraints.rebalanceThreshold,onChange:S=>M({...T,constraints:{...T.constraints,rebalanceThreshold:parseFloat(S.target.value)}})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Jt,{control:e.jsx(rs,{checked:T.constraints.allowShortSelling,onChange:S=>M({...T,constraints:{...T.constraints,allowShortSelling:S.target.checked}})}),label:"Allow Short Selling"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Jt,{control:e.jsx(rs,{checked:T.includeAlternatives,onChange:S=>M({...T,includeAlternatives:S.target.checked})}),label:"Include Alternative Investments (REITs, Commodities)"})})]})},{label:"Review & Optimize",description:"Review settings and run optimization",content:e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Optimization Summary"}),e.jsxs(jr,{children:[e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(gS,{})}),e.jsx(Ut,{primary:"Objective",secondary:T.objective.replace("_"," ").toUpperCase()})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(kr,{})}),e.jsx(Ut,{primary:"Risk Tolerance",secondary:`${T.riskTolerance}%`})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(xn,{})}),e.jsx(Ut,{primary:"Time Horizon",secondary:T.timeHorizon})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(xS,{})}),e.jsx(Ut,{primary:"Max Position Size",secondary:`${T.constraints.maxSinglePosition}%`})]})]})]})}];return t?e.jsx(lt,{maxWidth:"xl",children:e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(Je,{})})}):e.jsxs(lt,{maxWidth:"xl",children:[e.jsxs(g,{sx:{mb:4},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Portfolio Optimization"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"AI-driven portfolio optimization and rebalancing recommendations"})]}),n&&e.jsx(we,{severity:"error",sx:{mb:3},onClose:()=>i(null),children:n}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,lg:8,children:[e.jsxs(z,{sx:{mb:3},children:[e.jsx(Ue,{title:"Optimization Wizard",action:e.jsx(oe,{variant:"contained",startIcon:a?e.jsx(Je,{size:20}):e.jsx(Gr,{}),onClick:N,disabled:a,children:a?"Optimizing...":"Run Optimization"})}),e.jsx(U,{children:e.jsx(yS,{activeStep:l,orientation:"vertical",children:(k||[]).map((S,L)=>e.jsxs(jS,{children:[e.jsx(bS,{optional:e.jsx(d,{variant:"caption",children:S.description}),children:S.label}),e.jsxs(vS,{children:[S.content,e.jsxs(g,{sx:{mb:2,mt:2},children:[e.jsx(oe,{variant:"contained",onClick:()=>c(Math.min(l+1,(k?.length||0)-1)),sx:{mr:1},disabled:l===(k?.length||0)-1,children:l===(k?.length||0)-1?"Complete":"Continue"}),e.jsx(oe,{disabled:l===0,onClick:()=>c(Math.max(l-1,0)),children:"Back"})]})]})]},S.label))})})]}),m&&e.jsxs(z,{children:[e.jsx(Ue,{title:"Rebalancing Recommendations"}),e.jsx(U,{children:e.jsx(Ae,{component:He,variant:"outlined",children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Current Weight"}),e.jsx(f,{align:"right",children:"Target Weight"}),e.jsx(f,{align:"right",children:"Difference"}),e.jsx(f,{align:"right",children:"Action"}),e.jsx(f,{children:"Priority"})]})}),e.jsx(ke,{children:(m||[]).map((S,L)=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:S.symbol})}),e.jsxs(f,{align:"right",children:[S.currentWeight.toFixed(2),"%"]}),e.jsxs(f,{align:"right",children:[S.targetWeight.toFixed(2),"%"]}),e.jsxs(f,{align:"right",sx:{color:S.difference>=0?"success.main":"error.main"},children:[S.difference>=0?"+":"",S.difference.toFixed(2),"%"]}),e.jsx(f,{align:"right",children:e.jsx(X,{label:S.action,color:S.action==="BUY"?"success":"error",size:"small"})}),e.jsx(f,{children:e.jsx(X,{label:S.priority,color:S.priority==="HIGH"?"error":S.priority==="MEDIUM"?"warning":"success",size:"small"})})]},`${S.symbol}-${L}`))})]})})})]})]}),e.jsxs(y,{item:!0,xs:12,lg:4,children:[x&&e.jsxs(z,{sx:{mb:3},children:[e.jsx(Ue,{title:"Current Portfolio"}),e.jsx(U,{children:e.jsxs(jr,{dense:!0,children:[e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(Fs,{})}),e.jsx(Ut,{primary:"Total Value",secondary:`$${x.totalValue?.toLocaleString()}`})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(at,{})}),e.jsx(Ut,{primary:"Expected Return",secondary:`${x.expectedReturn?.toFixed(2)}%`})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(kr,{})}),e.jsx(Ut,{primary:"Risk (Volatility)",secondary:`${x.risk?.toFixed(2)}%`})]}),e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(xr,{})}),e.jsx(Ut,{primary:"Sharpe Ratio",secondary:x.sharpeRatio?.toFixed(2)})]})]})})]}),A&&e.jsxs(z,{children:[e.jsx(Ue,{title:"Risk Analysis"}),e.jsxs(U,{children:[e.jsxs(g,{sx:{mb:2},children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Portfolio Risk Score"}),e.jsx(g,{sx:{display:"flex",alignItems:"center",mb:1},children:e.jsx(g,{sx:{width:"100%",mr:1},children:e.jsx(Yf,{value:A.riskScore,"aria-labelledby":"risk-score-slider",valueLabelDisplay:"auto",step:1,marks:!0,min:0,max:100,disabled:!0,sx:{"& .MuiSlider-thumb":{color:A.riskScore>70?"error.main":A.riskScore>40?"warning.main":"success.main"},"& .MuiSlider-track":{color:A.riskScore>70?"error.main":A.riskScore>40?"warning.main":"success.main"}}})})})]}),e.jsx(Fe,{sx:{my:2}}),e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:"Risk Factors"}),A.riskFactors?.map((S,L)=>e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(Ar,{sx:{mr:1,color:S.severity==="HIGH"?"error.main":S.severity==="MEDIUM"?"warning.main":"info.main"}}),e.jsx(d,{variant:"body2",children:S.name})]})}),e.jsxs(os,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:S.description}),e.jsx(X,{label:S.severity,size:"small",color:S.severity==="HIGH"?"error":S.severity==="MEDIUM"?"warning":"info",sx:{mt:1}})]})]},L))]})]})]})]}),e.jsxs(Os,{open:R,onClose:()=>E(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(Ls,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Sx,{sx:{mr:1}}),"Optimization Results"]})}),e.jsx(ks,{children:h&&e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Current vs Optimized"}),e.jsx(Ae,{component:He,variant:"outlined",children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Metric"}),e.jsx(f,{align:"right",children:"Current"}),e.jsx(f,{align:"right",children:"Optimized"}),e.jsx(f,{align:"right",children:"Improvement"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Expected Return"}),e.jsxs(f,{align:"right",children:[h.current.expectedReturn.toFixed(2),"%"]}),e.jsxs(f,{align:"right",children:[h.optimized.expectedReturn.toFixed(2),"%"]}),e.jsxs(f,{align:"right",sx:{color:"success.main"},children:["+",(h.optimized.expectedReturn-h.current.expectedReturn).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Risk (Volatility)"}),e.jsxs(f,{align:"right",children:[h.current.risk.toFixed(2),"%"]}),e.jsxs(f,{align:"right",children:[h.optimized.risk.toFixed(2),"%"]}),e.jsxs(f,{align:"right",sx:{color:h.optimized.risk<h.current.risk?"success.main":"error.main"},children:[h.optimized.risk<h.current.risk?"":"+",(h.optimized.risk-h.current.risk).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Sharpe Ratio"}),e.jsx(f,{align:"right",children:h.current.sharpeRatio.toFixed(2)}),e.jsx(f,{align:"right",children:h.optimized.sharpeRatio.toFixed(2)}),e.jsxs(f,{align:"right",sx:{color:"success.main"},children:["+",(h.optimized.sharpeRatio-h.current.sharpeRatio).toFixed(2)]})]})]})]})})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Optimized Allocation"}),e.jsx(st,{width:"100%",height:250,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:w?.allocation,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"weight",label:({symbol:S,weight:L})=>`${S} ${L.toFixed(1)}%`,children:w?.allocation?.map((S,L)=>e.jsx(xt,{fill:`hsl(${L*45}, 70%, 50%)`},`cell-${L}`))}),e.jsx(ot,{formatter:S=>[`${S.toFixed(2)}%`,"Weight"]})]})})]})]})}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>E(!1),children:"Close"}),e.jsx(oe,{variant:"contained",color:"primary",children:"Apply Optimization"})]})]})]})};function ER(r){return typeof r=="string"}function IR(r,t,s){return r===void 0||ER(r)?t:{...t,ownerState:{...t.ownerState,...s}}}function DR(r,t=[]){if(r===void 0)return{};const s={};return Object.keys(r).filter(n=>n.match(/^on[A-Z]/)&&typeof r[n]=="function"&&!t.includes(n)).forEach(n=>{s[n]=r[n]}),s}function Ff(r,t,s){return typeof r=="function"?r(t,s):r}function RR(...r){const t=j.useRef(void 0),s=j.useCallback(n=>{const i=r.map(a=>{if(a==null)return null;if(typeof a=="function"){const o=a,l=o(n);return typeof l=="function"?l:()=>{o(null)}}return a.current=n,()=>{a.current=null}});return()=>{i.forEach(a=>a?.())}},r);return j.useMemo(()=>r.every(n=>n==null)?null:n=>{t.current&&(t.current(),t.current=void 0),n!=null&&(t.current=s(n))},r)}function Hg(r){if(r===void 0)return{};const t={};return Object.keys(r).filter(s=>!(s.match(/^on[A-Z]/)&&typeof r[s]=="function")).forEach(s=>{t[s]=r[s]}),t}function MR(r){const{getSlotProps:t,additionalProps:s,externalSlotProps:n,externalForwardedProps:i,className:a}=r;if(!t){const x=Cs(s?.className,a,i?.className,n?.className),b={...s?.style,...i?.style,...n?.style},w={...s,...i,...n};return x.length>0&&(w.className=x),Object.keys(b).length>0&&(w.style=b),{props:w,internalRef:void 0}}const o=DR({...i,...n}),l=Hg(n),c=Hg(i),h=t(o),u=Cs(h?.className,s?.className,a,i?.className,n?.className),m={...h?.style,...s?.style,...i?.style,...n?.style},p={...h,...s,...c,...l};return u.length>0&&(p.className=u),Object.keys(m).length>0&&(p.style=m),{props:p,internalRef:h.ref}}function ds(r){const{elementType:t,externalSlotProps:s,ownerState:n,skipResolvingSlotProps:i=!1,...a}=r,o=i?{}:Ff(s,n),{props:l,internalRef:c}=MR({...a,externalSlotProps:o}),h=RR(c,o?.ref,r.additionalProps?.ref);return IR(t,{...l,ref:h},n)}const ja=(r,t)=>r.length!==t.length?!1:t.every(s=>r.includes(s)),LR=({openTo:r,defaultOpenTo:t,views:s,defaultViews:n})=>{const i=s??n;let a;if(r!=null)a=r;else if(i.includes(t))a=t;else if(i.length>0)a=i[0];else throw new Error("MUI: The `views` prop must contain at least one view");return{views:i,openTo:a}},hc=(r,t,s)=>{let n=t;return n=r.setHours(n,r.getHours(s)),n=r.setMinutes(n,r.getMinutes(s)),n=r.setSeconds(n,r.getSeconds(s)),n},Ra=({date:r,disableFuture:t,disablePast:s,maxDate:n,minDate:i,isDateDisabled:a,utils:o,timezone:l})=>{const c=hc(o,o.dateWithTimezone(void 0,l),r);s&&o.isBefore(i,c)&&(i=c),t&&o.isAfter(n,c)&&(n=c);let h=r,u=r;for(o.isBefore(r,i)&&(h=i,u=null),o.isAfter(r,n)&&(u&&(u=n),h=null);h||u;){if(h&&o.isAfter(h,n)&&(h=null),u&&o.isBefore(u,i)&&(u=null),h){if(!a(h))return h;h=o.addDays(h,1)}if(u){if(!a(u))return u;u=o.addDays(u,-1)}}return null},FR=(r,t)=>t==null||!r.isValid(t)?null:t,vr=(r,t,s)=>t==null||!r.isValid(t)?s:t,NR=(r,t,s)=>!r.isValid(t)&&t!=null&&!r.isValid(s)&&s!=null?!0:r.isEqual(t,s),Nf=(r,t)=>{const n=[r.startOfYear(t)];for(;n.length<12;){const i=n[n.length-1];n.push(r.addMonths(i,1))}return n},dw=(r,t,s)=>s==="date"?r.startOfDay(r.dateWithTimezone(void 0,t)):r.dateWithTimezone(void 0,t),WR=["year","month","day"],Gg=r=>WR.includes(r),Wf=(r,{format:t,views:s},n)=>{if(t!=null)return t;const i=r.formats;return ja(s,["year"])?i.year:ja(s,["month"])?i.month:ja(s,["day"])?i.dayOfMonth:ja(s,["month","year"])?`${i.month} ${i.year}`:ja(s,["day","month"])?`${i.month} ${i.dayOfMonth}`:n?/en/.test(r.getCurrentLocaleCode())?i.normalDateWithWeekday:i.normalDate:i.keyboardDate},$R=(r,t)=>{const s=r.startOfWeek(t);return[0,1,2,3,4,5,6].map(n=>r.addDays(s,n))},VR=["hours","minutes","seconds"],zR=r=>VR.includes(r),Kg=(r,t)=>t.getHours(r)*3600+t.getMinutes(r)*60+t.getSeconds(r),BR=(r,t)=>(s,n)=>r?t.isAfter(s,n):Kg(s,t)>Kg(n,t),$r={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7},UR=r=>Math.max(...r.map(t=>{var s;return(s=$r[t.type])!=null?s:1})),ba=(r,t,s)=>{if(t===$r.year)return r.startOfYear(s);if(t===$r.month)return r.startOfMonth(s);if(t===$r.day)return r.startOfDay(s);let n=s;return t<$r.minutes&&(n=r.setMinutes(n,0)),t<$r.seconds&&(n=r.setSeconds(n,0)),t<$r.milliseconds&&(n=r.setMilliseconds(n,0)),n},QR=({props:r,utils:t,granularity:s,timezone:n,getTodayDate:i})=>{var a;let o=i?i():ba(t,s,dw(t,n));r.minDate!=null&&t.isAfterDay(r.minDate,o)&&(o=ba(t,s,r.minDate)),r.maxDate!=null&&t.isBeforeDay(r.maxDate,o)&&(o=ba(t,s,r.maxDate));const l=BR((a=r.disableIgnoringDatePartForTimeValidation)!=null?a:!1,t);return r.minTime!=null&&l(r.minTime,o)&&(o=ba(t,s,r.disableIgnoringDatePartForTimeValidation?r.minTime:hc(t,o,r.minTime))),r.maxTime!=null&&l(o,r.maxTime)&&(o=ba(t,s,r.disableIgnoringDatePartForTimeValidation?r.maxTime:hc(t,o,r.maxTime))),o},hw=(r,t)=>{const s=r.formatTokenMap[t];if(s==null)throw new Error([`MUI: The token "${t}" is not supported by the Date and Time Pickers.`,"Please try using another token or open an issue on https://github.com/mui/mui-x/issues/new/choose if you think it should be supported."].join(`
`));return typeof s=="string"?{type:s,contentType:s==="meridiem"?"letter":"digit",maxLength:void 0}:{type:s.sectionType,contentType:s.contentType,maxLength:s.maxLength}},qR=r=>{switch(r){case"ArrowUp":return 1;case"ArrowDown":return-1;case"PageUp":return 5;case"PageDown":return-5;default:return 0}},$c=(r,t,s)=>{const n=[],i=r.dateWithTimezone(void 0,t),a=r.startOfWeek(i),o=r.endOfWeek(i);let l=a;for(;r.isBefore(l,o);)n.push(l),l=r.addDays(l,1);return n.map(c=>r.formatByString(c,s))},uw=(r,t,s,n)=>{switch(s){case"month":return Nf(r,r.dateWithTimezone(void 0,t)).map(i=>r.formatByString(i,n));case"weekDay":return $c(r,t,n);case"meridiem":{const i=r.dateWithTimezone(void 0,t);return[r.startOfDay(i),r.endOfDay(i)].map(a=>r.formatByString(a,n))}default:return[]}},fw=(r,t,s)=>{let n=t;for(n=Number(n).toString();n.length<s;)n=`0${n}`;return n},mw=(r,t,s,n,i)=>{if(i.type==="day"&&i.contentType==="digit-with-letter"){const o=r.setDate(n.longestMonth,s);return r.formatByString(o,i.format)}const a=s.toString();return i.hasLeadingZerosInInput?fw(r,a,i.maxLength):a},HR=(r,t,s,n,i,a,o)=>{const l=qR(n),c=n==="Home",h=n==="End",u=s.value===""||c||h,m=()=>{const x=i[s.type]({currentDate:a,format:s.format,contentType:s.contentType}),b=_=>mw(r,t,_,x,s),w=s.type==="minutes"&&o!=null&&o.minutesStep?o.minutesStep:1;let A=parseInt(s.value,10)+l*w;if(u){if(s.type==="year"&&!h&&!c)return r.formatByString(r.dateWithTimezone(void 0,t),s.format);l>0||c?A=x.minimum:A=x.maximum}return A%w!==0&&((l<0||c)&&(A+=w-(w+A)%w),(l>0||h)&&(A-=A%w)),A>x.maximum?b(x.minimum+(A-x.maximum-1)%(x.maximum-x.minimum+1)):A<x.minimum?b(x.maximum-(x.minimum-A-1)%(x.maximum-x.minimum+1)):b(A)},p=()=>{const x=uw(r,t,s.type,s.format);if(x.length===0)return s.value;if(u)return l>0||c?x[0]:x[x.length-1];const w=(x.indexOf(s.value)+x.length+l)%x.length;return x[w]};return s.contentType==="digit"||s.contentType==="digit-with-letter"?m():p()},$f=(r,t)=>{let s=r.value||r.placeholder;const n=t==="non-input"?r.hasLeadingZerosInFormat:r.hasLeadingZerosInInput;return t==="non-input"&&r.hasLeadingZerosInInput&&!r.hasLeadingZerosInFormat&&(s=Number(s).toString()),["input-rtl","input-ltr"].includes(t)&&r.contentType==="digit"&&!n&&s.length===1&&(s=`${s}‎`),t==="input-rtl"&&(s=`⁨${s}⁩`),s},Fi=r=>r.replace(/[\u2066\u2067\u2068\u2069]/g,""),pw=(r,t)=>{let s=0,n=t?1:0;const i=[];for(let a=0;a<r.length;a+=1){const o=r[a],l=$f(o,t?"input-rtl":"input-ltr"),c=`${o.startSeparator}${l}${o.endSeparator}`,h=Fi(c).length,u=c.length,m=Fi(l),p=n+l.indexOf(m[0])+o.startSeparator.length,x=p+m.length;i.push(me({},o,{start:s,end:s+h,startInInput:p,endInInput:x})),s+=h,n+=u}return i},GR=(r,t,s,n,i)=>{switch(n.type){case"year":return s.fieldYearPlaceholder({digitAmount:r.formatByString(r.dateWithTimezone(void 0,t),i).length,format:i});case"month":return s.fieldMonthPlaceholder({contentType:n.contentType,format:i});case"day":return s.fieldDayPlaceholder({format:i});case"weekDay":return s.fieldWeekDayPlaceholder({contentType:n.contentType,format:i});case"hours":return s.fieldHoursPlaceholder({format:i});case"minutes":return s.fieldMinutesPlaceholder({format:i});case"seconds":return s.fieldSecondsPlaceholder({format:i});case"meridiem":return s.fieldMeridiemPlaceholder({format:i});default:return i}},Yg=(r,t,s,n)=>r.formatByString(r.parse(t,s),n),gw=(r,t,s)=>r.formatByString(r.dateWithTimezone(void 0,t),s).length===4,xw=(r,t,s,n,i)=>{if(s!=="digit")return!1;const a=r.dateWithTimezone(void 0,t);switch(n){case"year":return gw(r,t,i)?r.formatByString(r.setYear(a,1),i)==="0001":r.formatByString(r.setYear(a,2001),i)==="01";case"month":return r.formatByString(r.startOfYear(a),i).length>1;case"day":return r.formatByString(r.startOfMonth(a),i).length>1;case"weekDay":return r.formatByString(r.startOfWeek(a),i).length>1;case"hours":return r.formatByString(r.setHours(a,1),i).length>1;case"minutes":return r.formatByString(r.setMinutes(a,1),i).length>1;case"seconds":return r.formatByString(r.setSeconds(a,1),i).length>1;default:throw new Error("Invalid section type")}},KR=(r,t)=>{const s=[],{start:n,end:i}=r.escapedCharacters,a=new RegExp(`(\\${n}[^\\${i}]*\\${i})+`,"g");let o=null;for(;o=a.exec(t);)s.push({start:o.index,end:a.lastIndex-1});return s},Xg=(r,t,s,n,i,a,o,l)=>{let c="";const h=[],u=r.date(),m=R=>{if(R==="")return null;const E=hw(r,R),T=xw(r,t,E.contentType,E.type,R),M=o?T:E.contentType==="digit",I=i!=null&&r.isValid(i);let N=I?r.formatByString(i,R):"",k=null;if(M)if(T)k=N===""?r.formatByString(u,R).length:N.length;else{if(E.maxLength==null)throw new Error(`MUI: The token ${R} should have a 'maxDigitNumber' property on it's adapter`);k=E.maxLength,I&&(N=fw(r,N,k))}return h.push(me({},E,{format:R,maxLength:k,value:N,placeholder:GR(r,t,s,E,R),hasLeadingZeros:T,hasLeadingZerosInFormat:T,hasLeadingZerosInInput:M,startSeparator:h.length===0?c:"",endSeparator:"",modified:!1})),null};let p=10,x=n,b=r.expandFormat(n);for(;b!==x;)if(x=b,b=r.expandFormat(x),p-=1,p<0)throw new Error("MUI: The format expansion seems to be  enter in an infinite loop. Please open an issue with the format passed to the picker component");const w=b,C=KR(r,w),A=new RegExp(`^(${Object.keys(r.formatTokenMap).sort((R,E)=>E.length-R.length).join("|")})`,"g");let _="";for(let R=0;R<w.length;R+=1){const E=C.find(k=>k.start<=R&&k.end>=R),T=w[R],M=E!=null,I=`${_}${w.slice(R)}`,N=A.test(I);!M&&T.match(/([A-Za-z]+)/)&&N?(_=I.slice(0,A.lastIndex),R+=A.lastIndex-1):M&&E?.start===R||E?.end===R||(m(_),_="",h.length===0?c+=T:h[h.length-1].endSeparator+=T)}return m(_),h.map(R=>{const E=T=>{let M=T;return l&&M!==null&&M.includes(" ")&&(M=`⁩${M}⁦`),a==="spacious"&&["/",".","-"].includes(M)&&(M=` ${M} `),M};return R.startSeparator=E(R.startSeparator),R.endSeparator=E(R.endSeparator),R})},YR=(r,t)=>{const s=t.some(l=>l.type==="day"),n=[],i=[];for(let l=0;l<t.length;l+=1){const c=t[l];s&&c.type==="weekDay"||(n.push(c.format),i.push($f(c,"non-input")))}const a=n.join(" "),o=i.join(" ");return r.parse(o,a)},XR=(r,t)=>{const n=r.map(i=>{const a=$f(i,t?"input-rtl":"input-ltr");return`${i.startSeparator}${a}${i.endSeparator}`}).join("");return t?`⁦${n}⁩`:n},ZR=(r,t)=>{const s=r.dateWithTimezone(void 0,t),n=r.endOfYear(s),i=r.endOfDay(s),{maxDaysInMonth:a,longestMonth:o}=Nf(r,s).reduce((l,c)=>{const h=r.getDaysInMonth(c);return h>l.maxDaysInMonth?{maxDaysInMonth:h,longestMonth:c}:l},{maxDaysInMonth:0,longestMonth:null});return{year:({format:l})=>({minimum:0,maximum:gw(r,t,l)?9999:99}),month:()=>({minimum:1,maximum:r.getMonth(n)+1}),day:({currentDate:l})=>({minimum:1,maximum:l!=null&&r.isValid(l)?r.getDaysInMonth(l):a,longestMonth:o}),weekDay:({format:l,contentType:c})=>{if(c==="digit"){const h=$c(r,t,l).map(Number);return{minimum:Math.min(...h),maximum:Math.max(...h)}}return{minimum:1,maximum:7}},hours:({format:l})=>{const c=r.getHours(i);return r.formatByString(r.endOfDay(s),l)!==c.toString()?{minimum:1,maximum:Number(r.formatByString(r.startOfDay(s),l))}:{minimum:0,maximum:c}},minutes:()=>({minimum:0,maximum:r.getMinutes(i)}),seconds:()=>({minimum:0,maximum:r.getSeconds(i)}),meridiem:()=>({minimum:0,maximum:0})}},JR=(r,t,s,n,i)=>{switch(s.type){case"year":return r.setYear(i,r.getYear(n));case"month":return r.setMonth(i,r.getMonth(n));case"weekDay":{const a=$c(r,t,s.format),o=r.formatByString(n,s.format),l=a.indexOf(o),h=a.indexOf(s.value)-l;return r.addDays(n,h)}case"day":return r.setDate(i,r.getDate(n));case"meridiem":{const a=r.getHours(n)<12,o=r.getHours(i);return a&&o>=12?r.addHours(i,-12):!a&&o<12?r.addHours(i,12):i}case"hours":return r.setHours(i,r.getHours(n));case"minutes":return r.setMinutes(i,r.getMinutes(n));case"seconds":return r.setSeconds(i,r.getSeconds(n));default:return i}},Zg={year:1,month:2,day:3,weekDay:4,hours:5,minutes:6,seconds:7,meridiem:8},Jg=(r,t,s,n,i,a)=>[...n].sort((o,l)=>Zg[o.type]-Zg[l.type]).reduce((o,l)=>!a||l.modified?JR(r,t,l,s,o):o,i),eM=()=>navigator.userAgent.toLowerCase().indexOf("android")>-1,tM=(r,t)=>{const s={};if(!t)return r.forEach((c,h)=>{const u=h===0?null:h-1,m=h===r.length-1?null:h+1;s[h]={leftIndex:u,rightIndex:m}}),{neighbors:s,startIndex:0,endIndex:r.length-1};const n={},i={};let a=0,o=0,l=r.length-1;for(;l>=0;){o=r.findIndex((c,h)=>{var u;return h>=a&&((u=c.endSeparator)==null?void 0:u.includes(" "))&&c.endSeparator!==" / "}),o===-1&&(o=r.length-1);for(let c=o;c>=a;c-=1)i[c]=l,n[l]=c,l-=1;a=o+1}return r.forEach((c,h)=>{const u=i[h],m=u===0?null:n[u-1],p=u===r.length-1?null:n[u+1];s[h]={leftIndex:m,rightIndex:p}}),{neighbors:s,startIndex:n[0],endIndex:n[r.length-1]}},sM=["value","referenceDate"],Sn={emptyValue:null,getTodayValue:dw,getInitialReferenceValue:r=>{let{value:t,referenceDate:s}=r,n=kt(r,sM);return t!=null&&n.utils.isValid(t)?t:s??QR(n)},cleanValue:FR,areValuesEqual:NR,isSameError:(r,t)=>r===t,hasError:r=>r!=null,defaultErrorState:null,getTimezone:(r,t)=>t==null||!r.isValid(t)?null:r.getTimezone(t),setTimezone:(r,t,s)=>s==null?null:r.setTimezone(s,t)},rM={updateReferenceValue:(r,t,s)=>t==null||!r.isValid(t)?s:t,getSectionsFromValue:(r,t,s,n,i)=>!r.isValid(t)&&!!s?s:pw(i(t),n),getValueStrFromSections:XR,getActiveDateManager:(r,t)=>({date:t.value,referenceDate:t.referenceValue,getSections:s=>s,getNewValuesFromNewActiveDate:s=>({value:s,referenceValue:s==null||!r.isValid(s)?t.referenceValue:s})}),parseValueStr:(r,t,s)=>s(r.trim(),t)},nM=["localeText"],du=j.createContext(null),Vc=function(t){var s;const{localeText:n}=t,i=kt(t,nM),{utils:a,localeText:o}=(s=j.useContext(du))!=null?s:{utils:void 0,localeText:void 0},l=ms({props:i,name:"MuiLocalizationProvider"}),{children:c,dateAdapter:h,dateFormats:u,dateLibInstance:m,adapterLocale:p,localeText:x}=l,b=j.useMemo(()=>me({},x,o,n),[x,o,n]),w=j.useMemo(()=>{if(!h)return a||null;const _=new h({locale:p,formats:u,instance:m});if(!_.isMUIAdapter)throw new Error(["MUI: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/getting-started/#installation"].join(`
`));return _},[h,p,u,m,a]),C=j.useMemo(()=>w?{minDate:w.date("1900-01-01T00:00:00.000"),maxDate:w.date("2099-12-31T00:00:00.000")}:null,[w]),A=j.useMemo(()=>({utils:w,defaultDates:C,localeText:b}),[C,w,b]);return e.jsx(du.Provider,{value:A,children:c})},iM=r=>({components:{MuiLocalizationProvider:{defaultProps:{localeText:me({},r)}}}}),yw={previousMonth:"Previous month",nextMonth:"Next month",openPreviousView:"open previous view",openNextView:"open next view",calendarViewSwitchingButtonAriaLabel:r=>r==="year"?"year view is open, switch to calendar view":"calendar view is open, switch to year view",start:"Start",end:"End",cancelButtonLabel:"Cancel",clearButtonLabel:"Clear",okButtonLabel:"OK",todayButtonLabel:"Today",datePickerToolbarTitle:"Select date",dateTimePickerToolbarTitle:"Select date & time",timePickerToolbarTitle:"Select time",dateRangePickerToolbarTitle:"Select date range",clockLabelText:(r,t,s)=>`Select ${r}. ${t===null?"No time selected":`Selected time is ${s.format(t,"fullTime")}`}`,hoursClockNumberText:r=>`${r} hours`,minutesClockNumberText:r=>`${r} minutes`,secondsClockNumberText:r=>`${r} seconds`,selectViewText:r=>`Select ${r}`,calendarWeekNumberHeaderLabel:"Week number",calendarWeekNumberHeaderText:"#",calendarWeekNumberAriaLabelText:r=>`Week ${r}`,calendarWeekNumberText:r=>`${r}`,openDatePickerDialogue:(r,t)=>r!==null&&t.isValid(r)?`Choose date, selected date is ${t.format(r,"fullDate")}`:"Choose date",openTimePickerDialogue:(r,t)=>r!==null&&t.isValid(r)?`Choose time, selected time is ${t.format(r,"fullTime")}`:"Choose time",fieldClearLabel:"Clear value",timeTableLabel:"pick time",dateTableLabel:"pick date",fieldYearPlaceholder:r=>"Y".repeat(r.digitAmount),fieldMonthPlaceholder:r=>r.contentType==="letter"?"MMMM":"MM",fieldDayPlaceholder:()=>"DD",fieldWeekDayPlaceholder:r=>r.contentType==="letter"?"EEEE":"EE",fieldHoursPlaceholder:()=>"hh",fieldMinutesPlaceholder:()=>"mm",fieldSecondsPlaceholder:()=>"ss",fieldMeridiemPlaceholder:()=>"aa"},aM=yw;iM(yw);const ji=()=>{const r=j.useContext(du);if(r===null)throw new Error(["MUI: Can not find the date and time pickers localization context.","It looks like you forgot to wrap your component in LocalizationProvider.","This can also happen if you are bundling multiple versions of the `@mui/x-date-pickers` package"].join(`
`));if(r.utils===null)throw new Error(["MUI: Can not find the date and time pickers adapter from its localization context.","It looks like you forgot to pass a `dateAdapter` to your LocalizationProvider."].join(`
`));const t=j.useMemo(()=>me({},aM,r.localeText),[r.localeText]);return j.useMemo(()=>me({},r,{localeText:t}),[r,t])},Ft=()=>ji().utils,Oo=()=>ji().defaultDates,Gn=()=>ji().localeText,zc=r=>{const t=Ft(),s=j.useRef();return s.current===void 0&&(s.current=t.dateWithTimezone(void 0,r)),s.current};function oM(r){return $s("MuiPickersToolbar",r)}Vs("MuiPickersToolbar",["root","content"]);const lM=r=>{const{classes:t,isLandscape:s}=r;return Rs({root:["root"],content:["content"],penIconButton:["penIconButton",s&&"penIconButtonLandscape"]},oM,t)},cM=ct("div",{name:"MuiPickersToolbar",slot:"Root",overridesResolver:(r,t)=>t.root})(({theme:r,ownerState:t})=>me({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",padding:r.spacing(2,3)},t.isLandscape&&{height:"auto",maxWidth:160,padding:16,justifyContent:"flex-start",flexWrap:"wrap"})),dM=ct("div",{name:"MuiPickersToolbar",slot:"Content",overridesResolver:(r,t)=>t.content})(({ownerState:r})=>{var t;return{display:"flex",flexWrap:"wrap",width:"100%",justifyContent:r.isLandscape?"flex-start":"space-between",flexDirection:r.isLandscape?(t=r.landscapeDirection)!=null?t:"column":"row",flex:1,alignItems:r.isLandscape?"flex-start":"center"}}),hM=j.forwardRef(function(t,s){const n=ms({props:t,name:"MuiPickersToolbar"}),{children:i,className:a,toolbarTitle:o,hidden:l,titleId:c}=n,h=n,u=lM(h);return l?null:e.jsxs(cM,{ref:s,className:Cs(u.root,a),ownerState:h,children:[e.jsx(d,{color:"text.secondary",variant:"overline",id:c,children:o}),e.jsx(dM,{className:u.content,ownerState:h,children:i})]})});function uM(r){return $s("MuiDatePickerToolbar",r)}Vs("MuiDatePickerToolbar",["root","title"]);const fM=["value","isLandscape","onChange","toolbarFormat","toolbarPlaceholder","views","className"],mM=r=>{const{classes:t}=r;return Rs({root:["root"],title:["title"]},uM,t)},pM=ct(hM,{name:"MuiDatePickerToolbar",slot:"Root",overridesResolver:(r,t)=>t.root})({}),gM=ct(d,{name:"MuiDatePickerToolbar",slot:"Title",overridesResolver:(r,t)=>t.title})(({ownerState:r})=>me({},r.isLandscape&&{margin:"auto 16px auto auto"})),xM=j.forwardRef(function(t,s){const n=ms({props:t,name:"MuiDatePickerToolbar"}),{value:i,isLandscape:a,toolbarFormat:o,toolbarPlaceholder:l="––",views:c,className:h}=n,u=kt(n,fM),m=Ft(),p=Gn(),x=mM(n),b=j.useMemo(()=>{if(!i)return l;const C=Wf(m,{format:o,views:c},!0);return m.formatByString(i,C)},[i,o,l,m,c]),w=n;return e.jsx(pM,me({ref:s,toolbarTitle:p.datePickerToolbarTitle,isLandscape:a,className:Cs(x.root,h)},u,{children:e.jsx(gM,{variant:"h4",align:a?"left":"center",ownerState:w,className:x.title,children:b})}))}),jw=r=>{if(r!==void 0)return Object.keys(r).reduce((t,s)=>me({},t,{[`${s.slice(0,1).toLowerCase()}${s.slice(1)}`]:r[s]}),{})};function bw(r,t){var s,n,i,a;const o=Ft(),l=Oo(),c=ms({props:r,name:t}),h=j.useMemo(()=>{var m;return((m=c.localeText)==null?void 0:m.toolbarTitle)==null?c.localeText:me({},c.localeText,{datePickerToolbarTitle:c.localeText.toolbarTitle})},[c.localeText]),u=(s=c.slots)!=null?s:jw(c.components);return me({},c,{localeText:h},LR({views:c.views,openTo:c.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{disableFuture:(n=c.disableFuture)!=null?n:!1,disablePast:(i=c.disablePast)!=null?i:!1,minDate:vr(o,c.minDate,l.minDate),maxDate:vr(o,c.maxDate,l.maxDate),slots:me({toolbar:xM},u),slotProps:(a=c.slotProps)!=null?a:c.componentsProps})}const yM=Un(e.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),jM=Un(e.jsx("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"ArrowLeft"),bM=Un(e.jsx("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"ArrowRight"),vM=Un(e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Calendar");Un(e.jsxs(j.Fragment,{children:[e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Clock");Un(e.jsx("path",{d:"M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"}),"DateRange");Un(e.jsxs(j.Fragment,{children:[e.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),e.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Time");const wM=Un(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");function SM(r){return $s("MuiPickersArrowSwitcher",r)}Vs("MuiPickersArrowSwitcher",["root","spacer","button"]);const OM=["children","className","slots","slotProps","isNextDisabled","isNextHidden","onGoToNext","nextLabel","isPreviousDisabled","isPreviousHidden","onGoToPrevious","previousLabel"],kM=["ownerState"],CM=["ownerState"],AM=ct("div",{name:"MuiPickersArrowSwitcher",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"flex"}),TM=ct("div",{name:"MuiPickersArrowSwitcher",slot:"Spacer",overridesResolver:(r,t)=>t.spacer})(({theme:r})=>({width:r.spacing(3)})),ex=ct(Ge,{name:"MuiPickersArrowSwitcher",slot:"Button",overridesResolver:(r,t)=>t.button})(({ownerState:r})=>me({},r.hidden&&{visibility:"hidden"})),PM=r=>{const{classes:t}=r;return Rs({root:["root"],spacer:["spacer"],button:["button"]},SM,t)},_M=j.forwardRef(function(t,s){var n,i,a,o;const c=Zs().direction==="rtl",h=ms({props:t,name:"MuiPickersArrowSwitcher"}),{children:u,className:m,slots:p,slotProps:x,isNextDisabled:b,isNextHidden:w,onGoToNext:C,nextLabel:A,isPreviousDisabled:_,isPreviousHidden:R,onGoToPrevious:E,previousLabel:T}=h,M=kt(h,OM),I=h,N=PM(I),k={isDisabled:b,isHidden:w,goTo:C,label:A},S={isDisabled:_,isHidden:R,goTo:E,label:T},L=(n=p?.previousIconButton)!=null?n:ex,W=ds({elementType:L,externalSlotProps:x?.previousIconButton,additionalProps:{size:"medium",title:S.label,"aria-label":S.label,disabled:S.isDisabled,edge:"end",onClick:S.goTo},ownerState:me({},I,{hidden:S.isHidden}),className:N.button}),F=(i=p?.nextIconButton)!=null?i:ex,$=ds({elementType:F,externalSlotProps:x?.nextIconButton,additionalProps:{size:"medium",title:k.label,"aria-label":k.label,disabled:k.isDisabled,edge:"start",onClick:k.goTo},ownerState:me({},I,{hidden:k.isHidden}),className:N.button}),q=(a=p?.leftArrowIcon)!=null?a:jM,ne=ds({elementType:q,externalSlotProps:x?.leftArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),he=kt(ne,kM),re=(o=p?.rightArrowIcon)!=null?o:bM,G=ds({elementType:re,externalSlotProps:x?.rightArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:void 0}),H=kt(G,CM);return e.jsxs(AM,me({ref:s,className:Cs(N.root,m),ownerState:I},M,{children:[e.jsx(L,me({},W,{children:c?e.jsx(re,me({},H)):e.jsx(q,me({},he))})),u?e.jsx(d,{variant:"subtitle1",component:"span",children:u}):e.jsx(TM,{className:N.spacer,ownerState:I}),e.jsx(F,me({},$,{children:c?e.jsx(q,me({},he)):e.jsx(re,me({},H))}))]}))}),io=36,Bc=2,Uc=320,EM=280,Vf=334,IM=ct(Os)({[`& .${Xf.container}`]:{outline:0},[`& .${Xf.paper}`]:{outline:0,minWidth:Uc}}),DM=ct(ks)({"&:first-of-type":{padding:0}});function RM(r){var t,s;const{children:n,onDismiss:i,open:a,slots:o,slotProps:l}=r,c=(t=o?.dialog)!=null?t:IM,h=(s=o?.mobileTransition)!=null?s:oo;return e.jsx(c,me({open:a,onClose:i},l?.dialog,{TransitionComponent:h,TransitionProps:l?.mobileTransition,PaperComponent:o?.mobilePaper,PaperProps:l?.mobilePaper,children:e.jsx(DM,{children:n})}))}function MM(r){return $s("MuiPickersPopper",r)}Vs("MuiPickersPopper",["root","paper"]);function LM(r,t){return Array.isArray(t)?t.every(s=>r.indexOf(s)!==-1):r.indexOf(t)!==-1}const FM=(r,t)=>s=>{(s.key==="Enter"||s.key===" ")&&(r(s),s.preventDefault(),s.stopPropagation())},uc=(r=document)=>{const t=r.activeElement;return t?t.shadowRoot?uc(t.shadowRoot):t:null},NM="@media (pointer: fine)",WM="@media (prefers-reduced-motion: reduce)",Qi=typeof navigator<"u"&&navigator.userAgent.match(/android\s(\d+)|OS\s(\d+)/i),tx=Qi&&Qi[1]?parseInt(Qi[1],10):null,sx=Qi&&Qi[2]?parseInt(Qi[2],10):null,$M=tx&&tx<10||sx&&sx<13||!1,vw=()=>fu(WM,{defaultMatches:!1})||$M,VM=["PaperComponent","popperPlacement","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],zM=r=>{const{classes:t}=r;return Rs({root:["root"],paper:["paper"]},MM,t)},BM=ct(OS,{name:"MuiPickersPopper",slot:"Root",overridesResolver:(r,t)=>t.root})(({theme:r})=>({zIndex:r.zIndex.modal})),UM=ct(He,{name:"MuiPickersPopper",slot:"Paper",overridesResolver:(r,t)=>t.paper})(({ownerState:r})=>me({outline:0,transformOrigin:"top center"},r.placement.includes("top")&&{transformOrigin:"bottom center"}));function QM(r,t){return t.documentElement.clientWidth<r.clientX||t.documentElement.clientHeight<r.clientY}function qM(r,t){const s=j.useRef(!1),n=j.useRef(!1),i=j.useRef(null),a=j.useRef(!1);j.useEffect(()=>{if(!r)return;function c(){a.current=!0}return document.addEventListener("mousedown",c,!0),document.addEventListener("touchstart",c,!0),()=>{document.removeEventListener("mousedown",c,!0),document.removeEventListener("touchstart",c,!0),a.current=!1}},[r]);const o=Ze(c=>{if(!a.current)return;const h=n.current;n.current=!1;const u=Kc(i.current);if(!i.current||"clientX"in c&&QM(c,u))return;if(s.current){s.current=!1;return}let m;c.composedPath?m=c.composedPath().indexOf(i.current)>-1:m=!u.documentElement.contains(c.target)||i.current.contains(c.target),!m&&!h&&t(c)}),l=()=>{n.current=!0};return j.useEffect(()=>{if(r){const c=Kc(i.current),h=()=>{s.current=!0};return c.addEventListener("touchstart",o),c.addEventListener("touchmove",h),()=>{c.removeEventListener("touchstart",o),c.removeEventListener("touchmove",h)}}},[r,o]),j.useEffect(()=>{if(r){const c=Kc(i.current);return c.addEventListener("click",o),()=>{c.removeEventListener("click",o),n.current=!1}}},[r,o]),[i,l,l]}const HM=j.forwardRef((r,t)=>{const{PaperComponent:s,popperPlacement:n,ownerState:i,children:a,paperSlotProps:o,paperClasses:l,onPaperClick:c,onPaperTouchStart:h}=r,u=kt(r,VM),m=me({},i,{placement:n}),p=ds({elementType:s,externalSlotProps:o,additionalProps:{tabIndex:-1,elevation:8,ref:t},className:l,ownerState:m});return e.jsx(s,me({},u,p,{onClick:x=>{var b;c(x),(b=p.onClick)==null||b.call(p,x)},onTouchStart:x=>{var b;h(x),(b=p.onTouchStart)==null||b.call(p,x)},ownerState:m,children:a}))});function GM(r){var t,s,n,i;const a=ms({props:r,name:"MuiPickersPopper"}),{anchorEl:o,children:l,containerRef:c=null,shouldRestoreFocus:h,onBlur:u,onDismiss:m,open:p,role:x,placement:b,slots:w,slotProps:C,reduceAnimations:A}=a;j.useEffect(()=>{function G(H){p&&(H.key==="Escape"||H.key==="Esc")&&m()}return document.addEventListener("keydown",G),()=>{document.removeEventListener("keydown",G)}},[m,p]);const _=j.useRef(null);j.useEffect(()=>{x==="tooltip"||h&&!h()||(p?_.current=uc(document):_.current&&_.current instanceof HTMLElement&&setTimeout(()=>{_.current instanceof HTMLElement&&_.current.focus()}))},[p,x,h]);const[R,E,T]=qM(p,u??m),M=j.useRef(null),I=ci(M,c),N=ci(I,R),k=a,S=zM(k),L=vw(),W=A??L,F=G=>{G.key==="Escape"&&(G.stopPropagation(),m())},$=((t=w?.desktopTransition)!=null?t:W)?oo:wS,q=(s=w?.desktopTrapFocus)!=null?s:SS,ne=(n=w?.desktopPaper)!=null?n:UM,he=(i=w?.popper)!=null?i:BM,re=ds({elementType:he,externalSlotProps:C?.popper,additionalProps:{transition:!0,role:x,open:p,anchorEl:o,placement:b,onKeyDown:F},className:S.root,ownerState:a});return e.jsx(he,me({},re,{children:({TransitionProps:G,placement:H})=>e.jsx(q,me({open:p,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:x==="tooltip",isEnabled:()=>!0},C?.desktopTrapFocus,{children:e.jsx($,me({},G,C?.desktopTransition,{children:e.jsx(HM,{PaperComponent:ne,ownerState:k,popperPlacement:H,ref:N,onPaperClick:E,onPaperTouchStart:T,paperClasses:S.paper,paperSlotProps:C?.desktopPaper,children:l})}))}))}))}const zf=({timezone:r,value:t,defaultValue:s,onChange:n,valueManager:i})=>{var a,o;const l=Ft(),c=j.useRef(s),h=(a=t??c.current)!=null?a:i.emptyValue,u=j.useMemo(()=>i.getTimezone(l,h),[l,i,h]),m=Ze(w=>u==null?w:i.setTimezone(l,u,w)),p=(o=r??u)!=null?o:"default",x=j.useMemo(()=>i.setTimezone(l,p,h),[i,l,p,h]),b=Ze((w,...C)=>{const A=m(w);n?.(A,...C)});return{value:x,handleValueChange:b,timezone:p}},Bf=({name:r,timezone:t,value:s,defaultValue:n,onChange:i,valueManager:a})=>{const[o,l]=Nn({name:r,state:"value",controlled:s,default:n??a.emptyValue}),c=Ze((h,...u)=>{l(h),i?.(h,...u)});return zf({timezone:t,value:o,defaultValue:void 0,onChange:c,valueManager:a})};function ww(r,t,s,n){const{value:i,onError:a}=r,o=ji(),l=j.useRef(n),c=t({adapter:o,value:i,props:r});return j.useEffect(()=>{a&&!s(c,l.current)&&a(c,i),l.current=c},[s,a,l,c,i]),c}const KM=r=>{const t=Ft(),s=Gn(),n=ji(),a=Zs().direction==="rtl",{valueManager:o,fieldValueManager:l,validator:c,internalProps:h,internalProps:{value:u,defaultValue:m,referenceDate:p,onChange:x,format:b,formatDensity:w="dense",selectedSections:C,onSelectedSectionsChange:A,shouldRespectLeadingZeros:_=!1,timezone:R}}=r,{timezone:E,value:T,handleValueChange:M}=zf({timezone:R,value:u,defaultValue:m,onChange:x,valueManager:o}),I=j.useMemo(()=>ZR(t,E),[t,E]),N=j.useCallback((Y,ce=null)=>l.getSectionsFromValue(t,Y,ce,a,ae=>Xg(t,E,s,b,ae,w,_,a)),[l,b,s,a,_,t,w,E]),k=j.useMemo(()=>l.getValueStrFromSections(N(o.emptyValue),a),[l,N,o.emptyValue,a]),[S,L]=j.useState(()=>{const Y=N(T),ce={sections:Y,value:T,referenceValue:o.emptyValue,tempValueStrAndroid:null},ae=UR(Y),ee=o.getInitialReferenceValue({referenceDate:p,value:T,utils:t,props:h,granularity:ae,timezone:E});return me({},ce,{referenceValue:ee})}),[W,F]=Nn({controlled:C,default:null,name:"useField",state:"selectedSectionIndexes"}),$=Y=>{F(Y),A?.(Y),L(ce=>me({},ce,{selectedSectionQuery:null}))},q=j.useMemo(()=>{if(W==null)return null;if(W==="all")return{startIndex:0,endIndex:S.sections.length-1,shouldSelectBoundarySelectors:!0};if(typeof W=="number")return{startIndex:W,endIndex:W};if(typeof W=="string"){const Y=S.sections.findIndex(ce=>ce.type===W);return{startIndex:Y,endIndex:Y}}return W},[W,S.sections]),ne=({value:Y,referenceValue:ce,sections:ae})=>{if(L(te=>me({},te,{sections:ae,value:Y,referenceValue:ce,tempValueStrAndroid:null})),o.areValuesEqual(t,S.value,Y))return;const ee={validationError:c({adapter:n,value:Y,props:me({},h,{value:Y,timezone:E})})};M(Y,ee)},he=(Y,ce)=>{const ae=[...S.sections];return ae[Y]=me({},ae[Y],{value:ce,modified:!0}),pw(ae,a)},re=()=>{ne({value:o.emptyValue,referenceValue:S.referenceValue,sections:N(o.emptyValue)})},G=()=>{if(q==null)return;const Y=S.sections[q.startIndex],ce=l.getActiveDateManager(t,S,Y),ee=ce.getSections(S.sections).filter(et=>et.value!=="").length===(Y.value===""?0:1),te=he(q.startIndex,""),Pe=ee?null:t.date(new Date("")),Be=ce.getNewValuesFromNewActiveDate(Pe);(Pe!=null&&!t.isValid(Pe))!=(ce.date!=null&&!t.isValid(ce.date))?ne(me({},Be,{sections:te})):L(et=>me({},et,Be,{sections:te,tempValueStrAndroid:null}))},H=Y=>{const ce=(te,Pe)=>{const Be=t.parse(te,b);if(Be==null||!t.isValid(Be))return null;const et=Xg(t,E,s,b,Be,w,_,a);return Jg(t,E,Be,et,Pe,!1)},ae=l.parseValueStr(Y,S.referenceValue,ce),ee=l.updateReferenceValue(t,ae,S.referenceValue);ne({value:ae,referenceValue:ee,sections:N(ae,S.sections)})},P=({activeSection:Y,newSectionValue:ce,shouldGoToNextSection:ae})=>{ae&&q&&q.startIndex<S.sections.length-1?$(q.startIndex+1):q&&q.startIndex!==q.endIndex&&$(q.startIndex);const ee=l.getActiveDateManager(t,S,Y),te=he(q.startIndex,ce),Pe=ee.getSections(te),Be=YR(t,Pe);let et,De;if(Be!=null&&t.isValid(Be)){const ze=Jg(t,E,Be,Pe,ee.referenceDate,!0);et=ee.getNewValuesFromNewActiveDate(ze),De=!0}else et=ee.getNewValuesFromNewActiveDate(Be),De=(Be!=null&&!t.isValid(Be))!=(ee.date!=null&&!t.isValid(ee.date));return De?ne(me({},et,{sections:te})):L(ze=>me({},ze,et,{sections:te,tempValueStrAndroid:null}))},D=Y=>L(ce=>me({},ce,{tempValueStrAndroid:Y}));return j.useEffect(()=>{const Y=N(S.value);L(ce=>me({},ce,{sections:Y}))},[b,t.locale]),j.useEffect(()=>{let Y=!1;o.areValuesEqual(t,S.value,T)?Y=o.getTimezone(t,S.value)!==o.getTimezone(t,T):Y=!0,Y&&L(ce=>me({},ce,{value:T,referenceValue:l.updateReferenceValue(t,T,ce.referenceValue),sections:N(T)}))},[T]),{state:S,selectedSectionIndexes:q,setSelectedSections:$,clearValue:re,clearActiveSection:G,updateSectionValue:P,updateValueFromValueStr:H,setTempAndroidValueStr:D,sectionsValueBoundaries:I,placeholder:k,timezone:E}},YM=5e3,ki=r=>r.saveQuery!=null,XM=({sections:r,updateSectionValue:t,sectionsValueBoundaries:s,setTempAndroidValueStr:n,timezone:i})=>{const a=Ft(),[o,l]=j.useState(null),c=Ze(()=>l(null));j.useEffect(()=>{var x;o!=null&&((x=r[o.sectionIndex])==null?void 0:x.type)!==o.sectionType&&c()},[r,o,c]),j.useEffect(()=>{if(o!=null){const x=setTimeout(()=>c(),YM);return()=>{window.clearTimeout(x)}}return()=>{}},[o,c]);const h=({keyPressed:x,sectionIndex:b},w,C)=>{const A=x.toLowerCase(),_=r[b];if(o!=null&&(!C||C(o.value))&&o.sectionIndex===b){const E=`${o.value}${A}`,T=w(E,_);if(!ki(T))return l({sectionIndex:b,value:E,sectionType:_.type}),T}const R=w(A,_);return ki(R)&&!R.saveQuery?(c(),null):(l({sectionIndex:b,value:A,sectionType:_.type}),ki(R)?null:R)},u=x=>{const b=(A,_,R)=>{const E=_.filter(T=>T.toLowerCase().startsWith(R));return E.length===0?{saveQuery:!1}:{sectionValue:E[0],shouldGoToNextSection:E.length===1}},w=(A,_,R,E)=>{const T=M=>uw(a,i,_.type,M);if(_.contentType==="letter")return b(_.format,T(_.format),A);if(R&&E!=null&&hw(a,R).contentType==="letter"){const M=T(R),I=b(R,M,A);return ki(I)?{saveQuery:!1}:me({},I,{sectionValue:E(I.sectionValue,M)})}return{saveQuery:!1}};return h(x,(A,_)=>{switch(_.type){case"month":{const R=E=>Yg(a,E,a.formats.month,_.format);return w(A,_,a.formats.month,R)}case"weekDay":{const R=(E,T)=>T.indexOf(E).toString();return w(A,_,a.formats.weekday,R)}case"meridiem":return w(A,_);default:return{saveQuery:!1}}})},m=x=>{const b=(C,A)=>{const _=+`${C}`,R=s[A.type]({currentDate:null,format:A.format,contentType:A.contentType});if(_>R.maximum)return{saveQuery:!1};if(_<R.minimum)return{saveQuery:!0};const E=+`${C}0`>R.maximum||C.length===R.maximum.toString().length;return{sectionValue:mw(a,i,_,R,A),shouldGoToNextSection:E}};return h(x,(C,A)=>{if(A.contentType==="digit"||A.contentType==="digit-with-letter")return b(C,A);if(A.type==="month"){xw(a,i,"digit","month","MM");const _=b(C,{type:A.type,format:"MM",hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(ki(_))return _;const R=Yg(a,_.sectionValue,"MM",A.format);return me({},_,{sectionValue:R})}if(A.type==="weekDay"){const _=b(C,A);if(ki(_))return _;const R=$c(a,i,A.format)[Number(_.sectionValue)-1];return me({},_,{sectionValue:R})}return{saveQuery:!1}},C=>!Number.isNaN(Number(C)))};return{applyCharacterEditing:Ze(x=>{const b=r[x.sectionIndex],C=x.keyPressed!==" "&&!Number.isNaN(Number(x.keyPressed))?m(x):u(x);C==null?n(null):t({activeSection:b,newSectionValue:C.sectionValue,shouldGoToNextSection:C.shouldGoToNextSection})}),resetCharacterQuery:c}},ZM=["onClick","onKeyDown","onFocus","onBlur","onMouseUp","onPaste","error","clearable","onClear","disabled"],JM=r=>{const t=Ft(),{state:s,selectedSectionIndexes:n,setSelectedSections:i,clearValue:a,clearActiveSection:o,updateSectionValue:l,updateValueFromValueStr:c,setTempAndroidValueStr:h,sectionsValueBoundaries:u,placeholder:m,timezone:p}=KM(r),{inputRef:x,internalProps:b,internalProps:{readOnly:w=!1,unstableFieldRef:C,minutesStep:A},forwardedProps:{onClick:_,onKeyDown:R,onFocus:E,onBlur:T,onMouseUp:M,onPaste:I,error:N,clearable:k,onClear:S,disabled:L},fieldValueManager:W,valueManager:F,validator:$}=r,q=kt(r.forwardedProps,ZM),{applyCharacterEditing:ne,resetCharacterQuery:he}=XM({sections:s.sections,updateSectionValue:l,sectionsValueBoundaries:u,setTempAndroidValueStr:h,timezone:p}),re=j.useRef(null),G=ci(x,re),H=j.useRef(void 0),D=Zs().direction==="rtl",Y=j.useMemo(()=>tM(s.sections,D),[s.sections,D]),ce=()=>{var Q;if(w){i(null);return}const Z=(Q=re.current.selectionStart)!=null?Q:0;let K;Z<=s.sections[0].startInInput||Z>=s.sections[s.sections.length-1].endInInput?K=1:K=s.sections.findIndex($e=>$e.startInInput-$e.startSeparator.length>Z);const ue=K===-1?s.sections.length-1:K-1;i(ue)},ae=Ze((Q,...Z)=>{Q.isDefaultPrevented()||(_?.(Q,...Z),ce())}),ee=Ze(Q=>{M?.(Q),Q.preventDefault()}),te=Ze((...Q)=>{E?.(...Q);const Z=re.current;window.clearTimeout(H.current),H.current=setTimeout(()=>{!Z||Z!==re.current||n!=null||w||(Z.value.length&&Number(Z.selectionEnd)-Number(Z.selectionStart)===Z.value.length?i("all"):ce())})}),Pe=Ze((...Q)=>{T?.(...Q),i(null)}),Be=Ze(Q=>{if(I?.(Q),w){Q.preventDefault();return}const Z=Q.clipboardData.getData("text");if(n&&n.startIndex===n.endIndex){const K=s.sections[n.startIndex],ue=/^[a-zA-Z]+$/.test(Z),$e=/^[0-9]+$/.test(Z),Le=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(Z);if(K.contentType==="letter"&&ue||K.contentType==="digit"&&$e||K.contentType==="digit-with-letter"&&Le){he(),l({activeSection:K,newSectionValue:Z,shouldGoToNextSection:!0}),Q.preventDefault();return}if(ue||$e){Q.preventDefault();return}}Q.preventDefault(),he(),c(Z)}),et=Ze(Q=>{if(w)return;const Z=Q.target.value;if(Z===""){he(),a();return}const K=Q.nativeEvent.data,ue=K&&K.length>1,$e=ue?K:Z,Le=Fi($e);if(n==null||ue){c(ue?K:Le);return}let O;if(n.startIndex===0&&n.endIndex===s.sections.length-1&&Le.length===1)O=Le;else{const Ce=Fi(W.getValueStrFromSections(s.sections,D));let At=-1,Bt=-1;for(let As=0;As<Ce.length;As+=1)At===-1&&Ce[As]!==Le[As]&&(At=As),Bt===-1&&Ce[Ce.length-As-1]!==Le[Le.length-As-1]&&(Bt=As);const or=s.sections[n.startIndex];if(At<or.start||Ce.length-Bt-1>or.end)return;const qt=Le.length-Ce.length+or.end-Fi(or.endSeparator||"").length;O=Le.slice(or.start+Fi(or.startSeparator||"").length,qt)}if(O.length===0){eM()?h($e):(he(),o());return}ne({keyPressed:O,sectionIndex:n.startIndex})}),De=Ze(Q=>{switch(R?.(Q),!0){case(Q.key==="a"&&(Q.ctrlKey||Q.metaKey)):{Q.preventDefault(),i("all");break}case Q.key==="ArrowRight":{if(Q.preventDefault(),n==null)i(Y.startIndex);else if(n.startIndex!==n.endIndex)i(n.endIndex);else{const Z=Y.neighbors[n.startIndex].rightIndex;Z!==null&&i(Z)}break}case Q.key==="ArrowLeft":{if(Q.preventDefault(),n==null)i(Y.endIndex);else if(n.startIndex!==n.endIndex)i(n.startIndex);else{const Z=Y.neighbors[n.startIndex].leftIndex;Z!==null&&i(Z)}break}case Q.key==="Delete":{if(Q.preventDefault(),w)break;n==null||n.startIndex===0&&n.endIndex===s.sections.length-1?a():o(),he();break}case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(Q.key):{if(Q.preventDefault(),w||n==null)break;const Z=s.sections[n.startIndex],K=W.getActiveDateManager(t,s,Z),ue=HR(t,p,Z,Q.key,u,K.date,{minutesStep:A});l({activeSection:Z,newSectionValue:ue,shouldGoToNextSection:!1});break}}});Hi(()=>{if(!re.current)return;if(n==null){re.current.scrollLeft&&(re.current.scrollLeft=0);return}const Q=s.sections[n.startIndex],Z=s.sections[n.endIndex];let K=Q.startInInput,ue=Z.endInInput;if(n.shouldSelectBoundarySelectors&&(K-=Q.startSeparator.length,ue+=Z.endSeparator.length),K!==re.current.selectionStart||ue!==re.current.selectionEnd){const $e=re.current.scrollTop;re.current===uc(document)&&re.current.setSelectionRange(K,ue),re.current.scrollTop=$e}});const ze=ww(me({},b,{value:s.value,timezone:p}),$,F.isSameError,F.defaultErrorState),ve=j.useMemo(()=>N!==void 0?N:F.hasError(ze),[F,ze,N]);j.useEffect(()=>{!ve&&!n&&he()},[s.referenceValue,n,ve]),j.useEffect(()=>(re.current&&re.current===document.activeElement&&i("all"),()=>window.clearTimeout(H.current)),[]),j.useEffect(()=>{s.tempValueStrAndroid!=null&&n!=null&&(he(),o())},[s.tempValueStrAndroid]);const B=j.useMemo(()=>{var Q;return(Q=s.tempValueStrAndroid)!=null?Q:W.getValueStrFromSections(s.sections,D)},[s.sections,W,s.tempValueStrAndroid,D]),pe=j.useMemo(()=>n==null||s.sections[n.startIndex].contentType==="letter"?"text":"numeric",[n,s.sections]),je=re.current&&re.current===uc(document),xe=F.areValuesEqual(t,s.value,F.emptyValue),v=!je&&xe;j.useImperativeHandle(C,()=>({getSections:()=>s.sections,getActiveSectionIndex:()=>{var Q,Z,K;const ue=(Q=re.current.selectionStart)!=null?Q:0,$e=(Z=re.current.selectionEnd)!=null?Z:0,Le=!!((K=re.current)!=null&&K.readOnly);if(ue===0&&$e===0||Le)return null;const O=ue<=s.sections[0].startInInput?1:s.sections.findIndex(Ce=>Ce.startInInput-Ce.startSeparator.length>ue);return O===-1?s.sections.length-1:O-1},setSelectedSections:Q=>i(Q)}));const ie=Ze((Q,...Z)=>{var K;Q.preventDefault(),S?.(Q,...Z),a(),re==null||(K=re.current)==null||K.focus(),i(0)});return me({placeholder:m,autoComplete:"off",disabled:!!L},q,{value:v?"":B,inputMode:pe,readOnly:w,onClick:ae,onFocus:te,onBlur:Pe,onPaste:Be,onChange:et,onKeyDown:De,onMouseUp:ee,onClear:ie,error:ve,ref:G,clearable:!!(k&&!xe&&!w&&!L)})},eL=({open:r,onOpen:t,onClose:s})=>{const n=j.useRef(typeof r=="boolean").current,[i,a]=j.useState(!1);j.useEffect(()=>{if(n){if(typeof r!="boolean")throw new Error("You must not mix controlling and uncontrolled mode for `open` prop");a(r)}},[n,r]);const o=j.useCallback(l=>{n||a(l),l&&t&&t(),!l&&s&&s()},[n,t,s]);return{isOpen:i,setIsOpen:o}},tL=r=>{const{action:t,hasChanged:s,dateState:n,isControlled:i}=r,a=!i&&!n.hasBeenModifiedSinceMount;return t.name==="setValueFromField"?!0:t.name==="setValueFromAction"?a&&["accept","today","clear"].includes(t.pickerAction)?!0:s(n.lastPublishedValue):t.name==="setValueFromView"&&t.selectionState!=="shallow"||t.name==="setValueFromShortcut"?a?!0:s(n.lastPublishedValue):!1},sL=r=>{const{action:t,hasChanged:s,dateState:n,isControlled:i,closeOnSelect:a}=r,o=!i&&!n.hasBeenModifiedSinceMount;return t.name==="setValueFromAction"?o&&["accept","today","clear"].includes(t.pickerAction)?!0:s(n.lastCommittedValue):t.name==="setValueFromView"&&t.selectionState==="finish"&&a?o?!0:s(n.lastCommittedValue):t.name==="setValueFromShortcut"?t.changeImportance==="accept"&&s(n.lastCommittedValue):!1},rL=r=>{const{action:t,closeOnSelect:s}=r;return t.name==="setValueFromAction"?!0:t.name==="setValueFromView"?t.selectionState==="finish"&&s:t.name==="setValueFromShortcut"?t.changeImportance==="accept":!1},nL=({props:r,valueManager:t,valueType:s,wrapperVariant:n,validator:i})=>{const{onAccept:a,onChange:o,value:l,defaultValue:c,closeOnSelect:h=n==="desktop",selectedSections:u,onSelectedSectionsChange:m,timezone:p}=r,{current:x}=j.useRef(c),{current:b}=j.useRef(l!==void 0),w=Ft(),C=ji(),[A,_]=Nn({controlled:u,default:null,name:"usePickerValue",state:"selectedSections"}),{isOpen:R,setIsOpen:E}=eL(r),[T,M]=j.useState(()=>{let te;return l!==void 0?te=l:x!==void 0?te=x:te=t.emptyValue,{draft:te,lastPublishedValue:te,lastCommittedValue:te,lastControlledValue:l,hasBeenModifiedSinceMount:!1}}),{timezone:I,handleValueChange:N}=zf({timezone:p,value:l,defaultValue:x,onChange:o,valueManager:t});ww(me({},r,{value:T.draft,timezone:I}),i,t.isSameError,t.defaultErrorState);const k=Ze(te=>{const Pe={action:te,dateState:T,hasChanged:ze=>!t.areValuesEqual(w,te.value,ze),isControlled:b,closeOnSelect:h},Be=tL(Pe),et=sL(Pe),De=rL(Pe);if(M(ze=>me({},ze,{draft:te.value,lastPublishedValue:Be?te.value:ze.lastPublishedValue,lastCommittedValue:et?te.value:ze.lastCommittedValue,hasBeenModifiedSinceMount:!0})),Be){const ve={validationError:te.name==="setValueFromField"?te.context.validationError:i({adapter:C,value:te.value,props:me({},r,{value:te.value,timezone:I})})};te.name==="setValueFromShortcut"&&te.shortcut!=null&&(ve.shortcut=te.shortcut),N(te.value,ve)}et&&a&&a(te.value),De&&E(!1)});if(l!==void 0&&(T.lastControlledValue===void 0||!t.areValuesEqual(w,T.lastControlledValue,l))){const te=t.areValuesEqual(w,T.draft,l);M(Pe=>me({},Pe,{lastControlledValue:l},te?{}:{lastCommittedValue:l,lastPublishedValue:l,draft:l,hasBeenModifiedSinceMount:!0}))}const S=Ze(()=>{k({value:t.emptyValue,name:"setValueFromAction",pickerAction:"clear"})}),L=Ze(()=>{k({value:T.lastPublishedValue,name:"setValueFromAction",pickerAction:"accept"})}),W=Ze(()=>{k({value:T.lastPublishedValue,name:"setValueFromAction",pickerAction:"dismiss"})}),F=Ze(()=>{k({value:T.lastCommittedValue,name:"setValueFromAction",pickerAction:"cancel"})}),$=Ze(()=>{k({value:t.getTodayValue(w,I,s),name:"setValueFromAction",pickerAction:"today"})}),q=Ze(()=>E(!0)),ne=Ze(()=>E(!1)),he=Ze((te,Pe="partial")=>k({name:"setValueFromView",value:te,selectionState:Pe})),re=Ze((te,Pe,Be)=>k({name:"setValueFromShortcut",value:te,changeImportance:Pe??"accept",shortcut:Be})),G=Ze((te,Pe)=>k({name:"setValueFromField",value:te,context:Pe})),H=Ze(te=>{_(te),m?.(te)}),P={onClear:S,onAccept:L,onDismiss:W,onCancel:F,onSetToday:$,onOpen:q,onClose:ne},D={value:T.draft,onChange:G,selectedSections:A,onSelectedSectionsChange:H},Y=j.useMemo(()=>t.cleanValue(w,T.draft),[w,t,T.draft]),ce={value:Y,onChange:he,onClose:ne,open:R,onSelectedSectionsChange:H},ee=me({},P,{value:Y,onChange:he,onSelectShortcut:re,isValid:te=>{const Pe=i({adapter:C,value:te,props:me({},r,{value:te,timezone:I})});return!t.hasError(Pe)}});return{open:R,fieldProps:D,viewProps:ce,layoutProps:ee,actions:P}};function Sw({onChange:r,onViewChange:t,openTo:s,view:n,views:i,autoFocus:a,focusedView:o,onFocusedViewChange:l}){var c,h;const u=j.useRef(s),m=j.useRef(i),p=j.useRef(i.includes(s)?s:i[0]),[x,b]=Nn({name:"useViews",state:"view",controlled:n,default:p.current}),w=j.useRef(a?x:null),[C,A]=Nn({name:"useViews",state:"focusedView",controlled:o,default:w.current});j.useEffect(()=>{(u.current&&u.current!==s||m.current&&m.current.some(k=>!i.includes(k)))&&(b(i.includes(s)?s:i[0]),m.current=i,u.current=s)},[s,b,x,i]);const _=i.indexOf(x),R=(c=i[_-1])!=null?c:null,E=(h=i[_+1])!=null?h:null,T=Ze((k,S)=>{A(S?k:L=>k===L?null:L),l?.(k,S)}),M=Ze(k=>{T(k,!0),k!==x&&(b(k),t&&t(k))}),I=Ze(()=>{E&&M(E)}),N=Ze((k,S,L)=>{const W=S==="finish",F=L?i.indexOf(L)<i.length-1:!!E;if(r(k,W&&F?"partial":S,L),L&&L!==x){const q=i[i.indexOf(L)+1];q&&M(q)}else W&&I()});return{view:x,setView:M,focusedView:C,setFocusedView:T,nextView:E,previousView:R,defaultView:i.includes(s)?s:i[0],goToNextView:I,setValueAndGoToNextView:N}}const iL=["className","sx"],aL=({props:r,propsFromPickerValue:t,additionalViewProps:s,inputRef:n,autoFocusView:i})=>{const{onChange:a,open:o,onSelectedSectionsChange:l,onClose:c}=t,{view:h,views:u,openTo:m,onViewChange:p,viewRenderers:x,timezone:b}=r,w=kt(r,iL),{view:C,setView:A,defaultView:_,focusedView:R,setFocusedView:E,setValueAndGoToNextView:T}=Sw({view:h,views:u,openTo:m,onChange:a,onViewChange:p,autoFocus:i}),{hasUIView:M,viewModeLookup:I}=j.useMemo(()=>u.reduce(($,q)=>{let ne;return x[q]!=null?ne="UI":ne="field",$.viewModeLookup[q]=ne,ne==="UI"&&($.hasUIView=!0),$},{hasUIView:!1,viewModeLookup:{}}),[x,u]),N=j.useMemo(()=>u.reduce(($,q)=>x[q]!=null&&zR(q)?$+1:$,0),[x,u]),k=I[C],S=Ze(()=>k==="UI"),[L,W]=j.useState(k==="UI"?C:null);return L!==C&&I[C]==="UI"&&W(C),Hi(()=>{k==="field"&&o&&(c(),setTimeout(()=>{n?.current.focus(),l(C)}))},[C]),Hi(()=>{if(!o)return;let $=C;k==="field"&&L!=null&&($=L),$!==_&&I[$]==="UI"&&I[_]==="UI"&&($=_),$!==C&&A($),E($,!0)},[o]),{hasUIView:M,shouldRestoreFocus:S,layoutProps:{views:u,view:L,onViewChange:A},renderCurrentView:()=>{if(L==null)return null;const $=x[L];return $==null?null:$(me({},w,s,t,{views:u,timezone:b,onChange:T,view:L,onViewChange:A,focusedView:R,onFocusedViewChange:E,showViewSwitcher:N>1,timeViewsCount:N}))}}};function rx(){return typeof window>"u"?"portrait":window.screen&&window.screen.orientation&&window.screen.orientation.angle?Math.abs(window.screen.orientation.angle)===90?"landscape":"portrait":window.orientation&&Math.abs(Number(window.orientation))===90?"landscape":"portrait"}const oL=(r,t)=>{const[s,n]=j.useState(rx);return Hi(()=>{const a=()=>{n(rx())};return window.addEventListener("orientationchange",a),()=>{window.removeEventListener("orientationchange",a)}},[]),LM(r,["hours","minutes","seconds"])?!1:(t||s)==="landscape"},lL=({props:r,propsFromPickerValue:t,propsFromPickerViews:s,wrapperVariant:n})=>{const{orientation:i}=r,a=oL(s.views,i);return{layoutProps:me({},s,t,{isLandscape:a,wrapperVariant:n,disabled:r.disabled,readOnly:r.readOnly})}},Ow=({props:r,valueManager:t,valueType:s,wrapperVariant:n,inputRef:i,additionalViewProps:a,validator:o,autoFocusView:l})=>{const c=nL({props:r,valueManager:t,valueType:s,wrapperVariant:n,validator:o}),h=aL({props:r,inputRef:i,additionalViewProps:a,autoFocusView:l,propsFromPickerValue:c.viewProps}),u=lL({props:r,wrapperVariant:n,propsFromPickerValue:c.layoutProps,propsFromPickerViews:h.layoutProps});return{open:c.open,actions:c.actions,fieldProps:c.fieldProps,renderCurrentView:h.renderCurrentView,hasUIView:h.hasUIView,shouldRestoreFocus:h.shouldRestoreFocus,layoutProps:u.layoutProps}};function kw(r){return $s("MuiPickersLayout",r)}const Kd=Vs("MuiPickersLayout",["root","landscape","contentWrapper","toolbar","actionBar","tabs","shortcuts"]),cL=["onAccept","onClear","onCancel","onSetToday","actions"];function dL(r){const{onAccept:t,onClear:s,onCancel:n,onSetToday:i,actions:a}=r,o=kt(r,cL),l=Gn();if(a==null||a.length===0)return null;const c=a?.map(h=>{switch(h){case"clear":return e.jsx(oe,{onClick:s,children:l.clearButtonLabel},h);case"cancel":return e.jsx(oe,{onClick:n,children:l.cancelButtonLabel},h);case"accept":return e.jsx(oe,{onClick:t,children:l.okButtonLabel},h);case"today":return e.jsx(oe,{onClick:i,children:l.todayButtonLabel},h);default:return null}});return e.jsx(Is,me({},o,{children:c}))}const hL=["items","changeImportance","isLandscape","onChange","isValid"],uL=["getValue"];function fL(r){const{items:t,changeImportance:s,onChange:n,isValid:i}=r,a=kt(r,hL);if(t==null||t.length===0)return null;const o=t.map(l=>{let{getValue:c}=l,h=kt(l,uL);const u=c({isValid:i});return{label:h.label,onClick:()=>{n(u,s,h)},disabled:!i(u)}});return e.jsx(jr,me({dense:!0,sx:[{maxHeight:Vf,maxWidth:200,overflow:"auto"},...Array.isArray(a.sx)?a.sx:[a.sx]]},a,{children:o.map(l=>e.jsx(Dt,{children:e.jsx(X,me({},l))},l.label))}))}function mL(r){return r.view!==null}const pL=r=>{const{classes:t,isLandscape:s}=r;return Rs({root:["root",s&&"landscape"],contentWrapper:["contentWrapper"],toolbar:["toolbar"],actionBar:["actionBar"],tabs:["tabs"],landscape:["landscape"],shortcuts:["shortcuts"]},kw,t)},gL=r=>{var t,s;const{wrapperVariant:n,onAccept:i,onClear:a,onCancel:o,onSetToday:l,view:c,views:h,onViewChange:u,value:m,onChange:p,onSelectShortcut:x,isValid:b,isLandscape:w,disabled:C,readOnly:A,children:_,components:R,componentsProps:E,slots:T,slotProps:M}=r,I=T??jw(R),N=M??E,k=pL(r),S=(t=I?.actionBar)!=null?t:dL,L=ds({elementType:S,externalSlotProps:N?.actionBar,additionalProps:{onAccept:i,onClear:a,onCancel:o,onSetToday:l,actions:n==="desktop"?[]:["cancel","accept"],className:k.actionBar},ownerState:me({},r,{wrapperVariant:n})}),W=e.jsx(S,me({},L)),F=I?.toolbar,$=ds({elementType:F,externalSlotProps:N?.toolbar,additionalProps:{isLandscape:w,onChange:p,value:m,view:c,onViewChange:u,views:h,disabled:C,readOnly:A,className:k.toolbar},ownerState:me({},r,{wrapperVariant:n})}),q=mL($)&&F?e.jsx(F,me({},$)):null,ne=_,he=I?.tabs,re=c&&he?e.jsx(he,me({view:c,onViewChange:u,className:k.tabs},N?.tabs)):null,G=(s=I?.shortcuts)!=null?s:fL,H=ds({elementType:G,externalSlotProps:N?.shortcuts,additionalProps:{isValid:b,isLandscape:w,onChange:x,className:k.shortcuts},ownerState:{isValid:b,isLandscape:w,onChange:x,className:k.shortcuts,wrapperVariant:n}}),P=c&&G?e.jsx(G,me({},H)):null;return{toolbar:q,content:ne,tabs:re,actionBar:W,shortcuts:P}},xL=r=>{const{isLandscape:t,classes:s}=r;return Rs({root:["root",t&&"landscape"],contentWrapper:["contentWrapper"]},kw,s)},Cw=ct("div",{name:"MuiPickersLayout",slot:"Root",overridesResolver:(r,t)=>t.root})(({theme:r,ownerState:t})=>({display:"grid",gridAutoColumns:"max-content auto max-content",gridAutoRows:"max-content auto max-content",[`& .${Kd.toolbar}`]:t.isLandscape?{gridColumn:r.direction==="rtl"?3:1,gridRow:"2 / 3"}:{gridColumn:"2 / 4",gridRow:1},[`.${Kd.shortcuts}`]:t.isLandscape?{gridColumn:"2 / 4",gridRow:1}:{gridColumn:r.direction==="rtl"?3:1,gridRow:"2 / 3"},[`& .${Kd.actionBar}`]:{gridColumn:"1 / 4",gridRow:3}}));Cw.propTypes={as:fe.elementType,ownerState:fe.shape({isLandscape:fe.bool.isRequired}).isRequired,sx:fe.oneOfType([fe.arrayOf(fe.oneOfType([fe.func,fe.object,fe.bool])),fe.func,fe.object])};const yL=ct("div",{name:"MuiPickersLayout",slot:"ContentWrapper",overridesResolver:(r,t)=>t.contentWrapper})({gridColumn:2,gridRow:2,display:"flex",flexDirection:"column"}),Aw=function(t){const s=ms({props:t,name:"MuiPickersLayout"}),{toolbar:n,content:i,tabs:a,actionBar:o,shortcuts:l}=gL(s),{sx:c,className:h,isLandscape:u,ref:m,wrapperVariant:p}=s,x=s,b=xL(x);return e.jsxs(Cw,{ref:m,sx:c,className:Cs(h,b.root),ownerState:x,children:[u?l:n,u?n:l,e.jsx(yL,{className:b.contentWrapper,children:p==="desktop"?e.jsxs(j.Fragment,{children:[i,a]}):e.jsxs(j.Fragment,{children:[a,i]})}),o]})};function jL(r,{disableFuture:t,maxDate:s,timezone:n}){const i=Ft();return j.useMemo(()=>{const a=i.dateWithTimezone(void 0,n),o=i.startOfMonth(t&&i.isBefore(a,s)?a:s);return!i.isAfter(o,r)},[t,s,r,i,n])}function bL(r,{disablePast:t,minDate:s,timezone:n}){const i=Ft();return j.useMemo(()=>{const a=i.dateWithTimezone(void 0,n),o=i.startOfMonth(t&&i.isAfter(a,s)?a:s);return!i.isBefore(o,r)},[t,s,r,i,n])}const Tw=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],vL=["disablePast","disableFuture","minTime","maxTime","shouldDisableClock","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],wL=["minDateTime","maxDateTime"],SL=[...Tw,...vL,...wL],Pw=r=>SL.reduce((t,s)=>(r.hasOwnProperty(s)&&(t[s]=r[s]),t),{}),OL=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","readOnly","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef"],kL=(r,t)=>{const s=me({},r),n={},i=a=>{s.hasOwnProperty(a)&&(n[a]=s[a],delete s[a])};return OL.forEach(i),Tw.forEach(i),{forwardedProps:s,internalProps:n}},Qc=({props:r,value:t,adapter:s})=>{if(t===null)return null;const{shouldDisableDate:n,shouldDisableMonth:i,shouldDisableYear:a,disablePast:o,disableFuture:l,timezone:c}=r,h=s.utils.dateWithTimezone(void 0,c),u=vr(s.utils,r.minDate,s.defaultDates.minDate),m=vr(s.utils,r.maxDate,s.defaultDates.maxDate);switch(!0){case!s.utils.isValid(t):return"invalidDate";case!!(n&&n(t)):return"shouldDisableDate";case!!(i&&i(t)):return"shouldDisableMonth";case!!(a&&a(t)):return"shouldDisableYear";case!!(l&&s.utils.isAfterDay(t,h)):return"disableFuture";case!!(o&&s.utils.isBeforeDay(t,h)):return"disablePast";case!!(u&&s.utils.isBeforeDay(t,u)):return"minDate";case!!(m&&s.utils.isAfterDay(t,m)):return"maxDate";default:return null}};function CL(r){return $s("MuiPickersDay",r)}const Jn=Vs("MuiPickersDay",["root","dayWithMargin","dayOutsideMonth","hiddenDaySpacingFiller","today","selected","disabled"]),AL=["autoFocus","className","day","disabled","disableHighlightToday","disableMargin","hidden","isAnimating","onClick","onDaySelect","onFocus","onBlur","onKeyDown","onMouseDown","onMouseEnter","outsideCurrentMonth","selected","showDaysOutsideCurrentMonth","children","today","isFirstVisibleCell","isLastVisibleCell"],TL=r=>{const{selected:t,disableMargin:s,disableHighlightToday:n,today:i,disabled:a,outsideCurrentMonth:o,showDaysOutsideCurrentMonth:l,classes:c}=r,h=o&&!l;return Rs({root:["root",t&&!h&&"selected",a&&"disabled",!s&&"dayWithMargin",!n&&i&&"today",o&&l&&"dayOutsideMonth",h&&"hiddenDaySpacingFiller"],hiddenDaySpacingFiller:["hiddenDaySpacingFiller"]},CL,c)},_w=({theme:r,ownerState:t})=>me({},r.typography.caption,{width:io,height:io,borderRadius:"50%",padding:0,backgroundColor:"transparent",transition:r.transitions.create("background-color",{duration:r.transitions.duration.short}),color:(r.vars||r).palette.text.primary,"@media (pointer: fine)":{"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.hoverOpacity})`:Xe(r.palette.primary.main,r.palette.action.hoverOpacity)}},"&:focus":{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.focusOpacity})`:Xe(r.palette.primary.main,r.palette.action.focusOpacity),[`&.${Jn.selected}`]:{willChange:"background-color",backgroundColor:(r.vars||r).palette.primary.dark}},[`&.${Jn.selected}`]:{color:(r.vars||r).palette.primary.contrastText,backgroundColor:(r.vars||r).palette.primary.main,fontWeight:r.typography.fontWeightMedium,"&:hover":{willChange:"background-color",backgroundColor:(r.vars||r).palette.primary.dark}},[`&.${Jn.disabled}:not(.${Jn.selected})`]:{color:(r.vars||r).palette.text.disabled},[`&.${Jn.disabled}&.${Jn.selected}`]:{opacity:.6}},!t.disableMargin&&{margin:`0 ${Bc}px`},t.outsideCurrentMonth&&t.showDaysOutsideCurrentMonth&&{color:(r.vars||r).palette.text.secondary},!t.disableHighlightToday&&t.today&&{[`&:not(.${Jn.selected})`]:{border:`1px solid ${(r.vars||r).palette.text.secondary}`}}),Ew=(r,t)=>{const{ownerState:s}=r;return[t.root,!s.disableMargin&&t.dayWithMargin,!s.disableHighlightToday&&s.today&&t.today,!s.outsideCurrentMonth&&s.showDaysOutsideCurrentMonth&&t.dayOutsideMonth,s.outsideCurrentMonth&&!s.showDaysOutsideCurrentMonth&&t.hiddenDaySpacingFiller]},PL=ct(kS,{name:"MuiPickersDay",slot:"Root",overridesResolver:Ew})(_w),_L=ct("div",{name:"MuiPickersDay",slot:"Root",overridesResolver:Ew})(({theme:r,ownerState:t})=>me({},_w({theme:r,ownerState:t}),{opacity:0,pointerEvents:"none"})),va=()=>{},EL=j.forwardRef(function(t,s){const n=ms({props:t,name:"MuiPickersDay"}),{autoFocus:i=!1,className:a,day:o,disabled:l=!1,disableHighlightToday:c=!1,disableMargin:h=!1,isAnimating:u,onClick:m,onDaySelect:p,onFocus:x=va,onBlur:b=va,onKeyDown:w=va,onMouseDown:C=va,onMouseEnter:A=va,outsideCurrentMonth:_,selected:R=!1,showDaysOutsideCurrentMonth:E=!1,children:T,today:M=!1}=n,I=kt(n,AL),N=me({},n,{autoFocus:i,disabled:l,disableHighlightToday:c,disableMargin:h,selected:R,showDaysOutsideCurrentMonth:E,today:M}),k=TL(N),S=Ft(),L=j.useRef(null),W=ci(L,s);Hi(()=>{i&&!l&&!u&&!_&&L.current.focus()},[i,l,u,_]);const F=q=>{C(q),_&&q.preventDefault()},$=q=>{l||p(o),_&&q.currentTarget.focus(),m&&m(q)};return _&&!E?e.jsx(_L,{className:Cs(k.root,k.hiddenDaySpacingFiller,a),ownerState:N,role:I.role}):e.jsx(PL,me({className:Cs(k.root,a),ref:W,centerRipple:!0,disabled:l,tabIndex:R?0:-1,onKeyDown:q=>w(q,o),onFocus:q=>x(q,o),onBlur:q=>b(q,o),onMouseEnter:q=>A(q,o),onClick:$,onMouseDown:F},I,{ownerState:N,children:T||S.format(o,"dayOfMonth")}))}),IL=j.memo(EL),DL=r=>$s("MuiPickersSlideTransition",r),hr=Vs("MuiPickersSlideTransition",["root","slideEnter-left","slideEnter-right","slideEnterActive","slideExit","slideExitActiveLeft-left","slideExitActiveLeft-right"]),RL=["children","className","reduceAnimations","slideDirection","transKey","classes"],ML=r=>{const{classes:t,slideDirection:s}=r,n={root:["root"],exit:["slideExit"],enterActive:["slideEnterActive"],enter:[`slideEnter-${s}`],exitActive:[`slideExitActiveLeft-${s}`]};return Rs(n,DL,t)},LL=ct(Ox,{name:"MuiPickersSlideTransition",slot:"Root",overridesResolver:(r,t)=>[t.root,{[`.${hr["slideEnter-left"]}`]:t["slideEnter-left"]},{[`.${hr["slideEnter-right"]}`]:t["slideEnter-right"]},{[`.${hr.slideEnterActive}`]:t.slideEnterActive},{[`.${hr.slideExit}`]:t.slideExit},{[`.${hr["slideExitActiveLeft-left"]}`]:t["slideExitActiveLeft-left"]},{[`.${hr["slideExitActiveLeft-right"]}`]:t["slideExitActiveLeft-right"]}]})(({theme:r})=>{const t=r.transitions.create("transform",{duration:r.transitions.duration.complex,easing:"cubic-bezier(0.35, 0.8, 0.4, 1)"});return{display:"block",position:"relative",overflowX:"hidden","& > *":{position:"absolute",top:0,right:0,left:0},[`& .${hr["slideEnter-left"]}`]:{willChange:"transform",transform:"translate(100%)",zIndex:1},[`& .${hr["slideEnter-right"]}`]:{willChange:"transform",transform:"translate(-100%)",zIndex:1},[`& .${hr.slideEnterActive}`]:{transform:"translate(0%)",transition:t},[`& .${hr.slideExit}`]:{transform:"translate(0%)"},[`& .${hr["slideExitActiveLeft-left"]}`]:{willChange:"transform",transform:"translate(-100%)",transition:t,zIndex:0},[`& .${hr["slideExitActiveLeft-right"]}`]:{willChange:"transform",transform:"translate(100%)",transition:t,zIndex:0}}});function FL(r){const t=ms({props:r,name:"MuiPickersSlideTransition"}),{children:s,className:n,reduceAnimations:i,transKey:a}=t,o=kt(t,RL),l=ML(t),c=Zs();if(i)return e.jsx("div",{className:Cs(l.root,n),children:s});const h={exit:l.exit,enterActive:l.enterActive,enter:l.enter,exitActive:l.exitActive};return e.jsx(LL,{className:Cs(l.root,n),childFactory:u=>j.cloneElement(u,{classNames:h}),role:"presentation",children:e.jsx(CS,me({mountOnEnter:!0,unmountOnExit:!0,timeout:c.transitions.duration.complex,classNames:h},o,{children:s}),a)})}const Iw=({shouldDisableDate:r,shouldDisableMonth:t,shouldDisableYear:s,minDate:n,maxDate:i,disableFuture:a,disablePast:o,timezone:l})=>{const c=ji();return j.useCallback(h=>Qc({adapter:c,value:h,props:{shouldDisableDate:r,shouldDisableMonth:t,shouldDisableYear:s,minDate:n,maxDate:i,disableFuture:a,disablePast:o,timezone:l}})!==null,[c,r,t,s,n,i,a,o,l])},NL=r=>$s("MuiDayCalendar",r);Vs("MuiDayCalendar",["root","header","weekDayLabel","loadingContainer","slideTransition","monthContainer","weekContainer","weekNumberLabel","weekNumber"]);const WL=["parentProps","day","focusableDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"],$L=["ownerState"],VL=r=>{const{classes:t}=r;return Rs({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},NL,t)},Dw=(io+Bc*2)*6,zL=ct("div",{name:"MuiDayCalendar",slot:"Root",overridesResolver:(r,t)=>t.root})({}),BL=ct("div",{name:"MuiDayCalendar",slot:"Header",overridesResolver:(r,t)=>t.header})({display:"flex",justifyContent:"center",alignItems:"center"}),UL=ct(d,{name:"MuiDayCalendar",slot:"WeekDayLabel",overridesResolver:(r,t)=>t.weekDayLabel})(({theme:r})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(r.vars||r).palette.text.secondary})),QL=ct(d,{name:"MuiDayCalendar",slot:"WeekNumberLabel",overridesResolver:(r,t)=>t.weekNumberLabel})(({theme:r})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:r.palette.text.disabled})),qL=ct(d,{name:"MuiDayCalendar",slot:"WeekNumber",overridesResolver:(r,t)=>t.weekNumber})(({theme:r})=>me({},r.typography.caption,{width:io,height:io,padding:0,margin:`0 ${Bc}px`,color:r.palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"})),HL=ct("div",{name:"MuiDayCalendar",slot:"LoadingContainer",overridesResolver:(r,t)=>t.loadingContainer})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:Dw}),GL=ct(FL,{name:"MuiDayCalendar",slot:"SlideTransition",overridesResolver:(r,t)=>t.slideTransition})({minHeight:Dw}),KL=ct("div",{name:"MuiDayCalendar",slot:"MonthContainer",overridesResolver:(r,t)=>t.monthContainer})({overflow:"hidden"}),YL=ct("div",{name:"MuiDayCalendar",slot:"WeekContainer",overridesResolver:(r,t)=>t.weekContainer})({margin:`${Bc}px 0`,display:"flex",justifyContent:"center"});function XL(r){var t,s,n;let{parentProps:i,day:a,focusableDay:o,selectedDays:l,isDateDisabled:c,currentMonthNumber:h,isViewFocused:u}=r,m=kt(r,WL);const{disabled:p,disableHighlightToday:x,isMonthSwitchingAnimating:b,showDaysOutsideCurrentMonth:w,components:C,componentsProps:A,slots:_,slotProps:R,timezone:E}=i,T=Ft(),M=zc(E),I=o!==null&&T.isSameDay(a,o),N=l.some(he=>T.isSameDay(he,a)),k=T.isSameDay(a,M),S=(t=(s=_?.day)!=null?s:C?.Day)!=null?t:IL,L=ds({elementType:S,externalSlotProps:(n=R?.day)!=null?n:A?.day,additionalProps:me({disableHighlightToday:x,showDaysOutsideCurrentMonth:w,role:"gridcell",isAnimating:b,"data-timestamp":T.toJsDate(a).valueOf()},m),ownerState:me({},i,{day:a,selected:N})}),W=kt(L,$L),F=j.useMemo(()=>p||c(a),[p,c,a]),$=j.useMemo(()=>T.getMonth(a)!==h,[T,a,h]),q=j.useMemo(()=>{const he=T.startOfMonth(T.setMonth(a,h));return w?T.isSameDay(a,T.startOfWeek(he)):T.isSameDay(a,he)},[h,a,w,T]),ne=j.useMemo(()=>{const he=T.endOfMonth(T.setMonth(a,h));return w?T.isSameDay(a,T.endOfWeek(he)):T.isSameDay(a,he)},[h,a,w,T]);return e.jsx(S,me({},W,{day:a,disabled:F,autoFocus:u&&I,today:k,outsideCurrentMonth:$,isFirstVisibleCell:q,isLastVisibleCell:ne,selected:N,tabIndex:I?0:-1,"aria-selected":N,"aria-current":k?"date":void 0}))}function ZL(r){const t=ms({props:r,name:"MuiDayCalendar"}),{onFocusedDayChange:s,className:n,currentMonth:i,selectedDays:a,focusedDay:o,loading:l,onSelectedDaysChange:c,onMonthSwitchingAnimationEnd:h,readOnly:u,reduceAnimations:m,renderLoading:p=()=>e.jsx("span",{children:"..."}),slideDirection:x,TransitionProps:b,disablePast:w,disableFuture:C,minDate:A,maxDate:_,shouldDisableDate:R,shouldDisableMonth:E,shouldDisableYear:T,dayOfWeekFormatter:M,hasFocus:I,onFocusedViewChange:N,gridLabelId:k,displayWeekNumber:S,fixedWeekNumber:L,autoFocus:W,timezone:F}=t,$=zc(F),q=Ft(),ne=VL(t),re=Zs().direction==="rtl",G=M||((v,ie)=>q.format(ie,"weekdayShort").charAt(0).toUpperCase()),H=Iw({shouldDisableDate:R,shouldDisableMonth:E,shouldDisableYear:T,minDate:A,maxDate:_,disablePast:w,disableFuture:C,timezone:F}),P=Gn(),[D,Y]=Nn({name:"DayCalendar",state:"hasFocus",controlled:I,default:W??!1}),[ce,ae]=j.useState(()=>o||$),ee=Ze(v=>{u||c(v)}),te=v=>{H(v)||(s(v),ae(v),N?.(!0),Y(!0))},Pe=Ze((v,ie)=>{switch(v.key){case"ArrowUp":te(q.addDays(ie,-7)),v.preventDefault();break;case"ArrowDown":te(q.addDays(ie,7)),v.preventDefault();break;case"ArrowLeft":{const Q=q.addDays(ie,re?1:-1),Z=q.addMonths(ie,re?1:-1),K=Ra({utils:q,date:Q,minDate:re?Q:q.startOfMonth(Z),maxDate:re?q.endOfMonth(Z):Q,isDateDisabled:H,timezone:F});te(K||Q),v.preventDefault();break}case"ArrowRight":{const Q=q.addDays(ie,re?-1:1),Z=q.addMonths(ie,re?-1:1),K=Ra({utils:q,date:Q,minDate:re?q.startOfMonth(Z):Q,maxDate:re?Q:q.endOfMonth(Z),isDateDisabled:H,timezone:F});te(K||Q),v.preventDefault();break}case"Home":te(q.startOfWeek(ie)),v.preventDefault();break;case"End":te(q.endOfWeek(ie)),v.preventDefault();break;case"PageUp":te(q.addMonths(ie,1)),v.preventDefault();break;case"PageDown":te(q.addMonths(ie,-1)),v.preventDefault();break}}),Be=Ze((v,ie)=>te(ie)),et=Ze((v,ie)=>{D&&q.isSameDay(ce,ie)&&N?.(!1)}),De=q.getMonth(i),ze=j.useMemo(()=>a.filter(v=>!!v).map(v=>q.startOfDay(v)),[q,a]),ve=De,B=j.useMemo(()=>j.createRef(),[ve]),pe=q.startOfWeek($),je=j.useMemo(()=>{const v=q.startOfMonth(i),ie=q.endOfMonth(i);return H(ce)||q.isAfterDay(ce,ie)||q.isBeforeDay(ce,v)?Ra({utils:q,date:ce,minDate:v,maxDate:ie,disablePast:w,disableFuture:C,isDateDisabled:H,timezone:F}):ce},[i,C,w,ce,H,q,F]),xe=j.useMemo(()=>{const v=q.setTimezone(i,F),ie=q.getWeekArray(v);let Q=q.addMonths(v,1);for(;L&&ie.length<L;){const Z=q.getWeekArray(Q),K=q.isSameDay(ie[ie.length-1][0],Z[0][0]);Z.slice(K?1:0).forEach(ue=>{ie.length<L&&ie.push(ue)}),Q=q.addMonths(Q,1)}return ie},[i,L,q,F]);return e.jsxs(zL,{role:"grid","aria-labelledby":k,className:ne.root,children:[e.jsxs(BL,{role:"row",className:ne.header,children:[S&&e.jsx(QL,{variant:"caption",role:"columnheader","aria-label":P.calendarWeekNumberHeaderLabel,className:ne.weekNumberLabel,children:P.calendarWeekNumberHeaderText}),$R(q,$).map((v,ie)=>{var Q;const Z=q.format(v,"weekdayShort");return e.jsx(UL,{variant:"caption",role:"columnheader","aria-label":q.format(q.addDays(pe,ie),"weekday"),className:ne.weekDayLabel,children:(Q=G?.(Z,v))!=null?Q:Z},Z+ie.toString())})]}),l?e.jsx(HL,{className:ne.loadingContainer,children:p()}):e.jsx(GL,me({transKey:ve,onExited:h,reduceAnimations:m,slideDirection:x,className:Cs(n,ne.slideTransition)},b,{nodeRef:B,children:e.jsx(KL,{ref:B,role:"rowgroup",className:ne.monthContainer,children:xe.map((v,ie)=>e.jsxs(YL,{role:"row",className:ne.weekContainer,"aria-rowindex":ie+1,children:[S&&e.jsx(qL,{className:ne.weekNumber,role:"rowheader","aria-label":P.calendarWeekNumberAriaLabelText(q.getWeekNumber(v[0])),children:P.calendarWeekNumberText(q.getWeekNumber(v[0]))}),v.map((Q,Z)=>e.jsx(XL,{parentProps:t,day:Q,selectedDays:ze,focusableDay:je,onKeyDown:Pe,onFocus:Be,onBlur:et,onDaySelect:ee,isDateDisabled:H,currentMonthNumber:De,isViewFocused:D,"aria-colindex":Z+1},Q.toString()))]},`week-${v[0]}`))})}))]})}const JL=(r,t,s)=>(n,i)=>{switch(i.type){case"changeMonth":return me({},n,{slideDirection:i.direction,currentMonth:i.newMonth,isMonthSwitchingAnimating:!r});case"finishMonthSwitchingAnimation":return me({},n,{isMonthSwitchingAnimating:!1});case"changeFocusedDay":{if(n.focusedDay!=null&&i.focusedDay!=null&&s.isSameDay(i.focusedDay,n.focusedDay))return n;const a=i.focusedDay!=null&&!t&&!s.isSameMonth(n.currentMonth,i.focusedDay);return me({},n,{focusedDay:i.focusedDay,isMonthSwitchingAnimating:a&&!r&&!i.withoutMonthSwitchingAnimation,currentMonth:a?s.startOfMonth(i.focusedDay):n.currentMonth,slideDirection:i.focusedDay!=null&&s.isAfterDay(i.focusedDay,n.currentMonth)?"left":"right"})}default:throw new Error("missing support")}},eF=r=>{const{value:t,referenceDate:s,defaultCalendarMonth:n,disableFuture:i,disablePast:a,disableSwitchToMonthOnDayFocus:o=!1,maxDate:l,minDate:c,onMonthChange:h,reduceAnimations:u,shouldDisableDate:m,timezone:p}=r,x=Ft(),b=j.useRef(JL(!!u,o,x)).current,w=j.useMemo(()=>{let I=null;return s?I=s:n&&(I=x.startOfMonth(n)),Sn.getInitialReferenceValue({value:t,utils:x,timezone:p,props:r,referenceDate:I,granularity:$r.day})},[]),[C,A]=j.useReducer(b,{isMonthSwitchingAnimating:!1,focusedDay:w,currentMonth:x.startOfMonth(w),slideDirection:"left"}),_=j.useCallback(I=>{A(me({type:"changeMonth"},I)),h&&h(I.newMonth)},[h]),R=j.useCallback(I=>{const N=I;x.isSameMonth(N,C.currentMonth)||_({newMonth:x.startOfMonth(N),direction:x.isAfterDay(N,C.currentMonth)?"left":"right"})},[C.currentMonth,_,x]),E=Iw({shouldDisableDate:m,minDate:c,maxDate:l,disableFuture:i,disablePast:a,timezone:p}),T=j.useCallback(()=>{A({type:"finishMonthSwitchingAnimation"})},[]),M=Ze((I,N)=>{E(I)||A({type:"changeFocusedDay",focusedDay:I,withoutMonthSwitchingAnimation:N})});return{referenceDate:w,calendarState:C,changeMonth:R,changeFocusedDay:M,isDateDisabled:E,onMonthSwitchingAnimationEnd:T,handleChangeMonth:_}},tF=["props","getOpenDialogAriaText"],sF=["ownerState"],rF=["ownerState"],nF=r=>{var t,s,n,i,a;let{props:o,getOpenDialogAriaText:l}=r,c=kt(r,tF);const{slots:h,slotProps:u,className:m,sx:p,format:x,formatDensity:b,timezone:w,name:C,label:A,inputRef:_,readOnly:R,disabled:E,autoFocus:T,localeText:M,reduceAnimations:I}=o,N=Ft(),k=j.useRef(null),S=j.useRef(null),L=mu(),W=(t=u==null||(s=u.toolbar)==null?void 0:s.hidden)!=null?t:!1,{open:F,actions:$,hasUIView:q,layoutProps:ne,renderCurrentView:he,shouldRestoreFocus:re,fieldProps:G}=Ow(me({},c,{props:o,inputRef:k,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"desktop"})),H=(n=h.inputAdornment)!=null?n:ts,P=ds({elementType:H,externalSlotProps:u?.inputAdornment,additionalProps:{position:"end"},ownerState:o}),D=kt(P,sF),Y=(i=h.openPickerButton)!=null?i:Ge,ce=ds({elementType:Y,externalSlotProps:u?.openPickerButton,additionalProps:{disabled:E||R,onClick:F?$.onClose:$.onOpen,"aria-label":l(G.value,N),edge:D.position},ownerState:o}),ae=kt(ce,rF),ee=h.openPickerIcon,te=h.field,Pe=ds({elementType:te,externalSlotProps:u?.field,additionalProps:me({},G,W&&{id:L},{readOnly:R,disabled:E,className:m,sx:p,format:x,formatDensity:b,timezone:w,label:A,name:C,autoFocus:T&&!o.open,focused:F?!0:void 0}),ownerState:o});q&&(Pe.InputProps=me({},Pe.InputProps,{ref:S},!o.disableOpenPicker&&{[`${D.position}Adornment`]:e.jsx(H,me({},D,{children:e.jsx(Y,me({},ae,{children:e.jsx(ee,me({},u?.openPickerIcon))}))}))}));const Be=me({textField:h.textField,clearIcon:h.clearIcon,clearButton:h.clearButton},Pe.slots),et=(a=h.layout)!=null?a:Aw,De=ci(k,Pe.inputRef,_);let ze=L;W&&(A?ze=`${L}-label`:ze=void 0);const ve=me({},u,{toolbar:me({},u?.toolbar,{titleId:L}),popper:me({"aria-labelledby":ze},u?.popper)});return{renderPicker:()=>e.jsxs(Vc,{localeText:M,children:[e.jsx(te,me({},Pe,{slots:Be,slotProps:ve,inputRef:De})),e.jsx(GM,me({role:"dialog",placement:"bottom-start",anchorEl:S.current},$,{open:F,slots:h,slotProps:ve,shouldRestoreFocus:re,reduceAnimations:I,children:e.jsx(et,me({},ne,ve?.layout,{slots:h,slotProps:ve,children:he()}))}))]})}},iF=r=>{var t,s,n;const i=Ft(),a=Oo();return me({},r,{disablePast:(t=r.disablePast)!=null?t:!1,disableFuture:(s=r.disableFuture)!=null?s:!1,format:(n=r.format)!=null?n:i.formats.keyboardDate,minDate:vr(i,r.minDate,a.minDate),maxDate:vr(i,r.maxDate,a.maxDate)})},aF=({props:r,inputRef:t})=>{const s=iF(r),{forwardedProps:n,internalProps:i}=kL(s);return JM({inputRef:t,forwardedProps:n,internalProps:i,valueManager:Sn,fieldValueManager:rM,validator:Qc})},oF=["ownerState"],lF=({clearable:r,fieldProps:t,InputProps:s,onClear:n,slots:i,slotProps:a,components:o,componentsProps:l})=>{var c,h,u,m,p,x;const b=Gn(),w=(c=(h=i?.clearButton)!=null?h:o?.ClearButton)!=null?c:Ge,C=ds({elementType:w,externalSlotProps:(u=a?.clearButton)!=null?u:l?.clearButton,ownerState:{},className:"clearButton",additionalProps:{title:b.fieldClearLabel}}),A=kt(C,oF),_=(m=(p=i?.clearIcon)!=null?p:o?.ClearIcon)!=null?m:wM,R=ds({elementType:_,externalSlotProps:(x=a?.clearIcon)!=null?x:l?.clearIcon,ownerState:{}}),E=me({},s,{endAdornment:e.jsxs(j.Fragment,{children:[r&&e.jsx(ts,{position:"end",sx:{marginRight:s!=null&&s.endAdornment?-1:-1.5},children:e.jsx(w,me({},A,{onClick:n,children:e.jsx(_,me({fontSize:"small"},R))}))}),s?.endAdornment]})}),T=me({},t,{sx:[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(t.sx)?t.sx:[t.sx]]});return{InputProps:E,fieldProps:T}},cF=["components","componentsProps","slots","slotProps","InputProps","inputProps"],dF=["inputRef"],hF=["ref","onPaste","onKeyDown","inputMode","readOnly","clearable","onClear"],Rw=j.forwardRef(function(t,s){var n,i,a;const o=ms({props:t,name:"MuiDateField"}),{components:l,componentsProps:c,slots:h,slotProps:u,InputProps:m,inputProps:p}=o,x=kt(o,cF),b=o,w=(n=(i=h?.textField)!=null?i:l?.TextField)!=null?n:_e,C=ds({elementType:w,externalSlotProps:(a=u?.textField)!=null?a:c?.textField,externalForwardedProps:x,ownerState:b}),{inputRef:A}=C,_=kt(C,dF);_.inputProps=me({},p,_.inputProps),_.InputProps=me({},m,_.InputProps);const R=aF({props:_,inputRef:A}),{ref:E,onPaste:T,onKeyDown:M,inputMode:I,readOnly:N,clearable:k,onClear:S}=R,L=kt(R,hF),{InputProps:W,fieldProps:F}=lF({onClear:S,clearable:k,fieldProps:L,InputProps:L.InputProps,slots:h,slotProps:u,components:l,componentsProps:c});return e.jsx(w,me({ref:s},F,{InputProps:me({},W,{readOnly:N}),inputProps:me({},L.inputProps,{inputMode:I,onPaste:T,onKeyDown:M,ref:E})}))}),uF=r=>$s("MuiPickersFadeTransitionGroup",r);Vs("MuiPickersFadeTransitionGroup",["root"]);const fF=r=>{const{classes:t}=r;return Rs({root:["root"]},uF,t)},mF=ct(Ox,{name:"MuiPickersFadeTransitionGroup",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"block",position:"relative"});function Mw(r){const t=ms({props:r,name:"MuiPickersFadeTransitionGroup"}),{children:s,className:n,reduceAnimations:i,transKey:a}=t,o=fF(t),l=Zs();return i?s:e.jsx(mF,{className:Cs(o.root,n),children:e.jsx(oo,{appear:!1,mountOnEnter:!0,unmountOnExit:!0,timeout:{appear:l.transitions.duration.enteringScreen,enter:l.transitions.duration.enteringScreen,exit:0},children:s},a)})}function pF(r){return $s("MuiPickersMonth",r)}const cl=Vs("MuiPickersMonth",["root","monthButton","disabled","selected"]),gF=["autoFocus","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","aria-label","monthsPerRow"],xF=r=>{const{disabled:t,selected:s,classes:n}=r;return Rs({root:["root"],monthButton:["monthButton",t&&"disabled",s&&"selected"]},pF,n)},yF=ct("div",{name:"MuiPickersMonth",slot:"Root",overridesResolver:(r,t)=>[t.root]})(({ownerState:r})=>({flexBasis:r.monthsPerRow===3?"33.3%":"25%",display:"flex",alignItems:"center",justifyContent:"center"})),jF=ct("button",{name:"MuiPickersMonth",slot:"MonthButton",overridesResolver:(r,t)=>[t.monthButton,{[`&.${cl.disabled}`]:t.disabled},{[`&.${cl.selected}`]:t.selected}]})(({theme:r})=>me({color:"unset",backgroundColor:"transparent",border:0,outline:0},r.typography.subtitle1,{margin:"8px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:Xe(r.palette.action.active,r.palette.action.hoverOpacity)},"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:Xe(r.palette.action.active,r.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${cl.disabled}`]:{color:(r.vars||r).palette.text.secondary},[`&.${cl.selected}`]:{color:(r.vars||r).palette.primary.contrastText,backgroundColor:(r.vars||r).palette.primary.main,"&:focus, &:hover":{backgroundColor:(r.vars||r).palette.primary.dark}}})),bF=j.memo(function(t){const s=ms({props:t,name:"MuiPickersMonth"}),{autoFocus:n,children:i,disabled:a,selected:o,value:l,tabIndex:c,onClick:h,onKeyDown:u,onFocus:m,onBlur:p,"aria-current":x,"aria-label":b}=s,w=kt(s,gF),C=j.useRef(null),A=xF(s);return Hi(()=>{if(n){var _;(_=C.current)==null||_.focus()}},[n]),e.jsx(yF,me({className:A.root,ownerState:s},w,{children:e.jsx(jF,{ref:C,disabled:a,type:"button",role:"radio",tabIndex:a?-1:c,"aria-current":x,"aria-checked":o,"aria-label":b,onClick:_=>h(_,l),onKeyDown:_=>u(_,l),onFocus:_=>m(_,l),onBlur:_=>p(_,l),className:A.monthButton,ownerState:s,children:i})}))});function vF(r){return $s("MuiMonthCalendar",r)}Vs("MuiMonthCalendar",["root"]);const wF=["className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","shouldDisableMonth","readOnly","disableHighlightToday","autoFocus","onMonthFocus","hasFocus","onFocusedViewChange","monthsPerRow","timezone","gridLabelId"],SF=r=>{const{classes:t}=r;return Rs({root:["root"]},vF,t)};function OF(r,t){const s=Ft(),n=Oo(),i=ms({props:r,name:t});return me({disableFuture:!1,disablePast:!1},i,{minDate:vr(s,i.minDate,n.minDate),maxDate:vr(s,i.maxDate,n.maxDate)})}const kF=ct("div",{name:"MuiMonthCalendar",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"flex",flexWrap:"wrap",alignContent:"stretch",padding:"0 4px",width:Uc,boxSizing:"border-box"}),CF=j.forwardRef(function(t,s){const n=OF(t,"MuiMonthCalendar"),{className:i,value:a,defaultValue:o,referenceDate:l,disabled:c,disableFuture:h,disablePast:u,maxDate:m,minDate:p,onChange:x,shouldDisableMonth:b,readOnly:w,disableHighlightToday:C,autoFocus:A=!1,onMonthFocus:_,hasFocus:R,onFocusedViewChange:E,monthsPerRow:T=3,timezone:M,gridLabelId:I}=n,N=kt(n,wF),{value:k,handleValueChange:S,timezone:L}=Bf({name:"MonthCalendar",timezone:M,value:a,defaultValue:o,onChange:x,valueManager:Sn}),W=zc(L),F=kx(),$=Ft(),q=j.useMemo(()=>Sn.getInitialReferenceValue({value:k,utils:$,props:n,timezone:L,referenceDate:l,granularity:$r.month}),[]),ne=n,he=SF(ne),re=j.useMemo(()=>$.getMonth(W),[$,W]),G=j.useMemo(()=>k!=null?$.getMonth(k):C?null:$.getMonth(q),[k,$,C,q]),[H,P]=j.useState(()=>G||re),[D,Y]=Nn({name:"MonthCalendar",state:"hasFocus",controlled:R,default:A??!1}),ce=Ze(De=>{Y(De),E&&E(De)}),ae=j.useCallback(De=>{const ze=$.startOfMonth(u&&$.isAfter(W,p)?W:p),ve=$.startOfMonth(h&&$.isBefore(W,m)?W:m),B=$.startOfMonth(De);return $.isBefore(B,ze)||$.isAfter(B,ve)?!0:b?b(B):!1},[h,u,m,p,W,b,$]),ee=Ze((De,ze)=>{if(w)return;const ve=$.setMonth(k??q,ze);S(ve)}),te=Ze(De=>{ae($.setMonth(k??q,De))||(P(De),ce(!0),_&&_(De))});j.useEffect(()=>{P(De=>G!==null&&De!==G?G:De)},[G]);const Pe=Ze((De,ze)=>{switch(De.key){case"ArrowUp":te((12+ze-3)%12),De.preventDefault();break;case"ArrowDown":te((12+ze+3)%12),De.preventDefault();break;case"ArrowLeft":te((12+ze+(F.direction==="ltr"?-1:1))%12),De.preventDefault();break;case"ArrowRight":te((12+ze+(F.direction==="ltr"?1:-1))%12),De.preventDefault();break}}),Be=Ze((De,ze)=>{te(ze)}),et=Ze((De,ze)=>{H===ze&&ce(!1)});return e.jsx(kF,me({ref:s,className:Cs(he.root,i),ownerState:ne,role:"radiogroup","aria-labelledby":I},N,{children:Nf($,k??q).map(De=>{const ze=$.getMonth(De),ve=$.format(De,"monthShort"),B=$.format(De,"month"),pe=ze===G,je=c||ae(De);return e.jsx(bF,{selected:pe,value:ze,onClick:ee,onKeyDown:Pe,autoFocus:D&&ze===H,disabled:je,tabIndex:ze===H?0:-1,onFocus:Be,onBlur:et,"aria-current":re===ze?"date":void 0,"aria-label":B,monthsPerRow:T,children:ve},ve)})}))});function AF(r){return $s("MuiPickersYear",r)}const dl=Vs("MuiPickersYear",["root","yearButton","selected","disabled"]),TF=["autoFocus","className","children","disabled","selected","value","tabIndex","onClick","onKeyDown","onFocus","onBlur","aria-current","yearsPerRow"],PF=r=>{const{disabled:t,selected:s,classes:n}=r;return Rs({root:["root"],yearButton:["yearButton",t&&"disabled",s&&"selected"]},AF,n)},_F=ct("div",{name:"MuiPickersYear",slot:"Root",overridesResolver:(r,t)=>[t.root]})(({ownerState:r})=>({flexBasis:r.yearsPerRow===3?"33.3%":"25%",display:"flex",alignItems:"center",justifyContent:"center"})),EF=ct("button",{name:"MuiPickersYear",slot:"YearButton",overridesResolver:(r,t)=>[t.yearButton,{[`&.${dl.disabled}`]:t.disabled},{[`&.${dl.selected}`]:t.selected}]})(({theme:r})=>me({color:"unset",backgroundColor:"transparent",border:0,outline:0},r.typography.subtitle1,{margin:"6px 0",height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.focusOpacity})`:Xe(r.palette.action.active,r.palette.action.focusOpacity)},"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:Xe(r.palette.action.active,r.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${dl.disabled}`]:{color:(r.vars||r).palette.text.secondary},[`&.${dl.selected}`]:{color:(r.vars||r).palette.primary.contrastText,backgroundColor:(r.vars||r).palette.primary.main,"&:focus, &:hover":{backgroundColor:(r.vars||r).palette.primary.dark}}})),IF=j.memo(function(t){const s=ms({props:t,name:"MuiPickersYear"}),{autoFocus:n,className:i,children:a,disabled:o,selected:l,value:c,tabIndex:h,onClick:u,onKeyDown:m,onFocus:p,onBlur:x,"aria-current":b}=s,w=kt(s,TF),C=j.useRef(null),A=PF(s);return j.useEffect(()=>{n&&C.current.focus()},[n]),e.jsx(_F,me({className:Cs(A.root,i),ownerState:s},w,{children:e.jsx(EF,{ref:C,disabled:o,type:"button",role:"radio",tabIndex:o?-1:h,"aria-current":b,"aria-checked":l,onClick:_=>u(_,c),onKeyDown:_=>m(_,c),onFocus:_=>p(_,c),onBlur:_=>x(_,c),className:A.yearButton,ownerState:s,children:a})}))});function DF(r){return $s("MuiYearCalendar",r)}Vs("MuiYearCalendar",["root"]);const RF=["autoFocus","className","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsPerRow","timezone","gridLabelId"],MF=r=>{const{classes:t}=r;return Rs({root:["root"]},DF,t)};function LF(r,t){var s;const n=Ft(),i=Oo(),a=ms({props:r,name:t});return me({disablePast:!1,disableFuture:!1},a,{yearsPerRow:(s=a.yearsPerRow)!=null?s:3,minDate:vr(n,a.minDate,i.minDate),maxDate:vr(n,a.maxDate,i.maxDate)})}const FF=ct("div",{name:"MuiYearCalendar",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"flex",flexDirection:"row",flexWrap:"wrap",overflowY:"auto",height:"100%",padding:"0 4px",width:Uc,maxHeight:EM,boxSizing:"border-box",position:"relative"}),NF=j.forwardRef(function(t,s){const n=LF(t,"MuiYearCalendar"),{autoFocus:i,className:a,value:o,defaultValue:l,referenceDate:c,disabled:h,disableFuture:u,disablePast:m,maxDate:p,minDate:x,onChange:b,readOnly:w,shouldDisableYear:C,disableHighlightToday:A,onYearFocus:_,hasFocus:R,onFocusedViewChange:E,yearsPerRow:T,timezone:M,gridLabelId:I}=n,N=kt(n,RF),{value:k,handleValueChange:S,timezone:L}=Bf({name:"YearCalendar",timezone:M,value:o,defaultValue:l,onChange:b,valueManager:Sn}),W=zc(L),F=kx(),$=Ft(),q=j.useMemo(()=>Sn.getInitialReferenceValue({value:k,utils:$,props:n,timezone:L,referenceDate:c,granularity:$r.year}),[]),ne=n,he=MF(ne),re=j.useMemo(()=>$.getYear(W),[$,W]),G=j.useMemo(()=>k!=null?$.getYear(k):A?null:$.getYear(q),[k,$,A,q]),[H,P]=j.useState(()=>G||re),[D,Y]=Nn({name:"YearCalendar",state:"hasFocus",controlled:R,default:i??!1}),ce=Ze(ve=>{Y(ve),E&&E(ve)}),ae=j.useCallback(ve=>{if(m&&$.isBeforeYear(ve,W)||u&&$.isAfterYear(ve,W)||x&&$.isBeforeYear(ve,x)||p&&$.isAfterYear(ve,p))return!0;if(!C)return!1;const B=$.startOfYear(ve);return C(B)},[u,m,p,x,W,C,$]),ee=Ze((ve,B)=>{if(w)return;const pe=$.setYear(k??q,B);S(pe)}),te=Ze(ve=>{ae($.setYear(k??q,ve))||(P(ve),ce(!0),_?.(ve))});j.useEffect(()=>{P(ve=>G!==null&&ve!==G?G:ve)},[G]);const Pe=Ze((ve,B)=>{switch(ve.key){case"ArrowUp":te(B-T),ve.preventDefault();break;case"ArrowDown":te(B+T),ve.preventDefault();break;case"ArrowLeft":te(B+(F.direction==="ltr"?-1:1)),ve.preventDefault();break;case"ArrowRight":te(B+(F.direction==="ltr"?1:-1)),ve.preventDefault();break}}),Be=Ze((ve,B)=>{te(B)}),et=Ze((ve,B)=>{H===B&&ce(!1)}),De=j.useRef(null),ze=ci(s,De);return j.useEffect(()=>{if(i||De.current===null)return;const ve=De.current.querySelector('[tabindex="0"]');if(!ve)return;const B=ve.offsetHeight,pe=ve.offsetTop,je=De.current.clientHeight,xe=De.current.scrollTop,v=pe+B;B>je||pe<xe||(De.current.scrollTop=v-je/2-B/2)},[i]),e.jsx(FF,me({ref:ze,className:Cs(he.root,a),ownerState:ne,role:"radiogroup","aria-labelledby":I},N,{children:$.getYearRange(x,p).map(ve=>{const B=$.getYear(ve),pe=B===G,je=h||ae(ve);return e.jsx(IF,{selected:pe,value:B,onClick:ee,onKeyDown:Pe,autoFocus:D&&B===H,disabled:je,tabIndex:B===H?0:-1,onFocus:Be,onBlur:et,"aria-current":re===B?"date":void 0,yearsPerRow:T,children:$.format(ve,"year")},$.format(ve,"year"))})}))}),WF=r=>$s("MuiPickersCalendarHeader",r),$F=Vs("MuiPickersCalendarHeader",["root","labelContainer","label","switchViewButton","switchViewIcon"]),VF=["slots","slotProps","components","componentsProps","currentMonth","disabled","disableFuture","disablePast","maxDate","minDate","onMonthChange","onViewChange","view","reduceAnimations","views","labelId","className","timezone"],zF=["ownerState"],BF=r=>{const{classes:t}=r;return Rs({root:["root"],labelContainer:["labelContainer"],label:["label"],switchViewButton:["switchViewButton"],switchViewIcon:["switchViewIcon"]},WF,t)},UF=ct("div",{name:"MuiPickersCalendarHeader",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"flex",alignItems:"center",marginTop:16,marginBottom:8,paddingLeft:24,paddingRight:12,maxHeight:30,minHeight:30}),QF=ct("div",{name:"MuiPickersCalendarHeader",slot:"LabelContainer",overridesResolver:(r,t)=>t.labelContainer})(({theme:r})=>me({display:"flex",overflow:"hidden",alignItems:"center",cursor:"pointer",marginRight:"auto"},r.typography.body1,{fontWeight:r.typography.fontWeightMedium})),qF=ct("div",{name:"MuiPickersCalendarHeader",slot:"Label",overridesResolver:(r,t)=>t.label})({marginRight:6}),HF=ct(Ge,{name:"MuiPickersCalendarHeader",slot:"SwitchViewButton",overridesResolver:(r,t)=>t.switchViewButton})(({ownerState:r})=>me({marginRight:"auto"},r.view==="year"&&{[`.${$F.switchViewIcon}`]:{transform:"rotate(180deg)"}})),GF=ct(yM,{name:"MuiPickersCalendarHeader",slot:"SwitchViewIcon",overridesResolver:(r,t)=>t.switchViewIcon})(({theme:r})=>({willChange:"transform",transition:r.transitions.create("transform"),transform:"rotate(0deg)"})),KF=j.forwardRef(function(t,s){var n,i,a,o;const l=Gn(),c=Ft(),h=ms({props:t,name:"MuiPickersCalendarHeader"}),{slots:u,slotProps:m,components:p,currentMonth:x,disabled:b,disableFuture:w,disablePast:C,maxDate:A,minDate:_,onMonthChange:R,onViewChange:E,view:T,reduceAnimations:M,views:I,labelId:N,className:k,timezone:S}=h,L=kt(h,VF),W=h,F=BF(h),$=(n=(i=u?.switchViewButton)!=null?i:p?.SwitchViewButton)!=null?n:HF,q=ds({elementType:$,externalSlotProps:m?.switchViewButton,additionalProps:{size:"small","aria-label":l.calendarViewSwitchingButtonAriaLabel(T)},ownerState:W,className:F.switchViewButton}),ne=(a=(o=u?.switchViewIcon)!=null?o:p?.SwitchViewIcon)!=null?a:GF,he=ds({elementType:ne,externalSlotProps:m?.switchViewIcon,ownerState:void 0,className:F.switchViewIcon}),re=kt(he,zF),G=()=>R(c.addMonths(x,1),"left"),H=()=>R(c.addMonths(x,-1),"right"),P=jL(x,{disableFuture:w,maxDate:A,timezone:S}),D=bL(x,{disablePast:C,minDate:_,timezone:S}),Y=()=>{if(!(I.length===1||!E||b))if(I.length===2)E(I.find(ce=>ce!==T)||I[0]);else{const ce=I.indexOf(T)!==0?0:1;E(I[ce])}};return I.length===1&&I[0]==="year"?null:e.jsxs(UF,me({},L,{ownerState:W,className:Cs(k,F.root),ref:s,children:[e.jsxs(QF,{role:"presentation",onClick:Y,ownerState:W,"aria-live":"polite",className:F.labelContainer,children:[e.jsx(Mw,{reduceAnimations:M,transKey:c.format(x,"monthAndYear"),children:e.jsx(qF,{id:N,ownerState:W,className:F.label,children:c.format(x,"monthAndYear")})}),I.length>1&&!b&&e.jsx($,me({},q,{children:e.jsx(ne,me({},re))}))]}),e.jsx(oo,{in:T==="day",children:e.jsx(_M,{slots:u,slotProps:m,onGoToPrevious:H,isPreviousDisabled:D,previousLabel:l.previousMonth,onGoToNext:G,isNextDisabled:P,nextLabel:l.nextMonth})})]}))}),YF=ct("div")({overflow:"hidden",width:Uc,maxHeight:Vf,display:"flex",flexDirection:"column",margin:"0 auto"}),XF=r=>$s("MuiDateCalendar",r);Vs("MuiDateCalendar",["root","viewTransitionContainer"]);const ZF=["autoFocus","onViewChange","value","defaultValue","referenceDate","disableFuture","disablePast","defaultCalendarMonth","onChange","onYearChange","onMonthChange","reduceAnimations","shouldDisableDate","shouldDisableMonth","shouldDisableYear","view","views","openTo","className","disabled","readOnly","minDate","maxDate","disableHighlightToday","focusedView","onFocusedViewChange","showDaysOutsideCurrentMonth","fixedWeekNumber","dayOfWeekFormatter","components","componentsProps","slots","slotProps","loading","renderLoading","displayWeekNumber","yearsPerRow","monthsPerRow","timezone"],JF=r=>{const{classes:t}=r;return Rs({root:["root"],viewTransitionContainer:["viewTransitionContainer"]},XF,t)};function eN(r,t){var s,n,i,a,o,l,c;const h=Ft(),u=Oo(),m=vw(),p=ms({props:r,name:t});return me({},p,{loading:(s=p.loading)!=null?s:!1,disablePast:(n=p.disablePast)!=null?n:!1,disableFuture:(i=p.disableFuture)!=null?i:!1,openTo:(a=p.openTo)!=null?a:"day",views:(o=p.views)!=null?o:["year","day"],reduceAnimations:(l=p.reduceAnimations)!=null?l:m,renderLoading:(c=p.renderLoading)!=null?c:()=>e.jsx("span",{children:"..."}),minDate:vr(h,p.minDate,u.minDate),maxDate:vr(h,p.maxDate,u.maxDate)})}const tN=ct(YF,{name:"MuiDateCalendar",slot:"Root",overridesResolver:(r,t)=>t.root})({display:"flex",flexDirection:"column",height:Vf}),sN=ct(Mw,{name:"MuiDateCalendar",slot:"ViewTransitionContainer",overridesResolver:(r,t)=>t.viewTransitionContainer})({}),rN=j.forwardRef(function(t,s){var n,i,a;const o=Ft(),l=mu(),c=eN(t,"MuiDateCalendar"),{autoFocus:h,onViewChange:u,value:m,defaultValue:p,referenceDate:x,disableFuture:b,disablePast:w,defaultCalendarMonth:C,onChange:A,onYearChange:_,onMonthChange:R,reduceAnimations:E,shouldDisableDate:T,shouldDisableMonth:M,shouldDisableYear:I,view:N,views:k,openTo:S,className:L,disabled:W,readOnly:F,minDate:$,maxDate:q,disableHighlightToday:ne,focusedView:he,onFocusedViewChange:re,showDaysOutsideCurrentMonth:G,fixedWeekNumber:H,dayOfWeekFormatter:P,components:D,componentsProps:Y,slots:ce,slotProps:ae,loading:ee,renderLoading:te,displayWeekNumber:Pe,yearsPerRow:Be,monthsPerRow:et,timezone:De}=c,ze=kt(c,ZF),{value:ve,handleValueChange:B,timezone:pe}=Bf({name:"DateCalendar",timezone:De,value:m,defaultValue:p,onChange:A,valueManager:Sn}),{view:je,setView:xe,focusedView:v,setFocusedView:ie,goToNextView:Q,setValueAndGoToNextView:Z}=Sw({view:N,views:k,openTo:S,onChange:B,onViewChange:u,autoFocus:h,focusedView:he,onFocusedViewChange:re}),{referenceDate:K,calendarState:ue,changeFocusedDay:$e,changeMonth:Le,handleChangeMonth:O,isDateDisabled:Ce,onMonthSwitchingAnimationEnd:At}=eF({value:ve,defaultCalendarMonth:C,referenceDate:x,reduceAnimations:E,onMonthChange:R,minDate:$,maxDate:q,shouldDisableDate:T,disablePast:w,disableFuture:b,timezone:pe}),Bt=W&&ve||$,or=W&&ve||q,bi=`${l}-grid-label`,qt=v!==null,As=(n=(i=ce?.calendarHeader)!=null?i:D?.CalendarHeader)!=null?n:KF,ko=ds({elementType:As,externalSlotProps:(a=ae?.calendarHeader)!=null?a:Y?.calendarHeader,additionalProps:{views:k,view:je,currentMonth:ue.currentMonth,onViewChange:xe,onMonthChange:(Nt,Js)=>O({newMonth:Nt,direction:Js}),minDate:Bt,maxDate:or,disabled:W,disablePast:w,disableFuture:b,reduceAnimations:E,timezone:pe,labelId:bi,slots:ce,slotProps:ae},ownerState:c}),Co=Ze(Nt=>{const Js=o.startOfMonth(Nt),kn=o.endOfMonth(Nt),Rr=Ce(Nt)?Ra({utils:o,date:Nt,minDate:o.isBefore($,Js)?Js:$,maxDate:o.isAfter(q,kn)?kn:q,disablePast:w,disableFuture:b,isDateDisabled:Ce,timezone:pe}):Nt;Rr?(Z(Rr,"finish"),R?.(Js)):(Q(),Le(Js)),$e(Rr,!0)}),Ao=Ze(Nt=>{const Js=o.startOfYear(Nt),kn=o.endOfYear(Nt),Rr=Ce(Nt)?Ra({utils:o,date:Nt,minDate:o.isBefore($,Js)?Js:$,maxDate:o.isAfter(q,kn)?kn:q,disablePast:w,disableFuture:b,isDateDisabled:Ce,timezone:pe}):Nt;Rr?(Z(Rr,"finish"),_?.(Rr)):(Q(),Le(Js)),$e(Rr,!0)}),vi=Ze(Nt=>B(Nt&&hc(o,Nt,ve??K),"finish",je));j.useEffect(()=>{ve!=null&&o.isValid(ve)&&Le(ve)},[ve]);const ca=c,To=JF(ca),da={disablePast:w,disableFuture:b,maxDate:q,minDate:$},wi={disableHighlightToday:ne,readOnly:F,disabled:W,timezone:pe,gridLabelId:bi},ha=j.useRef(je);j.useEffect(()=>{ha.current!==je&&(v===ha.current&&ie(je,!0),ha.current=je)},[v,ie,je]);const qc=j.useMemo(()=>[ve],[ve]);return e.jsxs(tN,me({ref:s,className:Cs(To.root,L),ownerState:ca},ze,{children:[e.jsx(As,me({},ko)),e.jsx(sN,{reduceAnimations:E,className:To.viewTransitionContainer,transKey:je,ownerState:ca,children:e.jsxs("div",{children:[je==="year"&&e.jsx(NF,me({},da,wi,{value:ve,onChange:Ao,shouldDisableYear:I,hasFocus:qt,onFocusedViewChange:Nt=>ie("year",Nt),yearsPerRow:Be,referenceDate:K})),je==="month"&&e.jsx(CF,me({},da,wi,{hasFocus:qt,className:L,value:ve,onChange:Co,shouldDisableMonth:M,onFocusedViewChange:Nt=>ie("month",Nt),monthsPerRow:et,referenceDate:K})),je==="day"&&e.jsx(ZL,me({},ue,da,wi,{onMonthSwitchingAnimationEnd:At,onFocusedDayChange:$e,reduceAnimations:E,selectedDays:qc,onSelectedDaysChange:vi,shouldDisableDate:T,shouldDisableMonth:M,shouldDisableYear:I,hasFocus:qt,onFocusedViewChange:Nt=>ie("day",Nt),showDaysOutsideCurrentMonth:G,fixedWeekNumber:H,dayOfWeekFormatter:P,displayWeekNumber:Pe,components:D,componentsProps:Y,slots:ce,slotProps:ae,loading:ee,renderLoading:te}))]})})]}))}),qi=({view:r,onViewChange:t,views:s,focusedView:n,onFocusedViewChange:i,value:a,defaultValue:o,referenceDate:l,onChange:c,className:h,classes:u,disableFuture:m,disablePast:p,minDate:x,maxDate:b,shouldDisableDate:w,shouldDisableMonth:C,shouldDisableYear:A,reduceAnimations:_,onMonthChange:R,monthsPerRow:E,onYearChange:T,yearsPerRow:M,defaultCalendarMonth:I,components:N,componentsProps:k,slots:S,slotProps:L,loading:W,renderLoading:F,disableHighlightToday:$,readOnly:q,disabled:ne,showDaysOutsideCurrentMonth:he,dayOfWeekFormatter:re,sx:G,autoFocus:H,fixedWeekNumber:P,displayWeekNumber:D,timezone:Y})=>e.jsx(rN,{view:r,onViewChange:t,views:s.filter(Gg),focusedView:n&&Gg(n)?n:null,onFocusedViewChange:i,value:a,defaultValue:o,referenceDate:l,onChange:c,className:h,classes:u,disableFuture:m,disablePast:p,minDate:x,maxDate:b,shouldDisableDate:w,shouldDisableMonth:C,shouldDisableYear:A,reduceAnimations:_,onMonthChange:R,monthsPerRow:E,onYearChange:T,yearsPerRow:M,defaultCalendarMonth:I,components:N,componentsProps:k,slots:S,slotProps:L,loading:W,renderLoading:F,disableHighlightToday:$,readOnly:q,disabled:ne,showDaysOutsideCurrentMonth:he,dayOfWeekFormatter:re,sx:G,autoFocus:H,fixedWeekNumber:P,displayWeekNumber:D,timezone:Y}),Lw=j.forwardRef(function(t,s){var n,i,a,o;const l=Gn(),c=Ft(),h=bw(t,"MuiDesktopDatePicker"),u=me({day:qi,month:qi,year:qi},h.viewRenderers),m=me({},h,{viewRenderers:u,format:Wf(c,h,!1),yearsPerRow:(n=h.yearsPerRow)!=null?n:4,slots:me({openPickerIcon:vM,field:Rw},h.slots),slotProps:me({},h.slotProps,{field:x=>{var b;return me({},Ff((b=h.slotProps)==null?void 0:b.field,x),Pw(h),{ref:s})},toolbar:me({hidden:!0},(i=h.slotProps)==null?void 0:i.toolbar)})}),{renderPicker:p}=nF({props:m,valueManager:Sn,valueType:"date",getOpenDialogAriaText:(a=(o=m.localeText)==null?void 0:o.openDatePickerDialogue)!=null?a:l.openDatePickerDialogue,validator:Qc});return p()});Lw.propTypes={autoFocus:fe.bool,className:fe.string,closeOnSelect:fe.bool,components:fe.object,componentsProps:fe.object,dayOfWeekFormatter:fe.func,defaultCalendarMonth:fe.any,defaultValue:fe.any,disabled:fe.bool,disableFuture:fe.bool,disableHighlightToday:fe.bool,disableOpenPicker:fe.bool,disablePast:fe.bool,displayWeekNumber:fe.bool,fixedWeekNumber:fe.number,format:fe.string,formatDensity:fe.oneOf(["dense","spacious"]),inputRef:Cx,label:fe.node,loading:fe.bool,localeText:fe.object,maxDate:fe.any,minDate:fe.any,monthsPerRow:fe.oneOf([3,4]),name:fe.string,onAccept:fe.func,onChange:fe.func,onClose:fe.func,onError:fe.func,onMonthChange:fe.func,onOpen:fe.func,onSelectedSectionsChange:fe.func,onViewChange:fe.func,onYearChange:fe.func,open:fe.bool,openTo:fe.oneOf(["day","month","year"]),orientation:fe.oneOf(["landscape","portrait"]),readOnly:fe.bool,reduceAnimations:fe.bool,referenceDate:fe.any,renderLoading:fe.func,selectedSections:fe.oneOfType([fe.oneOf(["all","day","hours","meridiem","minutes","month","seconds","weekDay","year"]),fe.number,fe.shape({endIndex:fe.number.isRequired,startIndex:fe.number.isRequired})]),shouldDisableDate:fe.func,shouldDisableMonth:fe.func,shouldDisableYear:fe.func,showDaysOutsideCurrentMonth:fe.bool,slotProps:fe.object,slots:fe.object,sx:fe.oneOfType([fe.arrayOf(fe.oneOfType([fe.func,fe.object,fe.bool])),fe.func,fe.object]),timezone:fe.string,value:fe.any,view:fe.oneOf(["day","month","year"]),viewRenderers:fe.shape({day:fe.func,month:fe.func,year:fe.func}),views:fe.arrayOf(fe.oneOf(["day","month","year"]).isRequired),yearsPerRow:fe.oneOf([3,4])};const nN=["props","getOpenDialogAriaText"],iN=r=>{var t,s,n;let{props:i,getOpenDialogAriaText:a}=r,o=kt(r,nN);const{slots:l,slotProps:c,className:h,sx:u,format:m,formatDensity:p,timezone:x,name:b,label:w,inputRef:C,readOnly:A,disabled:_,localeText:R}=i,E=Ft(),T=j.useRef(null),M=mu(),I=(t=c==null||(s=c.toolbar)==null?void 0:s.hidden)!=null?t:!1,{open:N,actions:k,layoutProps:S,renderCurrentView:L,fieldProps:W}=Ow(me({},o,{props:i,inputRef:T,autoFocusView:!0,additionalViewProps:{},wrapperVariant:"mobile"})),F=l.field,$=ds({elementType:F,externalSlotProps:c?.field,additionalProps:me({},W,I&&{id:M},!(_||A)&&{onClick:k.onOpen,onKeyDown:FM(k.onOpen)},{readOnly:A??!0,disabled:_,className:h,sx:u,format:m,formatDensity:p,timezone:x,label:w,name:b}),ownerState:i});$.inputProps=me({},$.inputProps,{"aria-label":a(W.value,E)});const q=me({textField:l.textField},$.slots),ne=(n=l.layout)!=null?n:Aw,he=ci(T,$.inputRef,C);let re=M;I&&(w?re=`${M}-label`:re=void 0);const G=me({},c,{toolbar:me({},c?.toolbar,{titleId:M}),mobilePaper:me({"aria-labelledby":re},c?.mobilePaper)});return{renderPicker:()=>e.jsxs(Vc,{localeText:R,children:[e.jsx(F,me({},$,{slots:q,slotProps:G,inputRef:he})),e.jsx(RM,me({},k,{open:N,slots:l,slotProps:G,children:e.jsx(ne,me({},S,G?.layout,{slots:l,slotProps:G,children:L()}))}))]})}},Fw=j.forwardRef(function(t,s){var n,i,a;const o=Gn(),l=Ft(),c=bw(t,"MuiMobileDatePicker"),h=me({day:qi,month:qi,year:qi},c.viewRenderers),u=me({},c,{viewRenderers:h,format:Wf(l,c,!1),slots:me({field:Rw},c.slots),slotProps:me({},c.slotProps,{field:p=>{var x;return me({},Ff((x=c.slotProps)==null?void 0:x.field,p),Pw(c),{ref:s})},toolbar:me({hidden:!1},(n=c.slotProps)==null?void 0:n.toolbar)})}),{renderPicker:m}=iN({props:u,valueManager:Sn,valueType:"date",getOpenDialogAriaText:(i=(a=u.localeText)==null?void 0:a.openDatePickerDialogue)!=null?i:o.openDatePickerDialogue,validator:Qc});return m()});Fw.propTypes={autoFocus:fe.bool,className:fe.string,closeOnSelect:fe.bool,components:fe.object,componentsProps:fe.object,dayOfWeekFormatter:fe.func,defaultCalendarMonth:fe.any,defaultValue:fe.any,disabled:fe.bool,disableFuture:fe.bool,disableHighlightToday:fe.bool,disableOpenPicker:fe.bool,disablePast:fe.bool,displayWeekNumber:fe.bool,fixedWeekNumber:fe.number,format:fe.string,formatDensity:fe.oneOf(["dense","spacious"]),inputRef:Cx,label:fe.node,loading:fe.bool,localeText:fe.object,maxDate:fe.any,minDate:fe.any,monthsPerRow:fe.oneOf([3,4]),name:fe.string,onAccept:fe.func,onChange:fe.func,onClose:fe.func,onError:fe.func,onMonthChange:fe.func,onOpen:fe.func,onSelectedSectionsChange:fe.func,onViewChange:fe.func,onYearChange:fe.func,open:fe.bool,openTo:fe.oneOf(["day","month","year"]),orientation:fe.oneOf(["landscape","portrait"]),readOnly:fe.bool,reduceAnimations:fe.bool,referenceDate:fe.any,renderLoading:fe.func,selectedSections:fe.oneOfType([fe.oneOf(["all","day","hours","meridiem","minutes","month","seconds","weekDay","year"]),fe.number,fe.shape({endIndex:fe.number.isRequired,startIndex:fe.number.isRequired})]),shouldDisableDate:fe.func,shouldDisableMonth:fe.func,shouldDisableYear:fe.func,showDaysOutsideCurrentMonth:fe.bool,slotProps:fe.object,slots:fe.object,sx:fe.oneOfType([fe.arrayOf(fe.oneOfType([fe.func,fe.object,fe.bool])),fe.func,fe.object]),timezone:fe.string,value:fe.any,view:fe.oneOf(["day","month","year"]),viewRenderers:fe.shape({day:fe.func,month:fe.func,year:fe.func}),views:fe.arrayOf(fe.oneOf(["day","month","year"]).isRequired),yearsPerRow:fe.oneOf([3,4])};const aN=["desktopModeMediaQuery"],nx=j.forwardRef(function(t,s){const n=ms({props:t,name:"MuiDatePicker"}),{desktopModeMediaQuery:i=NM}=n,a=kt(n,aN);return fu(i,{defaultMatches:!0})?e.jsx(Lw,me({ref:s},a)):e.jsx(Fw,me({ref:s},a))});var hl={exports:{}},ix;function oN(){return ix||(ix=1,(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=function(c,h){switch(c){case"P":return h.date({width:"short"});case"PP":return h.date({width:"medium"});case"PPP":return h.date({width:"long"});case"PPPP":default:return h.date({width:"full"})}},n=function(c,h){switch(c){case"p":return h.time({width:"short"});case"pp":return h.time({width:"medium"});case"ppp":return h.time({width:"long"});case"pppp":default:return h.time({width:"full"})}},i=function(c,h){var u=c.match(/(P+)(p+)?/)||[],m=u[1],p=u[2];if(!p)return s(c,h);var x;switch(m){case"P":x=h.dateTime({width:"short"});break;case"PP":x=h.dateTime({width:"medium"});break;case"PPP":x=h.dateTime({width:"long"});break;case"PPPP":default:x=h.dateTime({width:"full"});break}return x.replace("{{date}}",s(m,h)).replace("{{time}}",n(p,h))},a={p:n,P:i},o=a;t.default=o,r.exports=t.default})(hl,hl.exports)),hl.exports}var lN=oN();const cN=pu(lN),dN={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},hN={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",fullDateWithWeekday:"PPPP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",monthAndYear:"LLLL yyyy",monthAndDate:"MMMM d",fullTime:"p",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",fullDateTime:"PP p",fullDateTime12h:"PP hh:mm aa",fullDateTime24h:"PP HH:mm",keyboardDateTime:"P p",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class uN{constructor(t){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib="date-fns",this.locale=void 0,this.formats=void 0,this.formatTokenMap=dN,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=a=>typeof a>"u"?new Date:a===null?null:new Date(a),this.dateWithTimezone=a=>this.date(a),this.getTimezone=()=>"default",this.setTimezone=a=>a,this.toJsDate=a=>a,this.getCurrentLocaleCode=()=>{var a;return((a=this.locale)==null?void 0:a.code)||"en-US"},this.is12HourCycleInCurrentLocale=()=>this.locale?/a/.test(this.locale.formatLong.time({width:"short"})):!0,this.expandFormat=a=>{const o=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return a.match(o).map(l=>{const c=l[0];if(c==="p"||c==="P"){const h=this.longFormatters[c];return h(l,this.locale.formatLong)}return l}).join("")},this.getFormatHelperText=a=>this.expandFormat(a).replace(/(aaa|aa|a)/g,"(a|p)m").toLocaleLowerCase(),this.isNull=a=>a===null,this.formatNumber=a=>a,this.getMeridiemText=a=>a==="am"?"AM":"PM";const{locale:s,formats:n,longFormatters:i}=t;this.locale=s,this.formats=me({},hN,n),this.longFormatters=i}}class Nw extends uN{constructor({locale:t,formats:s}={}){if(typeof td!="function")throw new Error(["MUI: The `date-fns` package v3.x is not compatible with this adapter.","Please, install v2.x of the package or use the `AdapterDateFnsV3` instead."].join(`
`));super({locale:t??sO,formats:s,longFormatters:cN}),this.parseISO=n=>rO(n),this.toISO=n=>nO(n,{format:"extended"}),this.parse=(n,i)=>n===""?null:iO(n,i,new Date,{locale:this.locale}),this.isValid=n=>aO(this.date(n)),this.format=(n,i)=>this.formatByString(n,this.formats[i]),this.formatByString=(n,i)=>Fa(n,i,{locale:this.locale}),this.getDiff=(n,i,a)=>{switch(a){case"years":return pO(n,this.date(i));case"quarters":return mO(n,this.date(i));case"months":return fO(n,this.date(i));case"weeks":return uO(n,this.date(i));case"days":return hO(n,this.date(i));case"hours":return dO(n,this.date(i));case"minutes":return cO(n,this.date(i));case"seconds":return lO(n,this.date(i));default:return oO(n,this.date(i))}},this.isEqual=(n,i)=>n===null&&i===null?!0:gO(n,i),this.isSameYear=(n,i)=>xO(n,i),this.isSameMonth=(n,i)=>yO(n,i),this.isSameDay=(n,i)=>jO(n,i),this.isSameHour=(n,i)=>bO(n,i),this.isAfter=(n,i)=>sd(n,i),this.isAfterYear=(n,i)=>sd(n,rd(i)),this.isAfterDay=(n,i)=>sd(n,lm(i)),this.isBefore=(n,i)=>ua(n,i),this.isBeforeYear=(n,i)=>ua(n,Po(i)),this.isBeforeDay=(n,i)=>ua(n,cm(i)),this.isWithinRange=(n,[i,a])=>vO(n,{start:i,end:a}),this.startOfYear=n=>Po(n),this.startOfMonth=n=>dm(n),this.startOfWeek=n=>nd(n,{locale:this.locale}),this.startOfDay=n=>cm(n),this.endOfYear=n=>rd(n),this.endOfMonth=n=>hm(n),this.endOfWeek=n=>id(n,{locale:this.locale}),this.endOfDay=n=>lm(n),this.addYears=(n,i)=>um(n,i),this.addMonths=(n,i)=>ad(n,i),this.addWeeks=(n,i)=>wO(n,i),this.addDays=(n,i)=>td(n,i),this.addHours=(n,i)=>SO(n,i),this.addMinutes=(n,i)=>OO(n,i),this.addSeconds=(n,i)=>kO(n,i),this.getYear=n=>CO(n),this.getMonth=n=>AO(n),this.getDate=n=>TO(n),this.getHours=n=>PO(n),this.getMinutes=n=>_O(n),this.getSeconds=n=>EO(n),this.getMilliseconds=n=>IO(n),this.setYear=(n,i)=>DO(n,i),this.setMonth=(n,i)=>RO(n,i),this.setDate=(n,i)=>MO(n,i),this.setHours=(n,i)=>LO(n,i),this.setMinutes=(n,i)=>FO(n,i),this.setSeconds=(n,i)=>NO(n,i),this.setMilliseconds=(n,i)=>WO(n,i),this.getDaysInMonth=n=>$O(n),this.getNextMonth=n=>ad(n,1),this.getPreviousMonth=n=>ad(n,-1),this.getMonthArray=n=>{const a=[Po(n)];for(;a.length<12;){const o=a[a.length-1];a.push(this.getNextMonth(o))}return a},this.mergeDateAndTime=(n,i)=>this.setSeconds(this.setMinutes(this.setHours(n,this.getHours(i)),this.getMinutes(i)),this.getSeconds(i)),this.getWeekdays=()=>{const n=new Date;return VO({start:nd(n,{locale:this.locale}),end:id(n,{locale:this.locale})}).map(i=>this.formatByString(i,"EEEEEE"))},this.getWeekArray=n=>{const i=nd(dm(n),{locale:this.locale}),a=id(hm(n),{locale:this.locale});let o=0,l=i;const c=[];for(;ua(l,a);){const h=Math.floor(o/7);c[h]=c[h]||[],c[h].push(l),l=td(l,1),o+=1}return c},this.getWeekNumber=n=>zO(n,{locale:this.locale}),this.getYearRange=(n,i)=>{const a=Po(n),o=rd(i),l=[];let c=a;for(;ua(c,o);)l.push(c),c=um(c,1);return l}}}const fN=()=>{const{user:r,isAuthenticated:t}=ps(),s=On(),[n,i]=j.useState([]),[a,o]=j.useState(!0),[l,c]=j.useState(null),[h,u]=j.useState(0),[m,p]=j.useState("date"),[x,b]=j.useState("desc"),[w,C]=j.useState(0),[A,_]=j.useState(25),[R,E]=j.useState(""),[T,M]=j.useState({start:null,end:null}),[I,N]=j.useState("all"),[k,S]=j.useState("all"),[L,W]=j.useState(!1),[F,$]=j.useState(null),[q,ne]=j.useState(!1),[he,re]=j.useState(!1),[G,H]=j.useState(null),[P,D]=j.useState([]),[Y,ce]=j.useState(null),[ae,ee]=j.useState([]);j.useEffect(()=>{t&&(te(),Pe(),Be(),et())},[t,s,w,A,m,x,I,k,T]);const te=async()=>{const Q=r?.token||null;if(!Q){console.warn("No user token available for fetching trade history"),o(!1);return}try{o(!0);const Z=new URLSearchParams({page:w+1,limit:A,sortBy:m,sortOrder:x,...I!=="all"&&{type:I},...k!=="all"&&{status:k},...T.start&&{startDate:T.start.toISOString()},...T.end&&{endDate:T.end.toISOString()},...R&&{search:R}}),K=await fetch(`/api/trades/history?${Z}`,{headers:{Authorization:`Bearer ${Q}`}});if(!K.ok)throw new Error("Failed to fetch trade history");const ue=await K.json();i(ue.trades||[]);const $e=ue.trades?.map(Le=>({date:new Date(Le.executedAt).toLocaleDateString(),pnl:Le.realizedPnl||0,value:Le.value||0,cumulative:Le.cumulativePnl||0}))||[];ee($e)}catch(Z){c(Z.message)}finally{o(!1)}},Pe=async()=>{const Q=r?.token||null;if(!Q){console.warn("No user token available for fetching analytics");return}try{const{apiUrl:Z}=Xt(),K=await fetch(`${Z}/api/trades/analytics/overview`,{headers:{Authorization:`Bearer ${Q}`}});if(K.ok){const ue=await K.json();H(ue)}}catch{}},Be=async()=>{const Q=r?.token||null;if(!Q){console.warn("No user token available for fetching insights");return}try{const{apiUrl:Z}=Xt(),K=await fetch(`${Z}/api/trades/insights`,{headers:{Authorization:`Bearer ${Q}`}});if(K.ok){const ue=await K.json();D(ue.insights||[])}}catch{}},et=async()=>{const Q=r?.token||null;if(!Q){console.warn("No user token available for fetching performance data");return}try{const{apiUrl:Z}=Xt(),K=await fetch(`${Z}/api/trades/performance`,{headers:{Authorization:`Bearer ${Q}`}});if(K.ok){const ue=await K.json();ce(ue)}}catch{}},De=async()=>{const Q=r?.token||null;if(!Q){c("No authentication token available");return}try{o(!0);const{apiUrl:Z}=Xt();if((await fetch(`${Z}/api/trades/import/alpaca`,{method:"POST",headers:{Authorization:`Bearer ${Q}`}})).ok)await te(),re(!1);else throw new Error("Failed to import trades")}catch(Z){c(Z.message)}finally{o(!1)}},ze=async(Q="csv")=>{const Z=r?.token||null;if(!Z){c("No authentication token available");return}try{const K=await fetch(`/api/trades/export?format=${Q}`,{headers:{Authorization:`Bearer ${Z}`}});if(K.ok){const ue=await K.blob(),$e=window.URL.createObjectURL(ue),Le=document.createElement("a");Le.href=$e,Le.download=`trades_${new Date().toISOString().split("T")[0]}.${Q}`,document.body.appendChild(Le),Le.click(),window.URL.revokeObjectURL($e),document.body.removeChild(Le)}}catch(K){c(K.message)}},ve=Q=>{switch(Q?.toLowerCase()){case"buy":return"success";case"sell":return"error";case"dividend":return"info";case"split":return"warning";default:return"default"}},B=Q=>{switch(Q?.toLowerCase()){case"filled":return"success";case"pending":return"warning";case"cancelled":return"error";case"partial":return"info";default:return"default"}},pe=Q=>Q==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Q),je=Q=>Q==null?"0.00%":`${(Q*100).toFixed(2)}%`,xe=j.useMemo(()=>{let Q=n.filter(Z=>{const K=!R||Z.symbol?.toLowerCase().includes(R.toLowerCase())||Z.type?.toLowerCase().includes(R.toLowerCase()),ue=I==="all"||Z.type===I,$e=k==="all"||Z.status===k;return K&&ue&&$e});return Q.sort((Z,K)=>{const ue=Z[m],$e=K[m];return x==="asc"?ue>$e?1:-1:ue<$e?1:-1}),Q},[n,R,I,k,m,x]),v=xe.slice(w*A,w*A+A),ie=({children:Q,value:Z,index:K,...ue})=>e.jsx("div",{role:"tabpanel",hidden:Z!==K,...ue,children:Z===K&&e.jsx(g,{sx:{p:3},children:Q})});return t?e.jsx(Vc,{dateAdapter:Nw,children:e.jsxs(lt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Trade History"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",children:"Complete overview of your trading activity and performance"})]}),l&&e.jsx(we,{severity:"error",sx:{mb:3},onClose:()=>c(null),children:l}),G&&e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(AS,{color:"primary",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Total Trades"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:G.totalTrades||0})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(TS,{color:"success",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Total P&L"})]}),e.jsx(d,{variant:"h4",sx:{mt:1,color:G.totalPnl>=0?"success.main":"error.main"},children:pe(G.totalPnl)})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Pr,{color:"info",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Win Rate"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:je(G.winRate)})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Lt,{color:"secondary",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Avg Hold Time"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:G.avgHoldTime||"N/A"})]})})})]}),e.jsxs(g,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(oe,{variant:"outlined",startIcon:e.jsx(PS,{}),onClick:()=>re(!0),children:"Import Trades"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kr,{}),onClick:()=>ze("csv"),children:"Export CSV"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kr,{}),onClick:()=>ze("json"),children:"Export JSON"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Es,{}),onClick:te,children:"Refresh"})]}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:h,onChange:(Q,Z)=>u(Z),children:[e.jsx(it,{value:0,icon:e.jsx(_S,{}),label:"Trade List"}),e.jsx(it,{value:1,icon:e.jsx(Gt,{}),label:"Performance Chart"}),e.jsx(it,{value:2,icon:e.jsx(xr,{}),label:"Analytics"}),e.jsx(it,{value:3,icon:e.jsx(fx,{}),label:"AI Insights"})]})}),e.jsxs(ie,{value:h,index:0,children:[e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[e.jsx(_e,{size:"small",placeholder:"Search by symbol or type...",value:R,onChange:Q=>E(Q.target.value),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})},sx:{minWidth:200}}),e.jsxs(ft,{size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Type"}),e.jsxs(pt,{value:I,label:"Type",onChange:Q=>N(Q.target.value),children:[e.jsx(J,{value:"all",children:"All Types"}),e.jsx(J,{value:"buy",children:"Buy"}),e.jsx(J,{value:"sell",children:"Sell"}),e.jsx(J,{value:"dividend",children:"Dividend"}),e.jsx(J,{value:"split",children:"Split"})]})]}),e.jsxs(ft,{size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Status"}),e.jsxs(pt,{value:k,label:"Status",onChange:Q=>S(Q.target.value),children:[e.jsx(J,{value:"all",children:"All Status"}),e.jsx(J,{value:"filled",children:"Filled"}),e.jsx(J,{value:"pending",children:"Pending"}),e.jsx(J,{value:"cancelled",children:"Cancelled"}),e.jsx(J,{value:"partial",children:"Partial"})]})]}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Tr,{}),onClick:()=>W(!L),children:"Filters"})]}),L&&e.jsx(g,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(nx,{label:"Start Date",value:T.start,onChange:Q=>M(Z=>({...Z,start:Q})),renderInput:Q=>e.jsx(_e,{...Q,fullWidth:!0})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(nx,{label:"End Date",value:T.end,onChange:Q=>M(Z=>({...Z,end:Q})),renderInput:Q=>e.jsx(_e,{...Q,fullWidth:!0})})})]})})]})}),e.jsxs(z,{children:[e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(Ca,{active:m==="symbol",direction:m==="symbol"?x:"asc",onClick:()=>{p("symbol"),b(m==="symbol"&&x==="asc"?"desc":"asc")},children:"Symbol"})}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Quantity"}),e.jsx(f,{children:"Price"}),e.jsx(f,{children:"Value"}),e.jsx(f,{children:"P&L"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:e.jsx(Ca,{active:m==="executedAt",direction:m==="executedAt"?x:"asc",onClick:()=>{p("executedAt"),b(m==="executedAt"&&x==="asc"?"desc":"asc")},children:"Date"})}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ke,{children:a?e.jsx(V,{children:e.jsx(f,{colSpan:9,align:"center",children:e.jsx(Je,{})})}):(v?.length||0)===0?e.jsx(V,{children:e.jsx(f,{colSpan:9,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No trades found"})})}):(v||[]).map(Q=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:Q.symbol})}),e.jsx(f,{children:e.jsx(X,{label:Q.type,color:ve(Q.type),size:"small",icon:Q.type==="buy"?e.jsx(at,{}):e.jsx(Tt,{})})}),e.jsx(f,{children:Q.quantity}),e.jsx(f,{children:pe(Q.price)}),e.jsx(f,{children:pe(Q.value)}),e.jsx(f,{children:e.jsx(d,{variant:"body2",color:Q.realizedPnl>=0?"success.main":"error.main",fontWeight:"bold",children:pe(Q.realizedPnl)})}),e.jsx(f,{children:e.jsx(X,{label:Q.status,color:B(Q.status),size:"small"})}),e.jsx(f,{children:new Date(Q.executedAt).toLocaleDateString()}),e.jsx(f,{children:e.jsx(Ge,{size:"small",onClick:()=>{$(Q),ne(!0)},children:e.jsx(xr,{})})})]},Q.id))})]})}),e.jsx(yn,{rowsPerPageOptions:[10,25,50,100],component:"div",count:xe?.length||0,rowsPerPage:A,page:w,onPageChange:(Q,Z)=>C(Z),onRowsPerPageChange:Q=>{_(parseInt(Q.target.value,10)),C(0)}})]})]}),e.jsx(ie,{value:h,index:1,children:e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"P&L Over Time"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:400,children:e.jsxs(BO,{data:ae,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"date"}),e.jsx(ht,{}),e.jsx(ot,{formatter:Q=>pe(Q)}),e.jsx(jt,{dataKey:"pnl",fill:"#8884d8"}),e.jsx(Ds,{type:"monotone",dataKey:"cumulative",stroke:"#82ca9d",strokeWidth:2})]})})})]})})})}),e.jsx(ie,{value:h,index:2,children:G&&e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Trading Statistics"}),e.jsx(U,{children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Total Trades:"}),e.jsx(d,{fontWeight:"bold",children:G.totalTrades})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Winning Trades:"}),e.jsx(d,{fontWeight:"bold",color:"success.main",children:G.winningTrades})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Losing Trades:"}),e.jsx(d,{fontWeight:"bold",color:"error.main",children:G.losingTrades})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Average Win:"}),e.jsx(d,{fontWeight:"bold",children:pe(G.avgWin)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Average Loss:"}),e.jsx(d,{fontWeight:"bold",children:pe(G.avgLoss)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Profit Factor:"}),e.jsx(d,{fontWeight:"bold",children:G.profitFactor})]})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Performance Metrics"}),e.jsx(U,{children:Y&&e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Total Return:"}),e.jsx(d,{fontWeight:"bold",color:Y.totalReturn>=0?"success.main":"error.main",children:je(Y.totalReturn)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Sharpe Ratio:"}),e.jsx(d,{fontWeight:"bold",children:Y.sharpeRatio})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Max Drawdown:"}),e.jsx(d,{fontWeight:"bold",color:"error.main",children:je(Y.maxDrawdown)})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(d,{children:"Volatility:"}),e.jsx(d,{fontWeight:"bold",children:je(Y.volatility)})]})]})})]})})]})}),e.jsx(ie,{value:h,index:3,children:e.jsxs(y,{container:!0,spacing:3,children:[(P||[]).map((Q,Z)=>e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:Q.title,subheader:Q.category}),e.jsxs(U,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:Q.description}),Q.recommendation&&e.jsx(we,{severity:Q.severity||"info",sx:{mt:2},children:Q.recommendation})]})]})},Z)),(P?.length||0)===0&&e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{children:e.jsx(U,{children:e.jsx(d,{variant:"body2",color:"text.secondary",align:"center",children:"No AI insights available. Execute more trades to generate insights."})})})})]})}),e.jsxs(Os,{open:he,onClose:()=>re(!1),children:[e.jsx(Ls,{children:"Import Trades"}),e.jsxs(ks,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Import your trades from connected brokers. This will sync your trade history and update your analytics."}),e.jsx(we,{severity:"info",children:"Make sure your broker API keys are configured in Settings before importing."})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>re(!1),children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:De,children:"Import from Alpaca"})]})]}),e.jsxs(Os,{open:q,onClose:()=>ne(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ls,{children:"Trade Details"}),e.jsx(ks,{children:F&&e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Symbol"}),e.jsx(d,{variant:"body2",children:F.symbol})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Type"}),e.jsx(d,{variant:"body2",children:F.type})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Quantity"}),e.jsx(d,{variant:"body2",children:F.quantity})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Price"}),e.jsx(d,{variant:"body2",children:pe(F.price)})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Total Value"}),e.jsx(d,{variant:"body2",children:pe(F.value)})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"P&L"}),e.jsx(d,{variant:"body2",color:F.realizedPnl>=0?"success.main":"error.main",children:pe(F.realizedPnl)})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Execution Date"}),e.jsx(d,{variant:"body2",children:new Date(F.executedAt).toLocaleString()})]}),e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Status"}),e.jsx(d,{variant:"body2",children:F.status})]}),F.fees&&e.jsxs(y,{item:!0,xs:12,sm:6,children:[e.jsx(d,{variant:"subtitle2",children:"Fees"}),e.jsx(d,{variant:"body2",children:pe(F.fees)})]}),F.notes&&e.jsxs(y,{item:!0,xs:12,children:[e.jsx(d,{variant:"subtitle2",children:"Notes"}),e.jsx(d,{variant:"body2",children:F.notes})]})]})}),e.jsx(Is,{children:e.jsx(oe,{onClick:()=>ne(!1),children:"Close"})})]})]})}):e.jsx(lt,{maxWidth:"md",sx:{mt:4},children:e.jsx(we,{severity:"warning",children:"Please log in to view your trade history."})})},mN=()=>{const{user:r,isAuthenticated:t}=ps(),s=On(),n=window.location.hostname==="localhost";j.useCallback(async(K,ue={})=>{const $e=r?.token||(n?"dev-bypass-token":null);if(!$e)throw new Vr("No authentication token available");const Le={...ue.headers,Authorization:`Bearer ${$e}`};return fetch(K,{...ue,headers:Le})},[r,n]);const[i,a]=j.useState([]),[o,l]=j.useState(!0),[c,h]=j.useState(null),[u,m]=j.useState(0),[p,x]=j.useState(!1),[b,w]=j.useState(!1),[C,A]=j.useState(null),[_,R]=j.useState(null),[E,T]=j.useState(null),[M,I]=j.useState([]),[N,k]=j.useState({}),[S,L]=j.useState([]),[W,F]=j.useState({symbol:"",side:"buy",quantity:"",orderType:"market",timeInForce:"day",limitPrice:"",stopPrice:"",expiration:null,extendedHours:!1,allOrNone:!1,notes:""}),[$,q]=j.useState(""),[ne,he]=j.useState("all"),[re,G]=j.useState("all"),[H,P]=j.useState({start:null,end:null}),[D,Y]=j.useState({}),[ce,ae]=j.useState([]),ee=j.useCallback(async()=>{const K=r?.token||(n?"dev-bypass-token":null);if(!K){console.warn("No user token available for fetching orders"),l(!1);return}try{l(!0);const{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/orders`,{headers:{Authorization:`Bearer ${K}`}});if(!$e.ok)throw new Vr("Failed to fetch orders");const Le=await $e.json();a(Le.orders||[])}catch(ue){h(ue.message),a([])}finally{l(!1)}},[r,n]),te=j.useCallback(async()=>{const K=r?.token||(n?"dev-bypass-token":null);if(!K){console.warn("No user token available for fetching account info");return}try{const{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/orders/account`,{headers:{Authorization:`Bearer ${K}`}});if($e.ok){const Le=await $e.json();T(Le)}}catch(ue){console.error("Failed to fetch account info:",ue),T(null)}},[r,n]),Pe=j.useCallback(async()=>{const K=r?.token||(n?"dev-bypass-token":null);if(!K){console.warn("No user token available for fetching positions");return}try{const{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/portfolio/holdings`,{headers:{Authorization:`Bearer ${K}`}});if($e.ok){const Le=await $e.json();I(Le?.data?.holdings||[])}}catch{}},[r,n]),Be=j.useCallback(async()=>{const K=r?.token||(n?"dev-bypass-token":null);if(!K){console.warn("No user token available for fetching watchlist");return}try{const{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/watchlist`,{headers:{Authorization:`Bearer ${K}`}});if($e.ok){const Le=await $e.json();L(Le.symbols||["AAPL","MSFT","GOOGL","AMZN","TSLA"])}}catch{L(["AAPL","MSFT","GOOGL","AMZN","TSLA"])}},[r,n]),et=j.useCallback(async()=>{const K=r?.token||(n?"dev-bypass-token":null);if(!K){console.warn("No user token available for fetching order updates");return}try{const{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/orders`,{headers:{Authorization:`Bearer ${K}`}});if($e.ok){const Le=await $e.json();Y(Le.updates||{});const O=Le.executions||[];O.length>0&&ae(Ce=>[...Ce,...O])}}catch{}},[r,n]),De=j.useCallback(async()=>{try{const K=[...new Set([...S,...(i||[]).map(Le=>Le.symbol)])];if(K.length===0){console.log("No symbols available for market data streaming");return}const ue=r?.token||(n?"dev-bypass-token":null),$e=await fetch(`/api/websocket/stream/${K.join(",")}`,{headers:{Authorization:`Bearer ${ue}`}});if($e.ok){const Le=await $e.json();k(Le.quotes||{})}}catch{}},[r,n,S,i]);j.useEffect(()=>{if(!n&&(!t||!r)){s("/");return}ee(),te(),Pe(),Be();{const K=setInterval(()=>{et(),De()},5e3);return()=>clearInterval(K)}},[t,r,s,ee,te,Pe,Be,et,De,n]);const ze=async()=>{try{l(!0);const K=je(W);if(!K.valid){h(K.message);return}const ue=await pe(W);R(ue),w(!0)}catch(K){h(K.message)}finally{l(!1)}},ve=async()=>{try{l(!0);const K=r?.token||(n?"dev-bypass-token":null),{apiUrl:ue}=Xt(),$e=await fetch(`${ue}/api/orders`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${K}`},body:JSON.stringify(W)});if(!$e.ok)throw new Vr("Failed to submit order");const Le=await $e.json();await ee(),F({symbol:"",side:"buy",quantity:"",orderType:"market",timeInForce:"day",limitPrice:"",stopPrice:"",expiration:null,extendedHours:!1,allOrNone:!1,notes:""}),x(!1),w(!1),ae(O=>[...O,{type:"success",message:`Order submitted successfully: ${Le.orderId}`,timestamp:new Date().toISOString()}])}catch(K){h(K.message)}finally{l(!1)}},B=async K=>{try{const ue=r?.token||(n?"dev-bypass-token":null);if(!(await fetch(`/api/orders/${K}/cancel`,{method:"POST",headers:{Authorization:`Bearer ${ue}`}})).ok)throw new Vr("Failed to cancel order");await ee(),ae(Le=>[...Le,{type:"info",message:`Order ${K} cancelled`,timestamp:new Date().toISOString()}])}catch(ue){h(ue.message)}},pe=async K=>{try{const ue=r?.token||(n?"dev-bypass-token":null),{apiUrl:$e}=Xt(),Le=await fetch(`${$e}/api/orders/preview`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ue}`},body:JSON.stringify(K)});if(!Le.ok)throw new Vr("Failed to get order preview");return await Le.json()}catch(ue){throw console.error("Failed to get order preview:",ue),ue}},je=K=>K.symbol?!K.quantity||parseFloat(K.quantity)<=0?{valid:!1,message:"Quantity must be greater than 0"}:K.orderType==="limit"&&(!K.limitPrice||parseFloat(K.limitPrice)<=0)?{valid:!1,message:"Limit price is required for limit orders"}:K.orderType==="stop"&&(!K.stopPrice||parseFloat(K.stopPrice)<=0)?{valid:!1,message:"Stop price is required for stop orders"}:{valid:!0}:{valid:!1,message:"Symbol is required"},xe=K=>{switch(K?.toLowerCase()){case"filled":return"success";case"pending":return"warning";case"cancelled":return"error";case"partial":return"info";case"rejected":return"error";default:return"default"}},v=K=>K==="buy"?"success":"error",ie=K=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(K||0),Q=j.useMemo(()=>i.filter(K=>{const ue=!$||K.symbol.toLowerCase().includes($.toLowerCase())||K.id.toLowerCase().includes($.toLowerCase()),$e=ne==="all"||K.status===ne,Le=re==="all"||K.side===re;return ue&&$e&&Le}),[i,$,ne,re]),Z=({children:K,value:ue,index:$e,...Le})=>e.jsx("div",{role:"tabpanel",hidden:ue!==$e,...Le,children:ue===$e&&e.jsx(g,{sx:{p:3},children:K})});return!n&&!t?e.jsx(lt,{maxWidth:"md",sx:{mt:4},children:e.jsx(we,{severity:"warning",children:"Please log in to access order management."})}):e.jsx(Vc,{dateAdapter:Nw,children:e.jsxs(lt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Order Management"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",children:"Execute trades, manage orders, and monitor positions"})]}),c&&e.jsx(we,{severity:"error",sx:{mb:3},onClose:()=>h(null),children:c}),ce.length>0&&e.jsx(g,{sx:{mb:3},children:ce.slice(-3).map((K,ue)=>e.jsx(we,{severity:K.type,sx:{mb:1},onClose:()=>ae($e=>$e.filter((Le,O)=>O!==ue)),children:K.message},ue))}),E&&e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Fs,{color:"primary",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Buying Power"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:ie(E.buyingPower)})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(yx,{color:"success",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Cash"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:ie(E.cash)})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Lt,{color:"info",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Portfolio Value"})]}),e.jsx(d,{variant:"h4",sx:{mt:1},children:ie(E.portfolioValue)})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xn,{color:"warning",sx:{mr:1}}),e.jsx(d,{variant:"h6",children:"Day Trades"})]}),e.jsxs(d,{variant:"h4",sx:{mt:1},children:[E.dayTrades,"/3"]}),e.jsx(d,{variant:"caption",color:"text.secondary",children:E.patternDayTrader?"PDT Account":"Standard Account"})]})})})]}),e.jsxs(g,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>x(!0),sx:{background:"linear-gradient(45deg, #1976d2, #42a5f5)"},children:"New Order"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Es,{}),onClick:ee,children:"Refresh"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Kr,{}),onClick:()=>{},children:"Export Orders"})]}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:u,onChange:(K,ue)=>m(ue),children:[e.jsx(it,{value:0,icon:e.jsx(ES,{}),label:"Open Orders"}),e.jsx(it,{value:1,icon:e.jsx(Pr,{}),label:"Order History"}),e.jsx(it,{value:2,icon:e.jsx(Gt,{}),label:"Positions"}),e.jsx(it,{value:3,icon:e.jsx(ao,{}),label:"Settings"})]})}),e.jsx(Z,{value:u,index:0,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Open Orders"}),e.jsxs(U,{children:[e.jsxs(g,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(_e,{size:"small",placeholder:"Search orders...",value:$,onChange:K=>q(K.target.value),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})}}),e.jsxs(ft,{size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Status"}),e.jsxs(pt,{value:ne,label:"Status",onChange:K=>he(K.target.value),children:[e.jsx(J,{value:"all",children:"All Status"}),e.jsx(J,{value:"pending",children:"Pending"}),e.jsx(J,{value:"filled",children:"Filled"}),e.jsx(J,{value:"cancelled",children:"Cancelled"}),e.jsx(J,{value:"partial",children:"Partial"})]})]}),e.jsxs(ft,{size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Side"}),e.jsxs(pt,{value:re,label:"Side",onChange:K=>G(K.target.value),children:[e.jsx(J,{value:"all",children:"All"}),e.jsx(J,{value:"buy",children:"Buy"}),e.jsx(J,{value:"sell",children:"Sell"})]})]})]}),e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Order ID"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Side"}),e.jsx(f,{children:"Quantity"}),e.jsx(f,{children:"Order Type"}),e.jsx(f,{children:"Price"}),e.jsx(f,{children:"Status"}),e.jsx(f,{children:"Submitted"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ke,{children:o?e.jsx(V,{children:e.jsx(f,{colSpan:9,align:"center",children:e.jsx(Je,{})})}):(Q?.length||0)===0?e.jsx(V,{children:e.jsx(f,{colSpan:9,align:"center",children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"No orders found"})})}):(Q||[]).map(K=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:K.id})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:K.symbol})}),e.jsx(f,{children:e.jsx(X,{label:K.side.toUpperCase(),color:v(K.side),size:"small",icon:K.side==="buy"?e.jsx(at,{}):e.jsx(Tt,{})})}),e.jsx(f,{children:K.filledQuantity>0?e.jsxs(g,{children:[e.jsxs(d,{variant:"body2",children:[K.filledQuantity,"/",K.quantity]}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:[(K.filledQuantity/K.quantity*100).toFixed(1),"% filled"]})]}):K.quantity}),e.jsx(f,{children:e.jsx(X,{label:K.orderType.toUpperCase(),size:"small",variant:"outlined"})}),e.jsx(f,{children:K.orderType==="market"?e.jsx(d,{variant:"body2",children:"Market"}):e.jsx(d,{variant:"body2",children:ie(K.limitPrice||K.stopPrice)})}),e.jsx(f,{children:e.jsx(X,{label:K.status.toUpperCase(),color:xe(K.status),size:"small"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:new Date(K.submittedAt).toLocaleString()})}),e.jsx(f,{children:e.jsxs(g,{sx:{display:"flex",gap:1},children:[K.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{title:"Modify Order",children:e.jsx(Ge,{size:"small",onClick:()=>{A(K),F({...K,limitPrice:K.limitPrice?.toString()||"",stopPrice:K.stopPrice?.toString()||"",quantity:K.quantity.toString()}),x(!0)},children:e.jsx(fc,{})})}),e.jsx(tt,{title:"Cancel Order",children:e.jsx(Ge,{size:"small",color:"error",onClick:()=>B(K.id),children:e.jsx(Ax,{})})})]}),e.jsx(tt,{title:"Order Details",children:e.jsx(Ge,{size:"small",onClick:()=>{A(K)},children:e.jsx(lo,{})})})]})})]},K.id))})]})})]})]})}),e.jsx(Z,{value:u,index:1,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Order History"}),e.jsx(U,{children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Complete order history with execution details and performance analytics."})})]})}),e.jsx(Z,{value:u,index:2,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Current Positions"}),e.jsx(U,{children:e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Quantity"}),e.jsx(f,{children:"Avg Cost"}),e.jsx(f,{children:"Market Value"}),e.jsx(f,{children:"P&L"}),e.jsx(f,{children:"Actions"})]})}),e.jsx(ke,{children:(M||[]).map(K=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:K.symbol})}),e.jsx(f,{children:K.quantity}),e.jsx(f,{children:ie(K.avgCost)}),e.jsx(f,{children:ie(K.marketValue)}),e.jsx(f,{children:e.jsx(d,{variant:"body2",color:K.unrealizedPnl>=0?"success.main":"error.main",fontWeight:"bold",children:ie(K.unrealizedPnl)})}),e.jsx(f,{children:e.jsx(oe,{size:"small",variant:"outlined",onClick:()=>{F({...W,symbol:K.symbol,side:"sell",quantity:K.quantity.toString(),orderType:"market"}),x(!0)},children:"Close Position"})})]},K.symbol))})]})})})]})}),e.jsx(Z,{value:u,index:3,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Order Settings"}),e.jsx(U,{children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Configure default order settings and risk management parameters."})})]})}),e.jsxs(Os,{open:p,onClose:()=>x(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ls,{children:C?"Modify Order":"New Order"}),e.jsx(ks,{children:e.jsxs(y,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{label:"Symbol",value:W.symbol,onChange:K=>F({...W,symbol:K.target.value.toUpperCase()}),fullWidth:!0,required:!0})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Side"}),e.jsxs(pt,{value:W.side,label:"Side",onChange:K=>F({...W,side:K.target.value}),children:[e.jsx(J,{value:"buy",children:"Buy"}),e.jsx(J,{value:"sell",children:"Sell"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{label:"Quantity",type:"number",value:W.quantity,onChange:K=>F({...W,quantity:K.target.value}),fullWidth:!0,required:!0})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Order Type"}),e.jsxs(pt,{value:W.orderType,label:"Order Type",onChange:K=>F({...W,orderType:K.target.value}),children:[e.jsx(J,{value:"market",children:"Market"}),e.jsx(J,{value:"limit",children:"Limit"}),e.jsx(J,{value:"stop",children:"Stop"}),e.jsx(J,{value:"stop_limit",children:"Stop Limit"})]})]})}),(W.orderType==="limit"||W.orderType==="stop_limit")&&e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{label:"Limit Price",type:"number",value:W.limitPrice,onChange:K=>F({...W,limitPrice:K.target.value}),fullWidth:!0,InputProps:{startAdornment:e.jsx(ts,{position:"start",children:"$"})}})}),(W.orderType==="stop"||W.orderType==="stop_limit")&&e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{label:"Stop Price",type:"number",value:W.stopPrice,onChange:K=>F({...W,stopPrice:K.target.value}),fullWidth:!0,InputProps:{startAdornment:e.jsx(ts,{position:"start",children:"$"})}})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Time in Force"}),e.jsxs(pt,{value:W.timeInForce,label:"Time in Force",onChange:K=>F({...W,timeInForce:K.target.value}),children:[e.jsx(J,{value:"day",children:"Day"}),e.jsx(J,{value:"gtc",children:"Good Till Cancelled"}),e.jsx(J,{value:"ioc",children:"Immediate or Cancel"}),e.jsx(J,{value:"fok",children:"Fill or Kill"})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Jt,{control:e.jsx(rs,{checked:W.extendedHours,onChange:K=>F({...W,extendedHours:K.target.checked})}),label:"Extended Hours Trading"})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(_e,{label:"Notes",multiline:!0,rows:3,value:W.notes,onChange:K=>F({...W,notes:K.target.value}),fullWidth:!0,placeholder:"Optional notes about this order..."})})]})}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(oe,{variant:"contained",onClick:ze,children:C?"Modify Order":"Preview Order"})]})]}),e.jsxs(Os,{open:b,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ls,{children:"Order Confirmation"}),e.jsx(ks,{children:_&&e.jsxs(g,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:[_.side.toUpperCase()," ",_.quantity," ",_.symbol]}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Estimated Price:"}),e.jsx(d,{variant:"body1",children:ie(_.estimatedPrice)})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Estimated Value:"}),e.jsx(d,{variant:"body1",children:ie(_.estimatedValue)})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Commission:"}),e.jsx(d,{variant:"body1",children:ie(_.estimatedCommission)})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Buying Power Required:"}),e.jsx(d,{variant:"body1",children:ie(_.buyingPowerRequired)})]})]}),_.warningMessages?.length>0&&e.jsx(we,{severity:"warning",sx:{mt:2},children:_.warningMessages.join(". ")}),e.jsx(g,{sx:{mt:2},children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Risk Assessment: ",_.riskAssessment]})})]})}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(oe,{variant:"contained",color:"primary",onClick:ve,children:"Confirm Order"})]})]})]})})},pN=window.CONFIG?.API_URL||"http://localhost:5001",gN=(r,t,s)=>{const n={news:.4,analyst:.35,social:.25};let i=0,a=0;return r!=null&&(a+=r*n.news,i+=n.news),t!=null&&(a+=t*n.analyst,i+=n.analyst),s!=null&&(a+=s*n.social,i+=n.social),i===0?null:a/i},xN=r=>r==null?{label:"Unknown",color:"default",icon:e.jsx(Ml,{})}:r>.3?{label:"Bullish",color:"success",icon:e.jsx(at,{})}:r<-.3?{label:"Bearish",color:"error",icon:e.jsx(Tt,{})}:{label:"Neutral",color:"warning",icon:e.jsx(Ml,{})};function yN(){const[r,t]=j.useState(null),[s,n]=j.useState(""),{data:i,isLoading:a,error:o}=Qe({queryKey:["sentimentStocks"],queryFn:async()=>{const x=await fetch(`${pN}/api/sentiment/stocks`);if(!x.ok)throw new Error("Failed to fetch sentiment");return x.json()},staleTime:3e5,refetchInterval:3e5}),c=(i?.data||[]).reduce((x,b)=>{const w=b.symbol;x[w]||(x[w]={symbol:w,news:[],social:[],analyst:[]});const C=(b.source||"").toLowerCase();return C.includes("news")||C.includes("article")?x[w].news.push(b):C.includes("reddit")||C.includes("social")||C.includes("twitter")?x[w].social.push(b):C.includes("analyst")||C.includes("rating")?x[w].analyst.push(b):x[w].news.push(b),x},{}),u=Object.values(c).map(x=>{const b=x.news[0],w=x.social[0],C=x.analyst[0],A=gN(b?.sentiment_score,C?.sentiment_score,w?.sentiment_score);return{symbol:x.symbol,compositeScore:A,compositeSentiment:xN(A),news:x.news,social:x.social,analyst:x.analyst,latestNews:b,latestSocial:w,latestAnalyst:C,allData:[...x.news,...x.social,...x.analyst].sort((_,R)=>new Date(R.date)-new Date(_.date))}}).filter(x=>x.symbol.toLowerCase().includes(s.toLowerCase()));u.sort((x,b)=>(b.compositeScore||-999)-(x.compositeScore||-999));const m=["#0088FE","#00C49F","#FFBB28","#FF8042"],p=x=>{t(r===x?null:x)};return e.jsxs(lt,{maxWidth:"xl",sx:{py:3},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(IS,{sx:{fontSize:40,color:"primary.main"}}),e.jsx(d,{variant:"h4",component:"h1",children:"Sentiment Analysis"})]}),e.jsx(d,{variant:"subtitle1",color:"textSecondary",sx:{mt:1},children:"Composite sentiment scores from news, analyst ratings, and social media"})]}),e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(_e,{fullWidth:!0,label:"Search Symbols",placeholder:"Filter by symbol (e.g., AAPL, GOOGL)",value:s,onChange:x=>n(x.target.value),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})}}),u.length>0&&e.jsxs(d,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:["Showing ",u.length," symbol",u.length!==1?"s":""," with sentiment data"]})]})}),a&&e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(Je,{})}),o&&e.jsxs(we,{severity:"error",sx:{mb:3},children:["Failed to load sentiment data: ",o.message]}),!a&&!o&&e.jsx(e.Fragment,{children:u.length===0?e.jsx(we,{severity:"info",children:s?`No symbols match "${s}"`:"No sentiment data available"}):e.jsx(g,{children:u.map(x=>{const b=[{name:"News",value:x.latestNews?.sentiment_score||0,weight:40},{name:"Analyst",value:x.latestAnalyst?.sentiment_score||0,weight:35},{name:"Social",value:x.latestSocial?.sentiment_score||0,weight:25}].filter(w=>w.value!==0);return e.jsxs(is,{expanded:r===x.symbol,onChange:()=>p(x.symbol),sx:{mb:1},children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{backgroundColor:"grey.50","&:hover":{backgroundColor:"grey.100"}},children:e.jsxs(y,{container:!0,alignItems:"center",spacing:2,children:[e.jsx(y,{item:!0,xs:2,children:e.jsx(d,{variant:"h6",fontWeight:"bold",children:x.symbol})}),e.jsx(y,{item:!0,xs:3,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[x.compositeSentiment.icon,e.jsx(X,{label:x.compositeSentiment.label,color:x.compositeSentiment.color,size:"small"})]})}),e.jsxs(y,{item:!0,xs:2,children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:x.compositeScore!==null?x.compositeScore.toFixed(2):"N/A"}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Composite Score"})]}),e.jsx(y,{item:!0,xs:5,children:e.jsxs(y,{container:!0,spacing:1,children:[e.jsx(y,{item:!0,xs:4,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Yc,{fontSize:"small"}),e.jsx(X,{label:x.latestNews?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestNews?.sentiment_score>.2?"success":x.latestNews?.sentiment_score<-.2?"error":"warning"})]})}),e.jsx(y,{item:!0,xs:4,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Xc,{fontSize:"small"}),e.jsx(X,{label:x.latestAnalyst?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestAnalyst?.sentiment_score>.2?"success":x.latestAnalyst?.sentiment_score<-.2?"error":"warning"})]})}),e.jsx(y,{item:!0,xs:4,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[e.jsx(Zc,{fontSize:"small"}),e.jsx(X,{label:x.latestSocial?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestSocial?.sentiment_score>.2?"success":x.latestSocial?.sentiment_score<-.2?"error":"warning"})]})})]})})]})}),e.jsx(os,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Composite Sentiment"}),e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsx(d,{variant:"h3",fontWeight:"bold",children:x.compositeScore!==null?x.compositeScore.toFixed(2):"N/A"}),e.jsx(X,{label:x.compositeSentiment.label,color:x.compositeSentiment.color,icon:x.compositeSentiment.icon,size:"large"})]}),e.jsx(Fe,{sx:{my:2}}),e.jsx(d,{variant:"caption",color:"textSecondary",children:"Weighted average of news (40%), analyst ratings (35%), and social sentiment (25%)"})]})})}),e.jsx(y,{item:!0,xs:12,md:8,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Sentiment Component Breakdown"}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,md:6,children:b.length>0?e.jsx(st,{width:"100%",height:200,children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:b,dataKey:"weight",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,label:({name:w,weight:C})=>`${w} (${C}%)`,children:b.map((w,C)=>e.jsx(xt,{fill:m[C%m.length]},`cell-${C}`))}),e.jsx(ot,{})]})}):e.jsx(d,{variant:"body2",color:"textSecondary",children:"No component data available"})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(g,{children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Yc,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:"News Sentiment"})]}),e.jsx(X,{label:x.latestNews?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestNews?.sentiment_score>.2?"success":x.latestNews?.sentiment_score<-.2?"error":"warning"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Xc,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:"Analyst Ratings"})]}),e.jsx(X,{label:x.latestAnalyst?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestAnalyst?.sentiment_score>.2?"success":x.latestAnalyst?.sentiment_score<-.2?"error":"warning"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Zc,{fontSize:"small"}),e.jsx(d,{variant:"body2",children:"Social Media"})]}),e.jsx(X,{label:x.latestSocial?.sentiment_score?.toFixed(2)||"N/A",size:"small",color:x.latestSocial?.sentiment_score>.2?"success":x.latestSocial?.sentiment_score<-.2?"error":"warning"})]})]})})]})]})})}),x.news.length>0&&e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(Yc,{}),e.jsx(d,{variant:"h6",children:"News Sentiment"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Score:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestNews?.sentiment_score?.toFixed(2)||"N/A"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Positive:"}),e.jsx(X,{label:x.latestNews?.positive_mentions||0,size:"small",color:"success",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Neutral:"}),e.jsx(X,{label:x.latestNews?.neutral_mentions||0,size:"small",color:"default",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Negative:"}),e.jsx(X,{label:x.latestNews?.negative_mentions||0,size:"small",color:"error",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Total Articles:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestNews?.total_mentions||0})]})]})})}),x.social.length>0&&e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(Zc,{}),e.jsx(d,{variant:"h6",children:"Social Media"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Score:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestSocial?.sentiment_score?.toFixed(2)||"N/A"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Positive:"}),e.jsx(X,{label:x.latestSocial?.positive_mentions||0,size:"small",color:"success",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Neutral:"}),e.jsx(X,{label:x.latestSocial?.neutral_mentions||0,size:"small",color:"default",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Negative:"}),e.jsx(X,{label:x.latestSocial?.negative_mentions||0,size:"small",color:"error",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Total Mentions:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestSocial?.total_mentions||0})]})]})})}),x.analyst.length>0&&e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,mb:2,children:[e.jsx(Xc,{}),e.jsx(d,{variant:"h6",children:"Analyst Ratings"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Score:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestAnalyst?.sentiment_score?.toFixed(2)||"N/A"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Buy:"}),e.jsx(X,{label:x.latestAnalyst?.positive_mentions||0,size:"small",color:"success",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Hold:"}),e.jsx(X,{label:x.latestAnalyst?.neutral_mentions||0,size:"small",color:"default",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Sell:"}),e.jsx(X,{label:x.latestAnalyst?.negative_mentions||0,size:"small",color:"error",variant:"outlined"})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",children:"Total Analysts:"}),e.jsx(d,{variant:"body2",fontWeight:"600",children:x.latestAnalyst?.total_mentions||0})]})]})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",mb:2,children:"Recent Sentiment Data"}),e.jsx(Ae,{component:He,variant:"outlined",children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Date"}),e.jsx(f,{children:"Source"}),e.jsx(f,{align:"center",children:"Score"}),e.jsx(f,{align:"center",children:"Positive"}),e.jsx(f,{align:"center",children:"Neutral"}),e.jsx(f,{align:"center",children:"Negative"}),e.jsx(f,{align:"center",children:"Total"})]})}),e.jsx(ke,{children:x.allData.slice(0,10).map((w,C)=>e.jsxs(V,{children:[e.jsx(f,{children:new Date(w.date).toLocaleDateString()}),e.jsx(f,{children:e.jsx(X,{label:w.source||"Unknown",size:"small",variant:"outlined"})}),e.jsx(f,{align:"center",children:e.jsx(X,{label:w.sentiment_score?.toFixed(2)||"N/A",size:"small",color:w.sentiment_score>.2?"success":w.sentiment_score<-.2?"error":"warning"})}),e.jsx(f,{align:"center",children:w.positive_mentions||0}),e.jsx(f,{align:"center",children:w.neutral_mentions||0}),e.jsx(f,{align:"center",children:w.negative_mentions||0}),e.jsx(f,{align:"center",children:w.total_mentions||0})]},`${x.symbol}-${C}`))})]})})]})})})]})})]},x.symbol)})})})]})}const jN=()=>{const[r,t]=j.useState([]),[s,n]=j.useState({}),[i,a]=j.useState(!0),[o,l]=j.useState(null),[c,h]=j.useState(""),[u,m]=j.useState("all"),[p]=j.useState(1),[x,b]=j.useState(0),[w,C]=j.useState(25);j.useEffect(()=>{A()},[p,u]);const A=async()=>{try{a(!0);const N=(await St.get(`/api/analysts/upgrades?page=${p}&limit=50`))?.data;if(N?.success){let k=N.data;u!=="all"&&(k=N.data.filter(S=>S.action&&S.action.toLowerCase().includes(u.toLowerCase()))),console.log("Filtered upgrades:",k),t(k)}else throw new Error(N.error||"Failed to fetch analyst data")}catch(I){console.error("Error fetching analyst data:",I),l("Failed to load analyst data")}finally{a(!1)}},_=async I=>{if(I)try{const k=(await St.get(`/api/analysts/${I.toUpperCase()}`)).data;k.success&&n(S=>({...S,[I.toUpperCase()]:k}))}catch(N){console.error(`Error fetching data for ${I}:`,N)}},R=(I,N,k)=>{if(!I)return e.jsx(Gt,{});const S=I.toLowerCase();if(S==="up"||S.includes("upgrade"))return e.jsx(at,{sx:{color:"success.main"}});if(S==="down"||S.includes("downgrade"))return e.jsx(Tt,{sx:{color:"error.main"}});if(N&&k){const L=["Buy","Outperform","Overweight","Strong Buy"],W=["Sell","Underperform","Underweight"],F=["Strong Sell","Sell","Underweight","Underperform","Hold","Neutral","Equal-Weight","Market Perform","Sector Perform","Peer Perform","Perform","Buy","Outperform","Overweight","Strong Buy"],$=F.findIndex(re=>N?.includes(re)),q=F.findIndex(re=>k?.includes(re));if(q>$&&$!==-1)return e.jsx(at,{sx:{color:"success.main"}});if(q<$&&q!==-1)return e.jsx(Tt,{sx:{color:"error.main"}});const ne=L.some(re=>k?.includes(re)),he=W.some(re=>k?.includes(re));if(ne)return e.jsx(at,{sx:{color:"success.main"}});if(he)return e.jsx(Tt,{sx:{color:"error.main"}})}return e.jsx(Gt,{sx:{color:"info.main"}})},E=(I,N,k)=>{if(!I)return"default";const S=I.toLowerCase();if(S==="up"||S.includes("upgrade"))return"success";if(S==="down"||S.includes("downgrade"))return"error";if(N&&k){const L=["Buy","Outperform","Overweight","Strong Buy"],W=["Sell","Underperform","Underweight"],F=["Strong Sell","Sell","Underweight","Underperform","Hold","Neutral","Equal-Weight","Market Perform","Sector Perform","Peer Perform","Perform","Buy","Outperform","Overweight","Strong Buy"],$=F.findIndex(re=>N?.includes(re)),q=F.findIndex(re=>k?.includes(re));if(q>$&&$!==-1)return"success";if(q<$&&q!==-1)return"error";const ne=L.some(re=>k?.includes(re)),he=W.some(re=>k?.includes(re));if(ne)return"success";if(he)return"error"}return"info"},T=I=>{if(!I)return"N/A";try{return new Date(I).toLocaleDateString()}catch{return I}},M=r.filter(I=>!c||I.symbol?.toLowerCase().includes(c.toLowerCase()));return i?e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Je,{})}):e.jsxs(g,{sx:{p:3},children:[e.jsx(g,{sx:{mb:4},children:e.jsxs(d,{variant:"h4",component:"h1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(La,{fontSize:"large"}),"Analyst Insights"]})}),o&&e.jsx(we,{severity:"error",sx:{mb:3},children:o}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Mt,{sx:{bgcolor:"success.main"},children:e.jsx(at,{})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:r.filter(I=>I.action?.toLowerCase().includes("upgrade")).length}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Recent Upgrades"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Mt,{sx:{bgcolor:"error.main"},children:e.jsx(Tt,{})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:r.filter(I=>I.action?.toLowerCase().includes("downgrade")).length}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Recent Downgrades"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Mt,{sx:{bgcolor:"info.main"},children:e.jsx(Ma,{})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:new Set(r.map(I=>I.firm).filter(Boolean)).size}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Active Firms"})]})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Mt,{sx:{bgcolor:"warning.main"},children:e.jsx(Lt,{})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:r.length}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Total Actions"})]})]})})})})]}),e.jsxs(g,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(_e,{placeholder:"Search by symbol...",variant:"outlined",size:"small",value:c,onChange:I=>h(I.target.value),InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(ar,{})})},sx:{minWidth:200}}),e.jsxs(ft,{size:"small",sx:{minWidth:150},children:[e.jsx(mt,{id:"action-filter-label",children:"Action Filter"}),e.jsxs(pt,{labelId:"action-filter-label",id:"action-filter",value:u,label:"Action Filter",onChange:I=>m(I.target.value),children:[e.jsx(J,{value:"all",children:"All Actions"}),e.jsx(J,{value:"upgrade",children:"Upgrades"}),e.jsx(J,{value:"downgrade",children:"Downgrades"}),e.jsx(J,{value:"initiate",children:"Initiations"}),e.jsx(J,{value:"maintain",children:"Maintains"})]})]})]}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{}),"Recent Analyst Actions"]}),e.jsx(Ae,{children:e.jsxs(Oe,{children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{children:"Company Name"}),e.jsx(f,{children:"Firm"}),e.jsx(f,{children:"Action"}),e.jsx(f,{children:"From Grade"}),e.jsx(f,{children:"To Grade"}),e.jsx(f,{children:"Date"})]})}),e.jsx(ke,{children:(w>0?M.slice(x*w,x*w+w):M).map((I,N)=>e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{cursor:"pointer",color:"primary.main"},onClick:()=>_(I.symbol),children:I.symbol})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:I.company_name||"N/A"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:I.firm||"N/A"})}),e.jsx(f,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[R(I.action,I.from_grade,I.to_grade),e.jsx(X,{label:I.action==="main"?"maint":I.action||"N/A",color:E(I.action,I.from_grade,I.to_grade),size:"small"})]})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:I.from_grade||"N/A"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:I.to_grade||"N/A"})}),e.jsx(f,{children:e.jsx(d,{variant:"body2",children:T(I.date)})})]},I.id||N))})]})}),e.jsx(yn,{component:"div",count:M.length,page:x,onPageChange:(I,N)=>b(N),rowsPerPage:w,onRowsPerPageChange:I=>{C(parseInt(I.target.value,10)),b(0)},rowsPerPageOptions:[10,25,50,100,{label:"All",value:-1}]})]})}),Object.keys(s).length>0&&e.jsx(g,{sx:{mt:2},children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Click on symbols to load detailed data (feature can be expanded)"})})]})};function Yd({children:r,value:t,index:s,...n}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`economic-tabpanel-${s}`,"aria-labelledby":`economic-tab-${s}`,...n,children:t===s&&e.jsx(g,{sx:{p:3},children:r})})}const ul=(r,t="N/A")=>r==null||isNaN(r)?t:Number(r).toFixed(1),ax=(r,t="N/A")=>r==null||isNaN(r)?t:Number(r).toFixed(0),ox=(r,t="N/A")=>r==null||isNaN(r)?t:Number(r).toFixed(0),bN=()=>{const[r,t]=j.useState(0),[s,n]=j.useState("6M"),[i,a]=j.useState("composite"),[o,l]=j.useState("base"),[c,h]=j.useState(null),[u,m]=j.useState(!0),[p,x]=j.useState(null),[b,w]=j.useState(!0),[C,A]=j.useState(70);j.useEffect(()=>{(async()=>{try{m(!0),x(null);const[S,L,W,F]=await Promise.all([le.get("/api/market/recession-forecast"),le.get("/api/market/leading-indicators"),le.get("/api/market/sectoral-analysis"),le.get("/api/market/economic-scenarios")]),$=L?.data?.data||L?.data||{},q=S?.data?.data||S?.data||{},ne=W?.data?.data||W?.data||{},he=F?.data?.data||F?.data||{};console.log("🔍 Economic Data Debug:",{leadingDataKeys:Object.keys($),indicatorsArray:$.indicators,indicatorsCount:$.indicators?.length,firstIndicator:$.indicators?.[0]});const re={forecastModels:q.forecastModels||[],recessionProbability:q.compositeRecessionProbability||0,riskLevel:q.riskLevel||"Medium",leadingIndicators:$.indicators||[],gdpGrowth:$.gdpGrowth||0,unemployment:$.unemployment||0,inflation:$.inflation||0,employment:$.employment||{},yieldCurve:{spread2y10y:$.yieldCurve?.spread2y10y||0,spread3m10y:$.yieldCurve?.spread3m10y||0,isInverted:$.yieldCurve?.isInverted||!1,interpretation:$.yieldCurve?.interpretation||"",historicalAccuracy:$.yieldCurve?.historicalAccuracy||0,averageLeadTime:$.yieldCurve?.averageLeadTime||0},yieldCurveData:$.yieldCurveData||[],sectoralData:ne.sectors||[],scenarios:he.scenarios||[],upcomingEvents:$.upcomingEvents||[]};h(re)}catch(S){x(S.message||"Failed to fetch economic data")}finally{m(!1)}})()},[s]);const _=j.useMemo(()=>{if(!c||!c.forecastModels)return 0;const k={"NY Fed Model":.35,"Goldman Sachs":.25,"JP Morgan":.25,"AI Ensemble":.15},S=c.forecastModels.reduce((L,W)=>L+(W.probability||0)*(k[W.name]||0),0);return Math.round(S)||0},[c]),R=j.useMemo(()=>{if(!c||!c.leadingIndicators)return 0;const k=c.leadingIndicators.filter(W=>W.signal==="Negative").length,S=c.leadingIndicators?.length||0,L=S>0?k/S*100:0;return Math.round(L)||0},[c]),E=j.useMemo(()=>{if(!c||!c.yieldCurve)return"Neutral";const k=c.yieldCurve;if(!k||typeof k!="object")return"Neutral";const S=k.spread2y10y,L=k.spread3m10y;return typeof S!="number"||typeof L!="number"?"Neutral":S<-50&&L<-50?"Strong Recession Signal":S<0&&L<0?"Recession Signal":S<50&&L<50?"Flattening":"Normal"},[c]),T=(k,S)=>{t(S)},M=k=>{switch(k?.toLowerCase()){case"low":return"success";case"medium":return"warning";case"high":return"error";default:return"default"}},I=k=>k<20?"success":k<40?"warning":"error",N=k=>{switch(k){case"improving":return e.jsx(at,{color:"success"});case"deteriorating":return e.jsx(Tt,{color:"error"});default:return e.jsx(Ml,{color:"action"})}};return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Economic Modeling & Forecasting"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Advanced econometric models and real-time recession probability analysis"})]}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ft,{size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Timeframe"}),e.jsxs(pt,{value:s,onChange:k=>n(k.target.value),label:"Timeframe",children:[e.jsx(J,{value:"3M",children:"3 Months"}),e.jsx(J,{value:"6M",children:"6 Months"}),e.jsx(J,{value:"1Y",children:"1 Year"}),e.jsx(J,{value:"2Y",children:"2 Years"}),e.jsx(J,{value:"5Y",children:"5 Years"})]})]}),e.jsx(Ge,{onClick:()=>m(!0),children:e.jsx(Es,{})})]})]}),u&&e.jsxs(g,{sx:{mb:3},children:[e.jsx(rt,{}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:"Loading economic data and forecasting models..."})]}),p&&e.jsxs(we,{severity:"error",sx:{mb:3},children:[e.jsx("strong",{children:"Error loading economic data:"})," ",p,e.jsx(oe,{color:"inherit",size:"small",onClick:()=>window.location.reload(),sx:{ml:2},children:"Retry"})]}),!u&&c&&b&&_>40&&e.jsxs(we,{severity:"warning",sx:{mb:3},action:e.jsx(oe,{color:"inherit",size:"small",children:"View Details"}),children:[e.jsx("strong",{children:"Elevated Recession Risk:"})," Composite model indicates"," ",_,"% probability of recession within"," ",s,". Monitor key indicators closely."]}),!u&&c?.yieldCurve?.isInverted&&e.jsxs(we,{severity:"error",sx:{mb:3},action:e.jsx(oe,{color:"inherit",size:"small",children:"Learn More"}),children:[e.jsx("strong",{children:"Yield Curve Inverted:"})," ",E," detected. Historical accuracy: ",c.yieldCurve.historicalAccuracy,"% in predicting recessions."]}),!u&&c&&e.jsxs(y,{container:!0,spacing:3,mb:4,children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"text.secondary",children:"Recession Probability"}),e.jsxs(d,{variant:"h4",color:I(_)+".main",children:[_,"%"]}),e.jsxs(d,{variant:"body2",children:["Composite model (",s,")"]})]}),e.jsx(Pr,{color:M(c.riskLevel),fontSize:"large"})]}),e.jsx(rt,{variant:"determinate",value:_,color:I(_),sx:{mt:2}})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"text.secondary",children:"Economic Stress"}),e.jsx(d,{variant:"h4",color:"primary",children:R}),e.jsx(d,{variant:"body2",children:"Stress Index (0-100)"})]}),e.jsx(xn,{color:"primary",fontSize:"large"})]}),e.jsx(rt,{variant:"determinate",value:R,color:R>60?"error":R>30?"warning":"success",sx:{mt:2}})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"text.secondary",children:"GDP Growth"}),e.jsxs(d,{variant:"h4",color:"secondary",children:[ul(c.gdpGrowth),"%"]}),e.jsx(d,{variant:"body2",children:"Annualized Q/Q"})]}),e.jsx(Gt,{color:"secondary",fontSize:"large"})]}),e.jsxs(g,{display:"flex",alignItems:"center",mt:1,children:[c.gdpGrowth>0?e.jsx(at,{color:"success",fontSize:"small"}):e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsx(d,{variant:"body2",color:"text.secondary",ml:1,children:"vs previous quarter"})]})]})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"text.secondary",children:"Unemployment"}),e.jsxs(d,{variant:"h4",color:"info.main",children:[ul(c.unemployment),"%"]}),e.jsx(d,{variant:"body2",children:"Current rate"})]}),e.jsx(DS,{color:"info",fontSize:"large"})]}),e.jsx(g,{display:"flex",alignItems:"center",mt:1,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Sahm Rule:"," ",c.employment?.sahmRule?.value||"N/A"]})})]})})})]}),!u&&c&&e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:r,onChange:T,"aria-label":"economic modeling tabs",children:[e.jsx(it,{value:0,label:"Leading Indicators",icon:e.jsx(xr,{})}),e.jsx(it,{value:1,label:"Yield Curve",icon:e.jsx(Gt,{})}),e.jsx(it,{value:2,label:"Scenario Planning",icon:e.jsx(RS,{})})]})}),e.jsx(Yd,{value:r,index:0,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Leading Economic Indicators",subheader:"Real-time economic momentum analysis",action:e.jsx(X,{label:`${c.leadingIndicators?.length||0} indicators`,color:"primary",variant:"outlined"})}),e.jsx(U,{children:e.jsx(y,{container:!0,spacing:3,children:c.leadingIndicators?.map((k,S)=>e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[N(k.trend),e.jsx(d,{variant:"h6",children:k.name})]}),e.jsx(X,{label:k.signal,color:k.signal==="Positive"?"success":k.signal==="Negative"?"error":"default",size:"small"})]}),e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:2,children:[e.jsx(d,{variant:"h4",color:"primary",children:k.value}),e.jsxs(d,{variant:"body2",color:k.change>0?"success.main":"error.main",children:[k.change>0?"+":"",k.change,"%"]})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:2,children:k.description}),e.jsxs(g,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Signal Strength"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[k.strength,"%"]})]}),e.jsx(rt,{variant:"determinate",value:k.strength,color:k.strength>70?"success":k.strength>40?"warning":"error"})]})]})})},S))})})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Signal Summary"}),e.jsxs(U,{children:[e.jsx(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"h3",color:"primary",children:R}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Stress Index"})]})}),e.jsxs(g,{mb:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Risk Level"}),e.jsx(X,{label:c.riskLevel,color:M(c.riskLevel),size:"large"})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Positive Signals"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:c.leadingIndicators?.filter(k=>k.signal==="Positive").length||0})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Negative Signals"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:c.leadingIndicators?.filter(k=>k.signal==="Negative").length||0})]}),e.jsxs(g,{display:"flex",justifyContent:"between",children:[e.jsx(d,{variant:"body2",children:"Neutral Signals"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:c.leadingIndicators?.filter(k=>k.signal==="Neutral").length||0})]})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Upcoming Events",subheader:"Next 30 days"}),e.jsx(U,{children:e.jsx(jr,{children:c.upcomingEvents?.map((k,S)=>e.jsxs(Dt,{alignItems:"flex-start",children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:M(k.importance)+".main"},children:e.jsx(jx,{})})}),e.jsx(Ut,{primary:k.event,secondary:e.jsxs(e.Fragment,{children:[e.jsxs("span",{style:{fontSize:"0.875rem",color:"rgba(0, 0, 0, 0.6)"},children:[k.date," • ",k.time]}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.875rem",color:"rgba(0, 0, 0, 0.87)"},children:k.forecast})]})})]},S))})})]})})]})})]})}),e.jsx(Yd,{value:r,index:1,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Yield Curve Analysis",subheader:"Treasury yield curve and inversion analysis"}),e.jsxs(U,{children:[e.jsx(st,{width:"100%",height:400,children:e.jsxs(Ks,{data:c.yieldCurveData,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"maturity"}),e.jsx(ht,{}),e.jsx(ot,{formatter:k=>[`${k}%`,"Yield"]}),e.jsx(Ds,{type:"monotone",dataKey:"yield",stroke:"#1976d2",strokeWidth:3,dot:{fill:"#1976d2",strokeWidth:2,r:6}}),e.jsx(UO,{y:0,stroke:"red",strokeDasharray:"2 2"})]})}),e.jsx(g,{mt:3,children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"2Y-10Y Spread"}),e.jsxs(d,{variant:"h6",color:c.yieldCurve?.spread2y10y<0?"error.main":"success.main",children:[ax(c.yieldCurve?.spread2y10y)," ","bps"]})]}),e.jsxs(y,{item:!0,xs:6,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"3M-10Y Spread"}),e.jsxs(d,{variant:"h6",color:c.yieldCurve?.spread3m10y<0?"error.main":"success.main",children:[ax(c.yieldCurve?.spread3m10y)," ","bps"]})]})]})})]})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Inversion Analysis"}),e.jsxs(U,{children:[e.jsxs(we,{severity:c.yieldCurve?.isInverted?"error":"success",sx:{mb:3},children:[e.jsx(d,{variant:"h6",children:c.yieldCurve?.isInverted?"Yield Curve Inverted":"Normal Yield Curve"}),e.jsx(d,{variant:"body2",children:c.yieldCurve?.interpretation})]}),e.jsxs(g,{mb:3,children:[e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Signal Strength"}),e.jsx(X,{label:E,color:E.includes("Strong")?"error":E.includes("Recession")?"warning":"success",size:"large"})]}),e.jsx(Fe,{sx:{mb:2}}),e.jsx(d,{variant:"h6",mb:2,children:"Historical Context"}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Historical Accuracy"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[ul(c.yieldCurve?.historicalAccuracy),"%"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Average Lead Time"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[ox(c.yieldCurve?.averageLeadTime)," ","months"]})]}),e.jsx(g,{mt:3,children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["The yield curve has inverted before"," ",ul(c.yieldCurve?.historicalAccuracy),"% of recessions since 1970, with an average lead time of"," ",ox(c.yieldCurve?.averageLeadTime)," ","months."]})})]})]})})]})}),e.jsx(Yd,{value:r,index:2,children:e.jsx(y,{container:!0,spacing:3,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Economic Scenario Analysis"}),e.jsx(U,{children:e.jsx(y,{container:!0,spacing:3,children:c.scenarios?.map((k,S)=>e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{variant:"outlined",sx:{border:o===k.name?.toLowerCase().replace(" ","")?2:1,borderColor:o===k.name?.toLowerCase().replace(" ","")?"primary.main":"divider"},children:e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:2,children:[e.jsx(d,{variant:"h6",children:k.name}),e.jsx(X,{label:`${k.probability}% probability`,color:k.name==="Base Case"?"primary":k.name==="Bull Case"?"success":"error",size:"small"})]}),e.jsx(g,{mb:3,children:e.jsx(d,{variant:"body2",color:"text.secondary",children:k.description})}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"GDP Growth"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[k.gdpGrowth,"%"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Unemployment"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[k.unemployment,"%"]})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Fed Funds Rate"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:[k.fedRate,"%"]})]}),e.jsx(oe,{variant:o===k.name?.toLowerCase().replace(" ","")?"contained":"outlined",fullWidth:!0,onClick:()=>l(k.name?.toLowerCase().replace(" ","")),children:"Analyze Scenario"})]})})},S))})})]})})})})]})]})},Xd={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"http://localhost:5001",VITE_API_URL:"http://localhost:5001",VITE_AWS_REGION:"us-east-1",VITE_BUILD_TIME:"2025-10-14T23:12:33.527Z",VITE_COGNITO_CLIENT_ID:"",VITE_COGNITO_DOMAIN:"",VITE_COGNITO_REDIRECT_SIGN_IN:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_REDIRECT_SIGN_OUT:"https://CLOUDFRONT_DOMAIN_PLACEHOLDER",VITE_COGNITO_USER_POOL_ID:"",VITE_DEV_TOOLS:"true",VITE_ENABLE_DEBUG:"false",VITE_ENABLE_MOCK_DATA:"false",VITE_ENVIRONMENT:"production",VITE_FORCE_DEV_AUTH:"true",VITE_LOCAL_API_URL:"http://localhost:5001",VITE_LOG_LEVEL:"debug",VITE_MOCK_API:"true",VITE_MOCK_WS:"true",VITE_MODE:"development",VITE_NODE_ENV:"development",VITE_SERVERLESS:"true",VITE_VERSION:"1.0.0-dev",VITE_WEBSOCKET_ENABLED:"true",VITE_WEBSOCKET_URL:"ws://localhost:3002",VITE_WS_URL:"ws://localhost:3002"};function Ci({children:r,value:t,index:s,...n}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`settings-tabpanel-${s}`,"aria-labelledby":`settings-tab-${s}`,...n,children:t===s&&e.jsx(g,{sx:{py:3},children:r})})}const vN=()=>{jc("Settings");const{user:r,isAuthenticated:t,isLoading:s,logout:n,checkAuthState:i}=ps(),a=On(),o=j.useMemo(()=>Xt(),[]),{apiUrl:l}=o,c=j.useMemo(()=>Qn("Settings"),[]),[h,u]=j.useState(0),[m,p]=j.useState(!1),[x,b]=j.useState({open:!1,message:"",severity:"success"}),[w,C]=j.useState([]),[A,_]=j.useState(!1),[R,E]=j.useState({}),[T,M]=j.useState({brokerName:"",apiKey:"",apiSecret:"",sandbox:!0}),[I,N]=j.useState({firstName:"",lastName:"",email:"",phone:"",timezone:"America/New_York",currency:"USD"}),[k,S]=j.useState({open:!1,currentPassword:"",newPassword:"",confirmPassword:"",errors:{}}),[L,W]=j.useState({email:!0,push:!0,priceAlerts:!0,portfolioUpdates:!0,marketNews:!1,weeklyReports:!0}),[F,$]=j.useState({darkMode:!1,primaryColor:"#1976d2",chartStyle:"candlestick",layout:"standard"}),q=j.useCallback(async()=>{try{const B=await St.getApiKeys();if(B&&B.ok){const pe=B.data||{},je=Object.entries(pe).map(([xe,v])=>({brokerName:xe,...v,createdAt:v.lastValidated||new Date().toISOString()}));C(je)}else throw new Error(`API keys endpoint failed: ${B?.status||"unknown"}`)}catch(B){throw c.error("Load API Keys Failed",B,{userId:r?.sub||r?.id,apiUrl:l,operation:"loadApiKeys",responseStatus:B.response?.status,responseData:B.response?.data}),C([]),B}},[l,c,r?.id,r?.sub]),ne=j.useCallback(async()=>{try{p(!0),N({firstName:r?.firstName||"",lastName:r?.lastName||"",email:r?.email||"",phone:r?.phone||"",timezone:r?.timezone||"America/New_York",currency:r?.currency||"USD"});try{await q()}catch(B){c.error("API Keys Loading Failed",B,{userId:r?.sub||r?.id,apiUrl:l,operation:"loadApiKeys",context:"settings initialization"}),H(`Failed to load API keys: ${B.message}`,"error")}try{const B=await fetch(`${l}/api/settings/preferences`,{headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(B.ok){const pe=await B.json();W(je=>({...je,...pe.preferences}))}else B.status===404&&console.log("Notifications endpoint not implemented, using defaults")}catch{console.log("Failed to load notification preferences, using defaults")}try{const B=await fetch(`${l}/api/settings/preferences`,{headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(B.ok){const pe=await B.json();$(je=>({...je,...pe.preferences}))}else B.status===404&&console.log("Theme endpoint not implemented, using defaults")}catch{console.log("Failed to load theme preferences, using defaults")}}catch{H("Failed to load settings","error"),N({firstName:"",lastName:"",email:"",phone:"",timezone:"America/New_York",currency:"USD"})}finally{p(!1)}},[l,c,q,r?.currency,r?.email,r?.firstName,r?.id,r?.lastName,r?.phone,r?.sub,r?.timezone,r?.tokens?.accessToken]),he=j.useRef(!1),re=j.useRef(ne);j.useEffect(()=>{re.current=ne},[ne]),j.useEffect(()=>{t&&!he.current&&!m&&(he.current=!0,c.info("User authenticated, loading settings",{userId:r?.sub||r?.id,email:r?.email}),re.current())},[t,m,c,r?.email,r?.id,r?.sub]),j.useEffect(()=>{!s&&!r&&!t&&Xd&&(c.error("No authenticated session found",new Error("Session check failed"),{isAuthenticated:t,isLoading:s,hasUser:!!r}),i().catch(B=>{c.error("Session recovery failed",B)}))},[s,t,r,i,c]);const G=(B,pe)=>{u(pe)},H=(B,pe="success")=>{b({open:!0,message:B,severity:pe})},P=async()=>{try{p(!0);const B=await fetch(`${l}/api/user/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`},body:JSON.stringify(I)});if(B.ok){const pe=await B.json();H("Profile updated successfully"),pe.user&&await ne()}else{const pe=await B.json();c.error("Profile Update Failed",new Error(`Profile update rejected: ${B.status}`),{userId:r?.sub||r?.id,profileData:I,responseStatus:B.status,errorData:pe,operation:"updateProfile"}),H(pe.error||"Failed to update profile","error")}}catch(B){c.error("Profile Save Error",B,{userId:r?.sub||r?.id,profileData:I,operation:"handleSaveProfile",context:"network or server error"}),H("Failed to update profile","error")}finally{p(!1)}},D=async()=>{try{p(!0);const B=await St.saveApiKey(T);if(B&&B.ok)H("API key added successfully"),_(!1),M({brokerName:"",apiKey:"",apiSecret:"",sandbox:!0}),await q();else{const pe=await B.json();H(pe.error||"Failed to add API key","error")}}catch{H("Failed to add API key","error")}finally{p(!1)}},Y=async B=>{try{await St.deleteApiKey(B),H("API key deleted successfully"),await q()}catch{H("Failed to delete API key","error")}},ce=async()=>{try{p(!0);const B=await St.updateSettings({preferences:{...F,...L}});B.ok?H("Notification preferences updated successfully"):H(B.error||"Failed to update notification preferences","error")}catch{H("Failed to update notification preferences","error")}finally{p(!1)}},ae=async()=>{try{p(!0);const B=await St.updateSettings({preferences:{...F,...L}});B.ok?H("Theme preferences updated successfully"):H(B.error||"Failed to update theme preferences","error")}catch{H("Failed to update theme preferences","error")}finally{p(!1)}},ee=async()=>{S({open:!0,currentPassword:"",newPassword:"",confirmPassword:"",errors:{}})},te=()=>{const B={};return k.currentPassword||(B.currentPassword="Current password is required"),k.newPassword?k.newPassword.length<8?B.newPassword="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(k.newPassword)||(B.newPassword="Password must contain uppercase, lowercase, and number"):B.newPassword="New password is required",k.newPassword!==k.confirmPassword&&(B.confirmPassword="Passwords do not match"),k.currentPassword===k.newPassword&&(B.newPassword="New password must be different from current password"),B},Pe=async()=>{const B=te();if(Object.keys(B).length>0){S(pe=>({...pe,errors:B}));return}try{p(!0);const pe=await fetch(`${l}/api/user/change-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`},body:JSON.stringify({currentPassword:k.currentPassword,newPassword:k.newPassword})});if(pe.ok)H("Password changed successfully","success"),S({open:!1,currentPassword:"",newPassword:"",confirmPassword:"",errors:{}});else{const je=await pe.json();pe.status===401?S(xe=>({...xe,errors:{currentPassword:"Current password is incorrect"}})):H(je.message||"Failed to change password","error")}}catch{H("Network error. Please try again.","error")}finally{p(!1)}},Be=()=>{S({open:!1,currentPassword:"",newPassword:"",confirmPassword:"",errors:{}})},et=async()=>{try{p(!0);const B=r?.twoFactorEnabled?"disable":"enable",pe=await fetch(`${l}/api/user/two-factor/${B}`,{method:"POST",headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(pe.ok){const je=await pe.json();H(r?.twoFactorEnabled?"Two-factor authentication disabled":"Two-factor authentication enabled"),!r?.twoFactorEnabled&&je.qrCode&&H("Please scan the QR code with your authenticator app","info"),await ne()}else{const je=await pe.json();H(je.error||"Failed to toggle two-factor authentication","error")}}catch{H("Failed to toggle two-factor authentication","error")}finally{p(!1)}},De=async()=>{try{p(!0);const B=await fetch(`${l}/api/user/recovery-codes`,{headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(B.ok){const je=(await B.json()).codes.join(`
`),xe=new Blob([je],{type:"text/plain"}),v=URL.createObjectURL(xe),ie=document.createElement("a");ie.href=v,ie.download="recovery-codes.txt",ie.click(),URL.revokeObjectURL(v),H("Recovery codes downloaded successfully","success")}else{const pe=await B.json();H(pe.error||"Failed to download recovery codes","error")}}catch{H("Failed to download recovery codes","error")}finally{p(!1)}},ze=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone.")&&window.confirm('This will permanently delete all your data. Type "DELETE" to confirm.')&&window.prompt('Type "DELETE" to confirm account deletion:')==="DELETE")try{p(!0);const pe=await fetch(`${l}/api/user/delete-account`,{method:"DELETE",headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(pe.ok)H("Account deleted successfully","success"),await n(),a("/");else{const je=await pe.json();H(je.error||"Failed to delete account","error")}}catch{H("Failed to delete account","error")}finally{p(!1)}},ve=async()=>{if(window.confirm("This will sign you out of all devices except this one. Continue?"))try{p(!0);const B=await fetch(`${l}/api/user/revoke-sessions`,{method:"POST",headers:{Authorization:`Bearer ${r?.tokens?.accessToken||"dev-token"}`}});if(B.ok)H("All other sessions have been revoked","success");else{const pe=await B.json();H(pe.error||"Failed to revoke sessions","error")}}catch{H("Failed to revoke sessions","error")}finally{p(!1)}};return m||s?e.jsx(lt,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:e.jsx(Je,{size:60})})}):!r&&!s?(Xd?c.error("Authentication Error",new Error("Unable to load user information"),{userObject:r,isAuthenticated:t,isLoading:s,apiUrl:l,reason:"No user object available after authentication loading completed",suggestedActions:["refresh page","login again","check session"],url:window.location.href}):console.log("🔧 DEV: Settings page - no authenticated user, showing login prompt"),e.jsx(lt,{maxWidth:"lg",sx:{mt:4,mb:4},children:e.jsx(we,{severity:"warning",action:e.jsx(oe,{color:"inherit",size:"small",onClick:()=>window.location.reload(),"aria-label":"Refresh page to re-authenticate",children:"Refresh"}),children:"Unable to load user information. This may be due to an expired session or authentication issue."})})):e.jsxs(lt,{maxWidth:"lg",sx:{mt:4,mb:4},"data-testid":"settings-page",children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Account Settings"}),e.jsx(d,{variant:"subtitle1",color:"text.secondary",sx:{mb:4},children:"Manage your account preferences, API connections, and security settings"}),e.jsxs(He,{sx:{width:"100%"},children:[e.jsxs(Ir,{value:h,onChange:G,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},"aria-label":"Settings navigation tabs",children:[e.jsx(it,{value:0,icon:e.jsx(Tx,{}),label:"Profile","aria-label":"Profile settings"}),e.jsx(it,{value:1,icon:e.jsx(Jd,{}),label:"API Keys","data-testid":"api-keys-tab","aria-label":"API keys management"}),e.jsx(it,{value:2,icon:e.jsx(Il,{}),label:"Notifications","aria-label":"Notification preferences"}),e.jsx(it,{value:3,icon:e.jsx(MS,{}),label:"Appearance","aria-label":"Appearance and theme settings"}),e.jsx(it,{value:4,icon:e.jsx(kr,{}),label:"Security","aria-label":"Security and account settings"}),e.jsx(it,{value:5,icon:e.jsx(LS,{}),label:"Privacy","aria-label":"Privacy settings and data management"})]}),e.jsx(Ci,{value:h,index:0,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Personal Information"}),e.jsxs(U,{children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{fullWidth:!0,label:"First Name",value:I.firstName,onChange:B=>N({...I,firstName:B.target.value})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{fullWidth:!0,label:"Last Name",value:I.lastName,onChange:B=>N({...I,lastName:B.target.value})})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(_e,{fullWidth:!0,label:"Email",type:"email",value:I.email,onChange:B=>N({...I,email:B.target.value})})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Timezone"}),e.jsxs(pt,{value:I.timezone,onChange:B=>N({...I,timezone:B.target.value}),children:[e.jsx(J,{value:"America/New_York",children:"Eastern Time"}),e.jsx(J,{value:"America/Chicago",children:"Central Time"}),e.jsx(J,{value:"America/Denver",children:"Mountain Time"}),e.jsx(J,{value:"America/Los_Angeles",children:"Pacific Time"}),e.jsx(J,{value:"Europe/London",children:"London"}),e.jsx(J,{value:"Asia/Tokyo",children:"Tokyo"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Currency"}),e.jsxs(pt,{value:I.currency,onChange:B=>N({...I,currency:B.target.value}),children:[e.jsx(J,{value:"USD",children:"USD - US Dollar"}),e.jsx(J,{value:"EUR",children:"EUR - Euro"}),e.jsx(J,{value:"GBP",children:"GBP - British Pound"}),e.jsx(J,{value:"CAD",children:"CAD - Canadian Dollar"})]})]})})]}),e.jsxs(g,{sx:{mt:3,display:"flex",gap:2},children:[e.jsx(oe,{variant:"contained",startIcon:e.jsx(Ni,{}),onClick:P,disabled:m,"aria-label":"Save profile changes",children:"Save Changes"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Ax,{}),onClick:ne,"aria-label":"Cancel and reset profile changes",children:"Reset"})]})]})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Account Overview"}),e.jsxs(U,{children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(Mt,{sx:{mr:2,width:56,height:56},children:(r?.firstName?.[0]||r?.username?.[0]||"U").toUpperCase()}),e.jsxs(g,{children:[e.jsxs(d,{variant:"h6",children:[r?.firstName||"Unknown"," ",r?.lastName||"User"]}),e.jsx(d,{color:"text.secondary",children:r?.email||"No email provided"})]})]}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(jr,{dense:!0,"aria-label":"Account information",children:[e.jsxs(Dt,{children:[e.jsx(Ut,{primary:"Account Status",secondary:"Active"}),e.jsx(Zf,{children:e.jsx(X,{label:"Active",color:"success",size:"small"})})]}),e.jsx(Dt,{children:e.jsx(Ut,{primary:"Member Since",secondary:new Date(r?.createdAt||Date.now()).toLocaleDateString()})})]})]})]})})]})}),e.jsx(Ci,{value:h,index:1,children:e.jsx(y,{container:!0,spacing:4,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"API Keys",subheader:"Manage your API keys for data providers and trading platforms",action:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>_(!0),"data-testid":"add-api-key-button","aria-label":"Add new API key",children:"Add API Key"})}),e.jsx(U,{children:w.length===0?e.jsx(we,{severity:"info",sx:{mb:2},children:"No API keys configured. Add your first API key to start accessing real market data."}):e.jsx(y,{container:!0,spacing:2,children:w.map(B=>e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{variant:"outlined",children:e.jsx(U,{children:e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",children:B.brokerName}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Added:"," ",new Date(B.createdAt).toLocaleDateString()]})]}),e.jsxs(g,{children:[e.jsx(X,{label:B.status||"Active",color:B.status==="active"?"success":"default",size:"small"}),e.jsx(Ge,{onClick:()=>Y(B.brokerName),color:"error","aria-label":`Delete ${B.brokerName} API key`,children:e.jsx(mc,{})})]})]})})})},B.brokerName))})})]})})})}),e.jsx(Ci,{value:h,index:2,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Notification Preferences",action:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Ni,{}),onClick:ce,disabled:m,"aria-label":"Save notification preferences",children:"Save"})}),e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Delivery Methods"}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(Jt,{control:e.jsx(rs,{checked:L.email,onChange:B=>W({...L,email:B.target.checked})}),label:"Email Notifications"}),e.jsx(Jt,{control:e.jsx(rs,{checked:L.push,onChange:B=>W({...L,push:B.target.checked})}),label:"Push Notifications"})]})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Content Types"}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(Jt,{control:e.jsx(rs,{checked:L.priceAlerts,onChange:B=>W({...L,priceAlerts:B.target.checked})}),label:"Price Alerts"}),e.jsx(Jt,{control:e.jsx(rs,{checked:L.portfolioUpdates,onChange:B=>W({...L,portfolioUpdates:B.target.checked})}),label:"Portfolio Updates"}),e.jsx(Jt,{control:e.jsx(rs,{checked:L.marketNews,onChange:B=>W({...L,marketNews:B.target.checked})}),label:"Market News"}),e.jsx(Jt,{control:e.jsx(rs,{checked:L.weeklyReports,onChange:B=>W({...L,weeklyReports:B.target.checked})}),label:"Weekly Reports"})]})]})]})})]})}),e.jsx(Ci,{value:h,index:3,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Appearance Settings",action:e.jsx(oe,{variant:"contained",startIcon:e.jsx(Ni,{}),onClick:ae,disabled:m,"aria-label":"Save appearance settings",children:"Save"})}),e.jsx(U,{children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Theme Settings"}),e.jsx(g,{sx:{mb:2},children:e.jsx(Jt,{control:e.jsx(rs,{checked:F.darkMode,onChange:B=>$({...F,darkMode:B.target.checked})}),label:"Dark Mode"})}),e.jsxs(ft,{fullWidth:!0,sx:{mb:2},children:[e.jsx(mt,{children:"Primary Color"}),e.jsxs(pt,{value:F.primaryColor,onChange:B=>$({...F,primaryColor:B.target.value}),children:[e.jsx(J,{value:"#1976d2",children:"Blue"}),e.jsx(J,{value:"#2e7d32",children:"Green"}),e.jsx(J,{value:"#ed6c02",children:"Orange"}),e.jsx(J,{value:"#9c27b0",children:"Purple"}),e.jsx(J,{value:"#d32f2f",children:"Red"})]})]}),e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{children:"Layout Style"}),e.jsxs(pt,{value:F.layout,onChange:B=>$({...F,layout:B.target.value}),children:[e.jsx(J,{value:"standard",children:"Standard"}),e.jsx(J,{value:"compact",children:"Compact"}),e.jsx(J,{value:"spacious",children:"Spacious"})]})]})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Chart Settings"}),e.jsxs(ft,{fullWidth:!0,sx:{mb:2},children:[e.jsx(mt,{children:"Default Chart Style"}),e.jsxs(pt,{value:F.chartStyle,onChange:B=>$({...F,chartStyle:B.target.value}),children:[e.jsx(J,{value:"candlestick",children:"Candlestick"}),e.jsx(J,{value:"line",children:"Line"}),e.jsx(J,{value:"area",children:"Area"}),e.jsx(J,{value:"bar",children:"Bar"})]})]}),e.jsx(we,{severity:"info",children:"Theme changes will be applied immediately. Some changes may require a page refresh."})]})]})})]})}),e.jsx(Ci,{value:h,index:4,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Password & Authentication"}),e.jsxs(U,{children:[e.jsx(oe,{variant:"outlined",fullWidth:!0,sx:{mb:2},startIcon:e.jsx(kr,{}),onClick:ee,disabled:m,"aria-label":"Change account password",children:"Change Password"}),e.jsxs(oe,{variant:"outlined",fullWidth:!0,sx:{mb:2},startIcon:e.jsx(kr,{}),onClick:et,disabled:m,"aria-label":`${r?.twoFactorEnabled?"Disable":"Enable"} two-factor authentication`,children:[r?.twoFactorEnabled?"Disable":"Enable"," Two-Factor Authentication"]}),e.jsx(oe,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(Kr,{}),onClick:De,disabled:m||!r?.twoFactorEnabled,"aria-label":"Download two-factor authentication recovery codes",children:"Download Recovery Codes"})]})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Account Actions"}),e.jsxs(U,{children:[e.jsx(oe,{variant:"outlined",fullWidth:!0,onClick:n,sx:{mb:2},disabled:m,"aria-label":"Sign out of account",children:"Sign Out"}),e.jsx(oe,{variant:"outlined",color:"error",fullWidth:!0,startIcon:e.jsx(Ar,{}),onClick:ze,disabled:m,"aria-label":"Delete account permanently",children:"Delete Account"})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Active Sessions"}),e.jsxs(U,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage your active login sessions across different devices."}),e.jsx(jr,{"aria-label":"Active sessions",children:e.jsxs(Dt,{children:[e.jsx(Sr,{children:e.jsx(Yr,{color:"success"})}),e.jsx(Ut,{primary:"Current Session",secondary:`${navigator.userAgent.includes("Chrome")?"Chrome":"Browser"} on ${navigator.platform} - ${new Date().toLocaleString()}`}),e.jsx(Zf,{children:e.jsx(X,{label:"Current",color:"primary",size:"small"})})]})}),e.jsx(oe,{variant:"outlined",color:"warning",startIcon:e.jsx(kr,{}),onClick:ve,disabled:m,"aria-label":"Revoke all other active sessions",children:"Revoke All Other Sessions"})]})]})})]})}),e.jsx(Ci,{value:h,index:5,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Data Privacy"}),e.jsxs(U,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Control how your data is collected, stored, and used."}),e.jsx(Jt,{control:e.jsx(rs,{defaultChecked:!0}),label:"Allow analytics collection",sx:{mb:2}}),e.jsx(Jt,{control:e.jsx(rs,{defaultChecked:!0}),label:"Share usage data for improvements",sx:{mb:2}}),e.jsx(Jt,{control:e.jsx(rs,{}),label:"Allow marketing communications",sx:{mb:2}}),e.jsx(oe,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(Kr,{}),sx:{mt:2},children:"Download My Data"})]})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Data Retention"}),e.jsxs(U,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage how long your data is stored in our systems."}),e.jsxs(ft,{fullWidth:!0,sx:{mb:2},children:[e.jsx(mt,{children:"Trading History Retention"}),e.jsxs(pt,{defaultValue:"12months",label:"Trading History Retention",children:[e.jsx(J,{value:"3months",children:"3 Months"}),e.jsx(J,{value:"6months",children:"6 Months"}),e.jsx(J,{value:"12months",children:"12 Months"}),e.jsx(J,{value:"forever",children:"Keep Forever"})]})]}),e.jsxs(ft,{fullWidth:!0,sx:{mb:2},children:[e.jsx(mt,{children:"Analytics Data Retention"}),e.jsxs(pt,{defaultValue:"6months",label:"Analytics Data Retention",children:[e.jsx(J,{value:"30days",children:"30 Days"}),e.jsx(J,{value:"3months",children:"3 Months"}),e.jsx(J,{value:"6months",children:"6 Months"}),e.jsx(J,{value:"never",children:"Don't Store"})]})]})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Account Data Management"}),e.jsxs(U,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Request actions regarding your personal data."}),e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:4,children:e.jsx(oe,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(Kr,{}),children:"Export Data"})}),e.jsx(y,{item:!0,xs:12,sm:4,children:e.jsx(oe,{variant:"outlined",color:"warning",fullWidth:!0,startIcon:e.jsx(Ar,{}),children:"Request Data Deletion"})}),e.jsx(y,{item:!0,xs:12,sm:4,children:e.jsx(oe,{variant:"outlined",color:"info",fullWidth:!0,children:"Privacy Report"})})]}),e.jsx(we,{severity:"info",sx:{mt:2},children:"Data export and deletion requests may take up to 30 days to process."})]})]})})]})})]}),e.jsxs(Os,{open:A,onClose:()=>_(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ls,{children:"Add Broker API Key"}),e.jsxs(ks,{children:[e.jsxs(y,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(ft,{fullWidth:!0,children:[e.jsx(mt,{id:"broker-select-label",children:"Broker"}),e.jsxs(pt,{labelId:"broker-select-label",id:"broker-select",label:"Broker",value:T.brokerName,onChange:B=>M({...T,brokerName:B.target.value}),children:[e.jsx(J,{value:"alpaca","data-provider":"alpaca",children:"Alpaca"}),e.jsx(J,{value:"polygon","data-provider":"polygon",children:"Polygon"})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(_e,{fullWidth:!0,label:"API Key",type:R.apiKey?"text":"password",value:T.apiKey,"data-testid":"api-key-input",onChange:B=>M({...T,apiKey:B.target.value}),InputProps:{endAdornment:e.jsx(Ge,{onClick:()=>E({...R,apiKey:!R.apiKey}),"aria-label":R.apiKey?"Hide API key":"Show API key",children:R.apiKey?e.jsx(di,{}):e.jsx(jn,{})})}})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(_e,{fullWidth:!0,label:"API Secret",type:R.apiSecret?"text":"password",value:T.apiSecret,onChange:B=>M({...T,apiSecret:B.target.value}),InputProps:{endAdornment:e.jsx(Ge,{onClick:()=>E({...R,apiSecret:!R.apiSecret}),"aria-label":R.apiSecret?"Hide API secret":"Show API secret",children:R.apiSecret?e.jsx(di,{}):e.jsx(jn,{})})}})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(Jt,{control:e.jsx(rs,{checked:T.sandbox,onChange:B=>M({...T,sandbox:B.target.checked})}),label:"Sandbox Environment (recommended for testing)"})})]}),e.jsx(we,{severity:"info",sx:{mt:2},children:"API keys are encrypted and stored securely. We recommend starting with sandbox mode for testing."})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>_(!1),"aria-label":"Cancel adding API key",children:"Cancel"}),e.jsx(oe,{onClick:D,variant:"contained",disabled:!T.brokerName||!T.apiKey||m,"aria-label":"Add new API key",children:"Add API Key"})]})]}),e.jsxs(Os,{open:k.open,onClose:Be,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ls,{children:"Change Password"}),e.jsxs(ks,{children:[e.jsx(_e,{autoFocus:!0,margin:"dense",label:"Current Password",type:"password",fullWidth:!0,variant:"outlined",value:k.currentPassword,onChange:B=>S(pe=>({...pe,currentPassword:B.target.value,errors:{...pe.errors,currentPassword:""}})),error:!!k.errors.currentPassword,helperText:k.errors.currentPassword,sx:{mb:2}}),e.jsx(_e,{margin:"dense",label:"New Password",type:"password",fullWidth:!0,variant:"outlined",value:k.newPassword,onChange:B=>S(pe=>({...pe,newPassword:B.target.value,errors:{...pe.errors,newPassword:""}})),error:!!k.errors.newPassword,helperText:k.errors.newPassword||"Must be at least 8 characters with uppercase, lowercase, and number",sx:{mb:2}}),e.jsx(_e,{margin:"dense",label:"Confirm New Password",type:"password",fullWidth:!0,variant:"outlined",value:k.confirmPassword,onChange:B=>S(pe=>({...pe,confirmPassword:B.target.value,errors:{...pe.errors,confirmPassword:""}})),error:!!k.errors.confirmPassword,helperText:k.errors.confirmPassword,onKeyPress:B=>{B.key==="Enter"&&Pe()}})]}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:Be,children:"Cancel"}),e.jsx(oe,{onClick:Pe,variant:"contained",disabled:m,startIcon:m&&e.jsx(Je,{size:20}),children:m?"Changing...":"Change Password"})]})]}),e.jsx(FS,{open:x.open,autoHideDuration:6e3,onClose:()=>b({...x,open:!1}),children:e.jsx(we,{onClose:()=>b({...x,open:!1}),severity:x.severity,sx:{width:"100%"},children:x.message})})]})},wN="modulepreload",SN=function(r){return"/"+r},lx={},cx=function(t,s,n){let i=Promise.resolve();if(s&&s.length>0){let c=function(h){return Promise.all(h.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");i=c(s.map(h=>{if(h=SN(h),h in lx)return;lx[h]=!0;const u=h.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":wN,u||(p.as="script"),p.crossOrigin="",p.href=h,l&&p.setAttribute("nonce",l),document.head.appendChild(p),u)return new Promise((x,b)=>{p.addEventListener("load",x),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})},ON=({signal:r,confidence:t=.75,size:s="medium",showConfidence:n=!1})=>{const i=Zs(),o=(c=>{switch(c?.toUpperCase()){case"BUY":return{color:i.palette.success.main,bgColor:Xe(i.palette.success.main,.1),icon:e.jsx(at,{sx:{fontSize:s==="small"?16:20}}),label:"BUY",textColor:i.palette.success.dark};case"SELL":return{color:i.palette.error.main,bgColor:Xe(i.palette.error.main,.1),icon:e.jsx(Tt,{sx:{fontSize:s==="small"?16:20}}),label:"SELL",textColor:i.palette.error.dark};case"HOLD":return{color:i.palette.warning.main,bgColor:Xe(i.palette.warning.main,.1),icon:e.jsx(Gt,{sx:{fontSize:s==="small"?16:20}}),label:"HOLD",textColor:i.palette.warning.dark};default:return{color:i.palette.grey[500],bgColor:Xe(i.palette.grey[500],.1),icon:e.jsx(ux,{sx:{fontSize:s==="small"?16:20}}),label:"N/A",textColor:i.palette.grey[600]}}})(r),l=Math.round(t*100);return e.jsx(tt,{title:n?`Signal: ${o.label} (${l}% confidence)`:`Trading Signal: ${o.label}`,children:e.jsxs(g,{sx:{display:"inline-flex",alignItems:"center",gap:.5,px:s==="small"?1:1.5,py:s==="small"?.25:.5,borderRadius:2,backgroundColor:o.bgColor,border:`1px solid ${Xe(o.color,.3)}`,minWidth:s==="small"?60:80,justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:Xe(o.color,.15),borderColor:Xe(o.color,.5),transform:"translateY(-1px)"}},children:[o.icon,e.jsx(d,{variant:s==="small"?"caption":"body2",sx:{color:o.textColor,fontWeight:600,fontSize:s==="small"?"0.65rem":"0.75rem"},children:o.label}),n&&e.jsxs(d,{variant:"caption",sx:{color:Xe(o.textColor,.7),fontSize:"0.6rem",ml:.5},children:[l,"%"]})]})})},kN=({score:r,size:t=60,showGrade:s=!1})=>{const n=Zs(),i=o=>o>=80?n.palette.success.main:o>=60?n.palette.warning.main:o>=40?n.palette.info.main:n.palette.error.main,a=o=>o>=90?"A+":o>=85?"A":o>=80?"A-":o>=75?"B+":o>=70?"B":o>=65?"B-":o>=60?"C+":o>=55?"C":o>=50?"C-":o>=45?"D+":o>=40?"D":"F";return e.jsx(g,{sx:{position:"relative",width:t,height:t,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(g,{sx:{width:t,height:t,borderRadius:"50%",background:`conic-gradient(${i(r)} ${r*3.6}deg, ${Xe(n.palette.action.disabled,.1)} 0deg)`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(g,{sx:{width:t-10,height:t-10,borderRadius:"50%",backgroundColor:n.palette.background.paper,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsx(d,{variant:"h6",fontWeight:700,fontSize:t>70?"1rem":"0.85rem",children:r}),s&&e.jsx(d,{variant:"caption",color:i(r),fontWeight:600,children:a(r)})]})})})},CN=()=>{const r=Zs(),[t,s]=j.useState(!0),[n,i]=j.useState([]),[a,o]=j.useState(""),[l,c]=j.useState(null),[h,u]=j.useState({}),[m,p]=j.useState(!1),[x,b]=j.useState(!1),[w,C]=j.useState(25),[A,_]=j.useState(!1),[R,E]=j.useState(0),[T,M]=j.useState(0),[I,N]=j.useState(0),[k,S]=j.useState(0),[L,W]=j.useState(0),[F,$]=j.useState("composite_score"),[q,ne]=j.useState("desc"),[he,re]=j.useState("all"),G=v=>{if(!v||v.length===0)return{};const ie=Z=>Z.reduce((K,ue)=>K+ue,0),Q=Z=>Z.length>0?ie(Z)/Z.length:0;return{quality:Q(v.map(Z=>Z.quality_score||0).filter(Z=>Z>0)),momentum:Q(v.map(Z=>Z.momentum_score||0).filter(Z=>Z>0)),value:Q(v.map(Z=>Z.value_score||0).filter(Z=>Z>0)),growth:Q(v.map(Z=>Z.growth_score||0).filter(Z=>Z>0)),positioning:Q(v.map(Z=>Z.positioning_score||0).filter(Z=>Z>0)),sentiment:Q(v.map(Z=>Z.sentiment_score||0).filter(Z=>Z>0)),risk:Q(v.map(Z=>Z.risk_score||0).filter(Z=>Z>0)),relative_strength:Q(v.map(Z=>Z.relative_strength_inputs?.relative_strength_score||0).filter(Z=>Z>0))}},H=(v,ie)=>{if(!ie||ie==="all"||!v||v.length===0)return{};const Q=v.filter(ue=>ue.sector===ie);if(Q.length===0)return{};const Z=ue=>ue.reduce(($e,Le)=>$e+Le,0),K=ue=>ue.length>0?Z(ue)/ue.length:0;return{quality:K(Q.map(ue=>ue.quality_score||0).filter(ue=>ue>0)),momentum:K(Q.map(ue=>ue.momentum_score||0).filter(ue=>ue>0)),value:K(Q.map(ue=>ue.value_score||0).filter(ue=>ue>0)),growth:K(Q.map(ue=>ue.growth_score||0).filter(ue=>ue>0)),positioning:K(Q.map(ue=>ue.positioning_score||0).filter(ue=>ue>0)),sentiment:K(Q.map(ue=>ue.sentiment_score||0).filter(ue=>ue>0)),risk:K(Q.map(ue=>ue.risk_score||0).filter(ue=>ue>0)),relative_strength:K(Q.map(ue=>ue.relative_strength_inputs?.relative_strength_score||0).filter(ue=>ue>0))}},P=v=>v.composite_score!==void 0?v:{symbol:v.symbol,composite_score:v.compositeScore||0,momentum_score:v.factors?.momentum?.score||0,value_score:v.factors?.value?.score||0,quality_score:v.factors?.quality?.score||0,growth_score:v.growth_score||0,positioning_score:v.positioning_score||0,sentiment_score:v.sentiment_score||0,risk_score:v.factors?.risk?.score||0,current_price:v.currentPrice||0,price_change_1d:v.priceChange1d||0,price_change_5d:v.factors?.technical?.priceChange5d||0,price_change_30d:v.factors?.technical?.priceChange30d||0,volatility_30d:v.factors?.quality?.volatility||v.factors?.risk?.volatility30d||0,market_cap:v.marketCap||0,volume_avg_30d:v.volume||0,pe_ratio:v.factors?.value?.peRatio||null,rsi:v.factors?.momentum?.rsi||0,sma_20:v.factors?.trend?.sma20||0,sma_50:v.factors?.trend?.sma50||0,macd:v.factors?.technical?.macd||null,last_updated:v.lastUpdated,score_date:v.scoreDate,momentum_components:v.factors?.momentum?.components||v.momentum_components||{},positioning_components:v.positioning_components||{}};j.useEffect(()=>{D()},[]),j.useEffect(()=>{n.length>0&&Y(n.slice(0,20))},[n]);const D=async()=>{s(!0);try{const{default:v}=await cx(async()=>{const{default:Q}=await Promise.resolve().then(()=>Rm);return{default:Q}},void 0),ie=await v.get("/api/scores");if(ie?.data?.success&&ie.data.data?.stocks){const Q=ie.data.data.stocks.map(P);i(Q)}else console.error("Invalid API response format:",ie),i([])}catch(v){console.error("Error loading scores:",v),i([])}finally{s(!1)}},Y=async v=>{if(!(m||v.length===0)){p(!0);try{const{default:ie}=await cx(async()=>{const{default:ue}=await Promise.resolve().then(()=>Rm);return{default:ue}},void 0),Q=v.map(async ue=>{try{const O=await ie.get(`/api/signals?symbol=${ue.symbol}&timeframe=daily&limit=1`);if(O?.data?.success&&O.data.data?.length>0){const Ce=O.data.data[0].signal;if(Ce&&Ce.toUpperCase()!=="NONE"&&["BUY","SELL","HOLD"].includes(Ce.toUpperCase()))return{symbol:ue.symbol,signal:Ce,confidence:O.data.data[0].confidence||.75,date:O.data.data[0].date}}}catch{}const Le=(O=>{const Ce=O.composite_score,At=O.momentum_score;return Ce>=80&&At>=75?{signal:"BUY",confidence:.85}:Ce>=70&&At>=65?{signal:"BUY",confidence:.75}:Ce<50||At<40?{signal:"SELL",confidence:.7}:{signal:"HOLD",confidence:.65}})(ue);return{symbol:ue.symbol,signal:Le.signal,confidence:Le.confidence,date:new Date().toISOString().split("T")[0]}}),Z=await Promise.all(Q),K={};Z.forEach(ue=>{ue&&(K[ue.symbol]=ue)}),u(ue=>({...ue,...K}))}catch(ie){console.error("Error loading signals:",ie)}finally{p(!1)}}},ce=[...new Set(n.map(v=>v.sector).filter(Boolean))].sort(),ae=n.filter(v=>{const ie=v.symbol.toLowerCase().includes(a.toLowerCase()),Q=v.composite_score>=R,Z=v.momentum_score>=T,K=v.quality_score>=I,ue=v.value_score>=k,$e=v.growth_score>=L,Le=he==="all"||v.sector===he;return ie&&Q&&Z&&K&&ue&&$e&&Le}).sort((v,ie)=>{let Q=0;const Z=v[F]||0;return Q=(ie[F]||0)-Z,q==="desc"?Q:-Q}),ee=A?ae:ae.slice(0,w),te=(v,ie=10,Q=null)=>[...Q&&Q!=="all"?n.filter(K=>K.sector===Q):n].sort((K,ue)=>(ue[v]||0)-(K[v]||0)).slice(0,ie),Pe=(v=5)=>{const ie={};return ce.forEach(Q=>{ie[Q]=[...n].filter(Z=>Z.sector===Q).sort((Z,K)=>(K.composite_score||0)-(Z.composite_score||0)).slice(0,v)}),ie},Be=te("quality_score",10,he),et=te("momentum_score",10,he),De=te("value_score",10,he),ze=te("growth_score",10,he),ve=te("positioning_score",10,he),B=te("sentiment_score",10,he),pe=Pe(5),je=v=>(ie,Q)=>{c(Q?v:null)},xe=()=>{o(""),E(0),M(0),N(0),S(0),W(0),re("all")};return t?e.jsx(lt,{maxWidth:"xl",sx:{py:4},children:e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(Je,{size:60})})}):e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsx(He,{elevation:0,sx:{textAlign:"center",mb:4,p:4,borderRadius:3,border:`1px solid ${r.palette.divider}`,background:r.palette.mode==="dark"?`linear-gradient(145deg, ${r.palette.background.paper}, ${Xe(r.palette.primary.main,.02)})`:`linear-gradient(145deg, ${r.palette.background.paper}, ${Xe(r.palette.primary.main,.03)})`},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:2,mb:2},children:[e.jsx(g,{sx:{width:60,height:60,borderRadius:"50%",background:`conic-gradient(${r.palette.primary.main} 90deg, ${r.palette.success.main} 90deg 180deg, ${r.palette.warning.main} 180deg 270deg, ${r.palette.error.main} 270deg)`,display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:e.jsx(g,{sx:{width:50,height:50,borderRadius:"50%",backgroundColor:r.palette.background.paper,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(d,{variant:"h4",sx:{fontWeight:700},children:"🎯"})})}),e.jsx(d,{variant:"h3",component:"h1",fontWeight:700,sx:{letterSpacing:"-0.5px"},children:"Bullseye Stock Screener"})]})}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(He,{sx:{p:2,textAlign:"center",background:`linear-gradient(135deg, ${Xe(r.palette.primary.main,.1)}, ${Xe(r.palette.primary.main,.05)})`,border:`1px solid ${r.palette.divider}`},children:[e.jsx(d,{variant:"h3",color:"primary",fontWeight:700,children:n.length}),e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:600,children:"Total Stocks Analyzed"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(He,{sx:{p:2,textAlign:"center",background:`linear-gradient(135deg, ${Xe(r.palette.success.main,.1)}, ${Xe(r.palette.success.main,.05)})`,border:`1px solid ${r.palette.divider}`},children:[e.jsx(d,{variant:"h3",color:"success.main",fontWeight:700,children:n.length>0?Math.max(...n.map(v=>v.composite_score)).toFixed(1):0}),e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:600,children:"Highest Overall Score"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(He,{sx:{p:2,textAlign:"center",background:`linear-gradient(135deg, ${Xe(r.palette.info.main,.1)}, ${Xe(r.palette.info.main,.05)})`,border:`1px solid ${r.palette.divider}`},children:[e.jsx(d,{variant:"h3",color:"info.main",fontWeight:700,children:n.length>0?(n.reduce((v,ie)=>v+ie.composite_score,0)/n.length).toFixed(1):0}),e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:600,children:"Market Average"})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(He,{sx:{p:2,textAlign:"center",background:`linear-gradient(135deg, ${Xe(r.palette.warning.main,.1)}, ${Xe(r.palette.warning.main,.05)})`,border:`1px solid ${r.palette.divider}`},children:[e.jsx(d,{variant:"h3",color:"warning.main",fontWeight:700,children:n.filter(v=>v.composite_score>=80).length}),e.jsx(d,{variant:"body2",color:"text.secondary",fontWeight:600,children:"High Quality Stocks (80+)"})]})})]}),e.jsx(He,{sx:{p:2,mb:3,border:`1px solid ${r.palette.divider}`,backgroundColor:Xe(r.palette.info.main,.02)},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(d,{variant:"body2",fontWeight:600,color:"text.secondary",children:"Score Guide:"}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(g,{sx:{width:60,height:8,borderRadius:1,backgroundColor:r.palette.success.main}}),e.jsx(d,{variant:"caption",children:"80-100 Excellent"})]}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(g,{sx:{width:60,height:8,borderRadius:1,backgroundColor:r.palette.warning.main}}),e.jsx(d,{variant:"caption",children:"60-79 Good"})]}),e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(g,{sx:{width:60,height:8,borderRadius:1,backgroundColor:r.palette.error.main}}),e.jsx(d,{variant:"caption",children:"0-59 Needs Improvement"})]})]})}),e.jsxs(He,{sx:{p:2,mb:3},children:[e.jsxs(g,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center",mb:x?2:0},children:[e.jsx(_e,{variant:"outlined",placeholder:"Search stocks by symbol...",value:a,onChange:v=>o(v.target.value),size:"small",sx:{minWidth:250,flex:1}}),e.jsxs(ft,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(mt,{children:"Sort By"}),e.jsxs(pt,{value:F,label:"Sort By",onChange:v=>$(v.target.value),children:[e.jsx(J,{value:"composite_score",children:"Composite"}),e.jsx(J,{value:"momentum_score",children:"Momentum"}),e.jsx(J,{value:"quality_score",children:"Quality"}),e.jsx(J,{value:"value_score",children:"Value"}),e.jsx(J,{value:"growth_score",children:"Growth"}),e.jsx(J,{value:"positioning_score",children:"Positioning"})]})]}),e.jsxs(ft,{variant:"outlined",size:"small",sx:{minWidth:120},children:[e.jsx(mt,{children:"Order"}),e.jsxs(pt,{value:q,label:"Order",onChange:v=>ne(v.target.value),children:[e.jsx(J,{value:"desc",children:"High to Low"}),e.jsx(J,{value:"asc",children:"Low to High"})]})]}),e.jsxs(ft,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(mt,{children:"Sector"}),e.jsxs(pt,{value:he,label:"Sector",onChange:v=>re(v.target.value),children:[e.jsx(J,{value:"all",children:"All Sectors"}),ce.map(v=>e.jsx(J,{value:v,children:v},v))]})]}),e.jsx(tt,{title:"Advanced Filters",children:e.jsx(Ge,{onClick:()=>b(!x),color:x?"primary":"default",children:e.jsx(Tr,{})})}),(a||R>0||T>0||I>0||k>0||L>0||he!=="all")&&e.jsx(tt,{title:"Clear All Filters",children:e.jsx(Ge,{onClick:xe,color:"error",size:"small",children:e.jsx(NS,{})})})]}),x&&e.jsx(g,{sx:{pt:2,borderTop:`1px solid ${r.palette.divider}`},children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Min Composite"}),e.jsxs(pt,{value:R,label:"Min Composite",onChange:v=>E(v.target.value),children:[e.jsx(J,{value:0,children:"All"}),e.jsx(J,{value:50,children:"50+"}),e.jsx(J,{value:60,children:"60+"}),e.jsx(J,{value:70,children:"70+"}),e.jsx(J,{value:80,children:"80+"}),e.jsx(J,{value:90,children:"90+"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Min Momentum"}),e.jsxs(pt,{value:T,label:"Min Momentum",onChange:v=>M(v.target.value),children:[e.jsx(J,{value:0,children:"All"}),e.jsx(J,{value:50,children:"50+"}),e.jsx(J,{value:60,children:"60+"}),e.jsx(J,{value:70,children:"70+"}),e.jsx(J,{value:80,children:"80+"}),e.jsx(J,{value:90,children:"90+"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Min Quality"}),e.jsxs(pt,{value:I,label:"Min Quality",onChange:v=>N(v.target.value),children:[e.jsx(J,{value:0,children:"All"}),e.jsx(J,{value:50,children:"50+"}),e.jsx(J,{value:60,children:"60+"}),e.jsx(J,{value:70,children:"70+"}),e.jsx(J,{value:80,children:"80+"}),e.jsx(J,{value:90,children:"90+"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Min Value"}),e.jsxs(pt,{value:k,label:"Min Value",onChange:v=>S(v.target.value),children:[e.jsx(J,{value:0,children:"All"}),e.jsx(J,{value:50,children:"50+"}),e.jsx(J,{value:60,children:"60+"}),e.jsx(J,{value:70,children:"70+"}),e.jsx(J,{value:80,children:"80+"}),e.jsx(J,{value:90,children:"90+"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(ft,{fullWidth:!0,size:"small",children:[e.jsx(mt,{children:"Min Growth"}),e.jsxs(pt,{value:L,label:"Min Growth",onChange:v=>W(v.target.value),children:[e.jsx(J,{value:0,children:"All"}),e.jsx(J,{value:50,children:"50+"}),e.jsx(J,{value:60,children:"60+"}),e.jsx(J,{value:70,children:"70+"}),e.jsx(J,{value:80,children:"80+"}),e.jsx(J,{value:90,children:"90+"})]})]})})]})})]}),e.jsxs(g,{sx:{mb:4},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(d,{variant:"h5",gutterBottom:!0,children:["Top Overall Stocks (",ae.length,")"]}),ae.length>w&&!A&&e.jsxs(oe,{variant:"outlined",size:"small",onClick:()=>_(!0),startIcon:e.jsx(Vt,{}),children:["Show All ",ae.length," Stocks"]}),A&&ae.length>w&&e.jsxs(oe,{variant:"outlined",size:"small",onClick:()=>_(!1),startIcon:e.jsx(Vt,{sx:{transform:"rotate(180deg)"}}),children:["Show Top ",w," Only"]})]}),ae.length===0?e.jsxs(He,{sx:{p:4,textAlign:"center"},children:[e.jsx(d,{variant:"h6",color:"text.secondary",children:"No stocks found matching your filters"}),e.jsx(oe,{variant:"outlined",onClick:xe,sx:{mt:2},children:"Clear Filters"})]}):e.jsx(g,{children:ee.map(v=>e.jsxs(is,{expanded:l===v.symbol,onChange:je(v.symbol),sx:{mb:1},children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{"&:hover":{backgroundColor:Xe(r.palette.primary.main,.02)}},children:e.jsxs(y,{container:!0,alignItems:"center",spacing:2,sx:{width:"100%"},children:[e.jsx(y,{item:!0,xs:"auto",children:e.jsx(kN,{score:Math.round(v.composite_score),size:70,showGrade:!0})}),e.jsx(y,{item:!0,xs:12,sm:"auto",sx:{flexGrow:{xs:1,sm:0},minWidth:{sm:200}},children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(d,{variant:"h5",fontWeight:700,children:v.symbol}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{lineHeight:1.2},children:v.company_name||"Company Name"}),h[v.symbol]&&e.jsx(g,{sx:{mt:.5},children:e.jsx(ON,{signal:h[v.symbol].signal,confidence:h[v.symbol].confidence,size:"small"})})]})}),e.jsx(y,{item:!0,xs:12,sm:!0,sx:{flexGrow:1},children:e.jsxs(y,{container:!0,spacing:1,children:[e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Quality"}),e.jsx(d,{variant:"caption",fontWeight:700,children:v.quality_score.toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.quality_score,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:v.quality_score>=80?r.palette.success.main:v.quality_score>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Momentum"}),e.jsx(d,{variant:"caption",fontWeight:700,children:v.momentum_score.toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.momentum_score,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:v.momentum_score>=80?r.palette.success.main:v.momentum_score>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Value"}),e.jsx(d,{variant:"caption",fontWeight:700,children:v.value_score.toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.value_score,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:v.value_score>=80?r.palette.success.main:v.value_score>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Growth"}),e.jsx(d,{variant:"caption",fontWeight:700,children:v.growth_score.toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.growth_score,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:v.growth_score>=80?r.palette.success.main:v.growth_score>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Positioning"}),e.jsx(d,{variant:"caption",fontWeight:700,children:v.positioning_score.toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.positioning_score,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:v.positioning_score>=80?r.palette.success.main:v.positioning_score>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Sentiment"}),e.jsx(d,{variant:"caption",fontWeight:700,children:(v.sentiment_score||0).toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.sentiment_score||0,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:(v.sentiment_score||0)>=80?r.palette.success.main:(v.sentiment_score||0)>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Rel. Strength"}),e.jsx(d,{variant:"caption",fontWeight:700,children:(v.relative_strength_inputs?.relative_strength_score||0).toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:v.relative_strength_inputs?.relative_strength_score||0,sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:(v.relative_strength_inputs?.relative_strength_score||0)>=80?r.palette.success.main:(v.relative_strength_inputs?.relative_strength_score||0)>=60?r.palette.warning.main:r.palette.error.main,borderRadius:1}}})]})}),e.jsx(y,{item:!0,xs:6,sm:4,children:e.jsxs(g,{children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(d,{variant:"caption",color:"text.secondary",fontWeight:600,children:"Risk"}),e.jsx(d,{variant:"caption",fontWeight:700,children:(v.risk_score||0).toFixed(0)})]}),e.jsx(rt,{variant:"determinate",value:Math.min(100,v.risk_score||0),sx:{height:8,borderRadius:1,backgroundColor:Xe(r.palette.action.disabled,.1),"& .MuiLinearProgress-bar":{backgroundColor:(v.risk_score||0)<30?r.palette.success.main:(v.risk_score||0)<50?r.palette.warning.main:(v.risk_score||0)<70?"#ff9800":r.palette.error.main,borderRadius:1}}}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem",mt:.5,display:"block"},children:(v.risk_score||0)<30?"Low":(v.risk_score||0)<50?"Moderate":(v.risk_score||0)<70?"High":"V. High"})]})})]})})]})}),e.jsx(os,{children:e.jsxs(g,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,sx:{mb:3},children:["Factor Analysis for ",v.symbol]}),(()=>{const ie=G(n),Q=H(n,v.sector);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(th,{sx:{color:r.palette.primary.main}}),e.jsx(d,{variant:"h6",children:"Quality & Fundamentals"}),e.jsx(X,{label:v.quality_score?.toFixed(1)||"N/A",color:v.quality_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Financial strength evaluation measuring profitability, balance sheet health, and operational efficiency"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.quality_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.quality||0},{name:"Market Avg",value:ie.quality||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Quality Score",children:[[e.jsx(xt,{fill:r.palette.primary.main},"stock"),e.jsx(xt,{fill:r.palette.info.main},"sector"),e.jsx(xt,{fill:r.palette.success.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Quality Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[!v.quality_inputs&&e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Quality metrics data loading..."})})}),v.quality_inputs&&Object.values(v.quality_inputs).every(Z=>Z==null)&&e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No detailed quality metrics available for this stock"})})}),v.quality_inputs&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Return on Equity (ROE)"}),e.jsx(f,{align:"right",children:v.quality_inputs.return_on_equity_pct!==null&&v.quality_inputs.return_on_equity_pct!==void 0?`${(v.quality_inputs.return_on_equity_pct*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Return on Assets (ROA)"}),e.jsx(f,{align:"right",children:v.quality_inputs.return_on_assets_pct!==null&&v.quality_inputs.return_on_assets_pct!==void 0?`${(v.quality_inputs.return_on_assets_pct*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Gross Margin"}),e.jsx(f,{align:"right",children:v.quality_inputs.gross_margin_pct!==null&&v.quality_inputs.gross_margin_pct!==void 0?`${(v.quality_inputs.gross_margin_pct*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Operating Margin"}),e.jsx(f,{align:"right",children:v.quality_inputs.operating_margin_pct!==null&&v.quality_inputs.operating_margin_pct!==void 0?`${(v.quality_inputs.operating_margin_pct*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Profit Margin"}),e.jsx(f,{align:"right",children:v.quality_inputs.profit_margin_pct!==null&&v.quality_inputs.profit_margin_pct!==void 0?`${(v.quality_inputs.profit_margin_pct*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"FCF / Net Income"}),e.jsx(f,{align:"right",children:v.quality_inputs.fcf_to_net_income!==null&&v.quality_inputs.fcf_to_net_income!==void 0?v.quality_inputs.fcf_to_net_income.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Operating CF / Net Income"}),e.jsx(f,{align:"right",children:v.quality_inputs.operating_cf_to_net_income!==null&&v.quality_inputs.operating_cf_to_net_income!==void 0?v.quality_inputs.operating_cf_to_net_income.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Debt-to-Equity Ratio"}),e.jsx(f,{align:"right",children:v.quality_inputs.debt_to_equity!==null&&v.quality_inputs.debt_to_equity!==void 0?v.quality_inputs.debt_to_equity.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Current Ratio"}),e.jsx(f,{align:"right",children:v.quality_inputs.current_ratio!==null&&v.quality_inputs.current_ratio!==void 0?v.quality_inputs.current_ratio.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Quick Ratio"}),e.jsx(f,{align:"right",children:v.quality_inputs.quick_ratio!==null&&v.quality_inputs.quick_ratio!==void 0?v.quality_inputs.quick_ratio.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Earnings Surprise Avg (4Q)"}),e.jsx(f,{align:"right",children:v.quality_inputs.earnings_surprise_avg!==null&&v.quality_inputs.earnings_surprise_avg!==void 0?`${v.quality_inputs.earnings_surprise_avg.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EPS Growth Stability (Std Dev)"}),e.jsx(f,{align:"right",children:v.quality_inputs.eps_growth_stability!==null&&v.quality_inputs.eps_growth_stability!==void 0?v.quality_inputs.eps_growth_stability.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Payout Ratio"}),e.jsx(f,{align:"right",children:v.quality_inputs.payout_ratio!==null&&v.quality_inputs.payout_ratio!==void 0?`${(v.quality_inputs.payout_ratio*100).toFixed(1)}%`:"N/A"})]})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Fs,{sx:{color:r.palette.success.main}}),e.jsx(d,{variant:"h6",children:"Value Metrics"}),e.jsx(X,{label:v.value_score?.toFixed(1)||"N/A",color:v.value_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Stock | Sector | Market"}),e.jsx(Fe,{sx:{my:2}}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Metric"}),e.jsx(f,{align:"right",children:"Stock"}),e.jsx(f,{align:"right",children:"Sector"}),e.jsx(f,{align:"right",children:"Market"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"P/E Ratio"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_pe?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_pe?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.market_pe?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Price/Book"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_pb?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_pb?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.market_pb?.toFixed(3)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Price/Sales"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_ps?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_ps?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.market_ps?.toFixed(3)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EV/EBITDA"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_ev_ebitda?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_ev_ebitda?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"FCF Yield"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_fcf_yield?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_fcf_yield?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.market_fcf_yield?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Dividend Yield"}),e.jsx(f,{align:"right",children:v.value_inputs?.stock_dividend_yield?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.sector_dividend_yield?.toFixed(3)||"N/A"}),e.jsx(f,{align:"right",children:v.value_inputs?.market_dividend_yield?.toFixed(3)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"PEG Ratio"}),e.jsx(f,{align:"right",children:v.value_inputs?.peg_ratio?.toFixed(2)||"N/A"}),e.jsx(f,{align:"right",children:"N/A"}),e.jsx(f,{align:"right",children:"N/A"})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(at,{sx:{color:r.palette.info.main}}),e.jsx(d,{variant:"h6",children:"Growth Metrics"}),e.jsx(X,{label:v.growth_score?.toFixed(1)||"N/A",color:v.growth_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"6 growth factors: Revenue, EPS, Op Income, ROE, Sustainable Rate, FCF"}),e.jsx(Fe,{sx:{my:2}}),e.jsx(Ae,{children:e.jsx(Oe,{size:"small",children:e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Revenue CAGR (3Y)"}),e.jsx(f,{align:"right",children:v.growth_inputs?.revenue_growth_3y_cagr!=null?`${v.growth_inputs.revenue_growth_3y_cagr.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EPS CAGR (3Y)"}),e.jsx(f,{align:"right",children:v.growth_inputs?.eps_growth_3y_cagr!=null?`${v.growth_inputs.eps_growth_3y_cagr.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Op Income Growth (YoY)"}),e.jsx(f,{align:"right",children:v.growth_inputs?.operating_income_growth_yoy!=null?`${v.growth_inputs.operating_income_growth_yoy.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"ROE Trend"}),e.jsx(f,{align:"right",children:v.growth_inputs?.roe_trend!=null?`${v.growth_inputs.roe_trend.toFixed(2)}`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Sustainable Growth Rate"}),e.jsx(f,{align:"right",children:v.growth_inputs?.sustainable_growth_rate!=null?`${v.growth_inputs.sustainable_growth_rate.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"FCF Growth (YoY)"}),e.jsx(f,{align:"right",children:v.growth_inputs?.fcf_growth_yoy!=null?`${v.growth_inputs.fcf_growth_yoy.toFixed(2)}%`:"N/A"})]})]})})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(kr,{sx:{color:r.palette.error.main}}),e.jsx(d,{variant:"h6",children:"Risk Factor Analysis"}),e.jsx(X,{label:(v.risk_score||0).toFixed(1),color:(v.risk_score||0)<30?"success":(v.risk_score||0)<50?"warning":"error",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Composite risk assessment measuring volatility, technical positioning, and financial leverage"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.risk_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.risk||0},{name:"Market Avg",value:ie.risk||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Risk Score",children:[[e.jsx(xt,{fill:(v.risk_score||0)<30?r.palette.success.main:(v.risk_score||0)<50?r.palette.warning.main:r.palette.error.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.info.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Risk Component"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Volatility (12M)"}),e.jsx(f,{align:"right",children:v.risk_inputs?.volatility_12m_pct!==null&&v.risk_inputs?.volatility_12m_pct!==void 0?`${(v.risk_inputs.volatility_12m_pct||0).toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Max Drawdown (52W)"}),e.jsx(f,{align:"right",children:v.risk_inputs?.max_drawdown_52w_pct!==null&&v.risk_inputs?.max_drawdown_52w_pct!==void 0?`${(v.risk_inputs.max_drawdown_52w_pct||0).toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Debt/Equity Ratio"}),e.jsx(f,{align:"right",children:v.risk_inputs?.debt_to_equity!==null&&v.risk_inputs?.debt_to_equity!==void 0?(v.risk_inputs.debt_to_equity||0).toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Current Ratio"}),e.jsx(f,{align:"right",children:v.risk_inputs?.current_ratio!==null&&v.risk_inputs?.current_ratio!==void 0?(v.risk_inputs.current_ratio||0).toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EPS Growth Stability"}),e.jsx(f,{align:"right",children:v.risk_inputs?.eps_growth_stability!==null&&v.risk_inputs?.eps_growth_stability!==void 0?(v.risk_inputs.eps_growth_stability||0).toFixed(2):"N/A"})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(xn,{sx:{color:r.palette.warning.main}}),e.jsx(d,{variant:"h6",children:"Momentum"}),e.jsx(X,{label:v.momentum_score?.toFixed(1)||"N/A",color:v.momentum_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Multi-timeframe price momentum with trend strength and volume confirmation"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.momentum_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.momentum||0},{name:"Market Avg",value:ie.momentum||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Momentum Score",children:[[e.jsx(xt,{fill:r.palette.warning.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.success.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Momentum Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[!v.momentum_inputs&&e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Momentum metrics data loading..."})})}),v.momentum_inputs&&Object.values(v.momentum_inputs).filter(Z=>Z!=null&&!Z.fallbacks).length===0&&e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"No detailed momentum metrics available for this stock"})})}),v.momentum_inputs&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600},children:"Intraweek Trend Confirmation (10pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"RSI (14-day)"}),e.jsx(f,{align:"right",children:v.rsi!==null&&v.rsi!==void 0?v.rsi.toFixed(1):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"MACD"}),e.jsx(f,{align:"right",children:v.macd!==null&&v.macd!==void 0?v.macd.toFixed(4):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs SMA 50"}),e.jsx(f,{align:"right",children:v.momentum_inputs.price_vs_sma_50!==null&&v.momentum_inputs.price_vs_sma_50!==void 0?`${v.momentum_inputs.price_vs_sma_50.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Short-Term Momentum (25pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"3-Month Return"}),e.jsx(f,{align:"right",children:v.momentum_inputs.momentum_3m!==null&&v.momentum_inputs.momentum_3m!==void 0?`${v.momentum_inputs.momentum_3m.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Medium-Term Momentum (25pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"6-Month Return"}),e.jsx(f,{align:"right",children:v.momentum_inputs.momentum_6m!==null&&v.momentum_inputs.momentum_6m!==void 0?`${v.momentum_inputs.momentum_6m.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Long-Term Momentum (15pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"12-Month Return (Excl. Last Month)"}),e.jsx(f,{align:"right",children:v.momentum_inputs.momentum_12m_1!==null&&v.momentum_inputs.momentum_12m_1!==void 0?`${v.momentum_inputs.momentum_12m_1.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Relative Strength (15pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Mansfield RS"}),e.jsx(f,{align:"right",children:v.momentum_components?.mansfield_rs!==null&&v.momentum_components?.mansfield_rs!==void 0?v.momentum_components.mansfield_rs.toFixed(0):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Risk-Adjusted Momentum"}),e.jsx(f,{align:"right",children:v.momentum_inputs.risk_adjusted_momentum!==null&&v.momentum_inputs.risk_adjusted_momentum!==void 0?v.momentum_inputs.risk_adjusted_momentum.toFixed(2):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{fontWeight:600,pt:2},children:"Stability (10pts)"}),e.jsx(f,{align:"right"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs SMA 200"}),e.jsx(f,{align:"right",children:v.momentum_inputs.price_vs_sma_200!==null&&v.momentum_inputs.price_vs_sma_200!==void 0?`${v.momentum_inputs.price_vs_sma_200.toFixed(2)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{sx:{pl:4},children:"Price vs 52-Week High"}),e.jsx(f,{align:"right",children:v.momentum_inputs.price_vs_52w_high!==null&&v.momentum_inputs.price_vs_52w_high!==void 0?`${v.momentum_inputs.price_vs_52w_high.toFixed(2)}%`:"N/A"})]})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(at,{sx:{color:r.palette.success.main}}),e.jsx(d,{variant:"h6",children:"Relative Strength"}),e.jsx(X,{label:v.relative_strength_inputs?.relative_strength_score?.toFixed(1)||"N/A",color:v.relative_strength_inputs?.relative_strength_score>=70?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"IBD-style RS Rating with sector-relative performance, momentum acceleration, and timeframe alignment"}),e.jsx(Fe,{sx:{my:2}}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"RS Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[v.relative_strength_inputs&&e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Sector Outperformance"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.sector_relative_12m!==null&&v.relative_strength_inputs.sector_relative_12m!==void 0?`${v.relative_strength_inputs.sector_relative_12m.toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Sector Rank"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.sector_percentile!==null&&v.relative_strength_inputs.sector_percentile!==void 0?v.relative_strength_inputs.sector_percentile.toFixed(0):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Price Momentum (4W)"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.rs_momentum_4w!=null?v.relative_strength_inputs.rs_momentum_4w.toFixed(1):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Price Momentum (13W)"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.rs_momentum_13w!=null?v.relative_strength_inputs.rs_momentum_13w.toFixed(1):"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Uptrend Stability"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.positive_months_12!==null&&v.relative_strength_inputs.positive_months_12!==void 0?`${v.relative_strength_inputs.positive_months_12}/12`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Timeframe Confirmation"}),e.jsx(f,{align:"right",children:v.relative_strength_inputs.timeframe_alignment!==null&&v.relative_strength_inputs.timeframe_alignment!==void 0?`${v.relative_strength_inputs.timeframe_alignment}/4`:"N/A"})]})]}),!v.relative_strength_inputs&&e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"RS metrics loading..."})})})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Fs,{sx:{color:r.palette.info.main}}),e.jsx(d,{variant:"h6",children:"Value Assessment"}),e.jsx(X,{label:v.value_score?.toFixed(1)||"N/A",color:v.value_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Valuation analysis using price multiples, cash flow, and intrinsic value relative to market and sector benchmarks"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.value_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.value||0},{name:"Market Avg",value:ie.value||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Value Score",children:[[e.jsx(xt,{fill:r.palette.info.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.success.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),v.value_inputs&&e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"P/E Ratio (Price-to-Earnings)"}),e.jsx(f,{align:"right",children:v.value_inputs.stock_pe?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"P/B Ratio (Price-to-Book)"}),e.jsx(f,{align:"right",children:v.value_inputs.stock_pb?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"P/S Ratio (Price-to-Sales)"}),e.jsx(f,{align:"right",children:v.value_inputs.stock_ps?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"EV/EBITDA"}),e.jsx(f,{align:"right",children:v.value_inputs.stock_ev_ebitda?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Dividend Yield"}),e.jsxs(f,{align:"right",children:[v.value_inputs.stock_dividend_yield?.toFixed(2)||"N/A","%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"FCF Yield (Free Cash Flow Yield)"}),e.jsxs(f,{align:"right",children:[v.value_inputs.stock_fcf_yield?.toFixed(2)||"N/A","%"]})]}),v.value_inputs.peg_ratio!==null&&v.value_inputs.peg_ratio!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"PEG Ratio (P/E to Growth)"}),e.jsx(f,{align:"right",children:v.value_inputs.peg_ratio.toFixed(2)})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Lt,{sx:{color:r.palette.success.main}}),e.jsx(d,{variant:"h6",children:"Growth Potential"}),e.jsx(X,{label:v.growth_score?.toFixed(1)||"N/A",color:v.growth_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Revenue and earnings growth trajectory with historical price performance"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.growth_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.growth||0},{name:"Market Avg",value:ie.growth||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Growth Score",children:[[e.jsx(xt,{fill:r.palette.success.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.info.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"1D Change %"}),e.jsxs(f,{align:"right",children:[(v.price_change_1d||0).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"5D Change %"}),e.jsxs(f,{align:"right",children:[(v.price_change_5d||0).toFixed(2),"%"]})]}),e.jsxs(V,{children:[e.jsx(f,{children:"30D Change %"}),e.jsxs(f,{align:"right",children:[(v.price_change_30d||0).toFixed(2),"%"]})]}),v.growth_inputs&&e.jsxs(e.Fragment,{children:[v.growth_inputs.revenue_growth_3y_cagr!==null&&v.growth_inputs.revenue_growth_3y_cagr!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"Revenue Growth (3Y CAGR)"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.revenue_growth_3y_cagr.toFixed(1),"%"]})]}),v.growth_inputs.eps_growth_3y_cagr!==null&&v.growth_inputs.eps_growth_3y_cagr!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"EPS Growth (3Y CAGR)"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.eps_growth_3y_cagr.toFixed(1),"%"]})]}),v.growth_inputs.operating_income_growth_yoy!==null&&v.growth_inputs.operating_income_growth_yoy!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"Operating Income Growth (YoY)"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.operating_income_growth_yoy.toFixed(1),"%"]})]}),v.growth_inputs.roe_trend!==null&&v.growth_inputs.roe_trend!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"ROE Trend (YoY Change)"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.roe_trend.toFixed(1),"%"]})]}),v.growth_inputs.sustainable_growth_rate!==null&&v.growth_inputs.sustainable_growth_rate!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"Sustainable Growth Rate"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.sustainable_growth_rate.toFixed(1),"%"]})]}),v.growth_inputs.fcf_growth_yoy!==null&&v.growth_inputs.fcf_growth_yoy!==void 0&&e.jsxs(V,{children:[e.jsx(f,{children:"FCF Growth (YoY)"}),e.jsxs(f,{align:"right",children:[v.growth_inputs.fcf_growth_yoy.toFixed(1),"%"]})]})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Jf,{sx:{color:r.palette.secondary.main}}),e.jsx(d,{variant:"h6",children:"Market Positioning"}),e.jsx(X,{label:v.positioning_score?.toFixed(1)||"N/A",color:v.positioning_score>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Analysis of institutional and insider ownership patterns, short interest dynamics, and smart money positioning"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.positioning_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.positioning||0},{name:"Market Avg",value:ie.positioning||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Positioning Score",children:[[e.jsx(xt,{fill:r.palette.secondary.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.info.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Positioning Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsxs(ke,{children:[e.jsxs(V,{children:[e.jsx(f,{children:"Institutional Ownership %"}),e.jsx(f,{align:"right",children:v.positioning_components?.institutional_ownership?`${(v.positioning_components.institutional_ownership*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Insider Ownership %"}),e.jsx(f,{align:"right",children:v.positioning_components?.insider_ownership?`${(v.positioning_components.insider_ownership*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Short % of Float"}),e.jsx(f,{align:"right",children:v.positioning_components?.short_percent_of_float?`${(v.positioning_components.short_percent_of_float*100).toFixed(1)}%`:"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Days to Cover (Short Ratio)"}),e.jsx(f,{align:"right",children:v.positioning_components?.days_to_cover?.toFixed(2)||v.positioning_components?.short_ratio?.toFixed(2)||"N/A"})]}),e.jsxs(V,{children:[e.jsx(f,{children:"Accumulation/Distribution Rating"}),e.jsx(f,{align:"right",children:v.positioning_components?.acc_dist_rating?.toFixed(1)||"N/A"})]})]})]})})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(em,{sx:{color:r.palette.success.main}}),e.jsx(d,{variant:"h6",children:"Market Sentiment"}),e.jsx(X,{label:(v.sentiment_score||0).toFixed(1),color:(v.sentiment_score||0)>=80?"success":"warning",size:"small"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Market sentiment analysis from news sources, social media, and analyst ratings"}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{sx:{mt:2},children:[e.jsx(d,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:"Score Comparison"}),e.jsx(st,{width:"100%",height:200,children:e.jsxs(Yt,{data:[{name:v.symbol,value:v.sentiment_score||0},{name:v.sector?`${v.sector} Avg`:"Sector Avg",value:Q.sentiment||0},{name:"Market Avg",value:ie.sentiment||0}],margin:{top:10,right:10,left:0,bottom:5},children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",style:{fontSize:"0.7rem"}}),e.jsx(ht,{domain:[0,100],style:{fontSize:"0.75rem"}}),e.jsx(ot,{}),e.jsxs(jt,{dataKey:"value",name:"Sentiment Score",children:[[e.jsx(xt,{fill:r.palette.success.main},"stock"),e.jsx(xt,{fill:r.palette.primary.main},"sector"),e.jsx(xt,{fill:r.palette.warning.light},"market")],e.jsx(Kn,{dataKey:"value",position:"top",style:{fontSize:"0.75rem",fontWeight:600},formatter:Z=>Z.toFixed(1)})]})]})})]}),e.jsx(Ae,{sx:{mt:2},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Metric"}),e.jsx(f,{align:"right",children:"Value"})]})}),e.jsx(ke,{children:e.jsx(V,{children:e.jsx(f,{colSpan:2,align:"center",children:e.jsx(d,{variant:"caption",color:"text.secondary",children:"Detailed sentiment metrics coming soon"})})})})]})})]})})})]}),e.jsx(Fe,{sx:{my:3}}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Last Updated: ",new Date(v.last_updated).toLocaleDateString()]})]})})()]})})]},v.symbol))})]}),e.jsx(d,{variant:"h4",gutterBottom:!0,sx:{mt:6,mb:3},children:"Top Performers by Sector"}),e.jsx(y,{container:!0,spacing:3,sx:{mb:6},children:ce.slice(0,6).map(v=>{const ie=pe[v]||[];return e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Pr,{sx:{color:r.palette.primary.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:v}),e.jsx(X,{label:`${ie.length} stocks`,size:"small",color:"default"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:ie.map((Q,Z)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:Z+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:Q.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:Q.composite_score.toFixed(1),size:"small",color:Q.composite_score>=80?"success":Q.composite_score>=60?"warning":"error"})})]},Q.symbol))})]})})]})},v)})}),e.jsxs(d,{variant:"h4",gutterBottom:!0,sx:{mt:6,mb:3},children:["Top Performers by Category",he!=="all"&&e.jsx(X,{label:`Filtered: ${he}`,size:"small",color:"primary",sx:{ml:2},onDelete:()=>re("all")})]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(th,{sx:{color:r.palette.primary.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Quality Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:Be.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:v.quality_score.toFixed(1),size:"small",color:v.quality_score>=80?"success":"warning"})})]},v.symbol))})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(xn,{sx:{color:r.palette.warning.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Momentum Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:et.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:v.momentum_score.toFixed(1),size:"small",color:v.momentum_score>=80?"success":"warning"})})]},v.symbol))})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Fs,{sx:{color:r.palette.info.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Value Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:De.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:v.value_score.toFixed(1),size:"small",color:v.value_score>=80?"success":"warning"})})]},v.symbol))})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Lt,{sx:{color:r.palette.success.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Growth Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:ze.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:v.growth_score.toFixed(1),size:"small",color:v.growth_score>=80?"success":"warning"})})]},v.symbol))})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Jf,{sx:{color:r.palette.secondary.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Positioning Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:ve.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:v.positioning_score.toFixed(1),size:"small",color:v.positioning_score>=80?"success":"warning"})})]},v.symbol))})]})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(He,{sx:{p:3},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(em,{sx:{color:r.palette.success.main,fontSize:32}}),e.jsx(d,{variant:"h6",children:"Sentiment Leaders"})]}),e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Rank"}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Score"})]})}),e.jsx(ke,{children:B.slice(0,10).map((v,ie)=>e.jsxs(V,{hover:!0,sx:{cursor:"pointer"},children:[e.jsx(f,{children:ie+1}),e.jsx(f,{children:e.jsx(d,{fontWeight:600,children:v.symbol})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:(v.sentiment_score||0).toFixed(1),size:"small",color:(v.sentiment_score||0)>=80?"success":"warning"})})]},v.symbol))})]})})]})})]})]})};function AN({onSwitchToRegister:r,onSwitchToForgotPassword:t}){const[s,n]=j.useState({username:"",password:""}),[i,a]=j.useState(!1),[o,l]=j.useState(""),[c,h]=j.useState(!1),{login:u,isLoading:m,error:p,clearError:x}=ps(),b=A=>{const{name:_,value:R}=A.target;n(E=>({...E,[_]:R})),p&&x(),o&&l("")},w=async A=>{if(A.preventDefault(),l(""),!s.username||!s.password){l("Please enter both username and password");return}localStorage.setItem("rememberMe",c.toString());const _=await u(s.username,s.password);!_.success&&_.error&&l(_.error)},C=p||o;return e.jsx(z,{sx:{maxWidth:400,mx:"auto",mt:4},children:e.jsxs(U,{sx:{p:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:[e.jsx(sh,{sx:{mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h4",component:"h1",color:"primary",children:"Sign In"})]}),e.jsx(d,{variant:"body1",color:"text.secondary",align:"center",mb:3,children:"Access your Financial Dashboard"}),C&&e.jsx(we,{severity:"error",sx:{mb:2},children:C}),e.jsxs(g,{component:"form",role:"form",onSubmit:w,noValidate:!0,children:[e.jsx(_e,{fullWidth:!0,id:"username",name:"username",label:"Username or Email",type:"text",value:s.username,onChange:b,margin:"normal",required:!0,autoComplete:"username",autoFocus:!0,disabled:m}),e.jsx(_e,{fullWidth:!0,id:"password",name:"password",label:"Password",type:i?"text":"password",value:s.password,onChange:b,margin:"normal",required:!0,autoComplete:"current-password",disabled:m,InputProps:{endAdornment:e.jsx(ts,{position:"end",children:e.jsx(Ge,{"aria-label":"toggle password visibility",onClick:()=>a(!i),edge:"end",disabled:m,children:i?e.jsx(di,{}):e.jsx(jn,{})})})}}),e.jsx(Jt,{control:e.jsx(WS,{checked:c,onChange:A=>h(A.target.checked),color:"primary",disabled:m}),label:"Remember me for 30 days",sx:{mt:1,mb:1}}),e.jsx(oe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:m,startIcon:m?e.jsx(Je,{size:20}):e.jsx(sh,{}),children:m?"Signing In...":"Sign In"}),e.jsx(g,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,children:e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:t,disabled:m,children:"Forgot password?"})}),e.jsx(Fe,{sx:{my:2}}),e.jsx(g,{textAlign:"center",children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Don't have an account?"," ",e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:r,disabled:m,sx:{fontWeight:"medium"},children:"Sign up here"})]})})]})]})})}function TN({onSwitchToLogin:r,onRegistrationSuccess:t}){const[s,n]=j.useState({username:"",email:"",password:"",confirmPassword:"",firstName:"",lastName:""}),[i,a]=j.useState(!1),[o,l]=j.useState(!1),[c,h]=j.useState(""),{register:u,isLoading:m,error:p,clearError:x}=ps(),b=_=>{const{name:R,value:E}=_.target;n(T=>({...T,[R]:E})),p&&x(),c&&h("")},w=()=>!s.username||!s.email||!s.password?(h("Please fill in all required fields"),!1):s.password!==s.confirmPassword?(h("Passwords do not match"),!1):(s.password?.length||0)<8?(h("Password must be at least 8 characters long"),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)?!0:(h("Please enter a valid email address"),!1),C=async _=>{if(_.preventDefault(),h(""),!w())return;const R=await u(s.username,s.password,s.email,s.firstName,s.lastName);R.success?t?.(s.username,R.nextStep):R.error&&h(R.error)},A=p||c;return e.jsx(z,{sx:{maxWidth:500,mx:"auto",mt:4},children:e.jsxs(U,{sx:{p:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:[e.jsx(tm,{sx:{mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h4",component:"h1",color:"primary",children:"Sign Up"})]}),e.jsx(d,{variant:"body1",color:"text.secondary",align:"center",mb:3,children:"Create your Financial Dashboard account"}),A&&e.jsx(we,{severity:"error",sx:{mb:2},children:A}),e.jsxs(g,{component:"form",onSubmit:C,noValidate:!0,children:[e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{fullWidth:!0,id:"firstName",name:"firstName",label:"First Name",value:s.firstName,onChange:b,autoComplete:"given-name",disabled:m})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(_e,{fullWidth:!0,id:"lastName",name:"lastName",label:"Last Name",value:s.lastName,onChange:b,autoComplete:"family-name",disabled:m})})]}),e.jsx(_e,{fullWidth:!0,id:"username",name:"username",label:"Username",value:s.username,onChange:b,margin:"normal",required:!0,autoComplete:"username",disabled:m,helperText:"This will be your unique identifier for signing in"}),e.jsx(_e,{fullWidth:!0,id:"email",name:"email",label:"Email Address",type:"email",value:s.email,onChange:b,margin:"normal",required:!0,autoComplete:"email",disabled:m,helperText:"We'll send verification instructions to this email"}),e.jsx(_e,{fullWidth:!0,id:"password",name:"password",label:"Password",type:i?"text":"password",value:s.password,onChange:b,margin:"normal",required:!0,autoComplete:"new-password",disabled:m,helperText:"Must be at least 8 characters long",InputProps:{endAdornment:e.jsx(ts,{position:"end",children:e.jsx(Ge,{"aria-label":"toggle password visibility",onClick:()=>a(!i),edge:"end",disabled:m,children:i?e.jsx(di,{}):e.jsx(jn,{})})})}}),e.jsx(_e,{fullWidth:!0,id:"confirmPassword",name:"confirmPassword",label:"Confirm Password",type:o?"text":"password",value:s.confirmPassword,onChange:b,margin:"normal",required:!0,autoComplete:"new-password",disabled:m,InputProps:{endAdornment:e.jsx(ts,{position:"end",children:e.jsx(Ge,{"aria-label":"toggle confirm password visibility",onClick:()=>l(!o),edge:"end",disabled:m,children:o?e.jsx(di,{}):e.jsx(jn,{})})})}}),e.jsx(oe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:m,startIcon:m?e.jsx(Je,{size:20}):e.jsx(tm,{}),children:m?"Creating Account...":"Create Account"}),e.jsx(Fe,{sx:{my:2}}),e.jsx(g,{textAlign:"center",children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Already have an account?"," ",e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:r,disabled:m,sx:{fontWeight:"medium"},children:"Sign in here"})]})})]})]})})}function PN({username:r,onConfirmationSuccess:t,onSwitchToLogin:s}){const[n,i]=j.useState(""),[a,o]=j.useState(""),[l,c]=j.useState(""),[h,u]=j.useState(0),{confirmRegistration:m,resendConfirmationCode:p,isLoading:x,error:b,clearError:w}=ps(),C=E=>{i(E.target.value),b&&w(),a&&o("")},A=async E=>{if(E.preventDefault(),o(""),!n){o("Please enter the confirmation code");return}const T=await m(r,n);T.success?t?.():T.error&&o(T.error)};j.useEffect(()=>{if(h>0){const E=setTimeout(()=>{u(h-1)},1e3);return()=>clearTimeout(E)}},[h]);const _=async()=>{o(""),c("");const E=await p(r);E.success?(c(E.message),u(60)):o(E.error)},R=b||a;return e.jsx(z,{sx:{maxWidth:400,mx:"auto",mt:4},children:e.jsxs(U,{sx:{p:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:[e.jsx(Yr,{sx:{mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h4",component:"h1",color:"primary",children:"Verify Account"})]}),e.jsx(d,{variant:"body1",color:"text.secondary",align:"center",mb:3,children:"Enter the verification code sent to your email address"}),R&&e.jsx(we,{severity:"error",sx:{mb:2},children:R}),l&&e.jsx(we,{severity:"success",sx:{mb:2},children:l}),e.jsxs(g,{component:"form",onSubmit:A,noValidate:!0,children:[e.jsx(_e,{fullWidth:!0,id:"confirmationCode",name:"confirmationCode",label:"Verification Code",type:"text",value:n,onChange:C,margin:"normal",required:!0,autoFocus:!0,disabled:x,placeholder:"Enter 6-digit code",inputProps:{maxLength:6}}),e.jsx(oe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:x,startIcon:x?e.jsx(Je,{size:20}):e.jsx(Yr,{}),children:x?"Verifying...":"Verify Account"}),e.jsxs(g,{textAlign:"center",mt:2,children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Didn't receive the code?"," ",e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:_,disabled:x||h>0,sx:{fontWeight:"medium"},children:h>0?`Resend (${h}s)`:"Resend"})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mt:1,children:e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:s,disabled:x,sx:{fontWeight:"medium"},children:"Back to Sign In"})})]})]})]})})}const _N=({onBack:r})=>{const[t,s]=j.useState(""),[n,i]=j.useState(!1),[a,o]=j.useState(""),[l,c]=j.useState(""),{forgotPassword:h}=ps(),u=async m=>{m.preventDefault(),i(!0),c(""),o("");try{const p=await h(t);p.success?o(p.message||"Reset code sent to your email"):c(p.error||"Failed to send password reset email.")}catch{c("Failed to send password reset email. Please try again.")}finally{i(!1)}};return e.jsxs(He,{elevation:3,sx:{p:4,maxWidth:400,width:"100%"},children:[e.jsx(d,{variant:"h4",gutterBottom:!0,align:"center",children:"Reset Password"}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},align:"center",children:"Enter your email address and we'll send you a password reset link."}),l&&e.jsx(we,{severity:"error",sx:{mb:2},children:l}),a&&e.jsx(we,{severity:"success",sx:{mb:2},children:a}),e.jsxs(g,{component:"form",onSubmit:u,sx:{mt:1},children:[e.jsx(_e,{margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,type:"email",value:t,onChange:m=>s(m.target.value),disabled:n}),e.jsx(oe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:n||!t,children:n?"Sending...":"Send Reset Email"}),e.jsx(oe,{fullWidth:!0,variant:"text",onClick:r,disabled:n,children:"Back to Sign In"})]})]})};function EN({username:r,onPasswordResetSuccess:t,onSwitchToLogin:s}){const[n,i]=j.useState({confirmationCode:"",newPassword:"",confirmPassword:""}),[a,o]=j.useState(!1),[l,c]=j.useState(!1),[h,u]=j.useState(""),{confirmForgotPassword:m,isLoading:p,error:x,clearError:b}=ps(),w=R=>{const{name:E,value:T}=R.target;i(M=>({...M,[E]:T})),x&&b(),h&&u("")},C=()=>!n.confirmationCode||!n.newPassword||!n.confirmPassword?(u("Please fill in all fields"),!1):n.newPassword!==n.confirmPassword?(u("Passwords do not match"),!1):(n.newPassword?.length||0)<8?(u("Password must be at least 8 characters long"),!1):!0,A=async R=>{if(R.preventDefault(),u(""),!C())return;const E=await m(r,n.confirmationCode,n.newPassword);E.success?t?.():E.error&&u(E.error)},_=x||h;return e.jsx(z,{sx:{maxWidth:400,mx:"auto",mt:4},children:e.jsxs(U,{sx:{p:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"center",mb:3,children:[e.jsx(sm,{sx:{mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h4",component:"h1",color:"primary",children:"Set New Password"})]}),e.jsx(d,{variant:"body1",color:"text.secondary",align:"center",mb:3,children:"Enter the code from your email and choose a new password"}),_&&e.jsx(we,{severity:"error",sx:{mb:2},children:_}),e.jsxs(g,{component:"form",onSubmit:A,noValidate:!0,children:[e.jsx(_e,{fullWidth:!0,id:"confirmationCode",name:"confirmationCode",label:"Reset Code",type:"text",value:n.confirmationCode,onChange:w,margin:"normal",required:!0,autoFocus:!0,disabled:p,placeholder:"Enter 6-digit code",inputProps:{maxLength:6}}),e.jsx(_e,{fullWidth:!0,id:"newPassword",name:"newPassword",label:"New Password",type:a?"text":"password",value:n.newPassword,onChange:w,margin:"normal",required:!0,disabled:p,autoComplete:"new-password",helperText:"Must be at least 8 characters long",InputProps:{endAdornment:e.jsx(ts,{position:"end",children:e.jsx(Ge,{"aria-label":"toggle password visibility",onClick:()=>o(!a),edge:"end",disabled:p,children:a?e.jsx(di,{}):e.jsx(jn,{})})})}}),e.jsx(_e,{fullWidth:!0,id:"confirmPassword",name:"confirmPassword",label:"Confirm New Password",type:l?"text":"password",value:n.confirmPassword,onChange:w,margin:"normal",required:!0,disabled:p,autoComplete:"new-password",InputProps:{endAdornment:e.jsx(ts,{position:"end",children:e.jsx(Ge,{"aria-label":"toggle confirm password visibility",onClick:()=>c(!l),edge:"end",disabled:p,children:l?e.jsx(di,{}):e.jsx(jn,{})})})}}),e.jsx(oe,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,py:1.5},disabled:p,startIcon:p?e.jsx(Je,{size:20}):e.jsx(sm,{}),children:p?"Resetting...":"Reset Password"}),e.jsx(g,{textAlign:"center",mt:2,children:e.jsx(d,{variant:"body2",color:"text.secondary",children:e.jsx(Gi,{component:"button",type:"button",variant:"body2",onClick:s,disabled:p,sx:{fontWeight:"medium"},children:"Back to Sign In"})})})]})]})})}function IN({challengeType:r="SMS_MFA",message:t="Please enter the verification code sent to your device.",onSuccess:s,onCancel:n}){const[i,a]=j.useState(""),[o,l]=j.useState(!1),[c,h]=j.useState(""),u=async p=>{if(p.preventDefault(),!i.trim()){h("Please enter the verification code");return}l(!0),h("");try{i==="123456"?s({username:"testuser",code:i,challengeType:r}):h("Invalid verification code. Please try again.")}catch{h("MFA verification failed. Please try again.")}finally{l(!1)}},m=()=>{switch(r){case"SMS_MFA":return"SMS Verification";case"SOFTWARE_TOKEN_MFA":return"Authenticator App";default:return"Multi-Factor Authentication"}};return e.jsxs(g,{sx:{p:3},children:[e.jsxs(g,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(kr,{sx:{mr:1,color:"primary.main"}}),e.jsx(d,{variant:"h6",component:"h2",children:m()})]}),e.jsx(d,{variant:"body2",color:"text.secondary",mb:3,children:t}),c&&e.jsx(we,{severity:"error",sx:{mb:2},children:c}),e.jsxs("form",{onSubmit:u,children:[e.jsx(_e,{fullWidth:!0,label:"Verification Code",value:i,onChange:p=>a(p.target.value),placeholder:"Enter 6-digit code",inputProps:{maxLength:6,pattern:"[0-9]{6}"},InputProps:{startAdornment:e.jsx(ts,{position:"start",children:e.jsx(kr,{})})},sx:{mb:3},required:!0}),e.jsxs(g,{display:"flex",gap:2,justifyContent:"flex-end",children:[e.jsx(oe,{variant:"outlined",onClick:n,disabled:o,children:"Cancel"}),e.jsx(oe,{type:"submit",variant:"contained",disabled:o||!i.trim(),children:o?"Verifying...":"Verify"})]})]}),e.jsx(d,{variant:"caption",display:"block",textAlign:"center",mt:2,children:"Didn't receive a code? Check your spam folder or try again."})]})}const Wt={LOGIN:"login",REGISTER:"register",CONFIRM:"confirm",FORGOT_PASSWORD:"forgot_password",RESET_PASSWORD:"reset_password",MFA_CHALLENGE:"mfa_challenge"};function DN({open:r,onClose:t,initialMode:s=Wt.LOGIN,email:n="",onSuccess:i}){const[a,o]=j.useState(s),[l,c]=j.useState(n),[h,u]=j.useState(""),m=(R,E)=>{c(R),u("Registration successful! Please check your email for a verification code."),o(Wt.CONFIRM)},p=()=>{u("Account confirmed! You can now sign in."),o(Wt.LOGIN)},x=R=>{c(R),u("Password reset code sent! Please check your email."),o(Wt.RESET_PASSWORD)},b=()=>{u("Password reset successful! You can now sign in with your new password."),o(Wt.LOGIN),i?.()},w=R=>{u("Multi-factor authentication successful!"),o(Wt.LOGIN),console.log("MFA Success:",R)},C=()=>{o(Wt.LOGIN)},A=()=>{o(s),c(""),u(""),t()},_=()=>{switch(a){case Wt.LOGIN:return"Sign In";case Wt.REGISTER:return"Create Account";case Wt.CONFIRM:return"Verify Account";case Wt.FORGOT_PASSWORD:return"Reset Password";case Wt.RESET_PASSWORD:return"Set New Password";case Wt.MFA_CHALLENGE:return"Multi-Factor Authentication";default:return"Authentication"}};return e.jsxs(Os,{open:r,onClose:A,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderBottom:1,borderColor:"divider",children:[e.jsx(d,{variant:"h6",component:"h2",children:_()}),e.jsx(Ge,{onClick:A,size:"small","aria-label":"close",children:e.jsx(wx,{})})]}),e.jsxs(ks,{sx:{p:0},children:[h&&e.jsx(we,{severity:"success",sx:{m:2,mb:0},children:h}),a===Wt.LOGIN&&e.jsx(AN,{onSwitchToRegister:()=>{u(""),o(Wt.REGISTER)},onSwitchToForgotPassword:()=>{u(""),o(Wt.FORGOT_PASSWORD)}}),a===Wt.REGISTER&&e.jsx(TN,{onSwitchToLogin:()=>{u(""),o(Wt.LOGIN)},onRegistrationSuccess:m}),a===Wt.CONFIRM&&e.jsx(PN,{username:l,onConfirmationSuccess:p,onSwitchToLogin:()=>{u(""),o(Wt.LOGIN)}}),a===Wt.FORGOT_PASSWORD&&e.jsx(_N,{onForgotPasswordSuccess:x,onSwitchToLogin:()=>{u(""),o(Wt.LOGIN)}}),a===Wt.RESET_PASSWORD&&e.jsx(EN,{username:l,onPasswordResetSuccess:b,onSwitchToLogin:()=>{u(""),o(Wt.LOGIN)}}),a===Wt.MFA_CHALLENGE&&e.jsx(IN,{challengeType:"SMS_MFA",message:"Please enter the verification code sent to your device.",onSuccess:w,onCancel:C})]})]})}function Ai({children:r,_requireAuth:t=!1,_fallback:s=null}){return r}const RN=()=>e.jsx(Xj,{}),MN=()=>{const{user:r}=ps(),[t,s]=j.useState([]),[n,i]=j.useState({}),[a,o]=j.useState(!0),[l,c]=j.useState(null),[h,u]=j.useState(!1),[m,p]=j.useState(""),[x,b]=j.useState(new Date),w=async()=>{try{s(["AAPL","MSFT","GOOGL","AMZN","TSLA","NVDA","META"])}catch{c("Failed to load watchlist")}},C=async E=>{try{c(null);const T=E||t;if(!r||(T?.length||0)===0)return;console.log(`Loading market data for ${T?.length||0} symbols`);const M=await St.get(`/api/websocket/stream/${T.join(",")}`);if(M?.data.success){const I=M?.data.data,N={};for(const k of T){const S=I?.data&&I.data[k];if(S&&!S.error){const L=(S.bidPrice+S.askPrice)/2;N[k]={symbol:k,price:L,bidPrice:S.bidPrice,askPrice:S.askPrice,spread:S.askPrice-S.bidPrice,spreadPercent:(S.askPrice-S.bidPrice)/L*100,volume:S.bidSize+S.askSize,timestamp:S.timestamp,dataSource:"live",change:0,changePercent:0}}else N[k]={symbol:k,price:0,error:S?.error||"Data unavailable",dataSource:"error"}}i(N),b(new Date),console.log("✅ Watchlist market data loaded successfully",{symbols:T?.length||0,successful:Object.values(N).filter(k=>!k.error).length,failed:Object.values(N).filter(k=>k.error).length})}else throw new Error("Failed to fetch watchlist market data")}catch(T){c(T.message)}finally{o(!1)}};j.useEffect(()=>{w()},[]),j.useEffect(()=>{t.length>0&&C(t)},[t]);const A=()=>{const E=m.toUpperCase().trim();E&&!t.includes(E)&&/^[A-Z]+$/.test(E)&&(s([...t,E]),p(""),u(!1))},_=E=>{s(t.filter(M=>M!==E));const T={...n};delete T[E],i(T)},R=E=>{const T=Math.floor((new Date-E)/1e3);if(T<60)return`${T}s ago`;const M=Math.floor(T/60);return M<60?`${M}m ago`:`${Math.floor(M/60)}h ago`};return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-start",md:"center"},justifyContent:"space-between",gap:{xs:2,md:0},mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Watchlist"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Track your favorite stocks with real-time market data"}),e.jsxs(g,{display:"flex",flexWrap:"wrap",gap:1,mt:1,children:[e.jsx(X,{label:`${t?.length||0} symbols`,color:"primary",size:"small"}),e.jsx(X,{label:"Live Data",color:"success",size:"small",variant:"outlined"}),e.jsx(X,{label:`Updated ${R(x)}`,color:"primary",size:"small",variant:"filled"})]})]}),e.jsxs(g,{display:"flex",gap:2,flexWrap:"wrap",children:[e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>u(!0),size:"medium",children:"Add Symbol"}),e.jsx(oe,{variant:"outlined",startIcon:e.jsx(Es,{}),onClick:()=>C(t),disabled:a,size:"medium",children:"Refresh"})]})]}),a&&e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,py:2,children:[e.jsx(rt,{sx:{flexGrow:1}}),e.jsx(d,{children:"Loading watchlist data..."})]})})}),l&&e.jsxs(we,{severity:"error",sx:{mb:3},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Failed to Load Watchlist Data"}),e.jsx(d,{variant:"body2",children:l}),e.jsx(oe,{variant:"outlined",size:"small",onClick:()=>C(t),sx:{mt:1},children:"Retry"})]}),!a&&t.length>0&&e.jsx(z,{children:e.jsx(U,{sx:{p:{xs:1,sm:2}},children:e.jsx(Ae,{sx:{overflowX:"auto"},children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:e.jsx("strong",{children:"Symbol"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Price"})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx("strong",{children:"Change"})}),e.jsx(f,{align:"right",children:e.jsx("strong",{children:"Change %"})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx("strong",{children:"Bid/Ask"})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:e.jsx("strong",{children:"Spread"})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx("strong",{children:"Volume"})}),e.jsx(f,{align:"center",children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(ke,{children:(t||[]).map(E=>{const T=n[E]||{},M=T.error,I=T.change>=0;return e.jsxs(V,{hover:!0,children:[e.jsx(f,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:E}),M&&e.jsx(X,{label:"Error",color:"error",size:"small"})]})}),e.jsx(f,{align:"right",children:M?e.jsx(d,{color:"error",children:"--"}):e.jsx(d,{variant:"h6",fontWeight:"bold",children:ge(T.price)})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",sm:"table-cell"}},children:M?e.jsx(d,{color:"error",children:"--"}):e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1,children:[I?e.jsx(at,{color:"success",fontSize:"small"}):e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsx(d,{color:I?"success.main":"error.main",fontWeight:"bold",children:ge(Math.abs(T.change))})]})}),e.jsx(f,{align:"right",children:M?e.jsx(d,{color:"error",children:"--"}):e.jsx(d,{color:I?"success.main":"error.main",fontWeight:"bold",children:Et(Math.abs(T.changePercent))})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:M?e.jsx(d,{color:"error",children:"--"}):e.jsx(g,{children:e.jsxs(d,{variant:"body2",children:[ge(T.bidPrice)," /"," ",ge(T.askPrice)]})})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:M?e.jsx(d,{color:"error",children:"--"}):e.jsxs(g,{children:[e.jsx(d,{variant:"body2",children:ge(T.spread)}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["(",Et(T.spreadPercent),")"]})]})}),e.jsx(f,{align:"right",sx:{display:{xs:"none",sm:"table-cell"}},children:M?e.jsx(d,{color:"error",children:"--"}):e.jsx(d,{variant:"body2",children:Me(T.volume)})}),e.jsx(f,{align:"center",children:e.jsx(Ge,{size:"small",color:"error",onClick:()=>_(E),"aria-label":`Remove ${E} from watchlist`,children:e.jsx(mc,{})})})]},E)})})]})})})}),!a&&(t?.length||0)===0&&e.jsx(z,{children:e.jsxs(U,{sx:{textAlign:"center",py:6},children:[e.jsx(d,{variant:"h5",gutterBottom:!0,color:"text.secondary",children:"Your watchlist is empty"}),e.jsx(d,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Add some symbols to start tracking your favorite stocks"}),e.jsx(oe,{variant:"contained",startIcon:e.jsx(Fn,{}),onClick:()=>u(!0),children:"Add Your First Symbol"})]})}),e.jsxs(Os,{open:h,onClose:()=>u(!1),children:[e.jsx(Ls,{children:"Add Symbol to Watchlist"}),e.jsx(ks,{children:e.jsx(_e,{autoFocus:!0,margin:"dense",label:"Stock Symbol",type:"text",fullWidth:!0,variant:"outlined",value:m,onChange:E=>p(E.target.value.toUpperCase()),placeholder:"e.g. AAPL, MSFT, GOOGL",helperText:"Enter a valid stock symbol (letters only)"})}),e.jsxs(Is,{children:[e.jsx(oe,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(oe,{onClick:A,variant:"contained",disabled:!m.trim()||!/^[A-Z]+$/.test(m.trim()),children:"Add Symbol"})]})]})]})},LN=()=>{const{user:r}=ps(),[t,s]=j.useState([]),[n,i]=j.useState(!0),[a,o]=j.useState(null),[l,c]=j.useState(new Date),h={Technology:"#2196F3",Healthcare:"#4CAF50",Financials:"#FF9800","Consumer Discretionary":"#9C27B0","Consumer Staples":"#795548",Energy:"#FF5722",Industrials:"#607D8B",Materials:"#8BC34A",Utilities:"#FFC107","Real Estate":"#E91E63","Communication Services":"#00BCD4"},{data:u,isLoading:m,error:p}=Qe({queryKey:["sector-performance"],queryFn:async()=>(await St.get("/api/market/sectors?limit=20&sortBy=overall_rank")).data,staleTime:6e4,enabled:!0,retry:!1}),{data:x,isLoading:b,error:w}=Qe({queryKey:["industry-performance"],queryFn:async()=>(await St.get("/api/market/industries?limit=20&sortBy=overall_rank")).data,staleTime:6e4,enabled:!0,retry:!1}),{data:C,isLoading:A,error:_}=Qe({queryKey:["sector-ranking-history"],queryFn:async()=>(await St.get("/api/sectors/ranking-history")).data,staleTime:3e5,enabled:!0,retry:!1}),{data:R,isLoading:E,error:T}=Qe({queryKey:["industry-ranking-history"],queryFn:async()=>{try{return(await St.get("/api/sectors/industries/ranking-history")).data}catch(S){return console.warn("Industry ranking history endpoint not available:",S.message),{data:[]}}},staleTime:3e5,enabled:!0,retry:!1});j.useEffect(()=>{M()},[]);const M=async()=>{try{o(null),i(!0),console.log("Loading sector analysis data from /api/sectors/performance");const S=await St.get("/api/sectors/performance");if(S?.data?.data&&Array.isArray(S.data.data)){const L=S.data.data.map(W=>({sector:W.sector||"Unknown",price:parseFloat(W.avg_price||0),change:0,changePercent:parseFloat(W.performance_pct||0),volume:parseInt(W.total_volume||0),marketCap:parseInt(W.stock_count||0)*1e9,color:h[W.sector]||"#666",dataSource:"database",stockCount:parseInt(W.stock_count||0),gainingStocks:parseInt(W.gaining_stocks||0),losingStocks:parseInt(W.losing_stocks||0)}));s(L),c(new Date),console.log("✅ Sector data loaded:",L.length)}else throw new Error("Invalid response structure from API")}catch(S){console.error("Failed to load sector data:",S),o(`Failed to load sector data: ${S.message}`),s([])}finally{i(!1)}},I=S=>{const L=Math.floor((new Date-S)/1e3);if(L<60)return`${L}s ago`;const W=Math.floor(L/60);return W<60?`${W}m ago`:`${Math.floor(W/60)}h ago`},N=t.filter(S=>!S.error).map(S=>({name:S.sector.length>15?S.sector.substring(0,15)+"...":S.sector,fullName:S.sector,performance:parseFloat(S.changePercent.toFixed(2)),color:S.color})).sort((S,L)=>L.performance-S.performance),k=t.filter(S=>!S.error).map(S=>({name:S.sector,value:S.marketCap/1e12,color:S.color}));return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsx(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:4,children:e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Sector Analysis"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Comprehensive sector performance analysis and comparisons"}),e.jsxs(g,{display:"flex",gap:1,mt:1,children:[e.jsx(X,{label:`${t?.length||0} sectors`,color:"primary",size:"small"}),e.jsx(X,{label:`Updated ${I(l)}`,color:"info",size:"small",variant:"outlined"})]})]})}),n&&e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,py:2,children:[e.jsx(rt,{sx:{flexGrow:1}}),e.jsx(d,{children:"Loading sector analysis data..."})]})})}),a&&e.jsxs(we,{severity:"error",sx:{mb:3},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Failed to Load Sector Data"}),e.jsx(d,{variant:"body2",children:a}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Check database connection and ensure sector data is populated."})]}),e.jsxs(y,{container:!0,spacing:3,mb:4,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",gap:1,children:[e.jsx(pl,{color:"primary"}),"Sector Performance Today"]}),e.jsx(g,{height:400,children:e.jsx(st,{width:"100%",height:"100%",children:e.jsxs(Yt,{data:N,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(ht,{}),e.jsx(ot,{formatter:S=>[`${S}%`,"Performance"]}),e.jsx(jt,{dataKey:"performance",fill:S=>S.color,radius:[4,4,0,0],children:(N||[]).map((S,L)=>e.jsx(xt,{fill:S.color},`cell-${L}`))})]})})})]})})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",gap:1,children:[e.jsx(Gt,{color:"primary"}),"Market Cap Distribution"]}),e.jsx(g,{height:400,children:e.jsx(st,{width:"100%",height:"100%",children:e.jsxs(Zr,{children:[e.jsx(Jr,{data:k,cx:"50%",cy:"50%",innerRadius:60,outerRadius:120,paddingAngle:2,dataKey:"value",children:(k||[]).map((S,L)=>e.jsx(xt,{fill:S.color},`cell-${L}`))}),e.jsx(ot,{formatter:S=>[`$${S.toFixed(1)}T`,"Market Cap"]}),e.jsx(gu,{})]})})})]})})})]}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{color:"primary"}),"Sector Ranking Trends (IBD-Style)"]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Track how sector rankings are trending over time (↑ improving, ↓ declining, → stable)"}),A?e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(rt,{sx:{width:"50%"}})}):_?e.jsx(we,{severity:"info",children:"Ranking history not yet available. Data will populate after sector loaders run."}):!C?.data||C.data.length===0?e.jsx(we,{severity:"info",children:"No historical ranking data available yet. Run loadsectordata.py to start populating history."}):e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.100"},children:[e.jsx(f,{children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Sector"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Trend"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Today"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"1 Wk Ago"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"3 Wks Ago"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"8 Wks Ago"})})]})}),e.jsx(ke,{children:C.data.slice(0,11).map((S,L)=>e.jsxs(V,{sx:{"&:hover":{backgroundColor:"grey.50"}},children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:S.sector})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"h6",sx:{color:S.direction==="↑"?"success.main":S.direction==="↓"?"error.main":"text.secondary",fontWeight:"bold"},children:S.direction})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings.today?.rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["1_week_ago"]?.rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["3_weeks_ago"]?.rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["8_weeks_ago"]?.rank||"-"})})]},L))})]})})]})}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",sx:{mb:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Lt,{color:"primary"}),"Industry Ranking Trends (IBD-Style)"]}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Monitor industry ranking progression to identify emerging opportunities (↑ improving, ↓ declining, → stable)"}),E?e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(rt,{sx:{width:"50%"}})}):T?e.jsx(we,{severity:"info",children:"Industry ranking history not yet available. Data will populate after industry loaders run."}):!R?.data||R.data.length===0?e.jsx(we,{severity:"info",children:"No historical industry ranking data available yet. Run loadindustrydata.py to start populating history."}):e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{sx:{backgroundColor:"grey.100"},children:[e.jsx(f,{children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Industry"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Trend"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Today"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"1 Wk Ago"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"3 Wks Ago"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"8 Wks Ago"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Stocks"})})]})}),e.jsx(ke,{children:R.data.slice(0,20).map((S,L)=>e.jsxs(V,{sx:{"&:hover":{backgroundColor:"grey.50"}},children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:S.industry})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"h6",sx:{color:S.direction==="↑"?"success.main":S.direction==="↓"?"error.main":"text.secondary",fontWeight:"bold"},children:S.direction})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings.today?.overall_rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["1_week_ago"]?.overall_rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["3_weeks_ago"]?.overall_rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings["8_weeks_ago"]?.overall_rank||"-"})}),e.jsx(f,{align:"center",children:e.jsx(d,{variant:"body2",children:S.rankings.today?.stock_count||"-"})})]},L))})]})})]})}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Top Sector Rankings"}),e.jsxs(y,{container:!0,spacing:2,alignItems:"center",sx:{mb:1,px:2,py:1,backgroundColor:"grey.200",borderRadius:1},children:[e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Rank"})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Sector"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"RS Rating"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Momentum"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Flow"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"20-Day %"})}),e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Industries"})})]}),m?e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(rt,{sx:{width:"50%"}})}):p?e.jsxs(we,{severity:"error",children:["Failed to load sector data: ",p?.message||p?.error||String(p)]}):u?.data?.sectors?.length?e.jsx(g,{children:(u?.data?.sectors||[]).map((S,L)=>{const W=(x?.data?.industries||[]).filter(F=>F.sector===S.sector);return e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{backgroundColor:"grey.50","&:hover":{backgroundColor:"grey.100"}},children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(X,{label:`#${S.overall_rank}`,size:"small",color:"primary",variant:"outlined"})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(d,{variant:"body1",fontWeight:"bold",children:S.sector})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(X,{label:`RS ${S.rs_rating}`,size:"small",sx:{bgcolor:S.rs_rating>=80?"success.main":S.rs_rating>=60?"info.main":S.rs_rating>=40?"warning.main":"error.main",color:"white",fontWeight:"bold"}})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(X,{label:S.momentum,color:S.momentum==="Strong"?"success":S.momentum==="Moderate"?"info":"default",size:"small"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(X,{label:S.flow,color:S.flow==="Inflow"?"success":S.flow==="Outflow"?"error":"default",size:"small"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.performance_20d)},children:Et(S.performance_20d)})}),e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(X,{label:`${S.industry_count} ind`,size:"small",variant:"outlined"})})]})}),e.jsx(os,{children:e.jsxs(g,{sx:{p:2},children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Top Industries in ",S.sector]}),W.length>0?e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Industry"}),e.jsx(f,{align:"center",children:"RS Rating"}),e.jsx(f,{align:"center",children:"Momentum"}),e.jsx(f,{align:"center",children:"Trend"}),e.jsx(f,{align:"right",children:"20-Day %"}),e.jsx(f,{align:"right",children:"Stocks"})]})}),e.jsx(ke,{children:W.slice(0,5).map((F,$)=>{const q=F.rs_rating>=80?"success.main":F.rs_rating>=60?"info.main":F.rs_rating>=40?"warning.main":"error.main";return e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:F.industry})}),e.jsx(f,{align:"center",children:e.jsx(X,{label:F.rs_rating,size:"small",sx:{bgcolor:q,color:"white",fontWeight:"bold"}})}),e.jsx(f,{align:"center",children:e.jsx(X,{label:F.momentum,color:F.momentum==="Strong"?"success":F.momentum==="Moderate"?"info":"default",size:"small"})}),e.jsx(f,{align:"center",children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,children:[F.trend==="Uptrend"&&e.jsx(at,{color:"success",fontSize:"small"}),F.trend==="Downtrend"&&e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsx(d,{variant:"body2",children:F.trend})]})}),e.jsx(f,{align:"right",sx:{color:Ts(F.performance_20d),fontWeight:600},children:Et(F.performance_20d)}),e.jsx(f,{align:"right",children:F.stock_count})]},$)})})]})}):e.jsx(d,{variant:"body2",color:"text.secondary",children:"No industry data available for this sector"})]})})]},L)})}):e.jsx(we,{severity:"warning",children:"No sector data available in database. Run loadindustrydata.py loader."})]})}),e.jsx(z,{sx:{mb:4},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600},children:"Top Industry Rankings"}),e.jsxs(y,{container:!0,spacing:2,alignItems:"center",sx:{mb:1,px:2,py:1,backgroundColor:"grey.200",borderRadius:1},children:[e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Rank"})}),e.jsx(y,{item:!0,xs:12,sm:3,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Industry"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"RS Rating"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Momentum"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"Trend"})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(d,{variant:"caption",fontWeight:"bold",children:"20-Day %"})})]}),b?e.jsx(g,{display:"flex",justifyContent:"center",py:4,children:e.jsx(rt,{sx:{width:"50%"}})}):w?e.jsx(we,{severity:"warning",children:"Industry rankings not available. Run loadindustrydata.py to populate data."}):x?.data?.industries?.length?e.jsx(g,{children:(x?.data?.industries||[]).map((S,L)=>{const W=S.rs_rating>=80?"success.main":S.rs_rating>=60?"info.main":S.rs_rating>=40?"warning.main":"error.main";return e.jsxs(is,{children:[e.jsx(as,{expandIcon:e.jsx(Vt,{}),sx:{backgroundColor:"grey.50","&:hover":{backgroundColor:"grey.100"}},children:e.jsxs(y,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(y,{item:!0,xs:12,sm:1,children:e.jsx(X,{label:`#${S.overall_rank}`,size:"small",color:"primary",variant:"outlined"})}),e.jsxs(y,{item:!0,xs:12,sm:3,children:[e.jsx(d,{variant:"body1",fontWeight:"bold",children:S.industry}),e.jsx(d,{variant:"caption",color:"text.secondary",children:S.sector})]}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(X,{label:`RS ${S.rs_rating}`,size:"small",sx:{bgcolor:W,color:"white",fontWeight:"bold"}})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsx(X,{label:S.momentum,color:S.momentum==="Strong"?"success":S.momentum==="Moderate"?"info":"default",size:"small"})}),e.jsx(y,{item:!0,xs:4,sm:2,children:e.jsxs(g,{display:"flex",alignItems:"center",gap:.5,children:[S.trend==="Uptrend"&&e.jsx(at,{color:"success",fontSize:"small"}),S.trend==="Downtrend"&&e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsx(d,{variant:"body2",children:S.trend})]})}),e.jsx(y,{item:!0,xs:12,sm:2,children:e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.performance_20d)},children:Et(S.performance_20d)})})]})}),e.jsx(os,{children:e.jsx(g,{sx:{p:2},children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,fontWeight:"bold",children:"Performance Metrics"}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"1-Day Performance:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.performance_1d)},children:Et(S.performance_1d)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"5-Day Performance:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.performance_5d)},children:Et(S.performance_5d)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"20-Day Performance:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.performance_20d)},children:Et(S.performance_20d)})]}),e.jsx(Fe,{}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"RS vs SPY:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.rs_vs_spy)},children:Et(S.rs_vs_spy)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Avg Change %:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",sx:{color:Ts(S.avg_change_percent)},children:Et(S.avg_change_percent)})]})]})]}),e.jsxs(y,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,fontWeight:"bold",children:"Volume & Market Metrics"}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Stock Count:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:S.stock_count})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Total Volume:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:Me(S.total_volume)})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Avg Volume:"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:Me(S.avg_volume)})]}),e.jsx(Fe,{}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Total Market Cap:"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:["$",Me(S.total_market_cap/1e9,1),"B"]})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",color:"text.secondary",children:"Avg Market Cap:"}),e.jsxs(d,{variant:"body2",fontWeight:"bold",children:["$",Me(S.avg_market_cap/1e9,1),"B"]})]})]})]}),e.jsxs(y,{item:!0,xs:12,children:[e.jsxs(d,{variant:"subtitle2",gutterBottom:!0,fontWeight:"bold",children:["Top Stocks in ",S.industry]}),e.jsxs(g,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:[(S.stock_symbols||[]).slice(0,10).map((F,$)=>e.jsx(X,{label:F,size:"small",variant:"outlined",sx:{fontFamily:"monospace"}},$)),S.stock_symbols?.length>10&&e.jsx(X,{label:`+${S.stock_symbols.length-10} more`,size:"small",variant:"outlined",color:"primary"})]})]})]})})})]},L)})}):e.jsx(we,{severity:"info",children:"No industry performance data available yet. Run loadindustrydata.py loader."}),x?.data?.summary&&e.jsx(g,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Showing top ",x.data.industries?.length||0," of"," ",x.data.summary.total_industries," industries |"," ","Avg 20-Day Performance:"," ",e.jsx("strong",{children:Et(x.data.summary.avg_performance_20d)})]})})]})})]})};function fl({children:r,value:t,index:s,...n}){return e.jsx("div",{role:"tabpanel",hidden:t!==s,id:`dashboard-tabpanel-${s}`,"aria-labelledby":`dashboard-tab-${s}`,...n,children:t===s&&e.jsx(g,{sx:{p:3},children:r})})}const FN=()=>{const{user:r}=ps(),[t,s]=j.useState(0),[n,i]=j.useState(!1),[a,o]=j.useState(new Date),[l,c]=j.useState(["AAPL","TSLA","NVDA","MSFT","GOOGL"]),[h,u]=j.useState(null),[m,p]=j.useState(null),[x,b]=j.useState(!0),[w,C]=j.useState(null),[A,_]=j.useState(5),R=j.useRef(null),E=j.useCallback(async()=>{try{if(C(null),!r){console.warn("User not authenticated, skipping market data fetch");return}if(!l||l.length===0){console.warn("No watchlist symbols available for market data streaming");return}const k=await St.get(`/api/websocket/stream/${l.join(",")}`);if(k?.data.success){const S=k?.data.data,L=(l||[]).map(W=>{const F=S?.data[W];if(F&&!F.error){const $=(F.bidPrice+F.askPrice)/2;return{symbol:W,price:$,bidPrice:F.bidPrice,askPrice:F.askPrice,spread:F.askPrice-F.bidPrice,change:0,changePercent:0,volume:F.bidSize+F.askSize,timestamp:F.timestamp,alert:!1,dataSource:"live",chartData:Array.from({length:20},(q,ne)=>({value:$+(ne%3-1)*.1}))}}else return{symbol:W,price:0,change:0,changePercent:0,volume:0,error:F?.error||"Data unavailable",timestamp:new Date().toISOString(),alert:!0,dataSource:"error",chartData:[]}});u({isMockData:!1,watchlistData:L,indices:{sp500:{value:0,change:0,changePercent:0},nasdaq:{value:0,change:0,changePercent:0}},vix:{value:0,label:"Data Loading..."},volume:{total:0,average:0},marketMovers:L.slice(0,6),sectorPerformance:[],lastUpdated:new Date().toISOString(),dataProvider:"alpaca",requestInfo:k?.data.request_info}),console.log("✅ Live market data loaded successfully",{symbols:l?.length||0,successful:k?.data.statistics?.successful||0,cached:k?.data.statistics?.cached||0,failed:k?.data.statistics?.failed||0})}else throw new Error("Failed to fetch live market data")}catch(k){C(k.message),u({isMockData:!1,error:!0,errorMessage:k.message,watchlistData:(l||[]).map(S=>({symbol:S,price:0,change:0,changePercent:0,volume:0,error:"Connection failed",alert:!0,dataSource:"error",chartData:[]})),indices:{sp500:{value:0,change:0,changePercent:0},nasdaq:{value:0,change:0,changePercent:0}},vix:{value:0,label:"Connection Error"},volume:{total:0,average:0},marketMovers:[],sectorPerformance:[]})}finally{b(!1)}},[r,l]);j.useEffect(()=>{E()},[E]),j.useEffect(()=>(n&&(typeof process>"u"||!0)?R.current=setInterval(()=>{E(),o(new Date)},A*1e3):R.current&&clearInterval(R.current),()=>{R.current&&clearInterval(R.current)}),[n,A,E]);const T=(k,S)=>{s(S)},M=()=>{i(!n)},I=k=>{c(l.filter(S=>S!==k))},N=k=>{const S=Math.floor((new Date-k)/1e3);if(S<60)return`${S}s ago`;const L=Math.floor(S/60);return L<60?`${L}m ago`:`${Math.floor(L/60)}h ago`};return e.jsxs(lt,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",mb:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Institutional Real-Time Dashboard"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Professional-grade streaming market data with sub-second latency"}),e.jsxs(g,{display:"flex",gap:1,mt:1,children:[e.jsx(X,{label:"Level II Data",color:"primary",size:"small",variant:"filled"}),e.jsx(X,{label:"Market Microstructure",color:"success",size:"small",variant:"filled"}),e.jsx(X,{label:"Real-time Analytics",color:"primary",size:"small",variant:"filled"}),e.jsx(X,{label:`${A}s refresh`,color:"secondary",size:"small",variant:"filled"})]})]}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,px:2,py:1,bgcolor:n?"success.light":"grey.100",borderRadius:2,children:[e.jsx(g,{width:8,height:8,borderRadius:"50%",bgcolor:n?"success.main":"grey.500",sx:{animation:n?"pulse 1s infinite":"none"}}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:n?"LIVE":"PAUSED"})]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Last update: ",N(a)]}),e.jsxs(oe,{variant:n?"contained":"outlined",startIcon:n?e.jsx($S,{}):e.jsx(Gr,{}),onClick:M,color:n?"error":"success",children:[n?"Pause":"Start"," Stream"]}),e.jsx(Ge,{onClick:E,disabled:n,"aria-label":"Refresh market data",children:e.jsx(Es,{})})]})]}),x&&e.jsx(z,{sx:{mb:3},children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,py:4,children:[e.jsx(Je,{size:24}),e.jsx(d,{children:"Loading live market data..."})]})})}),w&&e.jsx(we,{severity:"error",sx:{mb:3},children:e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Failed to Load Live Market Data"}),e.jsx(d,{variant:"body2",gutterBottom:!0,children:w}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Please ensure you have:"}),e.jsxs("ul",{style:{margin:"8px 0",paddingLeft:"20px"},children:[e.jsx("li",{children:"Configured your Alpaca API credentials in Settings"}),e.jsx("li",{children:"Valid market data permissions on your Alpaca account"}),e.jsx("li",{children:"Stable internet connection"})]}),e.jsx(oe,{variant:"outlined",size:"small",onClick:E,sx:{mt:1},children:"Retry"})]})}),e.jsx(z,{sx:{mb:3,bgcolor:"primary.dark",color:"primary.contrastText"},children:e.jsx(U,{sx:{py:2},children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:4,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",fontWeight:"bold",children:"Market Status: OPEN"}),e.jsx(d,{variant:"body2",opacity:.8,children:"NYSE | NASDAQ | Pre-Market 9:30 AM EST"})]}),e.jsxs(g,{display:"flex",gap:3,children:[e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",opacity:.8,children:"Trading Volume"}),e.jsxs(d,{variant:"h6",fontWeight:"bold",children:[h?Me((h.volume?.total||0)/1e9,1):"0","B"]})]}),e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",opacity:.8,children:"Market Breadth"}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"2,845 ↑ / 1,203 ↓"})]}),e.jsxs(g,{textAlign:"center",children:[e.jsx(d,{variant:"body2",opacity:.8,children:"VWAP Deviation"}),e.jsx(d,{variant:"h6",fontWeight:"bold",children:"+0.23%"})]})]})]}),e.jsx(g,{display:"flex",alignItems:"center",gap:2,children:e.jsxs(g,{textAlign:"right",children:[e.jsx(d,{variant:"body2",opacity:.8,children:"Data Feed Status"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(g,{width:6,height:6,borderRadius:"50%",bgcolor:h&&!h.error?"success.main":w?"error.main":"warning.main"}),e.jsx(d,{variant:"body2",fontWeight:"bold",children:h&&!h.error?"Live Data":w?"Disconnected":"Loading..."})]})]})})]})})}),h&&!x&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{container:!0,spacing:3,mb:4,children:[e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"primary",children:"S&P 500"}),e.jsx(d,{variant:"h4",children:Me(h.indices.sp500.value)}),e.jsxs(g,{display:"flex",alignItems:"center",children:[h.indices.sp500.change>=0?e.jsx(at,{color:"success",fontSize:"small"}):e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsxs(d,{variant:"body2",color:h.indices.sp500.change>=0?"success.main":"error.main",children:[Me(h.indices.sp500.change)," (",Et(h.indices.sp500.changePercent),")"]})]})]}),e.jsx(Gt,{color:"primary",fontSize:"large"})]})})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"secondary",children:"NASDAQ"}),e.jsx(d,{variant:"h4",children:Me(h.indices.nasdaq.value)}),e.jsxs(g,{display:"flex",alignItems:"center",children:[h.indices.nasdaq.change>=0?e.jsx(at,{color:"success",fontSize:"small"}):e.jsx(Tt,{color:"error",fontSize:"small"}),e.jsxs(d,{variant:"body2",color:h.indices.nasdaq.change>=0?"success.main":"error.main",children:[Me(h.indices.nasdaq.change)," (",Et(h.indices.nasdaq.changePercent),")"]})]})]}),e.jsx(Lt,{color:"secondary",fontSize:"large"})]})})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"info.main",children:"VIX"}),e.jsx(d,{variant:"h4",children:Me(h.vix.value)}),e.jsx(d,{variant:"body2",color:"text.secondary",children:h.vix.label})]}),e.jsx(xn,{color:"info",fontSize:"large"})]})})})}),e.jsx(y,{item:!0,xs:12,md:3,children:e.jsx(z,{children:e.jsx(U,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"warning.main",children:"Volume"}),e.jsxs(d,{variant:"h4",children:[Me(h.volume.total/1e6,0),"M"]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["vs"," ",Me(h.volume.average/1e6,0),"M avg"]})]}),e.jsx(pl,{color:"warning",fontSize:"large"})]})})})})]}),e.jsx(g,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Ir,{value:t,onChange:T,"aria-label":"dashboard tabs",children:[e.jsx(it,{value:0,label:"Watchlist",icon:e.jsx(jn,{})}),e.jsx(it,{value:1,label:"Market Movers",icon:e.jsx(at,{})}),e.jsx(it,{value:2,label:"Sector Performance",icon:e.jsx(pl,{})}),e.jsx(it,{value:3,label:"News Feed",icon:e.jsx(Il,{})})]})}),e.jsx(fl,{value:t,index:0,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,lg:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Institutional Watchlist",subheader:"Real-time Level II data with market microstructure analysis",action:e.jsxs(g,{display:"flex",gap:1,children:[e.jsxs(_e,{select:!0,size:"small",label:"Refresh Rate",value:A,onChange:k=>_(k.target.value),sx:{minWidth:120},children:[e.jsx(J,{value:1,children:"1 second"}),e.jsx(J,{value:5,children:"5 seconds"}),e.jsx(J,{value:10,children:"10 seconds"}),e.jsx(J,{value:30,children:"30 seconds"})]}),e.jsx(Jt,{control:e.jsx(rs,{checked:n,onChange:M,color:"primary"}),label:"Live Updates"})]})}),e.jsx(U,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Last"}),e.jsx(f,{align:"right",children:"Bid/Ask"}),e.jsx(f,{align:"right",children:"Change"}),e.jsx(f,{align:"right",children:"Volume"}),e.jsx(f,{align:"right",children:"VWAP"}),e.jsx(f,{align:"right",children:"Momentum"}),e.jsx(f,{align:"right",children:"Actions"})]})}),e.jsx(ke,{children:(h.watchlistData||[]).map(k=>{const S=k.price,L=(k.price-S)/S*100;return e.jsxs(V,{sx:{backgroundColor:k.alert?"warning.light":"inherit","&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(f,{children:e.jsxs(g,{display:"flex",alignItems:"center",children:[e.jsx(d,{variant:"subtitle2",fontWeight:"bold",children:k.symbol}),k.alert&&e.jsx(X,{label:"Alert",color:"warning",size:"small",sx:{ml:1,height:16}})]})}),e.jsx(f,{align:"right",children:e.jsxs(g,{textAlign:"right",children:[e.jsx(d,{variant:"body2",fontWeight:"bold",children:ge(k.price)}),e.jsxs(d,{variant:"caption",color:k.change>=0?"success.main":"error.main",children:[k.change>=0?"+":"",ge(k.change)]})]})}),e.jsx(f,{align:"right",children:e.jsxs(g,{textAlign:"right",children:[e.jsxs(d,{variant:"caption",color:"text.secondary",children:[ge(k.price*.999)," /"," ",ge(k.price*1.001)]}),e.jsxs(d,{variant:"caption",display:"block",color:"text.secondary",children:["Spread:"," ",ge(k.price*.002)]})]})}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`${k.changePercent>=0?"+":""}${Et(k.changePercent)}`,color:k.changePercent>=0?"success":"error",size:"small",variant:"filled"})}),e.jsx(f,{align:"right",children:e.jsxs(g,{textAlign:"right",children:[e.jsxs(d,{variant:"body2",children:[Me(k.volume/1e3),"K"]}),e.jsxs(d,{variant:"caption",color:"text.secondary",children:["vs"," ",Me(k.volume*.8/1e3),"K avg"]})]})}),e.jsx(f,{align:"right",children:e.jsxs(g,{textAlign:"right",children:[e.jsx(d,{variant:"body2",children:ge(S)}),e.jsxs(d,{variant:"caption",color:L>=0?"success.main":"error.main",children:[L>=0?"+":"",L.toFixed(2),"%"]})]})}),e.jsx(f,{align:"right",children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1,children:[e.jsx(g,{width:40,height:20,children:e.jsx(st,{width:"100%",height:"100%",children:e.jsx(Ks,{data:k.chartData,children:e.jsx(Ds,{type:"monotone",dataKey:"value",stroke:k.changePercent>=0?"#4caf50":"#f44336",strokeWidth:1.5,dot:{r:0}})})})}),e.jsx(X,{label:"↗",color:"success",size:"small",variant:"outlined"})]})}),e.jsx(f,{align:"right",children:e.jsxs(g,{display:"flex",gap:.5,children:[e.jsx(Ge,{size:"small",onClick:()=>I(k.symbol),color:"error","aria-label":`Remove ${k.symbol} from watchlist`,children:e.jsx(VS,{})}),e.jsx(Ge,{size:"small",color:"primary","aria-label":`View details for ${k.symbol}`,children:e.jsx(jn,{})})]})})]},k.symbol)})})]})})})]})}),e.jsx(y,{item:!0,xs:12,lg:4,children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Order Flow Analysis"}),e.jsxs(U,{children:[e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Institutional Activity (Last 30min)"}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Large Orders"}),e.jsx(X,{label:"247 blocks",color:"primary",size:"small"})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mb:1,children:[e.jsx(d,{variant:"body2",children:"Dark Pool"}),e.jsx(X,{label:"32%",color:"secondary",size:"small"})]}),e.jsxs(g,{display:"flex",justifyContent:"between",children:[e.jsx(d,{variant:"body2",children:"Sweep Activity"}),e.jsx(X,{label:"High",color:"warning",size:"small"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",mb:1,children:"Buy/Sell Pressure"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(g,{flex:.65,height:8,bgcolor:"success.main",borderRadius:1}),e.jsx(g,{flex:.35,height:8,bgcolor:"error.main",borderRadius:1})]}),e.jsxs(g,{display:"flex",justifyContent:"between",mt:.5,children:[e.jsx(d,{variant:"caption",color:"success.main",children:"65% Buy"}),e.jsx(d,{variant:"caption",color:"error.main",children:"35% Sell"})]})]})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Volume Profile"}),e.jsxs(U,{children:[e.jsx(st,{width:"100%",height:150,children:e.jsxs(pl,{data:[{price:"185",volume:40},{price:"186",volume:70},{price:"187",volume:100},{price:"188",volume:85},{price:"189",volume:120},{price:"190",volume:95},{price:"191",volume:60}],layout:"horizontal",children:[e.jsx(dt,{type:"number",hide:!0}),e.jsx(ht,{type:"category",dataKey:"price",width:40}),e.jsx(jt,{dataKey:"volume",fill:"#1976d2"})]})}),e.jsx(d,{variant:"caption",color:"text.secondary",children:"Price levels with highest volume concentration"})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Real-time Alerts"}),e.jsx(U,{children:e.jsxs(jr,{dense:!0,children:[e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"warning.main",width:24,height:24},children:e.jsx(Ar,{fontSize:"small"})})}),e.jsx(Ut,{primary:"AAPL Volume Spike",secondary:"3x avg volume in last 5min",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}})]}),e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"info.main",width:24,height:24},children:e.jsx(lo,{fontSize:"small"})})}),e.jsx(Ut,{primary:"TSLA Breakout",secondary:"Above 20-day resistance",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}})]}),e.jsxs(Dt,{children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"success.main",width:24,height:24},children:e.jsx(Yr,{fontSize:"small"})})}),e.jsx(Ut,{primary:"NVDA Support Hold",secondary:"Bounced off 50-day MA",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}})]})]})})]})})]})})]})}),e.jsx(fl,{value:t,index:1,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Top Gainers"}),e.jsx(U,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Price"}),e.jsx(f,{align:"right",children:"Change"}),e.jsx(f,{align:"right",children:"Volume"})]})}),e.jsx(ke,{children:h.marketMovers.filter(k=>k.change>0).sort((k,S)=>S.changePercent-k.changePercent).slice(0,10).map(k=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:k.symbol})}),e.jsx(f,{align:"right",children:ge(k.price)}),e.jsx(f,{align:"right",children:e.jsx(X,{label:`+${Et(k.changePercent)}`,color:"success",size:"small"})}),e.jsxs(f,{align:"right",children:[Me(k.volume/1e6,1),"M"]})]},k.symbol))})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Top Losers"}),e.jsx(U,{children:e.jsx(Ae,{children:e.jsxs(Oe,{size:"small",children:[e.jsx(Ve,{children:e.jsxs(V,{children:[e.jsx(f,{children:"Symbol"}),e.jsx(f,{align:"right",children:"Price"}),e.jsx(f,{align:"right",children:"Change"}),e.jsx(f,{align:"right",children:"Volume"})]})}),e.jsx(ke,{children:h.marketMovers.filter(k=>k.change<0).sort((k,S)=>k.changePercent-S.changePercent).slice(0,10).map(k=>e.jsxs(V,{children:[e.jsx(f,{children:e.jsx(d,{variant:"body2",fontWeight:"bold",children:k.symbol})}),e.jsx(f,{align:"right",children:ge(k.price)}),e.jsx(f,{align:"right",children:e.jsx(X,{label:Et(k.changePercent),color:"error",size:"small"})}),e.jsxs(f,{align:"right",children:[Me(k.volume/1e6,1),"M"]})]},k.symbol))})]})})})]})})]})}),e.jsxs(fl,{value:t,index:2,children:[e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Sector Performance"}),e.jsx(U,{children:e.jsx(st,{width:"100%",height:400,children:e.jsxs(Yt,{data:h.sectorPerformance,children:[e.jsx(ut,{strokeDasharray:"3 3"}),e.jsx(dt,{dataKey:"sector",angle:-45,textAnchor:"end",height:80}),e.jsx(ht,{}),e.jsx(ot,{formatter:k=>[`${Et(k)}`,"Change"]}),e.jsx(jt,{dataKey:"change",children:(h.sectorPerformance||[]).map((k,S)=>e.jsx(xt,{fill:k.change>=0?"#4caf50":"#f44336"},`cell-${S}`))})]})})})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Sector Leaders"}),e.jsx(U,{children:h.sectorPerformance.sort((k,S)=>S.change-k.change).map((k,S)=>e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"between",py:1,children:[e.jsx(d,{variant:"body2",children:k.sector}),e.jsx(X,{label:`${k.change>=0?"+":""}${Et(k.change)}`,color:k.change>=0?"success":"error",size:"small",variant:S===0?"filled":"outlined"})]},k.sector))})]})})]}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Market Data Analysis"}),e.jsx(U,{children:e.jsx(g,{sx:{textAlign:"center",py:4},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Advanced market analysis tools and sector insights available."})})})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsx(y,{container:!0,spacing:2,children:e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Dark Pool Activity"}),e.jsx(U,{children:e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Institutional Block Trades"}),["AAPL","MSFT","NVDA"].map((k,S)=>e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",py:.5,children:[e.jsx(d,{variant:"body2",children:k}),e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsxs(d,{variant:"caption",color:"text.secondary",children:[(Math.random()*5+1).toFixed(1),"M"]}),e.jsx(X,{label:Math.random()>.5?"BUY":"SELL",color:Math.random()>.5?"success":"error",size:"small",variant:"outlined"})]})]},k))]})})]})})})})]})]}),e.jsx(fl,{value:t,index:3,children:e.jsxs(y,{container:!0,spacing:3,children:[e.jsx(y,{item:!0,xs:12,md:8,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Live Market News",action:e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(X,{label:"LIVE",color:"error",size:"small",sx:{animation:n?"pulse 2s infinite":"none","&.MuiChip-colorError":{backgroundColor:"#ff1744",color:"white"}}}),e.jsx(Ge,{onClick:()=>{E()},disabled:n||x,"aria-label":"Refresh news feed data",children:e.jsx(Es,{})})]})}),e.jsx(U,{sx:{maxHeight:600,overflow:"auto"},children:m&&m.length>0?e.jsx(jr,{children:(m||[]).map((k,S)=>{const L=k.published_at?Math.floor((Date.now()-new Date(k.published_at).getTime())/6e4):0,W={earnings:{type:"earnings",icon:"📊",color:"success.main"},analyst:{type:"analyst",icon:"📈",color:"info.main"},market:{type:"market",icon:"⚡",color:"warning.main"},general:{type:"news",icon:"📰",color:"primary.main"},regulatory:{type:"regulatory",icon:"⚖️",color:"primary.main"}},F=W[k.category]||W.general;return e.jsxs(Dt,{divider:!0,children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:F.color,width:32,height:32},children:F.icon})}),e.jsx(Ut,{primary:e.jsxs(g,{display:"flex",alignItems:"flex-start",justifyContent:"space-between",children:[e.jsx(d,{variant:"body2",sx:{fontWeight:500,pr:1},children:k.headline||k.title}),e.jsxs(g,{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5,children:[e.jsx(X,{label:(k.impact||"medium").toUpperCase(),color:k.impact==="high"?"error":k.impact==="medium"?"warning":"default",size:"small",variant:"outlined"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:L>0?`${L}m ago`:"Just now"})]})]}),secondary:e.jsxs(g,{sx:{mt:1},children:[e.jsx(d,{variant:"caption",color:"text.secondary",children:k.summary||k.description||"No additional details available"}),k.symbols&&k.symbols.length>0&&e.jsxs(d,{variant:"caption",color:"text.secondary",display:"block",sx:{mt:.5},children:["Related:"," ",k.symbols.slice(0,3).join(", ")]})]})})]},k.id||S)})}):e.jsx(g,{sx:{textAlign:"center",py:4},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:x?"Loading news feed...":"No market news available. Try refreshing to load latest news."})})})]})}),e.jsx(y,{item:!0,xs:12,md:4,children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Market Sentiment"}),e.jsxs(U,{children:[e.jsxs(g,{mb:2,children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Overall Market Mood"}),e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(g,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"success.light",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(d,{variant:"h6",children:"😊"})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",color:"success.main",children:"Bullish"}),e.jsx(d,{variant:"caption",color:"text.secondary",children:h?.watchlistData?`${h.watchlistData.filter(k=>k.changePercent>0).length}/${h.watchlistData?.length||0} stocks up`:"Based on current market data"})]})]})]}),e.jsx(Fe,{sx:{my:2}}),e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"News Categories (Last Hour)"}),[{category:"Earnings",count:Math.floor(Math.random()*15)+5,color:"success"},{category:"Analyst Notes",count:Math.floor(Math.random()*10)+3,color:"info"},{category:"Market Moving",count:Math.floor(Math.random()*8)+2,color:"warning"},{category:"Regulatory",count:Math.floor(Math.random()*5)+1,color:"error"}].map((k,S)=>e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",py:.5,children:[e.jsx(d,{variant:"body2",children:k.category}),e.jsx(X,{label:k.count,color:k.color,size:"small",variant:"outlined"})]},S))]})]})]})}),e.jsx(y,{item:!0,xs:12,children:e.jsxs(z,{children:[e.jsx(Ue,{title:"Economic Calendar"}),e.jsx(U,{children:e.jsxs(g,{children:[e.jsx(d,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Today's Key Events"}),[{time:"8:30 AM",event:"Initial Jobless Claims",impact:"high"},{time:"10:00 AM",event:"Consumer Confidence",impact:"medium"},{time:"2:00 PM",event:"Fed Chair Speech",impact:"high"},{time:"4:00 PM",event:"Treasury Auction",impact:"low"}].map((k,S)=>e.jsxs(g,{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,children:[e.jsxs(g,{children:[e.jsx(d,{variant:"body2",fontWeight:"medium",children:k.time}),e.jsx(d,{variant:"caption",color:"text.secondary",children:k.event})]}),e.jsx(X,{label:k.impact,color:k.impact==="high"?"error":k.impact==="medium"?"warning":"default",size:"small",variant:"outlined"})]},S))]})})]})})]})})]})})]})]})},NN=()=>{const r=ps(),[t,s]=j.useState([]),n=l=>{const h=`${new Date().toLocaleTimeString()}: ${l}`;s(u=>[...u,h])};j.useEffect(()=>{n("AuthTest component mounted"),n(`Initial auth state: loading=${r.isLoading}, authenticated=${r.isAuthenticated}`)},[]),j.useEffect(()=>{n(`Auth state changed: loading=${r.isLoading}, authenticated=${r.isAuthenticated}, user=${r.user?.username||"none"}`)},[r.isLoading,r.isAuthenticated,r.user]);const i=async()=>{n("Attempting to login with test user...");try{const l=await r.login("testuser","testpass");n(`Login result: ${JSON.stringify(l)}`)}catch(l){n(`Login error: ${l.message}`)}},a=async()=>{n("Attempting to logout...");try{await r.logout(),n("Logout successful")}catch(l){n(`Logout error: ${l.message}`)}},o=async()=>{n("Manually checking auth state...");try{await r.checkAuthState(),n("Auth state check completed")}catch(l){n(`Auth state check error: ${l.message}`)}};return e.jsxs(lt,{maxWidth:"md",children:[e.jsx(d,{variant:"h4",gutterBottom:!0,children:"Authentication Test Page"}),e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Current Auth State:"}),e.jsxs(d,{children:["Loading: ",r.isLoading?"⏳ Yes":"✅ No"]}),e.jsxs(d,{children:["Authenticated: ",r.isAuthenticated?"✅ Yes":"❌ No"]}),e.jsxs(d,{children:["User: ",r.user?`✅ ${r.user.username}`:"❌ None"]}),e.jsxs(d,{children:["Error: ",r.error||"❌ None"]}),e.jsxs(d,{children:["Tokens: ",r.tokens?"✅ Present":"❌ None"]}),e.jsxs(g,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(oe,{onClick:i,variant:"contained",size:"small",children:"Login Test User"}),e.jsx(oe,{onClick:a,variant:"outlined",size:"small",children:"Logout"}),e.jsx(oe,{onClick:o,variant:"outlined",size:"small",children:"Check Auth State"})]})]})}),e.jsx(z,{sx:{mb:3},children:e.jsxs(U,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Local Storage Tokens:"}),e.jsxs(d,{children:["accessToken:"," ",localStorage.getItem("accessToken")?"✅ Present":"❌ Missing"]}),e.jsxs(d,{children:["authToken:"," ",localStorage.getItem("authToken")?"✅ Present":"❌ Missing"]})]})}),e.jsx(z,{children:e.jsxs(U,{children:[e.jsxs(d,{variant:"h6",gutterBottom:!0,children:["Debug Log (",t?.length||0," entries):"]}),e.jsx(g,{sx:{maxHeight:300,overflow:"auto",bgcolor:"grey.50",p:1},children:(t||[]).map((l,c)=>e.jsx(d,{variant:"body2",sx:{fontFamily:"monospace",marginBottom:"2px",fontSize:"0.75rem"},children:l},c))}),e.jsx(oe,{onClick:()=>s([]),variant:"outlined",size:"small",sx:{mt:1},children:"Clear Log"})]})})]})},WN=(r,t={})=>{const[s,n]=j.useState(!1),[i,a]=j.useState(null),o=j.useRef(null),l=j.useRef(null),c=j.useCallback(()=>{try{const m=r||"ws://localhost:3001/ws";o.current=new WebSocket(m),o.current.onopen=()=>{n(!0),a(null)},o.current.onmessage=p=>{t.onMessage&&t.onMessage(p.data)},o.current.onerror=p=>{a(new Error("WebSocket connection failed")),n(!1)},o.current.onclose=()=>{n(!1)}}catch(m){a(m),n(!1)}},[r,t]),h=j.useCallback(()=>{o.current&&typeof o.current.close=="function"&&(o.current.close(),o.current=null),n(!1),l.current&&(clearTimeout(l.current),l.current=null)},[]),u=j.useCallback(m=>{if(o.current&&o.current.readyState===WebSocket.OPEN){const p=typeof m=="string"?m:JSON.stringify(m);return o.current.send(p),console.log("📤 WebSocket message sent:",p),!0}else return console.warn("⚠️ WebSocket not connected, cannot send message:",m),!1},[]);return j.useEffect(()=>(t.enabled!==!1&&t.autoConnect!==!1?c():h(),()=>{h()}),[c,h,t.autoConnect,t.enabled]),{isConnected:s,error:i,sendMessage:u,connect:c,disconnect:h}},Zd={BASE:36,START_INDEX:2,END_INDEX:9},$N=()=>{const{_user:r}=ps(),[t,s]=j.useState([{id:1,type:"assistant",content:"Hello! I'm your enhanced AI investment assistant. I can provide real-time market analysis, personalized portfolio insights, and comprehensive investment guidance. What would you like to explore today?",timestamp:new Date,suggestions:["Analyze my portfolio performance","Current market opportunities","Risk assessment and optimization","Investment strategy review"],enhanced:!0}]),[n,i]=j.useState(""),[a,o]=j.useState(!1),[l,c]=j.useState(!1),[h,u]=j.useState(""),[m,p]=j.useState(null),[x,b]=j.useState(!1),[w,C]=j.useState(null),[A,_]=j.useState(null),[R,E]=j.useState(""),[T,M]=j.useState(!1),[I,N]=j.useState(new Set),[k,S]=j.useState({}),[L,W]=j.useState(!0),[F,$]=j.useState(!0),[q,ne]=j.useState("default"),[he,re]=j.useState("claude-3-haiku"),[G,H]=j.useState("balanced"),P=j.useRef(null),D=j.useRef(null),Y=j.useRef({}),{isConnected:ce,sendMessage:ae}=WN("/ws/ai",{enabled:L,onMessage:Pe}),ee=[{icon:e.jsx(at,{}),text:"Market Pulse",action:"Give me a comprehensive market analysis with current trends, sector performance, and key opportunities to watch today",color:"primary"},{icon:e.jsx(Fs,{}),text:"Portfolio Deep Dive",action:"Perform a detailed analysis of my portfolio including risk assessment, sector allocation, performance metrics, and optimization recommendations",color:"secondary"},{icon:e.jsx(Pr,{}),text:"Investment Research",action:"Help me research and analyze potential investment opportunities based on my current portfolio and risk profile",color:"success"},{icon:e.jsx(Sx,{}),text:"Strategy Advisor",action:"Review my investment strategy and provide recommendations for optimization, rebalancing, and future planning",color:"warning"}],te=()=>{P.current&&typeof P.current.scrollIntoView=="function"&&P.current.scrollIntoView({behavior:"smooth"})};j.useEffect(()=>{te()},[t,h]);function Pe(v){try{const ie=JSON.parse(v?.data);switch(ie.type){case"connection_established":console.log("✅ WebSocket connected:",ie._connectionId);break;case"ai_response_chunk":ie.streamId===m&&u(Q=>Q+(ie.content||""));break;case"ai_response_complete":if(ie.streamId===m){const Q={id:ie.messageId||Date.now(),type:"assistant",content:ie.fullResponse||h,suggestions:ie.suggestions||[],metadata:ie.metadata||{},timestamp:new Date,enhanced:!0,streamId:ie.streamId};s(Z=>[...Z,Q]),u(""),p(null),c(!1)}break;case"ai_streamerror":{console.error("Streaming error:",ie.error),c(!1),u(""),p(null);const Q={id:Date.now(),type:"assistant",content:`I encountered an error while processing your request: ${ie.error}. Please try again.`,timestamp:new Date,isError:!0};s(Z=>[...Z,Q]);break}case"error":console.error("WebSocket error:",ie.error);break;default:console.warn("Unknown WebSocket message type:",ie.type);break}}catch(ie){console.error(ie)}}const Be=async(v=null)=>{const ie=v||n.trim();if(!ie||a||l)return;const Q={id:Date.now(),type:"user",content:ie,timestamp:new Date};if(s(Z=>[...Z,Q]),i(""),L&&ce){c(!0),u("");const Z=`stream_${Date.now()}_${Math.random().toString(Zd.BASE).substring(Zd.START_INDEX,Zd.END_INDEX)}`;p(Z),ae({type:"ai_chat_request",content:ie,conversationId:q,context:{streamingEnabled:!0,model:he,responseStyle:G},options:{model:he}})}else{o(!0);try{const Z=await Ku(ie,{conversationId:q,model:he,responseStyle:G});if(Z.success){const K={id:Z.message.id||Date.now(),type:"assistant",content:Z.message.content,suggestions:Z.message.suggestions||[],metadata:Z.message.metadata||{},timestamp:new Date(Z.message.timestamp||new Date),enhanced:Z.enhanced||!1};s(ue=>[...ue,K])}else throw new Error(Z.error||"Failed to send message")}catch(Z){console.error(Z);const K={id:Date.now()+1,type:"assistant",content:"I'm sorry, I encountered an error. Please try again later.",timestamp:new Date,isError:!0};s(ue=>[...ue,K])}finally{o(!1)}}},et=()=>{m&&ce&&ae({type:"stream_stop",streamId:m}),c(!1),u(""),p(null)},De=(v,ie)=>{switch(v){case"copy":navigator.clipboard.writeText(ie.content);break;case"bookmark":N(Q=>{const Z=new Set(Q);return Z.has(ie.id)?Z.delete(ie.id):Z.add(ie.id),Z});break;case"share":navigator.share?navigator.share({title:"AI Chat Message",text:ie.content,url:window.location.href}).catch(Q=>console.error("Error sharing:",Q)):(navigator.clipboard.writeText(`AI Chat Message: ${ie.content}`),alert("Message copied to clipboard!"));break;case"thumbup":S(Q=>({...Q,[ie.id]:Q[ie.id]==="thumbup"?null:"thumbup"}));break;case"thumbdown":S(Q=>({...Q,[ie.id]:Q[ie.id]==="thumbdown"?null:"thumbdown"}));break;case"edit":ie.type==="user"&&(i(ie.content),D.current?.focus(),s(Q=>Q.filter(Z=>Z.id!==ie.id)));break;case"reply":i(`Regarding "${ie.content.substring(0,50)}...": `),D.current?.focus();break;default:console.warn("Unexpected message action:",v);break}_(null)},ze=v=>{if(E(v),!v.trim())return;const ie=t.filter(Q=>{const Z=v.toLowerCase();return Q.content.toLowerCase().includes(Z)||Q.type==="user"&&Q.content.toLowerCase().includes(Z)||Q.suggestions&&Q.suggestions.some(K=>K.toLowerCase().includes(Z))});if(ie.length>0){const Q=ie[0],Z=Y.current[Q.id];Z&&(Z.scrollIntoView({behavior:"smooth",block:"center"}),Z.style.backgroundColor="#fff3cd",setTimeout(()=>{Z.style.backgroundColor=""},2e3))}},ve=async()=>{try{await Yu(),s([{id:1,type:"assistant",content:"Chat cleared. How can I help you today?",timestamp:new Date,suggestions:["Analyze my portfolio performance","Current market opportunities","Risk assessment and optimization","Investment strategy review"]}])}catch(v){console.error(v)}C(null)},B=()=>{const v={conversationId:q,timestamp:new Date().toISOString(),messages:(t||[]).map(K=>({type:K.type,content:K.content,timestamp:K.timestamp,suggestions:K.suggestions}))},ie=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),Q=URL.createObjectURL(ie),Z=document.createElement("a");Z.href=Q,Z.download=`ai-conversation-${q}-${new Date().toISOString().split("T")[0]}.json`,Z.click(),URL.revokeObjectURL(Q),C(null)},pe=v=>{v.key==="Enter"&&!v.shiftKey?(v.preventDefault(),Be()):v.key==="Escape"&&l&&et()},je=()=>!l||!h?null:e.jsxs(Dt,{sx:{flexDirection:"row",alignItems:"flex-start",mb:2},children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:"primary.main",mr:1},children:e.jsx(Rn,{})})}),e.jsx(g,{sx:{flex:1,maxWidth:"70%"},children:e.jsxs(He,{elevation:1,sx:{p:2,bgcolor:"grey.100",borderRadius:2,position:"relative"},children:[e.jsxs(d,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:[h,e.jsx(g,{component:"span",sx:{display:"inline-block",width:"8px",height:"16px",bgcolor:"primary.main",ml:.5,animation:"blink 1s infinite"}})]}),e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:1},children:[e.jsx(d,{variant:"caption",sx:{opacity:.7},children:"Streaming..."}),e.jsx(tt,{title:"Stop streaming",children:e.jsx(Ge,{size:"small",onClick:et,sx:{opacity:.7},children:e.jsx(ml,{fontSize:"small"})})})]})]})})]}),xe=v=>{const ie=v.type==="user",Q=I.has(v.id),Z=k[v.id];return e.jsxs(Dt,{ref:K=>{Y.current[v.id]=K},sx:{flexDirection:ie?"row-reverse":"row",alignItems:"flex-start",mb:2},children:[e.jsx(mr,{children:e.jsx(Mt,{sx:{bgcolor:ie?"secondary.main":"primary.main",ml:ie?1:0,mr:ie?0:1},children:ie?e.jsx(La,{}):e.jsx(Rn,{})})}),e.jsxs(g,{sx:{flex:1,maxWidth:"70%"},children:[e.jsxs(He,{elevation:1,sx:{p:2,bgcolor:ie?"primary.light":"grey.100",color:ie?"primary.contrastText":"text.primary",borderRadius:2,position:"relative",...v.isError&&{bgcolor:"error.light"},...Q&&{border:"2px solid",borderColor:"primary.main",bgcolor:ie?"primary.light":"primary.50"}},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-wrap",flex:1},children:v.content}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:.5,mt:.5},children:[Q&&e.jsx(nm,{sx:{fontSize:16,color:"primary.main"}}),Z==="thumbup"&&e.jsx(im,{sx:{fontSize:16,color:"success.main"}}),Z==="thumbdown"&&e.jsx(am,{sx:{fontSize:16,color:"error.main"}})]})]}),v.enhanced&&v.metadata&&e.jsx(g,{sx:{mt:1,pt:1,borderTop:"1px solid rgba(0,0,0,0.1)"},children:e.jsxs(d,{variant:"caption",sx:{opacity:.7},children:["Enhanced • ",v.metadata.model," •"," ",v.metadata.tokensUsed," tokens",v.metadata.cost&&` • $${v.metadata.cost.toFixed(4)}`]})}),e.jsxs(g,{sx:{display:"flex",justifyContent:ie?"flex-end":"space-between",alignItems:"center",mt:1},children:[e.jsx(d,{variant:"caption",sx:{opacity:.7},children:v.timestamp.toLocaleTimeString()}),!ie&&e.jsxs(Or,{direction:"row",spacing:.5,children:[e.jsx(tt,{title:"Copy message",children:e.jsx(Ge,{size:"small",onClick:()=>De("copy",v),sx:{opacity:.7},children:e.jsx(Pi,{fontSize:"small"})})}),e.jsx(tt,{title:"More actions",children:e.jsx(Ge,{size:"small",onClick:K=>{_(v.id),C(K.currentTarget)},sx:{opacity:.7},children:e.jsx(rm,{fontSize:"small"})})})]})]})]}),v.suggestions&&v.suggestions.length>0&&e.jsx(g,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:.5},children:(v.suggestions||[]).map(K=>e.jsx(X,{label:K,size:"small",variant:"outlined",clickable:!0,onClick:()=>Be(K),sx:{fontSize:"0.75rem","&:hover":{bgcolor:"primary.light",color:"primary.contrastText"}}},`suggestion-${v.id}-${K.replace(/[^a-zA-Z0-9]/g,"").slice(0,20)}`))})]})]},v.id)};return e.jsxs(lt,{maxWidth:"lg",children:[e.jsxs(g,{sx:{height:"100vh",display:"flex",flexDirection:"column",py:2},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ii,{color:ce?"success":"error",variant:"dot",sx:{mr:2},children:e.jsx(Mt,{sx:{bgcolor:"primary.main"},children:e.jsx(zS,{})})}),e.jsxs(g,{children:[e.jsx(d,{variant:"h5",fontWeight:"bold",children:"Enhanced AI Assistant"}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Real-time financial advisor with streaming responses",L&&ce&&" • Connected",L&&!ce&&" • Connecting..."]})]})]}),e.jsxs(Or,{direction:"row",spacing:1,children:[e.jsx(tt,{title:"Search conversation",children:e.jsx(Ge,{onClick:()=>M(!T),children:e.jsx(ar,{})})}),e.jsx(tt,{title:"Settings",children:e.jsx(Ge,{onClick:()=>b(!0),children:e.jsx(ao,{})})}),e.jsx(tt,{title:"More options",children:e.jsx(Ge,{onClick:v=>C(v.currentTarget),children:e.jsx(rm,{})})})]})]}),T&&e.jsx(He,{sx:{p:2,mb:2},children:e.jsx(_e,{fullWidth:!0,size:"small",placeholder:"Search conversation...",value:R,onChange:v=>ze(v.target.value),InputProps:{startAdornment:e.jsx(ar,{sx:{mr:1,opacity:.6}})}})}),e.jsx(y,{container:!0,spacing:2,sx:{mb:2},children:(ee||[]).map(v=>e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(z,{sx:{cursor:"pointer",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:6,bgcolor:`${v.color}.50`}},onClick:()=>Be(v.action),children:e.jsxs(U,{sx:{textAlign:"center",py:2},children:[e.jsx(g,{sx:{color:`${v.color}.main`,mb:1},children:v.icon}),e.jsx(d,{variant:"body2",fontWeight:"medium",children:v.text})]})})},`quickaction-${v.color||"unknown"}-${(v.text||"untitled").replace(/\s+/g,"")}`))}),e.jsxs(He,{elevation:2,sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(g,{sx:{flex:1,overflow:"auto",p:2},children:[e.jsxs(jr,{children:[(t||[]).map(xe),je()]}),(a||l)&&e.jsx(g,{sx:{display:"flex",justifyContent:"center",py:2},children:e.jsxs(Or,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Je,{size:24}),e.jsx(d,{variant:"body2",children:l?"AI is streaming response...":"AI is thinking..."}),l&&e.jsx(oe,{size:"small",onClick:et,startIcon:e.jsx(ml,{}),children:"Stop"})]})}),e.jsx("div",{ref:P})]}),e.jsx(Fe,{}),e.jsxs(g,{sx:{p:2},children:[e.jsxs(g,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[e.jsx(_e,{ref:D,fullWidth:!0,multiline:!0,maxRows:4,variant:"outlined",placeholder:"Ask me about investments, portfolio analysis, market trends, or any financial topic...",value:n,onChange:v=>i(v.target.value),onKeyPress:pe,disabled:a||l,size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:3}}}),e.jsx(tt,{title:l?"Stop streaming":"Send message",children:e.jsx("span",{children:e.jsx(Ge,{color:"primary",onClick:l?et:()=>Be(),disabled:!n.trim()&&!l||a,"aria-label":l?"Stop streaming":"Send message",sx:{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"grey.300"}},children:l?e.jsx(ml,{}):e.jsx(BS,{})})})})]}),e.jsxs(g,{sx:{mt:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(d,{variant:"caption",color:"text.secondary",children:["Model: ",he," • Style: ",G,L&&` • Streaming: ${ce?"Connected":"Disconnected"}`]}),L&&!ce&&e.jsx(X,{size:"small",label:"Reconnecting...",color:"warning",variant:"outlined"})]})]})]}),e.jsx(Px,{anchorEl:w,open:!!w,onClose:()=>C(null),children:A?(()=>{const v=t.find(Z=>Z.id===A),ie=I.has(A),Q=k[A];return[e.jsxs(J,{onClick:()=>De("bookmark",v),children:[e.jsx(nm,{sx:{mr:1,color:ie?"primary.main":"inherit"}}),ie?"Remove Bookmark":"Bookmark"]},"bookmark"),e.jsxs(J,{onClick:()=>De("share",v),children:[e.jsx(bx,{sx:{mr:1}}),"Share"]},"share"),e.jsxs(J,{onClick:()=>De("thumbup",v),children:[e.jsx(im,{sx:{mr:1,color:Q==="thumbup"?"success.main":"inherit"}}),"Helpful"]},"thumbup"),e.jsxs(J,{onClick:()=>De("thumbdown",v),children:[e.jsx(am,{sx:{mr:1,color:Q==="thumbdown"?"error.main":"inherit"}}),"Not Helpful"]},"thumbdown"),...v?.type==="user"?[e.jsxs(J,{onClick:()=>De("edit",v),children:[e.jsx(fc,{sx:{mr:1}}),"Edit Message"]},"edit")]:[],e.jsxs(J,{onClick:()=>De("reply",v),children:[e.jsx(US,{sx:{mr:1}}),"Reply"]},"reply")]})():[e.jsxs(J,{onClick:B,children:[e.jsx(Kr,{sx:{mr:1}}),"Export Conversation"]},"export"),e.jsxs(J,{onClick:ve,children:[e.jsx(mn,{sx:{mr:1}}),"Clear Chat"]},"clear"),e.jsxs(J,{onClick:()=>window.location.reload(),children:[e.jsx(Es,{sx:{mr:1}}),"Refresh"]},"refresh")]}),e.jsxs(Os,{open:x,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ls,{children:"Enhanced AI Assistant Settings"}),e.jsx(ks,{children:e.jsxs(g,{sx:{display:"flex",flexDirection:"column",gap:3,mt:1},children:[e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Streaming & Performance"}),e.jsx(Jt,{control:e.jsx(rs,{checked:L,onChange:v=>W(v.target.checked)}),label:"Enable Real-time Streaming"}),e.jsx(d,{variant:"body2",color:"text.secondary",sx:{ml:4},children:"Get responses as they're generated for faster interaction"})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"AI Model"}),e.jsxs(El,{variant:"outlined",size:"small",children:[e.jsx(oe,{variant:he==="claude-3-haiku"?"contained":"outlined",onClick:()=>re("claude-3-haiku"),children:"Claude 3 Haiku (Fast)"}),e.jsx(oe,{variant:he==="claude-3-sonnet"?"contained":"outlined",onClick:()=>re("claude-3-sonnet"),children:"Claude 3 Sonnet (Advanced)"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Response Style"}),e.jsxs(El,{variant:"outlined",size:"small",children:[e.jsx(oe,{variant:G==="concise"?"contained":"outlined",onClick:()=>H("concise"),children:"Concise"}),e.jsx(oe,{variant:G==="balanced"?"contained":"outlined",onClick:()=>H("balanced"),children:"Balanced"}),e.jsx(oe,{variant:G==="detailed"?"contained":"outlined",onClick:()=>H("detailed"),children:"Detailed"})]})]}),e.jsxs(g,{children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Interface"}),e.jsx(Jt,{control:e.jsx(rs,{checked:F,onChange:v=>$(v.target.checked)}),label:"Auto-generate Suggestions"})]}),e.jsxs(we,{severity:ce?"success":"warning",children:["WebSocket Status: ",ce?"Connected":"Disconnected",!ce&&" - Using HTTP fallback"]})]})}),e.jsx(Is,{children:e.jsx(oe,{onClick:()=>b(!1),children:"Close"})})]})]}),e.jsx("style",{children:`
        @keyframes blink {
          0%, 50% { opacity: 1; }
          51%, 100% { opacity: 0; }
        }
      `})]})},VN=()=>e.jsx(lt,{maxWidth:"xl",children:e.jsxs(g,{sx:{py:3},children:[e.jsxs(g,{sx:{mb:3},children:[e.jsx(d,{variant:"h4",component:"h1",gutterBottom:!0,children:"AI Assistant"}),e.jsx(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Your personal AI-powered investment assistant powered by Claude"})]}),e.jsx(He,{sx:{p:0,height:"calc(100vh - 280px)",minHeight:"600px",overflow:"hidden",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:e.jsx($N,{})}),e.jsx(g,{sx:{mt:2,textAlign:"center"},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Ask me anything about your portfolio, market analysis, investment strategies, or financial data. I can help with technical analysis, market insights, and personalized investment guidance."})})]})}),Ti=240,dx=[{text:"Dashboard",icon:e.jsx(GS,{}),path:"/dashboard",category:"main"},{text:"Market Overview",icon:e.jsx(at,{}),path:"/market",category:"markets"},{text:"Sector Analysis",icon:e.jsx(Ma,{}),path:"/sectors",category:"markets"},{text:"Economic Indicators",icon:e.jsx(Dl,{}),path:"/economic",category:"markets"},{text:"Stock Analysis",icon:e.jsx(Tr,{}),path:"/stocks",category:"stocks"},{text:"Technical Analysis",icon:e.jsx(Gt,{}),path:"/technical",category:"stocks"},{text:"Stock Scores",icon:e.jsx(th,{}),path:"/scores",category:"stocks",premium:!0},{text:"Earnings Hub",icon:e.jsx(px,{}),path:"/earnings",category:"stocks"},{text:"Trading Signals",icon:e.jsx(at,{}),path:"/trading-signals",category:"stocks"},{text:"Financial Data",icon:e.jsx(eh,{}),path:"/financial-data",category:"stocks"},{text:"Sentiment Analysis",icon:e.jsx(Rn,{}),path:"/stocks/sentiment",category:"stocks",premium:!0},{text:"Analyst Insights",icon:e.jsx(La,{}),path:"/sentiment/analysts",category:"stocks",premium:!0},{text:"Portfolio Holdings",icon:e.jsx(Fs,{}),path:"/portfolio",category:"portfolio"},{text:"Trade History",icon:e.jsx(Lt,{}),path:"/trade-history",category:"portfolio"},{text:"Order Management",icon:e.jsx(Gr,{}),path:"/orders",category:"portfolio"},{text:"Optimization Tools",icon:e.jsx(xr,{}),path:"/portfolio/optimize",category:"portfolio",premium:!0},{text:"Watchlist",icon:e.jsx(Lt,{}),path:"/watchlist",category:"tools"},{text:"Real-Time Data",icon:e.jsx(Gr,{}),path:"/realtime",category:"tools"},{text:"Settings",icon:e.jsx(ao,{}),path:"/settings",category:"tools"},{text:"Health",icon:e.jsx(KS,{}),path:"/service-health",category:"tools"},{text:"Backtester",icon:e.jsx(Gr,{}),path:"/backtest",category:"tools",premium:!0},{text:"AI Assistant",icon:e.jsx(Rn,{}),path:"/tools/ai",category:"tools",premium:!0}];function zN(){console.log("🎯 APP COMPONENT: Starting App component render...");const[r,t]=j.useState(!1),[s,n]=j.useState(!1),[i,a]=j.useState(null),[o,l]=j.useState({markets:!0,stocks:!0,sentiment:!1,portfolio:!0,research:!1,tools:!1});console.log("🎯 APP COMPONENT: State initialized");const c=Zs();console.log("🎯 APP COMPONENT: Theme loaded:",c?"✅":"❌");const h=fu(c.breakpoints.down("md"));console.log("🎯 APP COMPONENT: isMobile:",h),console.log("🎯 APP COMPONENT: About to call useAuth...");const{isAuthenticated:u,user:m,logout:p}=ps();console.log("🎯 APP COMPONENT: Auth state loaded - isAuthenticated:",u,"user:",m);const x=On();console.log("🎯 APP COMPONENT: Navigate loaded");const b=yc();console.log("🎯 APP COMPONENT: Location loaded:",b?.pathname),j.useEffect(()=>{u&&s&&n(!1)},[u,s]);const w=()=>{t(!r)},C=N=>{a(N.currentTarget)},A=()=>{a(null)},_=async()=>{A(),await p()},R=N=>{x(N==="/dashboard"&&!u?"/market":N),h&&t(!1)},E=N=>{l(k=>({...k,[N]:!k[N]}))},T=dx.filter(N=>!(N.path==="/dashboard"&&!u)).reduce((N,k)=>(N[k.category]||(N[k.category]=[]),N[k.category].push(k),N),{}),M={main:"Dashboard",markets:"Markets",stocks:"Stocks",sentiment:"Sentiment Analysis",portfolio:"Portfolio",research:"Research & Education",tools:"Tools"},I=e.jsxs("div",{children:[e.jsx(Jc,{children:e.jsx(d,{variant:"h6",noWrap:!0,component:"div",sx:{fontWeight:700,color:"primary.main"},children:"Financial Platform"})}),e.jsx(jr,{sx:{px:1},children:Object.entries(T).map(([N,k])=>e.jsx(gn.Fragment,{children:N==="main"?(k||[]).map(S=>e.jsx(Dt,{disablePadding:!0,sx:{mb:1},children:e.jsxs(ed,{selected:b.pathname===S.path,onClick:()=>R(S.path,S.premium),sx:{borderRadius:1,"&.Mui-selected":{backgroundColor:c.palette.primary.main+"20","& .MuiListItemIcon-root":{color:c.palette.primary.main},"& .MuiListItemText-primary":{color:c.palette.primary.main,fontWeight:600}}},children:[e.jsx(Sr,{children:S.icon}),e.jsx(Ut,{primary:S.text})]})},S.text)):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{disablePadding:!0,children:e.jsxs(ed,{onClick:()=>E(N),"aria-label":`${o[N]?"Collapse":"Expand"} ${M[N]} section`,sx:{py:.5,"&:hover":{backgroundColor:"transparent"}},children:[e.jsx(Ut,{primary:M[N],primaryTypographyProps:{variant:"subtitle2",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:.5}}),o[N]?e.jsx(vx,{}):e.jsx(Vt,{})]})}),o[N]&&(k||[]).map(S=>e.jsx(Dt,{disablePadding:!0,sx:{pl:2},children:e.jsxs(ed,{selected:b.pathname===S.path,onClick:()=>R(S.path,S.premium),disabled:!1,sx:{borderRadius:1,py:.5,"&.Mui-selected":{backgroundColor:c.palette.primary.main+"20","& .MuiListItemIcon-root":{color:c.palette.primary.main},"& .MuiListItemText-primary":{color:c.palette.primary.main,fontWeight:600}},"&.Mui-disabled":{opacity:.6}},children:[e.jsx(Sr,{sx:{minWidth:36},children:S.icon}),e.jsx(Ut,{primary:S.text,primaryTypographyProps:{variant:"body2"}})]})},S.text))]})},N))})]});return console.log("🎯 APP COMPONENT: About to render JSX..."),e.jsx(Fl,{children:e.jsxs(g,{sx:{display:"flex",width:"100%",overflowX:"hidden"},children:[e.jsx(QS,{position:"fixed",sx:{width:{md:`calc(100% - ${Ti}px)`},ml:{md:`${Ti}px`},backgroundColor:"white",color:"text.primary",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:e.jsxs(Jc,{children:[e.jsx(Ge,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:w,sx:{mr:2,display:{md:"none"}},children:e.jsx(qS,{})}),e.jsx(d,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,mr:2,pointerEvents:"none"},children:dx.find(N=>N.path===b.pathname)?.text||"Dashboard"}),u?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{onClick:C,size:"large",edge:"end",color:"inherit",children:e.jsx(Mt,{sx:{width:32,height:32,bgcolor:"primary.main"},children:m?.username?.[0]?.toUpperCase()||"U"})}),e.jsxs(Px,{anchorEl:i,open:!!i,onClose:A,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(J,{onClick:A,children:[e.jsx(Tx,{sx:{mr:1}}),m?.username||"User"]}),e.jsx(Fe,{}),e.jsxs(J,{onClick:()=>{A(),x("/settings")},children:[e.jsx(ao,{sx:{mr:1}}),"Settings"]}),e.jsxs(J,{onClick:_,children:[e.jsx(HS,{sx:{mr:1}}),"Sign Out"]})]})]}):e.jsx(oe,{color:"inherit",startIcon:e.jsx(sh,{}),onClick:()=>n(!0),sx:{ml:2,zIndex:1e3,position:"relative",flexShrink:0},"data-testid":"auth-sign-in-button",children:"Sign In"})]})}),e.jsxs(g,{component:"nav",sx:{width:{md:Ti},flexShrink:{md:0}},children:[e.jsx(om,{variant:"temporary",open:r,onClose:w,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",md:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Ti}},children:I}),e.jsx(om,{variant:"permanent",sx:{display:{xs:"none",md:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Ti}},open:!0,children:I})]}),e.jsxs(g,{component:"main",sx:{flexGrow:1,p:{xs:1,sm:2,md:3},width:{xs:"100%",md:`calc(100% - ${Ti}px)`},backgroundColor:c.palette.background.default,minHeight:"100vh",overflowX:"hidden"},children:[e.jsx(Jc,{}),e.jsx(lt,{maxWidth:"xl",sx:{px:{xs:1,sm:2,md:3}},children:e.jsxs(W1,{children:[e.jsx(Ct,{path:"/",element:e.jsx(RN,{})}),e.jsx(Ct,{path:"/dashboard",element:e.jsx(Ai,{children:e.jsx(nC,{})})}),e.jsx(Ct,{path:"/realtime",element:e.jsx(Ai,{children:e.jsx(FN,{})})}),e.jsx(Ct,{path:"/portfolio",element:e.jsx(Ai,{children:e.jsx(PR,{})})}),e.jsx(Ct,{path:"/trade-history",element:e.jsx(Ai,{children:e.jsx(fN,{})})}),e.jsx(Ct,{path:"/orders",element:e.jsx(Ai,{children:e.jsx(mN,{})})}),e.jsx(Ct,{path:"/portfolio/optimize",element:e.jsx(_R,{})}),e.jsx(Ct,{path:"/market",element:e.jsx(Xj,{})}),e.jsx(Ct,{path:"/scores",element:e.jsx(CN,{})}),e.jsx(Ct,{path:"/economic",element:e.jsx(bN,{})}),e.jsx(Ct,{path:"/metrics",element:e.jsx(bC,{})}),e.jsx(Ct,{path:"/stocks",element:e.jsx(dd,{})}),e.jsx(Ct,{path:"/stock-explorer",element:e.jsx(dd,{})}),e.jsx(Ct,{path:"/stocks/:ticker",element:e.jsx(jC,{})}),e.jsx(Ct,{path:"/screener",element:e.jsx(dd,{})}),e.jsx(Ct,{path:"/trading",element:e.jsx(qg,{})}),e.jsx(Ct,{path:"/trading-signals",element:e.jsx(qg,{})}),e.jsx(Ct,{path:"/technical",element:e.jsx(Lm,{})}),e.jsx(Ct,{path:"/technical-analysis",element:e.jsx(Lm,{})}),e.jsx(Ct,{path:"/earnings",element:e.jsx(SC,{})}),e.jsx(Ct,{path:"/backtest",element:e.jsx(SR,{})}),e.jsx(Ct,{path:"/financial-data",element:e.jsx(OC,{})}),e.jsx(Ct,{path:"/service-health",element:e.jsx(kC,{})}),e.jsx(Ct,{path:"/settings",element:e.jsx(Ai,{children:e.jsx(vN,{})})}),e.jsx(Ct,{path:"/auth-test",element:e.jsx(NN,{})}),e.jsx(Ct,{path:"/technical-history/:symbol",element:e.jsx(CC,{})}),e.jsx(Ct,{path:"/sectors",element:e.jsx(LN,{})}),e.jsx(Ct,{path:"/watchlist",element:e.jsx(MN,{})}),e.jsx(Ct,{path:"/stocks/sentiment",element:e.jsx(yN,{})}),e.jsx(Ct,{path:"/sentiment/analysts",element:e.jsx(jN,{})}),e.jsx(Ct,{path:"/tools/ai",element:e.jsx(VN,{})})]})})]}),e.jsx(DN,{open:s,onClose:()=>n(!1)})]})})}const Tn=Qn("Main");window.addEventListener("error",function(r){const t={filename:r.filename,lineno:r.lineno,colno:r.colno,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString()};return Tn.error("WindowError",r.error||new Error(r.message),t),!1},!0);window.addEventListener("unhandledrejection",function(r){const t={url:window.location.href,timestamp:new Date().toISOString(),promiseState:"rejected"};return Tn.error("UnhandledPromiseRejection",r.reason,t),!1});"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(r){for(let t of r)t.unregister().then(function(s){})}).catch(function(r){console.error("Service Worker unregistration failed:",r)});"caches"in window&&caches.keys().then(function(r){return Promise.all((r||[]).map(function(t){return caches.delete(t)}))}).then(function(){}).catch(function(r){console.error("Cache clearing failed:",r)});window.__CONFIG__||setTimeout(()=>{},1e3);Fk();const BN=YS({palette:{mode:"light",primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#dc004e",light:"#ff5983",dark:"#9a0036"},background:{default:"#f5f5f5",paper:"#ffffff"},success:{main:"#2e7d32",light:"#4caf50",dark:"#1b5e20"},error:{main:"#d32f2f",light:"#ef5350",dark:"#c62828"},warning:{main:"#b7700d",light:"#d4951a",dark:"#8a5409"},info:{main:"#0277bd",light:"#29b6f6",dark:"#01579b"}},typography:{fontFamily:'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif',h1:{fontWeight:600},h2:{fontWeight:600},h3:{fontWeight:600},h4:{fontWeight:600},h5:{fontWeight:600},h6:{fontWeight:600}},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:500,minWidth:"44px",minHeight:"44px","&:focus":{outline:"3px solid #1976d2",outlineOffset:"2px",boxShadow:"0 0 0 3px rgba(25, 118, 210, 0.3)"},"&:focus-visible":{outline:"3px solid #1976d2",outlineOffset:"2px",boxShadow:"0 0 0 3px rgba(25, 118, 210, 0.3)"}}}},MuiIconButton:{styleOverrides:{root:{minWidth:"44px",minHeight:"44px","&:focus":{outline:"3px solid #1976d2",outlineOffset:"2px",boxShadow:"0 0 0 3px rgba(25, 118, 210, 0.3)"},"&:focus-visible":{outline:"3px solid #1976d2",outlineOffset:"2px",boxShadow:"0 0 0 3px rgba(25, 118, 210, 0.3)"}}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{"&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"#1976d2",borderWidth:"2px"}},"&:focus-within":{outline:"3px solid rgba(25, 118, 210, 0.3)",outlineOffset:"2px"}}}}},MuiCard:{styleOverrides:{root:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)",borderRadius:12}}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}},MuiChip:{styleOverrides:{root:{minHeight:"32px","& .MuiChip-label":{paddingLeft:"12px",paddingRight:"12px"}}}}}}),UN=new mk({defaultOptions:{queries:{staleTime:300*1e3,cacheTime:600*1e3,refetchOnWindowFocus:!1,retry:(r,t)=>t.status===404?!1:r<3}}}),QN=document.getElementById("root");QN||(console.error("❌ Root element not found!"),alert("Root element not found!"));try{Tn.info("React application initialization starting");const r=document.getElementById("root");if(!r)throw new Error("Root element not found in DOM");const t=HO.createRoot(r);Tn.info("React root created successfully"),t.render(e.jsx(Fl,{children:e.jsx(B1,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(gk,{client:UN,children:e.jsxs(XS,{theme:BN,children:[e.jsx(ZS,{}),e.jsx(Bk,{children:e.jsx(zN,{})})]})})})})),Tn.success("React application render initiated"),setTimeout(()=>{const s=document.getElementById("root");s&&s.innerHTML.trim()===""?Tn.error("EmptyRender",new Error("React rendered but root is empty"),{innerHTML:s.innerHTML,config:window.__CONFIG__,timestamp:new Date().toISOString()}):s&&Tn.success("React application rendered successfully",{contentLength:s.innerHTML.length,hasContent:s.innerHTML.length>0})},2e3)}catch(r){Tn.error("ReactInitialization",r,{phase:"main_render",config:window.__CONFIG__,userAgent:navigator.userAgent}),alert("Application failed to start. Please refresh the page or contact support.")}
//# sourceMappingURL=index-B5AFjStg.js.map
